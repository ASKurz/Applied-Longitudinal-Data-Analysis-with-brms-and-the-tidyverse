<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Treating Time More Flexibly | Applied longitudinal data analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Treating Time More Flexibly | Applied longitudinal data analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="github-repo" content="ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Treating Time More Flexibly | Applied longitudinal data analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2021-04-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="doing-data-analysis-with-the-multilevel-model-for-change.html"/>
<link rel="next" href="modeling-discontinuous-and-nonlinear-change.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li><a href="index.html#r-setup"><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html"><i class="fa fa-check"></i><b>1</b> A Framework for Investigating Change over Time</a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#when-might-you-study-change-over-time"><i class="fa fa-check"></i><b>1.1</b> When might you study change over time?</a></li>
<li class="chapter" data-level="1.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#distinguishing-between-two-types-of-questions-about-change"><i class="fa fa-check"></i><b>1.2</b> Distinguishing between two types of questions about change</a></li>
<li class="chapter" data-level="1.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#three-important-features-of-a-study-of-change"><i class="fa fa-check"></i><b>1.3</b> Three important features of a study of change</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#multiple-waves-of-data."><i class="fa fa-check"></i><b>1.3.1</b> Multiple waves of data.</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-sensible-metric-for-time."><i class="fa fa-check"></i><b>1.3.2</b> A sensible metric for time.</a></li>
<li class="chapter" data-level="1.3.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-continuous-outcome-that-changes-systematically-over-time."><i class="fa fa-check"></i><b>1.3.3</b> A continuous outcome that changes systematically over time.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html"><i class="fa fa-check"></i><b>2</b> Exploring Longitudinal Data on Change</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#creating-a-longitudinal-data-set"><i class="fa fa-check"></i><b>2.1</b> Creating a longitudinal data set</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-level-data-set."><i class="fa fa-check"></i><b>2.1.1</b> The person-level data set.</a></li>
<li class="chapter" data-level="2.1.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-period-data-set."><i class="fa fa-check"></i><b>2.1.2</b> The person-period data set.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#descriptive-analysis-of-individual-change-over-time"><i class="fa fa-check"></i><b>2.2</b> Descriptive analysis of individual change over time</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#empirical-growth-plots."><i class="fa fa-check"></i><b>2.2.1</b> Empirical growth plots.</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-a-trajectory-to-summarize-each-persons-empirical-growth-record."><i class="fa fa-check"></i><b>2.2.2</b> Using a trajectory to summarize each person’s empirical growth record.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-differences-in-change-across-people"><i class="fa fa-check"></i><b>2.3</b> Exploring differences in change across people</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#examining-the-entire-set-of-smooth-trajectories."><i class="fa fa-check"></i><b>2.3.1</b> Examining the entire set of smooth trajectories.</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-the-results-of-model-fitting-to-frame-questions-about-change."><i class="fa fa-check"></i><b>2.3.2</b> Using the results of model fitting to frame questions about change.</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-the-relationship-between-change-and-time-invariant-predictors."><i class="fa fa-check"></i><b>2.3.3</b> Exploring the relationship between change and time-invariant predictors.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#improving-the-precision-and-reliability-of-ols-single-level-bayesian-estimated-rates-of-change-lessons-for-research-design"><i class="fa fa-check"></i><b>2.4</b> Improving the precision and reliability of <del>OLS</del> single-level-Bayesian-estimated rates of change: Lessons for research design</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>3</b> Introducing the Multilevel Model for Change</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#what-is-the-purpose-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>3.1</b> What is the purpose of the multilevel model for change?</a></li>
<li class="chapter" data-level="3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-1-submodel-for-individual-change"><i class="fa fa-check"></i><b>3.2</b> The level-1 submodel for individual change</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-structural-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.1</b> The structural part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-stochastic-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.2</b> The stochastic part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#relating-the-level-1-submodel-to-the-ols-exploratory-methods-of-chapter-2."><i class="fa fa-check"></i><b>3.2.3</b> Relating the level-1 submodel to the OLS exploratory methods of chapter 2.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-2-submodel-for-systematic-interindividual-differences-in-change"><i class="fa fa-check"></i><b>3.3</b> The level-2 submodel for systematic interindividual differences in change</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#structural-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.1</b> Structural components of the level-2 submodel.</a></li>
<li class="chapter" data-level="3.3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#stochastic-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.2</b> Stochastic components of the level-2 submodel.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#fitting-the-multilevel-model-for-change-to-data"><i class="fa fa-check"></i><b>3.4</b> Fitting the multilevel model for change to data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-advantages-of-maximum-likelihood-bayesian-estimation."><i class="fa fa-check"></i><b>3.4.1</b> The advantages of <del>maximum likelihood</del> Bayesian estimation.</a></li>
<li class="chapter" data-level="3.4.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#using-maximum-likelihood-modern-bayesian-methods-to-fit-a-multilevel-model."><i class="fa fa-check"></i><b>3.4.2</b> Using <del>maximum likelihood</del> modern Bayesian methods to fit a multilevel model.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-fixed-effects"><i class="fa fa-check"></i><b>3.5</b> Examining estimated fixed effects</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-estimated-fixed-effects."><i class="fa fa-check"></i><b>3.5.1</b> Interpreting estimated fixed effects.</a></li>
<li class="chapter" data-level="3.5.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-fixed-effects."><i class="fa fa-check"></i><b>3.5.2</b> Single parameter tests for the fixed effects.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-variance-components"><i class="fa fa-check"></i><b>3.6</b> Examining estimated variance components</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-the-estimated-variance-components."><i class="fa fa-check"></i><b>3.6.1</b> Interpreting the estimated variance components.</a></li>
<li class="chapter" data-level="3.6.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-variance-components."><i class="fa fa-check"></i><b>3.6.2</b> Single parameter tests for the variance components.</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#bonus-how-did-you-simulate-that-data"><i class="fa fa-check"></i><b>3.7</b> Bonus: How did you simulate that data?</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>4</b> Doing Data Analysis with the Multilevel Model for Change</a>
<ul>
<li class="chapter" data-level="4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#example-changes-in-adolescent-alcohol-use"><i class="fa fa-check"></i><b>4.1</b> Example: Changes in adolescent alcohol use</a></li>
<li class="chapter" data-level="4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-composite-specification-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>4.2</b> The composite specification of the multilevel model for change</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-structural-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.1</b> The structural component of the composite model.</a></li>
<li class="chapter" data-level="4.2.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-stochastic-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.2</b> The stochastic component of the composite model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#methods-of-estimation-revisited"><i class="fa fa-check"></i><b>4.3</b> Methods of estimation, revisited</a></li>
<li class="chapter" data-level="4.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#first-steps-fitting-two-unconditional-multilevel-models-for-change"><i class="fa fa-check"></i><b>4.4</b> First steps: Fitting two unconditional multilevel models for change</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-means-model."><i class="fa fa-check"></i><b>4.4.1</b> The unconditional means model.</a></li>
<li class="chapter" data-level="4.4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-growth-model."><i class="fa fa-check"></i><b>4.4.2</b> The unconditional growth model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#quantifying-the-proportion-of-outcome-variation-explained."><i class="fa fa-check"></i><b>4.4.3</b> Quantifying the proportion of outcome variation “explained.”</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#practical-data-analytic-strategies-for-model-building"><i class="fa fa-check"></i><b>4.5</b> Practical data analytic strategies for model building</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#a-taxonomy-of-statistical-models."><i class="fa fa-check"></i><b>4.5.1</b> A taxonomy of statistical models.</a></li>
<li class="chapter" data-level="4.5.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#interpreting-fitted-models."><i class="fa fa-check"></i><b>4.5.2</b> Interpreting fitted models.</a></li>
<li class="chapter" data-level="4.5.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#displaying-prototypical-change-trajectories."><i class="fa fa-check"></i><b>4.5.3</b> Displaying prototypical change trajectories.</a></li>
<li class="chapter" data-level="4.5.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#recentering-predictors-to-improve-interpretation."><i class="fa fa-check"></i><b>4.5.4</b> Recentering predictors to improve interpretation.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#comparing-models-using-deviance-statistics"><i class="fa fa-check"></i><b>4.6</b> Comparing models using deviance statistics</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-deviance-statistic."><i class="fa fa-check"></i><b>4.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="4.6.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#when-and-how-can-you-compare-deviance-statistics"><i class="fa fa-check"></i><b>4.6.2</b> When and how can you compare deviance statistics?</a></li>
<li class="chapter" data-level="4.6.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#implementing-deviance-based-hypothesis-tests."><i class="fa fa-check"></i><b>4.6.3</b> Implementing deviance-based hypothesis tests.</a></li>
<li class="chapter" data-level="4.6.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#aic-and-bic-waic-and-loo-statistics-comparing-nonnested-models-using-information-criteria-and-cross-validation."><i class="fa fa-check"></i><b>4.6.4</b> <del>AIC and BIC</del> WAIC and LOO statistics: Comparing nonnested models using information criteria [and cross validation].</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#using-wald-statistics-to-test-composite-hypotheses-about-fixed-effects"><i class="fa fa-check"></i><b>4.7</b> Using Wald statistics to test composite hypotheses about fixed effects</a></li>
<li class="chapter" data-level="4.8" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#evaluating-the-tenability-of-a-models-assumptions"><i class="fa fa-check"></i><b>4.8</b> Evaluating the tenability of a model’s assumptions</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-functional-form."><i class="fa fa-check"></i><b>4.8.1</b> Checking functional form.</a></li>
<li class="chapter" data-level="4.8.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-normality."><i class="fa fa-check"></i><b>4.8.2</b> Checking normality.</a></li>
<li class="chapter" data-level="4.8.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-homoscedasticity."><i class="fa fa-check"></i><b>4.8.3</b> Checking homoscedasticity.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#model-based-empirical-bayes-estimates-of-the-individual-growth-parameters"><i class="fa fa-check"></i><b>4.9</b> Model-based (Empirical Bayes) estimates of the individual growth parameters</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html"><i class="fa fa-check"></i><b>5</b> Treating Time More Flexibly</a>
<ul>
<li class="chapter" data-level="5.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#variably-spaced-measurement-occasions"><i class="fa fa-check"></i><b>5.1</b> Variably spaced measurement occasions</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#the-structure-of-variably-spaced-data-sets."><i class="fa fa-check"></i><b>5.1.1</b> The structure of variably spaced data sets.</a></li>
<li class="chapter" data-level="5.1.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#postulating-and-fitting-multilevel-models-with-variably-spaced-waves-of-data."><i class="fa fa-check"></i><b>5.1.2</b> Postulating and fitting multilevel models with variably spaced waves of data.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#varying-numbers-of-measurement-occasions"><i class="fa fa-check"></i><b>5.2</b> Varying numbers of measurement occasions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#analyzing-data-sets-in-which-the-number-of-waves-per-person-varies."><i class="fa fa-check"></i><b>5.2.1</b> Analyzing data sets in which the number of waves per person varies.</a></li>
<li class="chapter" data-level="5.2.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#practical-problems-that-may-arise-when-analyzing-unbalanced-data-sets."><i class="fa fa-check"></i><b>5.2.2</b> Practical problems that may arise when analyzing unbalanced data sets.</a></li>
<li class="chapter" data-level="5.2.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#distinguishing-among-different-types-of-missingness."><i class="fa fa-check"></i><b>5.2.3</b> Distinguishing among different types of missingness.</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#time-varying-predictors"><i class="fa fa-check"></i><b>5.3</b> Time-varying predictors</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#including-the-main-effect-of-a-time-varying-predictor."><i class="fa fa-check"></i><b>5.3.1</b> Including the main effect of a time-varying predictor.</a></li>
<li class="chapter" data-level="5.3.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#allowing-the-effect-of-a-time-varying-predictor-to-vary-over-time."><i class="fa fa-check"></i><b>5.3.2</b> Allowing the effect of a time-varying predictor to vary over time.</a></li>
<li class="chapter" data-level="5.3.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-time-varying-predictors."><i class="fa fa-check"></i><b>5.3.3</b> Recentering time-varying predictors.</a></li>
<li class="chapter" data-level="5.3.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#an-important-caveat-the-problem-of-reciprocal-causation."><i class="fa fa-check"></i><b>5.3.4</b> An important caveat: The problem of reciprocal causation.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-the-effect-of-time"><i class="fa fa-check"></i><b>5.4</b> Recentering the effect of <em>TIME</em></a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html"><i class="fa fa-check"></i><b>6</b> Modeling Discontinuous and Nonlinear Change</a>
<ul>
<li class="chapter" data-level="6.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#discontinuous-individual-change"><i class="fa fa-check"></i><b>6.1</b> Discontinuous individual change</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#alternative-discontinuous-level-1-models-for-change."><i class="fa fa-check"></i><b>6.1.1</b> Alternative discontinuous level-1 models for change.</a></li>
<li class="chapter" data-level="6.1.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#selecting-among-the-alternative-discontinuous-models."><i class="fa fa-check"></i><b>6.1.2</b> Selecting among the alternative discontinuous models.</a></li>
<li class="chapter" data-level="6.1.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#further-extensions-of-the-discontinuous-growth-model."><i class="fa fa-check"></i><b>6.1.3</b> Further extensions of the discontinuous growth model.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#using-transformations-to-model-nonlinear-individual-change"><i class="fa fa-check"></i><b>6.2</b> Using transformations to model nonlinear individual change</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#the-ladder-of-transformations-and-the-rule-of-the-bulge."><i class="fa fa-check"></i><b>6.2.1</b> The ladder of transformations and the rule of the bulge.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#representing-individual-change-using-a-polynomial-function-of-time"><i class="fa fa-check"></i><b>6.3</b> Representing individual change using a polynomial function of TIME</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#the-shapes-of-polynomial-individual-change-trajectories."><i class="fa fa-check"></i><b>6.3.1</b> The shapes of polynomial individual change trajectories.</a></li>
<li class="chapter" data-level="6.3.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#selecting-a-suitable-level-1-polynomial-trajectory-for-change."><i class="fa fa-check"></i><b>6.3.2</b> Selecting a suitable level-1 polynomial trajectory for change.</a></li>
<li class="chapter" data-level="6.3.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#testing-higher-order-terms-in-a-polynomial-level-1-model."><i class="fa fa-check"></i><b>6.3.3</b> Testing higher order terms in a polynomial level-1 model.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#truly-nonlinear-trajectories"><i class="fa fa-check"></i><b>6.4</b> Truly nonlinear trajectories</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#what-do-we-mean-by-truly-nonlinear-models"><i class="fa fa-check"></i><b>6.4.1</b> What do we mean by truly nonlinear models?</a></li>
<li class="chapter" data-level="6.4.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#the-logistic-individual-growth-curve."><i class="fa fa-check"></i><b>6.4.2</b> The logistic individual growth curve.</a></li>
<li class="chapter" data-level="6.4.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#a-survey-of-truly-nonlinear-change-trajectories."><i class="fa fa-check"></i><b>6.4.3</b> A survey of truly nonlinear change trajectories.</a></li>
<li class="chapter" data-level="6.4.4" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#from-substantive-theory-to-mathematical-representations-of-individual-growth."><i class="fa fa-check"></i><b>6.4.4</b> From substantive theory to mathematical representations of individual growth.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#bonus-the-logistic-growth-model"><i class="fa fa-check"></i><b>6.5</b> Bonus: The logistic growth model</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#we-need-data."><i class="fa fa-check"></i><b>6.5.1</b> We need data.</a></li>
<li class="chapter" data-level="6.5.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#have-you-heard-of-the-generalized-linear-mixed-model"><i class="fa fa-check"></i><b>6.5.2</b> Have you heard of the generalized linear [mixed] model?</a></li>
<li class="chapter" data-level="6.5.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#define-the-simple-logistic-multilevel-growth-model."><i class="fa fa-check"></i><b>6.5.3</b> Define the simple logistic multilevel growth model.</a></li>
<li class="chapter" data-level="6.5.4" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#ease-into-the-model-with-a-prior-predictive-check."><i class="fa fa-check"></i><b>6.5.4</b> Ease into the model with a prior predictive check.</a></li>
<li class="chapter" data-level="6.5.5" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#you-may-want-more."><i class="fa fa-check"></i><b>6.5.5</b> You may want more.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html"><i class="fa fa-check"></i><b>7</b> Examining the Multilevel Model’s Error Covariance Structure</a>
<ul>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html"><i class="fa fa-check"></i><b>8</b> Modeling Change Using Covariance Structure Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html"><i class="fa fa-check"></i><b>9</b> A Framework for Investigating Event Occurrence</a>
<ul>
<li class="chapter" data-level="9.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#should-you-conduct-a-survival-analysis-the-whether-and-when-test"><i class="fa fa-check"></i><b>9.1</b> Should you conduct a survival analysis? The “whether” and “when” test</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#time-to-relapse-among-recently-treated-alcoholics."><i class="fa fa-check"></i><b>9.1.1</b> Time to relapse among recently treated alcoholics.</a></li>
<li class="chapter" data-level="9.1.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#length-of-stay-in-teaching."><i class="fa fa-check"></i><b>9.1.2</b> Length of stay in teaching.</a></li>
<li class="chapter" data-level="9.1.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#age-at-first-suicide-ideation."><i class="fa fa-check"></i><b>9.1.3</b> Age at first suicide ideation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#framing-a-research-question-about-event-occurrence"><i class="fa fa-check"></i><b>9.2</b> Framing a research question about event occurrence</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#defining-event-occurrence."><i class="fa fa-check"></i><b>9.2.1</b> Defining event occurrence.</a></li>
<li class="chapter" data-level="9.2.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#identifying-the-beginning-of-time."><i class="fa fa-check"></i><b>9.2.2</b> Identifying the “beginning of time.”</a></li>
<li class="chapter" data-level="9.2.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#specifying-a-metric-for-time."><i class="fa fa-check"></i><b>9.2.3</b> Specifying a metric for time.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#censoring-how-complete-are-the-data-on-event-occurrence"><i class="fa fa-check"></i><b>9.3</b> Censoring: How complete are the data on event occurrence?</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-and-why-does-censoring-arise"><i class="fa fa-check"></i><b>9.3.1</b> How and why does censoring arise?</a></li>
<li class="chapter" data-level="9.3.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#different-types-of-censoring."><i class="fa fa-check"></i><b>9.3.2</b> Different types of censoring.</a></li>
<li class="chapter" data-level="9.3.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-does-censoring-affect-statistical-analysis"><i class="fa fa-check"></i><b>9.3.3</b> How does censoring affect statistical analysis?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html"><i class="fa fa-check"></i><b>10</b> Describing Discrete-Time Event Occurrence Data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-life-table"><i class="fa fa-check"></i><b>10.1</b> The life table</a></li>
<li class="chapter" data-level="10.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data"><i class="fa fa-check"></i><b>10.2</b> A framework for characterizing the distribution of discrete-time event occurrence data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-function."><i class="fa fa-check"></i><b>10.2.1</b> Survivor function.</a></li>
<li class="chapter" data-level="10.2.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#median-lifetime."><i class="fa fa-check"></i><b>10.2.2</b> Median lifetime.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes"><i class="fa fa-check"></i><b>10.3</b> Developing intuition about hazard functions, survivor functions, and median lifetimes</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#identifying-periods-of-high-and-low-risk-using-hazard-functions."><i class="fa fa-check"></i><b>10.3.1</b> Identifying periods of high and low risk using hazard functions.</a></li>
<li class="chapter" data-level="10.3.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard."><i class="fa fa-check"></i><b>10.3.2</b> Survivor functions as a context for evaluating the magnitude of hazard.</a></li>
<li class="chapter" data-level="10.3.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#strengths-and-limitations-of-estimated-median-lifetimes."><i class="fa fa-check"></i><b>10.3.3</b> Strengths and limitations of estimated median lifetimes.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#quantifying-the-effects-of-sampling-variation"><i class="fa fa-check"></i><b>10.4</b> Quantifying the effects of sampling variation</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-standard-error-of-the-estimated-hazard-probabilities."><i class="fa fa-check"></i><b>10.4.1</b> The standard error of the estimated hazard probabilities.</a></li>
<li class="chapter" data-level="10.4.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#standard-error-of-the-estimated-survival-probabilities."><i class="fa fa-check"></i><b>10.4.2</b> Standard error of the estimated survival probabilities.</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-simple-and-useful-strategy-for-constructing-the-life-table"><i class="fa fa-check"></i><b>10.5</b> A simple and useful strategy for constructing the life table</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-person-period-data-set.-1"><i class="fa fa-check"></i><b>10.5.1</b> The person-period data set.</a></li>
<li class="chapter" data-level="10.5.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#using-the-person-period-data-set-to-construct-the-life-table."><i class="fa fa-check"></i><b>10.5.2</b> Using the person-period data set to construct the life table.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#bonus-fit-the-discrete-time-hazard-models-with-brms"><i class="fa fa-check"></i><b>10.6</b> Bonus: Fit the discrete-time hazard models with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html"><i class="fa fa-check"></i><b>11</b> Fitting Basic Discrete-Time Hazard Models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#toward-a-statistical-model-for-discrete-time-hazard"><i class="fa fa-check"></i><b>11.1</b> Toward a statistical model for discrete-time hazard</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#plots-of-within-group-hazard-functions-and-survivor-functions."><i class="fa fa-check"></i><b>11.1.1</b> Plots of within-group hazard functions and survivor functions.</a></li>
<li class="chapter" data-level="11.1.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-kind-of-statistical-model-do-these-graphs-suggest"><i class="fa fa-check"></i><b>11.1.2</b> What kind of statistical model do these graphs suggest?</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#formal-representation-of-the-population-discrete-time-hazard-model"><i class="fa fa-check"></i><b>11.2</b> Formal representation of the population discrete-time hazard model</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-do-the-parameters-represent"><i class="fa fa-check"></i><b>11.2.1</b> What do the parameters represent?</a></li>
<li class="chapter" data-level="11.2.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#an-alternative-representation-of-the-model."><i class="fa fa-check"></i><b>11.2.2</b> An alternative representation of the model.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-a-discrete-time-hazard-model-to-data"><i class="fa fa-check"></i><b>11.3</b> Fitting a discrete-time hazard model to data</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#adding-predictors-to-the-person-period-data-set."><i class="fa fa-check"></i><b>11.3.1</b> Adding predictors to the person-period data set.</a></li>
<li class="chapter" data-level="11.3.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model."><i class="fa fa-check"></i><b>11.3.2</b> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model.</a></li>
<li class="chapter" data-level="11.3.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-the-discrete-time-hazard-model-to-data."><i class="fa fa-check"></i><b>11.3.3</b> Fitting the discrete-time hazard model to data.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#interpreting-parameter-estimates"><i class="fa fa-check"></i><b>11.4</b> Interpreting parameter estimates</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-time-indicators."><i class="fa fa-check"></i><b>11.4.1</b> The time indicators.</a></li>
<li class="chapter" data-level="11.4.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#dichotomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.2</b> Dichotomous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#continuous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.3</b> Continuous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#polytomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.4</b> Polytomous substantive predictors.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#displaying-fitted-hazard-and-survivor-functions"><i class="fa fa-check"></i><b>11.5</b> Displaying fitted hazard and survivor functions</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#a-strategy-for-a-single-categorical-substantive-predictor."><i class="fa fa-check"></i><b>11.5.1</b> A strategy for a single categorical substantive predictor.</a></li>
<li class="chapter" data-level="11.5.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous."><i class="fa fa-check"></i><b>11.5.2</b> Extending this strategy to multiple predictors (some of which are continuous).</a></li>
<li class="chapter" data-level="11.5.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#two-cautions-when-interpreting-fitted-hazard-and-survivor-functions."><i class="fa fa-check"></i><b>11.5.3</b> Two cautions when interpreting fitted hazard and survivor functions.</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-models-using-deviance-statistics-and-information-criteria"><i class="fa fa-check"></i><b>11.6</b> Comparing models using <del>deviance statistics and</del> information criteria</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-deviance-statistic.-1"><i class="fa fa-check"></i><b>11.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="11.6.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-individual-predictors."><i class="fa fa-check"></i><b>11.6.2</b> Deviance-based hypothesis tests for individual predictors.</a></li>
<li class="chapter" data-level="11.6.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-groups-of-predictors."><i class="fa fa-check"></i><b>11.6.3</b> Deviance-based hypothesis tests for groups of predictors.</a></li>
<li class="chapter" data-level="11.6.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-nonnested-models-using-waic-and-loo."><i class="fa fa-check"></i><b>11.6.4</b> Comparing nonnested models using [WAIC and LOO].</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#statistical-inference-using-uncertainty-in-the-bayesian-posterior"><i class="fa fa-check"></i><b>11.7</b> Statistical inference using [uncertainty in the Bayesian posterior]</a>
<ul>
<li class="chapter" data-level="11.7.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-wald-chi-square-statistic."><i class="fa fa-check"></i><b>11.7.1</b> The <del>Wald chi-square statistic</del>.</a></li>
<li class="chapter" data-level="11.7.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#asymmetric-credible-intervals-for-parameters-and-odds-ratios."><i class="fa fa-check"></i><b>11.7.2</b> [Asymmetric credible intervals] for parameters and odds ratios.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#footnote-1"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html"><i class="fa fa-check"></i><b>12</b> Extending the Discrete-Time Hazard Model</a>
<ul>
<li class="chapter" data-level="12.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#alternative-specification-for-the-main-effect-of-time"><i class="fa fa-check"></i><b>12.1</b> Alternative specification for the “main effect” of <em>TIME</em></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#an-ordered-series-of-polynomial-specifications-for-time."><i class="fa fa-check"></i><b>12.1.1</b> An ordered series of polynomial specifications for <em>TIME</em>.</a></li>
<li class="chapter" data-level="12.1.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#criteria-for-comparing-alternative-specification."><i class="fa fa-check"></i><b>12.1.2</b> Criteria for comparing alternative specification.</a></li>
<li class="chapter" data-level="12.1.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-parameters-from-linear-quadratic-and-cubic-specifications."><i class="fa fa-check"></i><b>12.1.3</b> Interpreting parameters from linear, quadratic, and cubic specifications.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model"><i class="fa fa-check"></i><b>12.2</b> Using the complementary log-log link to specify a discrete-time hazard model</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-clog-log-transformation-when-and-why-it-is-useful."><i class="fa fa-check"></i><b>12.2.1</b> The clog-log transformation: When and why it is useful.</a></li>
<li class="chapter" data-level="12.2.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#a-discrete-time-hazard-model-using-the-complementary-log-log-link."><i class="fa fa-check"></i><b>12.2.2</b> A discrete-time hazard model using the complementary log-log link.</a></li>
<li class="chapter" data-level="12.2.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#choosing-between-logit-and-clog-log-links-for-discrete-time-hazard-models."><i class="fa fa-check"></i><b>12.2.3</b> Choosing between logit and clog-log links for discrete-time hazard models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#time-varying-predictors-1"><i class="fa fa-check"></i><b>12.3</b> Time-varying predictors</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#assumptions-underlying-a-model-with-time-varying-predictors."><i class="fa fa-check"></i><b>12.3.1</b> Assumptions underlying a model with time-varying predictors.</a></li>
<li class="chapter" data-level="12.3.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-and-displaying-time-varying-predictors-effects."><i class="fa fa-check"></i><b>12.3.2</b> Interpreting and displaying time-varying predictors’ effects.</a></li>
<li class="chapter" data-level="12.3.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#two-caveats-the-problems-of-state-and-rate-dependence."><i class="fa fa-check"></i><b>12.3.3</b> Two caveats: The problems of state and rate dependence.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-linear-additivity-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.4</b> The linear additivity assumption: Uncovering violations and simple solutions</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interactions-between-substantive-predictors."><i class="fa fa-check"></i><b>12.4.1</b> Interactions between substantive predictors.</a></li>
<li class="chapter" data-level="12.4.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#nonlinear-effects."><i class="fa fa-check"></i><b>12.4.2</b> Nonlinear effects.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-proportionality-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.5</b> The proportionality assumption: Uncovering violations and simple solutions</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#discrete-time-hazard-models-that-do-not-invoke-a-proportionality-assumption."><i class="fa fa-check"></i><b>12.5.1</b> Discrete-time hazard models that do not invoke a proportionality assumption.</a></li>
<li class="chapter" data-level="12.5.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#investigating-the-proportionality-assumption-in-practice."><i class="fa fa-check"></i><b>12.5.2</b> Investigating the proportionality assumption in practice.</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-no-unobserved-heterogeneity-assumption-no-simple-solution"><i class="fa fa-check"></i><b>12.6</b> The no unobserved heterogeneity assumption: No simple solution</a></li>
<li class="chapter" data-level="12.7" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#residual-analysis"><i class="fa fa-check"></i><b>12.7</b> Residual analysis</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#footnote-2"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html"><i class="fa fa-check"></i><b>13</b> Describing Continuous-Time Event Occurrence Data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#a-framework-for-characterizing-the-distribution-of-continuous-time-event-data"><i class="fa fa-check"></i><b>13.1</b> A framework for characterizing the distribution of continuous-time event data</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#salient-features-of-continuous-time-event-occurrence-data."><i class="fa fa-check"></i><b>13.1.1</b> Salient features of continuous-time event occurrence data.</a></li>
<li class="chapter" data-level="13.1.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-survivor-function."><i class="fa fa-check"></i><b>13.1.2</b> The survivor function.</a></li>
<li class="chapter" data-level="13.1.3" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-hazard-function."><i class="fa fa-check"></i><b>13.1.3</b> The hazard function.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#grouped-methods-for-estimating-continuous-time-survivor-and-hazard-functions"><i class="fa fa-check"></i><b>13.2</b> Grouped methods for estimating continuous-time survivor and hazard functions</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#constructing-a-grouped-life-table."><i class="fa fa-check"></i><b>13.2.1</b> Constructing a grouped life table.</a></li>
<li class="chapter" data-level="13.2.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-discrete-time-method."><i class="fa fa-check"></i><b>13.2.2</b> The discrete-time method.</a></li>
<li class="chapter" data-level="13.2.3" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-actuarial-method."><i class="fa fa-check"></i><b>13.2.3</b> The actuarial method.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-kaplan-meier-method-of-estimating-the-continuous-time-survivor-function"><i class="fa fa-check"></i><b>13.3</b> The Kaplan-Meier method of estimating the continuous-time survivor function</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#fitting-a-bayesian-kaplan-meier-model"><i class="fa fa-check"></i><b>13.3.1</b> Fitting a Bayesian Kaplan-Meier model</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-cumulative-hazard-function"><i class="fa fa-check"></i><b>13.4</b> The cumulative hazard function</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#understanding-the-meaning-of-cumulative-hazard."><i class="fa fa-check"></i><b>13.4.1</b> Understanding the meaning of cumulative hazard.</a></li>
<li class="chapter" data-level="13.4.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#estimating-the-cumulative-hazard-function."><i class="fa fa-check"></i><b>13.4.2</b> Estimating the cumulative hazard function.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#kernel-smoothed-estimates-of-the-hazard-function"><i class="fa fa-check"></i><b>13.5</b> Kernel-smoothed estimates of the hazard function</a></li>
<li class="chapter" data-level="13.6" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#developing-an-intuition-about-continuous-time-survivor-cumulative-hazard-and-kernel-smoothed-hazard-functions"><i class="fa fa-check"></i><b>13.6</b> Developing an intuition about continuous-time survivor, cumulative hazard, and kernel-smoothed hazard functions</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#bonus-bayesians-can-compare-continuous-time-survivor-cumulative-hazard-and-kernel-smoothed-hazard-functions-too."><i class="fa fa-check"></i><b>13.6.1</b> Bonus: Bayesians can compare continuous-time survivor, cumulative hazard, and kernel-smoothed hazard functions, too.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Applied longitudinal data analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="treating-time-more-flexibly" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Treating Time More Flexibly</h1>
<blockquote>
<p>All the illustrative longitudinal data sets in previous chapters share two structural features that simplify analysis. Each is: (1) balanced–everyone is assessed on the identical number of occasions; and (2) time-structured–each set of occasions is identical across individuals. Our analyses have also been limited in that we have used only: (1) time-invariant predictors that describe immutable characteristics of individuals or their environment (except for <em>TIME</em> itself); and (2) a representation of <em>TIME</em> that forces the level-1 individual growth parameters to represent “initial status” and “rate of change.”</p>
<p>The multilevel model for change is far more flexible than these examples suggest. With little or no adjustment, you can use the same strategies to analyze more complex data sets. Not only can the waves of data be irregularly spaced, their number and spacing can vary across participants. Each individual can have his or her own data collection schedule and number of waves can vary without limit from person to person. So, too, predictors of change can be time-invariant or time-varying, and the level-1 submodel can be parameterized in a variety of interesting ways. <span class="citation">(<a href="references.html#ref-singerAppliedLongitudinalData2003" role="doc-biblioref">Singer &amp; Willett, 2003, p. 138</a>, <em>emphasis</em> in the original)</span></p>
</blockquote>
<div id="variably-spaced-measurement-occasions" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Variably spaced measurement occasions</h2>
<blockquote>
<p>Many researchers design their studies with the goal of assessing each individual on an identical set of occasions…</p>
<p>Yet sometimes, despite a valiant attempt to collect time-structured data, actual measurement occasions will differ. Variation often results from the realities of fieldwork and data collection…</p>
<p>So, too, many researchers design their studies knowing full well that the measurement occasions may differ across participants. This is certainly true, for example, of those who use an <em>accelerated cohort</em> design in which an age-heterogeneous cohort of individuals is followed for a constant period of time. Because respondents initial vary in age, and age, not <em>wave</em>, is usually the appropriate metric for analyses (see the discussion of time metrics in section 1.3.2), observed measurement occasions will differ across individuals. (p. 139, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="the-structure-of-variably-spaced-data-sets." class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> The structure of variably spaced data sets.</h3>
<p>You can find the PIAT data from the CNLSY study in the <code>reading_pp.csv</code> file.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="treating-time-more-flexibly.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb448-2"><a href="treating-time-more-flexibly.html#cb448-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-3"><a href="treating-time-more-flexibly.html#cb448-3" aria-hidden="true" tabindex="-1"></a>reading_pp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/reading_pp.csv&quot;</span>)</span>
<span id="cb448-4"><a href="treating-time-more-flexibly.html#cb448-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-5"><a href="treating-time-more-flexibly.html#cb448-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reading_pp)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##      id  wave agegrp   age  piat
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1    6.5  6       18
## 2     1     2    8.5  8.33    35
## 3     1     3   10.5 10.3     59
## 4     2     1    6.5  6       18
## 5     2     2    8.5  8.5     25
## 6     2     3   10.5 10.6     28</code></pre>
<p>On pages 141 and 142, Singer and Willett discussed the phenomena of <em>occasion creep</em>, which is when “the temporal separations of occasions widens as the actual ages exceed design projections.” Here’s what that might look like.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="treating-time-more-flexibly.html#cb450-1" aria-hidden="true" tabindex="-1"></a>reading_pp <span class="sc">%&gt;%</span> </span>
<span id="cb450-2"><a href="treating-time-more-flexibly.html#cb450-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wave)) <span class="sc">+</span></span>
<span id="cb450-3"><a href="treating-time-more-flexibly.html#cb450-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">6.5</span>, <span class="fl">8.5</span>, <span class="fl">10.5</span>), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb450-4"><a href="treating-time-more-flexibly.html#cb450-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">height =</span> .<span class="dv">33</span>, <span class="at">width =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb450-5"><a href="treating-time-more-flexibly.html#cb450-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">6.5</span>, <span class="fl">8.5</span>, <span class="fl">10.5</span>)) <span class="sc">+</span></span>
<span id="cb450-6"><a href="treating-time-more-flexibly.html#cb450-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb450-7"><a href="treating-time-more-flexibly.html#cb450-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;This is what occasion creep looks like.&quot;</span>,</span>
<span id="cb450-8"><a href="treating-time-more-flexibly.html#cb450-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&quot;As the waves go by, the variation of the ages widens and their central tendency</span><span class="sc">\n</span><span class="st">creeps away from the ideal point.&quot;</span>) <span class="sc">+</span></span>
<span id="cb450-9"><a href="treating-time-more-flexibly.html#cb450-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here’s how we might make our version of Figure 5.1.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="treating-time-more-flexibly.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb451-2"><a href="treating-time-more-flexibly.html#cb451-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-3"><a href="treating-time-more-flexibly.html#cb451-3" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb451-4"><a href="treating-time-more-flexibly.html#cb451-4" aria-hidden="true" tabindex="-1"></a>reading_pp <span class="sc">%&gt;%</span> </span>
<span id="cb451-5"><a href="treating-time-more-flexibly.html#cb451-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(wave, agegrp, age, piat)) <span class="sc">%&gt;%</span> </span>
<span id="cb451-6"><a href="treating-time-more-flexibly.html#cb451-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb451-7"><a href="treating-time-more-flexibly.html#cb451-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb451-8"><a href="treating-time-more-flexibly.html#cb451-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this will help format and order the facets</span></span>
<span id="cb451-9"><a href="treating-time-more-flexibly.html#cb451-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">ifelse</span>(id <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">str_c</span>(<span class="st">&quot;0&quot;</span>, id), id) <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(<span class="st">&quot;id = &quot;</span>, .)) <span class="sc">%&gt;%</span> </span>
<span id="cb451-10"><a href="treating-time-more-flexibly.html#cb451-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;age&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb451-11"><a href="treating-time-more-flexibly.html#cb451-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb451-12"><a href="treating-time-more-flexibly.html#cb451-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb451-13"><a href="treating-time-more-flexibly.html#cb451-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> piat, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb451-14"><a href="treating-time-more-flexibly.html#cb451-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb451-15"><a href="treating-time-more-flexibly.html#cb451-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> F, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb451-16"><a href="treating-time-more-flexibly.html#cb451-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">&quot;B&quot;</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb451-17"><a href="treating-time-more-flexibly.html#cb451-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;measure of age&quot;</span>) <span class="sc">+</span></span>
<span id="cb451-18"><a href="treating-time-more-flexibly.html#cb451-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">12</span>),</span>
<span id="cb451-19"><a href="treating-time-more-flexibly.html#cb451-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>)) <span class="sc">+</span></span>
<span id="cb451-20"><a href="treating-time-more-flexibly.html#cb451-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb451-21"><a href="treating-time-more-flexibly.html#cb451-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>id)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-4-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>Since it wasn’t clear which <code>id</code> values the authors used in the text, we just randomized. Change the seed to view different samples.</p>
</div>
<div id="postulating-and-fitting-multilevel-models-with-variably-spaced-waves-of-data." class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Postulating and fitting multilevel models with variably spaced waves of data.</h3>
<p>The composite formula for our first model is</p>
<p><span class="math display">\[\begin{align*}
\text{piat}_{ij} &amp; = \gamma_{00} + \gamma_{10} (\text{agegrp}_{ij} - 6.5) + \zeta_{0i} + \zeta_{1i} (\text{agegrp}_{ij} - 6.5) + \epsilon_{ij} \\

\epsilon_{ij}    &amp; \sim \operatorname{Normal} (0, \sigma_\epsilon) \\

\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{1i} 
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix} 
\begin{bmatrix} 0 \\ 0 \end{bmatrix},
\mathbf \Sigma
\end{pmatrix}, \text{where} \\

\mathbf \Sigma  &amp; = \mathbf D \mathbf\Omega \mathbf D&#39;, \text{where} \\

\mathbf D       &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \text{and} \\ 

\mathbf \Omega  &amp; = \begin{bmatrix} 1 &amp; \rho_{01} \\ \rho_{01} &amp; 1 \end{bmatrix}

\end{align*}\]</span></p>
<p>It’s the same for the twin model using <code>age</code> rather than <code>agegrp</code>. Notice how we’ve switched from Singer and Willett’s <span class="math inline">\(\sigma^2\)</span> parameterization to the <span class="math inline">\(\sigma\)</span> parameterization typical of <strong>brms</strong>.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="treating-time-more-flexibly.html#cb452-1" aria-hidden="true" tabindex="-1"></a>reading_pp <span class="ot">&lt;-</span></span>
<span id="cb452-2"><a href="treating-time-more-flexibly.html#cb452-2" aria-hidden="true" tabindex="-1"></a>  reading_pp <span class="sc">%&gt;%</span> </span>
<span id="cb452-3"><a href="treating-time-more-flexibly.html#cb452-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agegrp_c =</span> agegrp <span class="sc">-</span> <span class="fl">6.5</span>,</span>
<span id="cb452-4"><a href="treating-time-more-flexibly.html#cb452-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_c    =</span> age    <span class="sc">-</span> <span class="fl">6.5</span>)</span>
<span id="cb452-5"><a href="treating-time-more-flexibly.html#cb452-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb452-6"><a href="treating-time-more-flexibly.html#cb452-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reading_pp)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##      id  wave agegrp   age  piat agegrp_c age_c
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1    6.5  6       18        0 -0.5 
## 2     1     2    8.5  8.33    35        2  1.83
## 3     1     3   10.5 10.3     59        4  3.83
## 4     2     1    6.5  6       18        0 -0.5 
## 5     2     2    8.5  8.5     25        2  2   
## 6     2     3   10.5 10.6     28        4  4.08</code></pre>
<p>In the last chapter, we began familiarizing ourselves with <code>brms::brm()</code> default priors. It’s time to level up. Another approach is to use domain knowledge to set weakly-informative priors. Let’s start with the PIAT. The Peabody Individual Achievement Test is a standardized individual test of scholastic achievement. It yields several subtest scores. The reading subtest is the one we’re focusing on, here. As is typical for such tests, the PIAT scores are normed to yield a population mean of 100 and a standard deviation of 15.</p>
<p>With that information alone, even a PIAT novice should have an idea about how to specify the priors. Since our sole predictor variables are versions of age centered at 6.5, we know that the model intercept is interpreted as the expected value on the PIAT when the children are 6.5 years old. If you knew nothing else, you’d guess the mean score would be 100 with a standard deviation around 15. One way to use a weakly-informative prior on the intercept would be to multiply that <span class="math inline">\(SD\)</span> by a number like 2.</p>
<p>Next we need a prior for the time variables, <code>age_c</code> and <code>agegrp_c</code>. A one-unit increase in either of these is the expected increase in the PIAT with one year’s passage of age. Bringing in a little domain knowledge, IQ and achievement tests tend to be rather stable over time. However, we also expect children to get better as they age and we also don’t know exactly how these data have been adjusted for the children’s ages. It’s also important to know that it’s typical within the Bayesian world to place Normal priors on <span class="math inline">\(\beta\)</span> parameters. So one approach would be to center the Normal prior on 0 and put something like twice the PIAT’s standard deviation on the prior’s <span class="math inline">\(\sigma\)</span>. If we were PIAT researchers, we could do much better. But with minimal knowledge of the test, this approach is certainly beats defaults.</p>
<p>Next we have the variance parameters. Recall that <code>brms::brm()</code> defaults are Student’s <span class="math inline">\(t\)</span>-distributions with <span class="math inline">\(\nu = 3\)</span> and <span class="math inline">\(\mu = 0\)</span>. Let’s start there. Now we just need to put values on <span class="math inline">\(\sigma\)</span>. Since the PIAT has a standard deviation of 15 in the population, why not just use 15? If you felt insecure about this, multiply if by a factor of 2 or so. Also recall that when Student’s <span class="math inline">\(t\)</span>-distributions has a <span class="math inline">\(\nu = 3\)</span>, the tails are quite fat. Within the context of Bayesian priors, those fat tails make it easy for the likelihood to dominate the prior even when it’s a good way into the tail.</p>
<p>Finally, we have the correlation among the group-level variance parameters, <span class="math inline">\(\sigma_0\)</span> and <span class="math inline">\(\sigma_1\)</span>. Recall that last chapter we learned the <code>brms::brm()</code> default was <code>lkj(1)</code>. To get a sense of what the LKJ does, we’ll simulate from it. McElreath’s <strong>rethinking</strong> package contains a handy <code>rlkjcorr()</code> function, which will allow us to simulate <code>n</code> draws from a <code>K</code> by <code>K</code> correlation matrix for which <span class="math inline">\(\eta\)</span> is defined by <code>eta</code>. Let’s take <code>n &lt;- 1e6</code> draws from two LKJ prior distributions, one with <span class="math inline">\(\eta = 1\)</span> and the other with <span class="math inline">\(\eta = 4\)</span>.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="treating-time-more-flexibly.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb454-2"><a href="treating-time-more-flexibly.html#cb454-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-3"><a href="treating-time-more-flexibly.html#cb454-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e6</span></span>
<span id="cb454-4"><a href="treating-time-more-flexibly.html#cb454-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb454-5"><a href="treating-time-more-flexibly.html#cb454-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-6"><a href="treating-time-more-flexibly.html#cb454-6" aria-hidden="true" tabindex="-1"></a>lkj <span class="ot">&lt;-</span></span>
<span id="cb454-7"><a href="treating-time-more-flexibly.html#cb454-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">eta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb454-8"><a href="treating-time-more-flexibly.html#cb454-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draws =</span> purrr<span class="sc">::</span><span class="fu">map</span>(eta, <span class="sc">~</span><span class="fu">rlkjcorr</span>(n, <span class="at">K =</span> <span class="dv">2</span>, <span class="at">eta =</span> .)[, <span class="dv">2</span>, <span class="dv">1</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb454-9"><a href="treating-time-more-flexibly.html#cb454-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(draws)</span>
<span id="cb454-10"><a href="treating-time-more-flexibly.html#cb454-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-11"><a href="treating-time-more-flexibly.html#cb454-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(lkj)</span></code></pre></div>
<pre><code>## Rows: 2,000,000
## Columns: 2
## $ eta   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ draws &lt;dbl&gt; 0.59957109, -0.83375155, 0.79069974, -0.05591997, -0.91300025, 0.45343010, 0.3631919…</code></pre>
<p>Now plot that lkj.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="treating-time-more-flexibly.html#cb456-1" aria-hidden="true" tabindex="-1"></a>lkj <span class="sc">%&gt;%</span> </span>
<span id="cb456-2"><a href="treating-time-more-flexibly.html#cb456-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eta =</span> <span class="fu">factor</span>(eta)) <span class="sc">%&gt;%</span> </span>
<span id="cb456-3"><a href="treating-time-more-flexibly.html#cb456-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb456-4"><a href="treating-time-more-flexibly.html#cb456-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> draws, <span class="at">fill =</span> eta, <span class="at">color =</span> eta)) <span class="sc">+</span></span>
<span id="cb456-5"><a href="treating-time-more-flexibly.html#cb456-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb456-6"><a href="treating-time-more-flexibly.html#cb456-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">tibble</span>(</span>
<span id="cb456-7"><a href="treating-time-more-flexibly.html#cb456-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">draws =</span> <span class="fu">c</span>(.<span class="dv">75</span>, .<span class="dv">35</span>),</span>
<span id="cb456-8"><a href="treating-time-more-flexibly.html#cb456-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y     =</span> <span class="fu">c</span>(.<span class="dv">6</span>, <span class="fl">1.05</span>),</span>
<span id="cb456-9"><a href="treating-time-more-flexibly.html#cb456-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;eta = 1&quot;</span>, <span class="st">&quot;eta = 4&quot;</span>),</span>
<span id="cb456-10"><a href="treating-time-more-flexibly.html#cb456-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta   =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()),</span>
<span id="cb456-11"><a href="treating-time-more-flexibly.html#cb456-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb456-12"><a href="treating-time-more-flexibly.html#cb456-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">end =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb456-13"><a href="treating-time-more-flexibly.html#cb456-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">end =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb456-14"><a href="treating-time-more-flexibly.html#cb456-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb456-15"><a href="treating-time-more-flexibly.html#cb456-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(rho)) <span class="sc">+</span></span>
<span id="cb456-16"><a href="treating-time-more-flexibly.html#cb456-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb456-17"><a href="treating-time-more-flexibly.html#cb456-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-7-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>When we use <code>lkj(1)</code>, the prior is flat over the parameter space. However, setting <code>lkj(4)</code> is tantamount to a prior with a probability mass concentrated a bit towards zero. It’s a prior that’s skeptical of extremely large or small correlations. Within the context of our multilevel model <span class="math inline">\(\rho\)</span> parameters, this will be our weakly-regularizing prior.</p>
<p>Let’s prepare to fit our models and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="treating-time-more-flexibly.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>rethinking, <span class="at">unload =</span> T)</span>
<span id="cb457-2"><a href="treating-time-more-flexibly.html#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code></pre></div>
<p>Fit the models. Following the same form, the differ in that the first uses <code>agegrp_c</code> and the second uses <code>age_c</code>.</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="treating-time-more-flexibly.html#cb458-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb458-2"><a href="treating-time-more-flexibly.html#cb458-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> reading_pp, </span>
<span id="cb458-3"><a href="treating-time-more-flexibly.html#cb458-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb458-4"><a href="treating-time-more-flexibly.html#cb458-4" aria-hidden="true" tabindex="-1"></a>      piat <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> agegrp_c <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> agegrp_c <span class="sc">|</span> id),</span>
<span id="cb458-5"><a href="treating-time-more-flexibly.html#cb458-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">30</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb458-6"><a href="treating-time-more-flexibly.html#cb458-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">30</span>),   <span class="at">class =</span> b, <span class="at">coef =</span> agegrp_c),</span>
<span id="cb458-7"><a href="treating-time-more-flexibly.html#cb458-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">15</span>), <span class="at">class =</span> sd),</span>
<span id="cb458-8"><a href="treating-time-more-flexibly.html#cb458-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">15</span>), <span class="at">class =</span> sigma),</span>
<span id="cb458-9"><a href="treating-time-more-flexibly.html#cb458-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb458-10"><a href="treating-time-more-flexibly.html#cb458-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb458-11"><a href="treating-time-more-flexibly.html#cb458-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb458-12"><a href="treating-time-more-flexibly.html#cb458-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.01&quot;</span>)</span>
<span id="cb458-13"><a href="treating-time-more-flexibly.html#cb458-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-14"><a href="treating-time-more-flexibly.html#cb458-14" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb458-15"><a href="treating-time-more-flexibly.html#cb458-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> reading_pp, </span>
<span id="cb458-16"><a href="treating-time-more-flexibly.html#cb458-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb458-17"><a href="treating-time-more-flexibly.html#cb458-17" aria-hidden="true" tabindex="-1"></a>      piat <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> age_c <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age_c <span class="sc">|</span> id),</span>
<span id="cb458-18"><a href="treating-time-more-flexibly.html#cb458-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">30</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb458-19"><a href="treating-time-more-flexibly.html#cb458-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">30</span>),   <span class="at">class =</span> b, <span class="at">coef =</span> age_c),</span>
<span id="cb458-20"><a href="treating-time-more-flexibly.html#cb458-20" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">15</span>), <span class="at">class =</span> sd),</span>
<span id="cb458-21"><a href="treating-time-more-flexibly.html#cb458-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">15</span>), <span class="at">class =</span> sigma),</span>
<span id="cb458-22"><a href="treating-time-more-flexibly.html#cb458-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb458-23"><a href="treating-time-more-flexibly.html#cb458-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb458-24"><a href="treating-time-more-flexibly.html#cb458-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb458-25"><a href="treating-time-more-flexibly.html#cb458-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.02&quot;</span>)</span></code></pre></div>
<p>Focusing first on <code>fit5.1</code>, our analogue to the <span class="math inline">\((AGEGRP – 6.5)\)</span> model displayed in Table 5.2, here is our model summary.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="treating-time-more-flexibly.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.1</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: piat ~ 0 + Intercept + agegrp_c + (1 + agegrp_c | id) 
##    Data: reading_pp (Number of observations: 267) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 89) 
##                         Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)              3.352     0.862    1.573    4.945 1.002      788      491
## sd(agegrp_c)               2.178     0.286    1.643    2.764 1.002      803     1730
## cor(Intercept,agegrp_c)    0.182     0.226   -0.232    0.643 1.002      523     1116
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept   21.200     0.643   19.948   22.445 1.001     5383     3230
## agegrp_c     5.026     0.315    4.400    5.640 1.001     4358     3074
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    5.291     0.363    4.615    6.057 1.000      931     2164
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s the <code>age_c</code> model.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="treating-time-more-flexibly.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.2</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: piat ~ 0 + Intercept + age_c + (1 + age_c | id) 
##    Data: reading_pp (Number of observations: 267) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 89) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           2.718     0.874    0.687    4.327 1.002      710      374
## sd(age_c)               1.989     0.255    1.508    2.508 1.001     1054     2415
## cor(Intercept,age_c)    0.221     0.235   -0.229    0.684 1.003      475      568
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept   21.099     0.577   19.918   22.217 1.001     5680     3063
## age_c        4.540     0.278    4.000    5.093 1.000     2984     2609
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    5.192     0.337    4.564    5.869 1.002     1044     2170
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>For a more focused look, we can use <code>fixef()</code> compare our <span class="math inline">\(\gamma\)</span>’s to each other and those in the text.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="treating-time-more-flexibly.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit5<span class="fl">.1</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           Estimate Est.Error   Q2.5  Q97.5
## Intercept   21.200     0.643 19.948 22.445
## agegrp_c     5.026     0.315  4.400  5.640</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="treating-time-more-flexibly.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit5<span class="fl">.2</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           Estimate Est.Error   Q2.5  Q97.5
## Intercept   21.099     0.577 19.918 22.217
## age_c        4.540     0.278  4.000  5.093</code></pre>
<p>Here are our <span class="math inline">\(\sigma_\epsilon\)</span> summaries.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="treating-time-more-flexibly.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit5<span class="fl">.1</span>)<span class="sc">$</span>residual<span class="sc">$</span>sd <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Estimate Est.Error  Q2.5 Q97.5
##     5.291     0.363 4.615 6.057</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="treating-time-more-flexibly.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit5<span class="fl">.2</span>)<span class="sc">$</span>residual<span class="sc">$</span>sd <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Estimate Est.Error  Q2.5 Q97.5
##     5.192     0.337 4.564 5.869</code></pre>
<p>From a quick glance, you can see they are about the square of the <span class="math inline">\(\sigma_\epsilon^2\)</span> estimates in the text.</p>
<p>Let’s go ahead and compute the LOO and WAIC.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="treating-time-more-flexibly.html#cb471-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.1</span>, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb471-2"><a href="treating-time-more-flexibly.html#cb471-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.2</span>, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span></code></pre></div>
<p>Compare the models with a WAIC difference.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="treating-time-more-flexibly.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.1</span>, fit5<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb472-2"><a href="treating-time-more-flexibly.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit5.2    0.0       0.0  -866.4      15.3         77.8    7.2    1732.7   30.6 
## fit5.1   -5.5       3.3  -871.9      13.7         78.6    6.6    1743.8   27.3</code></pre>
<p>The WAIC difference between the two isn’t that large relative to its standard error. The LOO tells a similar story.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="treating-time-more-flexibly.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.1</span>, fit5<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb474-2"><a href="treating-time-more-flexibly.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit5.2    0.0       0.0  -879.9     15.9        91.4    8.1   1759.9   31.8  
## fit5.1   -4.8       3.5  -884.7     14.3        91.5    7.5   1769.5   28.5</code></pre>
<p>The uncertainty in our WAIC and LOO estimates and their differences provides information that was not available for the AIC and the BIC comparisons in the text. We can also compare the WAIC and the LOO with model weights. Given the WAIC, from <span class="citation"><a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">McElreath</a> (<a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">2015</a>)</span> we learn</p>
<blockquote>
<p>A total weight of 1 is partitioned among the considered models, making it easier to compare their relative predictive accuracy. The weight for a model <span class="math inline">\(i\)</span> in a set of <span class="math inline">\(m\)</span> models is given by:</p>
<p><span class="math display">\[w_i = \frac{\exp(-\frac{1}{2} \text{dWAIC}_i)}{\sum_{j = 1}^m \exp(-\frac{1}{2} \text{dWAIC}_i)}\]</span></p>
<p>where dWAIC is the <code>dWAIC</code> in the <code>compare</code> table output. This example uses WAIC but the formula is the same for any other information criterion, since they are all on the deviance scale. (p. 199)</p>
</blockquote>
<p>The <code>compare()</code> function McElreath referenced is from his <span class="citation">(<a href="references.html#ref-R-rethinking" role="doc-biblioref">2020b</a>)</span> <a href="https://xcelab.net/rm/software/"><strong>rethinking</strong> package</a>, which is meant to accompany his <a href="https://xcelab.net/rm/statistical-rethinking/">texts</a>. We don’t have that function with <strong>brms</strong>. A rough analogue to the <code>rethinking::compare()</code> function is <code>loo_compare()</code>. We don’t quite have a <code>dWAIC</code> column from <code>loo_compare()</code>. Remember how last chapter we discussed how Aki Vehtari isn’t a fan of converting information criteria to the <span class="math inline">\(\chi^2\)</span> difference metric with that last <span class="math inline">\(-2 \times ...\)</span> step? That’s why we have an <code>elpd_diff</code> instead of a <code>dWAIC</code>. But to get the corresponding value, you just multiply those values by -2. And yet if you look closely at the formula for <span class="math inline">\(w_i\)</span>, you’ll see that each time the dWAIC term appears, it’s multiplied by <span class="math inline">\(-\frac{1}{2}\)</span>. So we don’t really need that <code>dWAIC</code> value anyway. As it turns out, we’re good to go with our <code>elpd_diff</code>. Thus the above equation simplifies to</p>
<p><span class="math display">\[
w_i = \frac{\exp(\text{elpd_diff}_i)}{\sum_{j = 1}^m \exp(\text{elpd_diff}_i)}
\]</span></p>
<p>But recall you don’t have to do any of this by hand. We have the <code>brms::model_weights()</code> function, which we can use to compute weights with the WAIC or the LOO.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="treating-time-more-flexibly.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.1</span>, fit5<span class="fl">.2</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.1 fit5.2 
##  0.004  0.996</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="treating-time-more-flexibly.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.1</span>, fit5<span class="fl">.2</span>, <span class="at">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.1 fit5.2 
##  0.008  0.992</code></pre>
<p>Both put the lion’s share of the weight on the <code>age_c</code> model. Back to McElreath <span class="citation"><a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">McElreath</a> (<a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">2015</a>)</span>:</p>
<blockquote>
<p>But what do these weights mean? There actually isn’t a consensus about that. But here’s Akaike’s interpretation, which is <a href="https://www.springer.com/us/book/9780387953649">common</a>.</p>
<blockquote>
<p><em>A model’s weight is an estimate of the probability that the model will make the best predictions on new data, conditional on the set of models considered</em>.</p>
</blockquote>
<p>Here’s the heuristic explanation. First, regard WAIC as the expected deviance of a model on future data. That is to say that WAIC gives us an estimate of <span class="math inline">\(\text{E} (D_\text{test})\)</span>. Akaike weights convert these deviance values, which are log-likelihoods, to plain likelihoods and then standardize them all. This is just like Bayes’ theorem uses a sum in the denominator to standardize the produce of the likelihood and prior. Therefore the Akaike weights are analogous to posterior probabilities of models, conditional on expected future data. (p. 199, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
</div>
<div id="varying-numbers-of-measurement-occasions" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Varying numbers of measurement occasions</h2>
<p>As Singer and Willett pointed out,</p>
<blockquote>
<p>once you allow the spacing of waves to vary across individuals, it is a small leap to allow their <em>number</em> to vary as well. Statisticians say that such data sets are <em>unbalanced.</em> As you would expect, balance facilitates analysis: models can be parameterized more easily, random effects can be estimated more precisely, and computer algorithms will converge more rapidly.</p>
<p>Yet a major advantage of the multilevel model for change is that it is easily fit to unbalanced data. (p. 146, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="analyzing-data-sets-in-which-the-number-of-waves-per-person-varies." class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Analyzing data sets in which the number of waves per person varies.</h3>
<p>Here we load the <code>wages_pp.csv</code> data.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="treating-time-more-flexibly.html#cb480-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/wages_pp.csv&quot;</span>)</span>
<span id="cb480-2"><a href="treating-time-more-flexibly.html#cb480-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3"><a href="treating-time-more-flexibly.html#cb480-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wages_pp)</span></code></pre></div>
<pre><code>## Rows: 6,402
## Columns: 15
## $ id            &lt;dbl&gt; 31, 31, 31, 31, 31, 31, 31, 31, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 53, …
## $ lnw           &lt;dbl&gt; 1.491, 1.433, 1.469, 1.749, 1.931, 1.709, 2.086, 2.129, 1.982, 1.798, 2.256,…
## $ exper         &lt;dbl&gt; 0.015, 0.715, 1.734, 2.773, 3.927, 4.946, 5.965, 6.984, 0.315, 0.983, 2.040,…
## $ ged           &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1…
## $ postexp       &lt;dbl&gt; 0.015, 0.715, 1.734, 2.773, 3.927, 4.946, 5.965, 6.984, 0.315, 0.983, 2.040,…
## $ black         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ hispanic      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1…
## $ hgc           &lt;dbl&gt; 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 7, 7, 7, 7, 7, 7, 7, 7…
## $ hgc.9         &lt;dbl&gt; -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2, -2, -2, -2…
## $ uerate        &lt;dbl&gt; 3.215, 3.215, 3.215, 3.295, 2.895, 2.495, 2.595, 4.795, 4.895, 7.400, 7.400,…
## $ ue.7          &lt;dbl&gt; -3.785, -3.785, -3.785, -3.705, -4.105, -4.505, -4.405, -2.205, -2.105, 0.40…
## $ ue.centert1   &lt;dbl&gt; 0.000, 0.000, 0.000, 0.080, -0.320, -0.720, -0.620, 1.580, 0.000, 2.505, 2.5…
## $ ue.mean       &lt;dbl&gt; 3.2150, 3.2150, 3.2150, 3.2150, 3.2150, 3.2150, 3.2150, 3.2150, 5.0965, 5.09…
## $ ue.person.cen &lt;dbl&gt; 0.0000, 0.0000, 0.0000, 0.0800, -0.3200, -0.7200, -0.6200, 1.5800, -0.2015, …
## $ ue1           &lt;dbl&gt; 3.215, 3.215, 3.215, 3.215, 3.215, 3.215, 3.215, 3.215, 4.895, 4.895, 4.895,…</code></pre>
<p>Here’s a more focused look along the lines of Table 5.3.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="treating-time-more-flexibly.html#cb482-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb482-2"><a href="treating-time-more-flexibly.html#cb482-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, exper, lnw, black, hgc, uerate) <span class="sc">%&gt;%</span> </span>
<span id="cb482-3"><a href="treating-time-more-flexibly.html#cb482-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">206</span>, <span class="dv">332</span>, <span class="dv">1028</span>))</span></code></pre></div>
<pre><code>## # A tibble: 20 x 6
##       id exper   lnw black   hgc uerate
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1   206 1.87  2.03      0    10   9.2 
##  2   206 2.81  2.30      0    10  11   
##  3   206 4.31  2.48      0    10   6.30
##  4   332 0.125 1.63      0     8   7.1 
##  5   332 1.62  1.48      0     8   9.6 
##  6   332 2.41  1.80      0     8   7.2 
##  7   332 3.39  1.44      0     8   6.20
##  8   332 4.47  1.75      0     8   5.60
##  9   332 5.18  1.53      0     8   4.60
## 10   332 6.08  2.04      0     8   4.30
## 11   332 7.04  2.18      0     8   3.40
## 12   332 8.20  2.19      0     8   4.39
## 13   332 9.09  4.04      0     8   6.70
## 14  1028 0.004 0.872     1     8   9.3 
## 15  1028 0.035 0.903     1     8   7.4 
## 16  1028 0.515 1.39      1     8   7.3 
## 17  1028 1.48  2.32      1     8   7.4 
## 18  1028 2.14  1.48      1     8   6.30
## 19  1028 3.16  1.70      1     8   5.90
## 20  1028 4.10  2.34      1     8   6.9</code></pre>
<p>To get a sense of the diversity in the number of occasions per <code>id</code>, use <code>group_by()</code> and <code>count()</code>.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="treating-time-more-flexibly.html#cb484-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb484-2"><a href="treating-time-more-flexibly.html#cb484-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb484-3"><a href="treating-time-more-flexibly.html#cb484-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb484-4"><a href="treating-time-more-flexibly.html#cb484-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb484-5"><a href="treating-time-more-flexibly.html#cb484-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb484-6"><a href="treating-time-more-flexibly.html#cb484-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;# measurement occasions&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb484-7"><a href="treating-time-more-flexibly.html#cb484-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;count of cases&quot;</span>) <span class="sc">+</span></span>
<span id="cb484-8"><a href="treating-time-more-flexibly.html#cb484-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The spacing of the measurement occasions also differs a lot across cases. Recall that <code>exper</code> “identifies the specific moment–to the nearest day–in each man’s labor force history associated with each observed value of” <code>lnw</code> (p. 147). Here’s a sense of what that looks like.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="treating-time-more-flexibly.html#cb485-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb485-2"><a href="treating-time-more-flexibly.html#cb485-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">206</span>, <span class="dv">332</span>, <span class="dv">1028</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb485-3"><a href="treating-time-more-flexibly.html#cb485-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">factor</span>(id)) <span class="sc">%&gt;%</span> </span>
<span id="cb485-4"><a href="treating-time-more-flexibly.html#cb485-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb485-5"><a href="treating-time-more-flexibly.html#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> exper, <span class="at">y =</span> lnw, <span class="at">color =</span> id)) <span class="sc">+</span></span>
<span id="cb485-6"><a href="treating-time-more-flexibly.html#cb485-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb485-7"><a href="treating-time-more-flexibly.html#cb485-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb485-8"><a href="treating-time-more-flexibly.html#cb485-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;B&quot;</span>, <span class="at">begin =</span> .<span class="dv">35</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb485-9"><a href="treating-time-more-flexibly.html#cb485-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Uneven for dayz.</p>
<p>Here’s the <strong>brms</strong> version of the composite formula for Model A, the unconditional growth model for <code>lnw</code>.</p>
<p><span class="math display">\[\begin{align*}
\text{lnw}_{ij} &amp; = \gamma_{00} + \gamma_{10} \text{exper}_{ij} + \zeta_{0i} + \zeta_{1i} \text{exper}_{ij} + \epsilon_{ij} \\
\epsilon_{ij} &amp; \sim \operatorname{Normal}(0, \sigma_\epsilon) \\

\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{1i} 
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix}
\begin{bmatrix} 0 \\ 0 \end{bmatrix},
\mathbf\Sigma
\end{pmatrix}, \text{where} \\

\mathbf\Sigma &amp; = \mathbf D \mathbf \Omega \mathbf D&#39;, \text{where} \\

\mathbf D     &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix}, \text{and} \\ 

\mathbf\Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{01} \\ \rho_{01} &amp; 1 \end{bmatrix}
\end{align*}\]</span></p>
<p>To attempt setting priors for this, we need to review what <code>lnw</code> is. From the text: “To adjust for inflation, each hourly wage is expressed in constant 1990 dollars. To address the skewness commonly found in wage data and to linearize the individual wage trajectories, we analyze the natural logarithm of wages, <em>LNW</em>” (p. 147). So it’s the log of participant wages in 1990 dollars. From the official <a href="https://www.ssa.gov/oact/cola/central.html">US Social Secutiry website</a>, we learn the average yearly wage in 1990 was $20,172.11. Here’s that natural log for that.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="treating-time-more-flexibly.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fl">20172.11</span>)</span></code></pre></div>
<pre><code>## [1] 9.912056</code></pre>
<p>However, that’s the yearly wage. In the text, this is conceptualized as rate per hour. If we presume a 40 hour week for 52 weeks, this translates to a little less than $10 per hour.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="treating-time-more-flexibly.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fl">20172.11</span> <span class="sc">/</span> (<span class="dv">40</span> <span class="sc">*</span> <span class="dv">52</span>)</span></code></pre></div>
<pre><code>## [1] 9.69813</code></pre>
<p>Here’s what that looks like in a log metric.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="treating-time-more-flexibly.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fl">20172.11</span> <span class="sc">/</span> (<span class="dv">40</span> <span class="sc">*</span> <span class="dv">52</span>))</span></code></pre></div>
<pre><code>## [1] 2.271933</code></pre>
<p>But keep in mind that “to track wages on a common temporal scale, Murnane and colleagues decided to clock time from each respondent’s first day of work” (p. 147). So the wages at one’s initial point in the study were often entry-level wages. From the official website for the <a href="https://www.dol.gov/whd/minwage/chart.htm">US Department of Labor</a>, we learn the national US minimum wage in 1990 was $3.80 per hour. Here’s what that looks like on the log scale.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="treating-time-more-flexibly.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fl">3.80</span>)</span></code></pre></div>
<pre><code>## [1] 1.335001</code></pre>
<p>So perhaps this is a better figure to center our prior for the model intercept on. If we stay with a conventional Gaussian prior and put <span class="math inline">\(\mu = 1.335\)</span>, what value should we use for the standard deviation? Well, if that’s the log minimum and 2.27 is the log mean, then there’s less than a log value of 1 between the minimum and the mean. If we’d like to continue our practice of weakly regularizing priors a value of 1 or even 0.5 on the log scale would seem reasonable. For simplicity, we’ll use <code>normal(1.335, 1)</code>.</p>
<p>Next we need a prior for the expected increase over a single year’s employment. A conservative default might be to center it on zero—no change from year to year. Since as we’ve established a 1 on the log scale is more than the difference between the minimum and average hourly wages in 1990 dollars, we might just use <code>normal(0, 0.5)</code> as a starting point.</p>
<p>So then what about our variance parameters? Given these are all entry-level workers and given how little we’d expect them to increase from year to year, a <code>student_t(3, 0, 1)</code> on the log scale would seem pretty permissive.</p>
<p>So then here’s how we might formally specify our model priors:</p>
<p><span class="math display">\[\begin{align*}
\gamma_{00}     &amp; \sim \operatorname{Normal}(1.335, 1) \\
\gamma_{10}     &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma_\epsilon &amp; \sim \operatorname{Student-t}(3, 0, 1) \\
\sigma_0        &amp; \sim \operatorname{Student-t}(3, 0, 1) \\
\sigma_1        &amp; \sim \operatorname{Student-t}(3, 0, 1) \\
\rho_{01}       &amp; \sim \operatorname{LKJ} (4)
\end{align*}\]</span></p>
<p>For a point of comparison, here are the <code>brms::brm()</code> default priors.</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="treating-time-more-flexibly.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">data =</span> wages_pp, </span>
<span id="cb494-2"><a href="treating-time-more-flexibly.html#cb494-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> gaussian,</span>
<span id="cb494-3"><a href="treating-time-more-flexibly.html#cb494-3" aria-hidden="true" tabindex="-1"></a>          lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> exper <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id))</span></code></pre></div>
<pre><code>##                 prior class      coef group resp dpar nlpar bound       source
##                (flat)     b                                            default
##                (flat)     b     exper                             (vectorized)
##                (flat)     b Intercept                             (vectorized)
##                lkj(1)   cor                                            default
##                lkj(1)   cor              id                       (vectorized)
##  student_t(3, 0, 2.5)    sd                                            default
##  student_t(3, 0, 2.5)    sd              id                       (vectorized)
##  student_t(3, 0, 2.5)    sd     exper    id                       (vectorized)
##  student_t(3, 0, 2.5)    sd Intercept    id                       (vectorized)
##  student_t(3, 0, 2.5) sigma                                            default</code></pre>
<p>Even though our priors are still quite permissive on the scale of the data, they’re much more informative than the defaults. If we had formal backgrounds in the entry-level economy of the US in the early 1900s, we’d be able to specify even better priors. But hopefully this walk-through gives a sense of how to start thinking about model priors.</p>
<p>Let’s fit the model. To keep the size of the <code>fits/fit05.03.rds</code> file below the 100MB GitHub limit, we’ll set <code>chains = 3</code> and compensate by upping <code>iter</code> a little.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="treating-time-more-flexibly.html#cb496-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.3</span> <span class="ot">&lt;-</span></span>
<span id="cb496-2"><a href="treating-time-more-flexibly.html#cb496-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_pp, </span>
<span id="cb496-3"><a href="treating-time-more-flexibly.html#cb496-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb496-4"><a href="treating-time-more-flexibly.html#cb496-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> exper <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb496-5"><a href="treating-time-more-flexibly.html#cb496-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb496-6"><a href="treating-time-more-flexibly.html#cb496-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b, <span class="at">coef =</span> exper),</span>
<span id="cb496-7"><a href="treating-time-more-flexibly.html#cb496-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb496-8"><a href="treating-time-more-flexibly.html#cb496-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb496-9"><a href="treating-time-more-flexibly.html#cb496-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb496-10"><a href="treating-time-more-flexibly.html#cb496-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb496-11"><a href="treating-time-more-flexibly.html#cb496-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb496-12"><a href="treating-time-more-flexibly.html#cb496-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.03&quot;</span>)</span></code></pre></div>
<p>Here are the results.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="treating-time-more-flexibly.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.3</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + exper + (1 + exper | id) 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.232     0.011    0.211    0.254 1.001     1861     2254
## sd(exper)               0.042     0.003    0.036    0.047 1.000      582     1098
## cor(Intercept,exper)   -0.290     0.069   -0.414   -0.143 1.001      759     1710
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept    1.715     0.011    1.694    1.738 1.000     3079     3373
## exper        0.046     0.002    0.041    0.050 1.001     3116     3414
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.309     0.003    0.303    0.315 1.000     3379     3102
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Since the criterion <code>lnw</code> is on the log scale, Singer and Willett pointed out our estimate for <span class="math inline">\(\gamma_{10}\)</span> indicates a nonlinear growth rate on the natural dollar scale. They further explicated that “if an outcome in a linear relationship, <span class="math inline">\(Y\)</span>, is expressed as a natural logarithm and <span class="math inline">\(\hat \gamma_{01}\)</span> is the regression coefficient for a predictor <span class="math inline">\(X\)</span>, then <span class="math inline">\(100(e^{\hat{\gamma}_{01}} - 1)\)</span> is the <em>percentage change</em> in <span class="math inline">\(Y\)</span> per unit difference in <span class="math inline">\(X\)</span>” (p. 148, <em>emphasis</em> in the original). Here’s how to do that conversion with our <strong>brms</strong> output.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="treating-time-more-flexibly.html#cb499-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span></span>
<span id="cb499-2"><a href="treating-time-more-flexibly.html#cb499-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(fit5<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb499-3"><a href="treating-time-more-flexibly.html#cb499-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">percent_change =</span> <span class="dv">100</span> <span class="sc">*</span> (<span class="fu">exp</span>(b_exper) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb499-4"><a href="treating-time-more-flexibly.html#cb499-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-5"><a href="treating-time-more-flexibly.html#cb499-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(post)</span></code></pre></div>
<pre><code>##   percent_change
## 1       4.506136
## 2       4.455165
## 3       4.938332
## 4       4.491649
## 5       4.553134
## 6       5.096546</code></pre>
<p>For our plot, let’s break out <a href="https://twitter.com/mjskay">Matthew Kay</a>’s handy <a href="mjskay.github.io/tidybayes/"><strong>tidybayes</strong> package</a> <span class="citation">(<a href="references.html#ref-R-tidybayes" role="doc-biblioref">Kay, 2020</a>)</span>. With the <code>tidybayes::stat_halfeye()</code> function, it’s easy to put horizontal point intervals beneath out parameter densities. Here we’ll use 95% intervals.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="treating-time-more-flexibly.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb501-2"><a href="treating-time-more-flexibly.html#cb501-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-3"><a href="treating-time-more-flexibly.html#cb501-3" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb501-4"><a href="treating-time-more-flexibly.html#cb501-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> percent_change, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb501-5"><a href="treating-time-more-flexibly.html#cb501-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb501-6"><a href="treating-time-more-flexibly.html#cb501-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb501-7"><a href="treating-time-more-flexibly.html#cb501-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Percent change&quot;</span>,</span>
<span id="cb501-8"><a href="treating-time-more-flexibly.html#cb501-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(<span class="dv">100</span><span class="sc">*</span>(<span class="fu">italic</span>(e)<span class="sc">^</span>(<span class="fu">hat</span>(gamma)[<span class="dv">1</span>][<span class="dv">0</span>])<span class="sc">-</span><span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb501-9"><a href="treating-time-more-flexibly.html#cb501-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-29-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>The <strong>tidybayes</strong> package also has a group of functions that make it easy to summarize posterior parameters with measures of central tendency (i.e., mean, median, mode) and intervals (i.e., percentile based, highest posterior density intervals). Here we’ll use <code>median_qi()</code> to get the posterior median and percentile-based 95% intervals.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="treating-time-more-flexibly.html#cb502-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb502-2"><a href="treating-time-more-flexibly.html#cb502-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(percent_change)</span></code></pre></div>
<pre><code>##   percent_change   .lower   .upper .width .point .interval
## 1       4.677213 4.186058 5.173748   0.95 median        qi</code></pre>
<p>For our next model, Model B in Table 5.4, we add two time-invariant covariates. In the data, these are listed as <code>black</code> and <code>hgc.9</code>. Before we proceed, let’s rename <code>hgc.9</code> to be more consistent with <a href="https://style.tidyverse.org/syntax.html#object-names"><strong>tidyverse</strong> style</a>.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="treating-time-more-flexibly.html#cb504-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="ot">&lt;-</span></span>
<span id="cb504-2"><a href="treating-time-more-flexibly.html#cb504-2" aria-hidden="true" tabindex="-1"></a>  wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb504-3"><a href="treating-time-more-flexibly.html#cb504-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">hgc_9 =</span> hgc<span class="fl">.9</span>)</span></code></pre></div>
<p>There we go. Let’s take a look at the distributions of our covariates.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="treating-time-more-flexibly.html#cb505-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb505-2"><a href="treating-time-more-flexibly.html#cb505-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(black, hgc_9)) <span class="sc">%&gt;%</span> </span>
<span id="cb505-3"><a href="treating-time-more-flexibly.html#cb505-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-4"><a href="treating-time-more-flexibly.html#cb505-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb505-5"><a href="treating-time-more-flexibly.html#cb505-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb505-6"><a href="treating-time-more-flexibly.html#cb505-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb505-7"><a href="treating-time-more-flexibly.html#cb505-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-32-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We see <code>black</code> is a dummy variable coded “Black” = 1, “Non-black” = 0. <code>hgc_9</code> is a somewhat Gaussian ordinal centered around zero. For context, it might also help to check its standard deviation.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="treating-time-more-flexibly.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(wages_pp<span class="sc">$</span>hgc_9)</span></code></pre></div>
<pre><code>## [1] 1.347135</code></pre>
<p>With a mean near 0 and an <span class="math inline">\(SD\)</span> near 1, <code>hgc_9</code> is almost in a standardized metric. If we wanted to keep with our weakly-regularizing approach, <code>normal(0, 1)</code> or even <code>normal(0, 0.5)</code> would be pretty permissive for both these variables. Recall that we’re predicting wage on the log scale. A <span class="math inline">\(\gamma\)</span> value of 1 or even 0.5 would be humongous for the social sciences. Since we already have the <span class="math inline">\(\gamma\)</span> for <code>exper</code> set to <code>normal(0, 0.5)</code>, let’s just keep with that. Here’s how we might describe our model in statistical terms:</p>
<p><span class="math display">\[\begin{align*}
\text{lnw}_{ij} &amp; = \gamma_{00} + \gamma_{01} (\text{hgc}_{i} - 9) + \gamma_{02} \text{black}_{i} \\
&amp; \;\;\; + \gamma_{10} \text{exper}_{ij} + \gamma_{11} \text{exper}_{ij} \times (\text{hgc}_{i} - 9) + \gamma_{12} \text{exper}_{ij} \times \text{black}_{i} \\
&amp; \;\;\; + \zeta_{0i} + \zeta_{1i} \text{exper}_{ij} + \epsilon_{ij} \\
\epsilon_{ij} &amp; \sim \operatorname{Normal} (0, \sigma_\epsilon) \\

\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{1i} 
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix} 
\begin{bmatrix} 0 \\ 0 \end{bmatrix},
\mathbf D \mathbf\Omega \mathbf D&#39;
\end{pmatrix} \\

\mathbf D     &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \\ 
\mathbf\Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{01} \\ \rho_{01} &amp; 1 \end{bmatrix} \\

\gamma_{00}                                      &amp; \sim \operatorname{Normal}(1.335, 1) \\
\gamma_{01},..., \gamma_{12}                     &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma_\epsilon, \sigma_0, \text{ and } \sigma_1 &amp; \sim \operatorname{Student-t} (3, 0, 1) \\
\rho_{01}                                        &amp; \sim \operatorname{LKJ} (4).
\end{align*}\]</span></p>
<p>The top portion up through the <span class="math inline">\(\mathbf\Omega\)</span> line is the likelihood. Starting with <span class="math inline">\(\gamma_{00} \sim \text{Normal}(1.335, 1)\)</span> on down, we’ve listed our priors. Here’s how to fit the model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="treating-time-more-flexibly.html#cb508-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.4</span> <span class="ot">&lt;-</span></span>
<span id="cb508-2"><a href="treating-time-more-flexibly.html#cb508-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_pp, </span>
<span id="cb508-3"><a href="treating-time-more-flexibly.html#cb508-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb508-4"><a href="treating-time-more-flexibly.html#cb508-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> hgc_9 <span class="sc">+</span> black <span class="sc">+</span> exper <span class="sc">+</span> exper<span class="sc">:</span>hgc_9 <span class="sc">+</span> exper<span class="sc">:</span>black <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb508-5"><a href="treating-time-more-flexibly.html#cb508-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb508-6"><a href="treating-time-more-flexibly.html#cb508-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b),</span>
<span id="cb508-7"><a href="treating-time-more-flexibly.html#cb508-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb508-8"><a href="treating-time-more-flexibly.html#cb508-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb508-9"><a href="treating-time-more-flexibly.html#cb508-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb508-10"><a href="treating-time-more-flexibly.html#cb508-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb508-11"><a href="treating-time-more-flexibly.html#cb508-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb508-12"><a href="treating-time-more-flexibly.html#cb508-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.04&quot;</span>)</span></code></pre></div>
<p>Let’s take a look at the results.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="treating-time-more-flexibly.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.4</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + black + exper + exper:hgc_9 + exper:black + (1 + exper | id) 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.227     0.011    0.206    0.249 1.002     1159     2598
## sd(exper)               0.040     0.003    0.035    0.046 1.002      389     1235
## cor(Intercept,exper)   -0.293     0.071   -0.424   -0.146 1.004      415     1261
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept      1.717     0.012    1.693    1.742 1.000     1768     3226
## hgc_9          0.035     0.008    0.020    0.050 1.000     2316     2886
## black          0.016     0.024   -0.033    0.061 1.001     1603     2781
## exper          0.049     0.003    0.044    0.055 1.000     1796     3019
## hgc_9:exper    0.001     0.002   -0.002    0.005 1.001     1985     2872
## black:exper   -0.018     0.006   -0.029   -0.008 1.001     1799     2557
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.309     0.003    0.303    0.315 1.000     2696     2879
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <span class="math inline">\(\gamma\)</span>’s are on par with those in the text. When we convert the <span class="math inline">\(\sigma\)</span> parameters to the <span class="math inline">\(\sigma^2\)</span> metric, here’s what they look like.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="treating-time-more-flexibly.html#cb511-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit5<span class="fl">.4</span>) </span>
<span id="cb511-2"><a href="treating-time-more-flexibly.html#cb511-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-3"><a href="treating-time-more-flexibly.html#cb511-3" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb511-4"><a href="treating-time-more-flexibly.html#cb511-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="ot">=</span> sd_id__Intercept<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb511-5"><a href="treating-time-more-flexibly.html#cb511-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="ot">=</span> sd_id__exper<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb511-6"><a href="treating-time-more-flexibly.html#cb511-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="ot">=</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb511-7"><a href="treating-time-more-flexibly.html#cb511-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb511-8"><a href="treating-time-more-flexibly.html#cb511-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb511-9"><a href="treating-time-more-flexibly.html#cb511-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb511-10"><a href="treating-time-more-flexibly.html#cb511-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb511-11"><a href="treating-time-more-flexibly.html#cb511-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> ggplot2<span class="sc">:::</span>parse_safe) <span class="sc">+</span></span>
<span id="cb511-12"><a href="treating-time-more-flexibly.html#cb511-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.4</span>, <span class="fl">3.4</span>)) <span class="sc">+</span></span>
<span id="cb511-13"><a href="treating-time-more-flexibly.html#cb511-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb511-14"><a href="treating-time-more-flexibly.html#cb511-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-35-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>We might plot our <span class="math inline">\(\gamma\)</span>’s, too. Here we’ll use <code>tidybayes::stat_pointinterval()</code> to just focus on the points and intervals.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="treating-time-more-flexibly.html#cb512-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb512-2"><a href="treating-time-more-flexibly.html#cb512-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span><span class="st">`</span><span class="at">b_black:exper</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb512-3"><a href="treating-time-more-flexibly.html#cb512-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;gamma&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;[0][0]&quot;</span>, <span class="st">&quot;[0][1]&quot;</span>, <span class="st">&quot;[0][2]&quot;</span>, <span class="st">&quot;[1][0]&quot;</span>, <span class="st">&quot;[1][1]&quot;</span>, <span class="st">&quot;[1][2]&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb512-4"><a href="treating-time-more-flexibly.html#cb512-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb512-5"><a href="treating-time-more-flexibly.html#cb512-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb512-6"><a href="treating-time-more-flexibly.html#cb512-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb512-7"><a href="treating-time-more-flexibly.html#cb512-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb512-8"><a href="treating-time-more-flexibly.html#cb512-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb512-9"><a href="treating-time-more-flexibly.html#cb512-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> ggplot2<span class="sc">:::</span>parse_safe) <span class="sc">+</span></span>
<span id="cb512-10"><a href="treating-time-more-flexibly.html#cb512-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb512-11"><a href="treating-time-more-flexibly.html#cb512-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-36-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>As in the text, our <span class="math inline">\(\gamma_{02}\)</span> and <span class="math inline">\(\gamma_{11}\)</span> parameters hovered around zero. For our next model, Model C in Table 5.4, we’ll drop those parameters.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="treating-time-more-flexibly.html#cb513-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.5</span> <span class="ot">&lt;-</span></span>
<span id="cb513-2"><a href="treating-time-more-flexibly.html#cb513-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_pp, </span>
<span id="cb513-3"><a href="treating-time-more-flexibly.html#cb513-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb513-4"><a href="treating-time-more-flexibly.html#cb513-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> hgc_9 <span class="sc">+</span> exper <span class="sc">+</span> exper<span class="sc">:</span>black <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb513-5"><a href="treating-time-more-flexibly.html#cb513-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb513-6"><a href="treating-time-more-flexibly.html#cb513-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b),</span>
<span id="cb513-7"><a href="treating-time-more-flexibly.html#cb513-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb513-8"><a href="treating-time-more-flexibly.html#cb513-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb513-9"><a href="treating-time-more-flexibly.html#cb513-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb513-10"><a href="treating-time-more-flexibly.html#cb513-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb513-11"><a href="treating-time-more-flexibly.html#cb513-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb513-12"><a href="treating-time-more-flexibly.html#cb513-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.05&quot;</span>)</span></code></pre></div>
<p>Let’s take a look at the results.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="treating-time-more-flexibly.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.5</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + exper + exper:black + (1 + exper | id) 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.227     0.011    0.205    0.248 1.000     1731     2831
## sd(exper)               0.040     0.003    0.035    0.045 1.004      650     1278
## cor(Intercept,exper)   -0.289     0.069   -0.412   -0.145 1.002      726     1093
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept      1.722     0.011    1.701    1.743 1.001     3071     3289
## hgc_9          0.038     0.006    0.026    0.051 1.000     2728     3261
## exper          0.049     0.003    0.044    0.054 1.000     2696     3104
## exper:black   -0.016     0.004   -0.025   -0.008 1.000     2233     3078
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.309     0.003    0.303    0.315 1.001     3187     3177
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Perhaps unsurprisingly, the parameter estimates for <code>fit5.5</code> ended up quite similar to those from <code>fit5.4</code>. Happily, they’re also similar to those in the text. Let’s compute the WAIC estimates.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="treating-time-more-flexibly.html#cb516-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb516-2"><a href="treating-time-more-flexibly.html#cb516-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.4</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb516-3"><a href="treating-time-more-flexibly.html#cb516-3" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.5</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<p>Compare their WAIC estimates using <span class="math inline">\(\text{elpd}\)</span> difference scores.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="treating-time-more-flexibly.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.3</span>, fit5<span class="fl">.4</span>, fit5<span class="fl">.5</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb517-2"><a href="treating-time-more-flexibly.html#cb517-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit5.4     0.0       0.0 -2053.3     103.7        867.6    27.0    4106.7   207.4
## fit5.5    -0.1       1.3 -2053.5     103.8        867.8    27.1    4106.9   207.7
## fit5.3    -4.2       4.3 -2057.6     103.6        879.8    27.1    4115.1   207.2</code></pre>
<p>The differences are subtle. Here are the WAIC weights.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="treating-time-more-flexibly.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.3</span>, fit5<span class="fl">.4</span>, fit5<span class="fl">.5</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb519-2"><a href="treating-time-more-flexibly.html#cb519-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.3 fit5.4 fit5.5 
##  0.008  0.529  0.463</code></pre>
<p>When we use weights, almost all goes to <code>fit5.4</code> and <code>fit5.5</code>. Focusing on the trimmed model, <code>fit5.5</code>, let’s get ready to make our version of Figure 5.2. We’ll start with <code>fitted()</code> work.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="treating-time-more-flexibly.html#cb521-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb521-2"><a href="treating-time-more-flexibly.html#cb521-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">black =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb521-3"><a href="treating-time-more-flexibly.html#cb521-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">hgc_9 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb521-4"><a href="treating-time-more-flexibly.html#cb521-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(black, hgc_9),</span>
<span id="cb521-5"><a href="treating-time-more-flexibly.html#cb521-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">exper =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">11</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb521-6"><a href="treating-time-more-flexibly.html#cb521-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-7"><a href="treating-time-more-flexibly.html#cb521-7" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb521-8"><a href="treating-time-more-flexibly.html#cb521-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.5</span>, </span>
<span id="cb521-9"><a href="treating-time-more-flexibly.html#cb521-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb521-10"><a href="treating-time-more-flexibly.html#cb521-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb521-11"><a href="treating-time-more-flexibly.html#cb521-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb521-12"><a href="treating-time-more-flexibly.html#cb521-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb521-13"><a href="treating-time-more-flexibly.html#cb521-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-14"><a href="treating-time-more-flexibly.html#cb521-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(f)</span></code></pre></div>
<pre><code>##   Estimate   Est.Error     Q2.5    Q97.5 black hgc_9     exper
## 1 1.721787 0.010686913 1.700879 1.742899     0     0 0.0000000
## 2 1.740298 0.010244068 1.719827 1.760547     0     0 0.3793103
## 3 1.758809 0.009873301 1.738834 1.778211     0     0 0.7586207
## 4 1.777321 0.009582981 1.758156 1.796154     0     0 1.1379310
## 5 1.795832 0.009380581 1.776815 1.814457     0     0 1.5172414
## 6 1.814343 0.009271860 1.795917 1.832718     0     0 1.8965517</code></pre>
<p>Here it is, our two-panel version of Figure 5.2.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="treating-time-more-flexibly.html#cb523-1" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span></span>
<span id="cb523-2"><a href="treating-time-more-flexibly.html#cb523-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">black =</span> <span class="fu">factor</span>(black,</span>
<span id="cb523-3"><a href="treating-time-more-flexibly.html#cb523-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Latinos and Whites&quot;</span>, <span class="st">&quot;Blacks&quot;</span>)),</span>
<span id="cb523-4"><a href="treating-time-more-flexibly.html#cb523-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">hgc_9 =</span> <span class="fu">factor</span>(hgc_9, </span>
<span id="cb523-5"><a href="treating-time-more-flexibly.html#cb523-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;9th grade dropouts&quot;</span>, <span class="st">&quot;12th grade dropouts&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb523-6"><a href="treating-time-more-flexibly.html#cb523-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb523-7"><a href="treating-time-more-flexibly.html#cb523-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> exper,</span>
<span id="cb523-8"><a href="treating-time-more-flexibly.html#cb523-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> black, <span class="at">fill =</span> black)) <span class="sc">+</span></span>
<span id="cb523-9"><a href="treating-time-more-flexibly.html#cb523-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb523-10"><a href="treating-time-more-flexibly.html#cb523-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb523-11"><a href="treating-time-more-flexibly.html#cb523-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb523-12"><a href="treating-time-more-flexibly.html#cb523-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> .<span class="dv">25</span>, <span class="at">end =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb523-13"><a href="treating-time-more-flexibly.html#cb523-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> .<span class="dv">25</span>, <span class="at">end =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb523-14"><a href="treating-time-more-flexibly.html#cb523-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;lnw&quot;</span>) <span class="sc">+</span></span>
<span id="cb523-15"><a href="treating-time-more-flexibly.html#cb523-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="fl">2.4</span>)) <span class="sc">+</span></span>
<span id="cb523-16"><a href="treating-time-more-flexibly.html#cb523-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb523-17"><a href="treating-time-more-flexibly.html#cb523-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hgc_9)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-42-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>This leads in nicely to a brief discussion of posterior predictive checks (PPC). The basic idea is that good models should be able to retrodict the data used to produce them. Table 5.3 in the text introduced the data set by highlighting three participants and we went ahead and looked at their data in a plot. One way to do a PPC might be to plot their original data atop their model estimates. The <code>fitted()</code> function will help us with the preparatory work.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="treating-time-more-flexibly.html#cb524-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb524-2"><a href="treating-time-more-flexibly.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb524-3"><a href="treating-time-more-flexibly.html#cb524-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">206</span>, <span class="dv">332</span>, <span class="dv">1028</span>))</span>
<span id="cb524-4"><a href="treating-time-more-flexibly.html#cb524-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-5"><a href="treating-time-more-flexibly.html#cb524-5" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb524-6"><a href="treating-time-more-flexibly.html#cb524-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.5</span>, </span>
<span id="cb524-7"><a href="treating-time-more-flexibly.html#cb524-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb524-8"><a href="treating-time-more-flexibly.html#cb524-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb524-9"><a href="treating-time-more-flexibly.html#cb524-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb524-10"><a href="treating-time-more-flexibly.html#cb524-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-11"><a href="treating-time-more-flexibly.html#cb524-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(f)</span></code></pre></div>
<pre><code>##   Estimate Est.Error     Q2.5    Q97.5  id   lnw exper ged postexp black hispanic hgc hgc_9 uerate
## 1 2.057522 0.1435246 1.773462 2.332123 206 2.028 1.874   0       0     0        0  10     1  9.200
## 2 2.117953 0.1427270 1.832584 2.390711 206 2.297 2.814   0       0     0        0  10     1 11.000
## 3 2.214386 0.1594774 1.901740 2.525090 206 2.482 4.314   0       0     0        0  10     1  6.295
## 4 1.466271 0.1408449 1.187568 1.742721 332 1.630 0.125   0       0     0        1   8    -1  7.100
## 5 1.648020 0.1141459 1.422562 1.868796 332 1.476 1.625   0       0     0        1   8    -1  9.600
## 6 1.743499 0.1031456 1.541837 1.941431 332 1.804 2.413   0       0     0        1   8    -1  7.200
##     ue.7 ue.centert1  ue.mean ue.person.cen ue1
## 1  2.200       0.000 8.831667     0.3683333 9.2
## 2  4.000       1.800 8.831667     2.1683333 9.2
## 3 -0.705      -2.905 8.831667    -2.5366667 9.2
## 4  0.100       0.000 5.906500     1.1935000 7.1
## 5  2.600       2.500 5.906500     3.6935000 7.1
## 6  0.200       0.100 5.906500     1.2935000 7.1</code></pre>
<p>Here’s the plot.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="treating-time-more-flexibly.html#cb526-1" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb526-2"><a href="treating-time-more-flexibly.html#cb526-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">str_c</span>(<span class="st">&quot;id = &quot;</span>, id)) <span class="sc">%&gt;%</span> </span>
<span id="cb526-3"><a href="treating-time-more-flexibly.html#cb526-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb526-4"><a href="treating-time-more-flexibly.html#cb526-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> exper)) <span class="sc">+</span></span>
<span id="cb526-5"><a href="treating-time-more-flexibly.html#cb526-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb526-6"><a href="treating-time-more-flexibly.html#cb526-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> id)) <span class="sc">+</span></span>
<span id="cb526-7"><a href="treating-time-more-flexibly.html#cb526-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> lnw)) <span class="sc">+</span></span>
<span id="cb526-8"><a href="treating-time-more-flexibly.html#cb526-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;B&quot;</span>, <span class="at">begin =</span> .<span class="dv">35</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb526-9"><a href="treating-time-more-flexibly.html#cb526-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;The black dots are the original data. The colored points and vertical lines are the participant-specific posterior</span><span class="sc">\n</span><span class="st">means and 95% intervals.&quot;</span>) <span class="sc">+</span></span>
<span id="cb526-10"><a href="treating-time-more-flexibly.html#cb526-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb526-11"><a href="treating-time-more-flexibly.html#cb526-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb526-12"><a href="treating-time-more-flexibly.html#cb526-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>id)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-44-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Although each participant got their own intercept and slope, the estimates all fall in straight lines. Since we’re only working with time-invariant covariates, that’s about the best we can do. Though our models can express gross trends over time, they’re unable to speak to variation from occasion to occasion. Just a little later on in this chapter and we’ll learn how to do better.</p>
</div>
<div id="practical-problems-that-may-arise-when-analyzing-unbalanced-data-sets." class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Practical problems that may arise when analyzing unbalanced data sets.</h3>
<p>With HMC, the issues with non-convergence aren’t quite the same as with maximum likelihood estimation. However, the basic issue still remains:</p>
<blockquote>
<p>Estimation of variance components requires that enough people have sufficient data to allow quantification of within-person residual variation–variation in the residuals over and above the fixed effects. If too many people have too little data, you will <del>be unable to quantify</del> [have difficulty quantifying] this residual variability. (p. 152)</p>
</blockquote>
<p>The big difference is that as Bayesians, our priors add additional information that will help us define the posterior distributions of our variance components. Thus our challenge will choosing sensible priors for our <span class="math inline">\(\sigma\)</span>’s.</p>
<div id="boundary-constraints." class="section level4" number="5.2.2.1">
<h4><span class="header-section-number">5.2.2.1</span> Boundary constraints.</h4>
<p>Unlike with the frequentist multilevel software discussed in the text, <strong>brms</strong> will not yield negative values on the <span class="math inline">\(\sigma\)</span> parameters. This is because the <strong>brms</strong> default is to set a lower limit of zero on those parameters. For example, see what happens when we execute <code>fit5.3$model</code>.</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="treating-time-more-flexibly.html#cb527-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.3</span><span class="sc">$</span>model</span></code></pre></div>
<pre><code>## // generated with brms 2.15.0
## functions {
##  /* compute correlated group-level effects
##   * Args: 
##   *   z: matrix of unscaled group-level effects
##   *   SD: vector of standard deviation parameters
##   *   L: cholesky factor correlation matrix
##   * Returns: 
##   *   matrix of scaled group-level effects
##   */ 
##   matrix scale_r_cor(matrix z, vector SD, matrix L) {
##     // r is stored in another dimension order than z
##     return transpose(diag_pre_multiply(SD, L) * z);
##   }
## }
## data {
##   int&lt;lower=1&gt; N;  // total number of observations
##   vector[N] Y;  // response variable
##   int&lt;lower=1&gt; K;  // number of population-level effects
##   matrix[N, K] X;  // population-level design matrix
##   // data for group-level effects of ID 1
##   int&lt;lower=1&gt; N_1;  // number of grouping levels
##   int&lt;lower=1&gt; M_1;  // number of coefficients per level
##   int&lt;lower=1&gt; J_1[N];  // grouping indicator per observation
##   // group-level predictor values
##   vector[N] Z_1_1;
##   vector[N] Z_1_2;
##   int&lt;lower=1&gt; NC_1;  // number of group-level correlations
##   int prior_only;  // should the likelihood be ignored?
## }
## transformed data {
## }
## parameters {
##   vector[K] b;  // population-level effects
##   real&lt;lower=0&gt; sigma;  // residual SD
##   vector&lt;lower=0&gt;[M_1] sd_1;  // group-level standard deviations
##   matrix[M_1, N_1] z_1;  // standardized group-level effects
##   cholesky_factor_corr[M_1] L_1;  // cholesky factor of correlation matrix
## }
## transformed parameters {
##   matrix[N_1, M_1] r_1;  // actual group-level effects
##   // using vectors speeds up indexing in loops
##   vector[N_1] r_1_1;
##   vector[N_1] r_1_2;
##   // compute actual group-level effects
##   r_1 = scale_r_cor(z_1, sd_1, L_1);
##   r_1_1 = r_1[, 1];
##   r_1_2 = r_1[, 2];
## }
## model {
##   // likelihood including constants
##   if (!prior_only) {
##     // initialize linear predictor term
##     vector[N] mu = rep_vector(0.0, N);
##     for (n in 1:N) {
##       // add more terms to the linear predictor
##       mu[n] += r_1_1[J_1[n]] * Z_1_1[n] + r_1_2[J_1[n]] * Z_1_2[n];
##     }
##     target += normal_id_glm_lpdf(Y | X, mu, b, sigma);
##   }
##   // priors including constants
##   target += normal_lpdf(b[1] | 1.335, 1);
##   target += normal_lpdf(b[2] | 0, 0.5);
##   target += student_t_lpdf(sigma | 3, 0, 1)
##     - 1 * student_t_lccdf(0 | 3, 0, 1);
##   target += student_t_lpdf(sd_1 | 3, 0, 1)
##     - 2 * student_t_lccdf(0 | 3, 0, 1);
##   target += std_normal_lpdf(to_vector(z_1));
##   target += lkj_corr_cholesky_lpdf(L_1 | 4);
## }
## generated quantities {
##   // compute group-level correlations
##   corr_matrix[M_1] Cor_1 = multiply_lower_tri_self_transpose(L_1);
##   vector&lt;lower=-1,upper=1&gt;[NC_1] cor_1;
##   // extract upper diagonal of correlation matrix
##   for (k in 1:M_1) {
##     for (j in 1:(k - 1)) {
##       cor_1[choose(k - 1, 2) + j] = Cor_1[j, k];
##     }
##   }
## }</code></pre>
<p>That returned the Stan code corresponding to our <code>brms::brm()</code> code, above. Notice the second and third lines in the <code>parameters</code> block. Both contained <code>&lt;lower=0&gt;</code>, which indicated the lower bounds for those parameters was zero. See? Stan has you covered.</p>
<p>Let’s load the <code>wages_small_pp.csv</code> data.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="treating-time-more-flexibly.html#cb529-1" aria-hidden="true" tabindex="-1"></a>wages_small_pp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/wages_small_pp.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb529-2"><a href="treating-time-more-flexibly.html#cb529-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">hgc_9 =</span> hcg<span class="fl">.9</span>)</span>
<span id="cb529-3"><a href="treating-time-more-flexibly.html#cb529-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb529-4"><a href="treating-time-more-flexibly.html#cb529-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wages_small_pp)</span></code></pre></div>
<pre><code>## Rows: 257
## Columns: 5
## $ id    &lt;dbl&gt; 206, 206, 206, 266, 304, 329, 329, 329, 336, 336, 336, 394, 394, 394, 518, 518, 541,…
## $ lnw   &lt;dbl&gt; 2.028, 2.297, 2.482, 1.808, 1.842, 1.422, 1.308, 1.885, 1.892, 1.279, 2.224, 2.383, …
## $ exper &lt;dbl&gt; 1.874, 2.814, 4.314, 0.322, 0.580, 0.016, 0.716, 1.756, 1.910, 2.514, 3.706, 1.890, …
## $ black &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, …
## $ hgc_9 &lt;dbl&gt; 1, 1, 1, 0, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, -1, -1, 1, 1, 1, 1, 1, 1, 2, -1, 0,…</code></pre>
<p>Here’s the distribution of the number of measurement occasions for our small data set.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="treating-time-more-flexibly.html#cb531-1" aria-hidden="true" tabindex="-1"></a>wages_small_pp <span class="sc">%&gt;%</span> </span>
<span id="cb531-2"><a href="treating-time-more-flexibly.html#cb531-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb531-3"><a href="treating-time-more-flexibly.html#cb531-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb531-4"><a href="treating-time-more-flexibly.html#cb531-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb531-5"><a href="treating-time-more-flexibly.html#cb531-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb531-6"><a href="treating-time-more-flexibly.html#cb531-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;# measurement occasions&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">limits =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">13</span>)) <span class="sc">+</span></span>
<span id="cb531-7"><a href="treating-time-more-flexibly.html#cb531-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;count of cases&quot;</span>) <span class="sc">+</span></span>
<span id="cb531-8"><a href="treating-time-more-flexibly.html#cb531-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-47-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Our <code>brm()</code> code is the same as that for <code>fit5.5</code>, above, with just a slightly different <code>data</code> argument. If we wanted to, we could be hasty and just use <code>update()</code>, instead. But since we’re still practicing setting our priors and such, here we’ll be exhaustive.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="treating-time-more-flexibly.html#cb532-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.6</span> <span class="ot">&lt;-</span></span>
<span id="cb532-2"><a href="treating-time-more-flexibly.html#cb532-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_small_pp, </span>
<span id="cb532-3"><a href="treating-time-more-flexibly.html#cb532-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb532-4"><a href="treating-time-more-flexibly.html#cb532-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> hgc_9 <span class="sc">+</span> exper <span class="sc">+</span> exper<span class="sc">:</span>black <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb532-5"><a href="treating-time-more-flexibly.html#cb532-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb532-6"><a href="treating-time-more-flexibly.html#cb532-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b),</span>
<span id="cb532-7"><a href="treating-time-more-flexibly.html#cb532-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb532-8"><a href="treating-time-more-flexibly.html#cb532-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb532-9"><a href="treating-time-more-flexibly.html#cb532-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb532-10"><a href="treating-time-more-flexibly.html#cb532-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb532-11"><a href="treating-time-more-flexibly.html#cb532-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb532-12"><a href="treating-time-more-flexibly.html#cb532-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.06&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="treating-time-more-flexibly.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>## Warning: There were 20 divergent transitions after warmup. Increasing adapt_delta above 0.8 may
## help. See http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + exper + exper:black + (1 + exper | id) 
##    Data: wages_small_pp (Number of observations: 257) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 124) 
##                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.29      0.05     0.19     0.37 1.00      850     1498
## sd(exper)                0.04      0.03     0.00     0.10 1.01      497      737
## cor(Intercept,exper)    -0.03      0.31    -0.59     0.60 1.00     3253     2167
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       1.74      0.05     1.64     1.83 1.00     3070     3144
## hgc_9           0.05      0.02    -0.00     0.10 1.00     2731     2542
## exper           0.05      0.02     0.01     0.10 1.00     2567     2349
## exper:black    -0.05      0.04    -0.13     0.02 1.00     2945     2428
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.34      0.02     0.30     0.39 1.00     1258     1547
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Let’s walk through this slow.</p>
<p>You may have noticed that warning message about divergent transitions. We’ll get to that in a bit. First focus on the parameter estimates for <code>sd(exper)</code>. Unlike in the text, our posterior mean is not 0.000. But do remember that our posterior is parameterized in the <span class="math inline">\(\sigma\)</span> metric. Let’s do a little converting and look at it in a plot.</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="treating-time-more-flexibly.html#cb536-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit5<span class="fl">.6</span>)</span>
<span id="cb536-2"><a href="treating-time-more-flexibly.html#cb536-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-3"><a href="treating-time-more-flexibly.html#cb536-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span></span>
<span id="cb536-4"><a href="treating-time-more-flexibly.html#cb536-4" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span></span>
<span id="cb536-5"><a href="treating-time-more-flexibly.html#cb536-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">sigma_1 =</span> sd_id__exper) <span class="sc">%&gt;%</span> </span>
<span id="cb536-6"><a href="treating-time-more-flexibly.html#cb536-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_2_1 =</span> sigma_1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb536-7"><a href="treating-time-more-flexibly.html#cb536-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;sigma[1]&quot;</span>, <span class="st">&quot;sigma[1]^2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb536-8"><a href="treating-time-more-flexibly.html#cb536-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>())</span></code></pre></div>
<p>Plot.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="treating-time-more-flexibly.html#cb537-1" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb537-2"><a href="treating-time-more-flexibly.html#cb537-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb537-3"><a href="treating-time-more-flexibly.html#cb537-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb537-4"><a href="treating-time-more-flexibly.html#cb537-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">&quot;sigma[1]&quot;</span>, <span class="st">&quot;sigma[1]^2&quot;</span>))) <span class="sc">+</span></span>
<span id="cb537-5"><a href="treating-time-more-flexibly.html#cb537-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb537-6"><a href="treating-time-more-flexibly.html#cb537-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-50-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>In the <span class="math inline">\(\sigma\)</span> metric, the posterior is bunched up a little on the boundary, but much of its mass is a gently right-skewed mound concentrated in the 0—0.1 range. When we convert the posterior to the <span class="math inline">\(\sigma^2\)</span> metric, the parameter appears much more bunched up against the boundary. Because we typically summarize our posteriors with means or medians, the point estimate still moves away from zero.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="treating-time-more-flexibly.html#cb538-1" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb538-2"><a href="treating-time-more-flexibly.html#cb538-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb538-3"><a href="treating-time-more-flexibly.html#cb538-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb538-4"><a href="treating-time-more-flexibly.html#cb538-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   name        value .lower .upper .width .point .interval
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 sigma[1]   0.0375 0.0015 0.097    0.95 mean   qi       
## 2 sigma[1]^2 0.0021 0      0.0094   0.95 mean   qi</code></pre>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="treating-time-more-flexibly.html#cb540-1" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb540-2"><a href="treating-time-more-flexibly.html#cb540-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb540-3"><a href="treating-time-more-flexibly.html#cb540-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb540-4"><a href="treating-time-more-flexibly.html#cb540-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   name        value .lower .upper .width .point .interval
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 sigma[1]   0.033  0.0015 0.097    0.95 median qi       
## 2 sigma[1]^2 0.0011 0      0.0094   0.95 median qi</code></pre>
<p>But it really does start to shoot to zero if we attempt to summarize the central tendency with the mode, as within the maximum likelihood paradigm.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="treating-time-more-flexibly.html#cb542-1" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb542-2"><a href="treating-time-more-flexibly.html#cb542-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb542-3"><a href="treating-time-more-flexibly.html#cb542-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mode_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb542-4"><a href="treating-time-more-flexibly.html#cb542-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   name          value .lower .upper .width .point .interval
##   &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 sigma[1]   0.016    0.0015 0.097    0.95 mode   qi       
## 2 sigma[1]^2 0.000300 0      0.0094   0.95 mode   qi</code></pre>
<p>Backing up to that warning message, we were informed that “Increasing adapt_delta above 0.8 may help.” The <code>adapt_delta</code> parameter ranges from 0 to 1. The <code>brm()</code> default is .8. In my experience, increasing to .9 or .99 is often a good place to start. For this model, .9 wasn’t quite enough, but .99 worked. Here’s how to do it.</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="treating-time-more-flexibly.html#cb544-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.7</span> <span class="ot">&lt;-</span></span>
<span id="cb544-2"><a href="treating-time-more-flexibly.html#cb544-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_small_pp, </span>
<span id="cb544-3"><a href="treating-time-more-flexibly.html#cb544-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb544-4"><a href="treating-time-more-flexibly.html#cb544-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> hgc_9 <span class="sc">+</span> exper <span class="sc">+</span> exper<span class="sc">:</span>black <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb544-5"><a href="treating-time-more-flexibly.html#cb544-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb544-6"><a href="treating-time-more-flexibly.html#cb544-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b),</span>
<span id="cb544-7"><a href="treating-time-more-flexibly.html#cb544-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb544-8"><a href="treating-time-more-flexibly.html#cb544-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb544-9"><a href="treating-time-more-flexibly.html#cb544-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb544-10"><a href="treating-time-more-flexibly.html#cb544-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb544-11"><a href="treating-time-more-flexibly.html#cb544-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb544-12"><a href="treating-time-more-flexibly.html#cb544-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb544-13"><a href="treating-time-more-flexibly.html#cb544-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.07&quot;</span>)</span></code></pre></div>
<p>Now look at the summary.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="treating-time-more-flexibly.html#cb545-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + exper + exper:black + (1 + exper | id) 
##    Data: wages_small_pp (Number of observations: 257) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 124) 
##                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.28      0.05     0.19     0.38 1.00      875     1133
## sd(exper)                0.04      0.03     0.00     0.11 1.00      433      920
## cor(Intercept,exper)    -0.03      0.32    -0.62     0.60 1.00     2785     2784
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       1.74      0.05     1.64     1.83 1.00     1965     2344
## hgc_9           0.05      0.02    -0.00     0.10 1.00     2125     2625
## exper           0.05      0.02     0.00     0.10 1.00     2461     2995
## exper:black    -0.05      0.04    -0.12     0.02 1.00     2483     2991
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.34      0.02     0.30     0.39 1.00     1225     2107
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our estimates were pretty much the same as before. Happily, this time we got our summary without any warning signs. It won’t always be that way, so make sure to take <code>adapt_delta</code> warnings seriously.</p>
<p>Now do note that for both <code>fit5.6</code> and <code>fit5.7</code>, our effective sample sizes for <span class="math inline">\(\sigma_0\)</span> and <span class="math inline">\(\sigma_1\)</span> aren’t terribly large relative to the total number of post-warmup draws, 4,000. If it was really important that you had high-quality summary statistics for these parameters, you might need to refit the model with something like <code>iter = 20000, warmup = 2000</code>.</p>
<p>In Model B in Table 5.5, Singer and Willett gave the results of a model with the boundary constraints on the <span class="math inline">\(\sigma^2\)</span> parameters removed. I am not going to attempt something like that with <strong>brms</strong>. If you’re interested, you’re on your own.</p>
<p>But we will fit a version of their Model C where we’ve removed the <span class="math inline">\(\sigma_1\)</span> parameter. Notice that this results in our removal of the LKJ prior for <span class="math inline">\(\rho_{01}\)</span>, too. Without a <span class="math inline">\(\sigma_1\)</span>, there’s no other parameter with which our lonely <span class="math inline">\(\sigma_0\)</span> might covary.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="treating-time-more-flexibly.html#cb547-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.8</span> <span class="ot">&lt;-</span></span>
<span id="cb547-2"><a href="treating-time-more-flexibly.html#cb547-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_small_pp, </span>
<span id="cb547-3"><a href="treating-time-more-flexibly.html#cb547-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb547-4"><a href="treating-time-more-flexibly.html#cb547-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> hgc_9 <span class="sc">+</span> exper <span class="sc">+</span> exper<span class="sc">:</span>black <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id),</span>
<span id="cb547-5"><a href="treating-time-more-flexibly.html#cb547-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb547-6"><a href="treating-time-more-flexibly.html#cb547-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b),</span>
<span id="cb547-7"><a href="treating-time-more-flexibly.html#cb547-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb547-8"><a href="treating-time-more-flexibly.html#cb547-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb547-9"><a href="treating-time-more-flexibly.html#cb547-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb547-10"><a href="treating-time-more-flexibly.html#cb547-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb547-11"><a href="treating-time-more-flexibly.html#cb547-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.08&quot;</span>)</span></code></pre></div>
<p>Here is the basic model summary.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="treating-time-more-flexibly.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + exper + exper:black + (1 | id) 
##    Data: wages_small_pp (Number of observations: 257) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 124) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.30      0.04     0.22     0.37 1.00     1125     2007
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       1.74      0.05     1.64     1.83 1.00     2560     2876
## hgc_9           0.05      0.02    -0.00     0.09 1.00     2321     2602
## exper           0.05      0.02     0.01     0.09 1.00     2647     2589
## exper:black    -0.06      0.04    -0.13     0.01 1.00     2520     3151
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.34      0.02     0.30     0.39 1.00     1509     2770
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>No warning messages and our effective samples for <span class="math inline">\(\sigma_0\)</span> improved a bit. Compute the WAIC for both models.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="treating-time-more-flexibly.html#cb550-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.7</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb550-2"><a href="treating-time-more-flexibly.html#cb550-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<p>Compare.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="treating-time-more-flexibly.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.7</span>, fit5<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb551-2"><a href="treating-time-more-flexibly.html#cb551-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff  elpd_waic se_elpd_waic p_waic   se_p_waic waic     se_waic 
## fit5.8    0.000     0.000 -131.467    20.302       69.642   11.970   262.935   40.604
## fit5.7   -2.902     2.669 -134.369    22.371       71.889   14.055   268.739   44.741</code></pre>
<p>Yep. Those WAIC estimates are quite similar and when you compare them with formal <span class="math inline">\(\text{elpd}\)</span> difference scores, the standard error is about the same size as the difference itself.</p>
<p>Though we’re stepping away from the text a bit, we should explore more alternatives for this boundary issue. The Stan team has put together a <em>Prior Choice Recommendations</em> wiki at <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations</a>. In the <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations#boundary-avoiding-priors-for-modal-estimation-posterior-mode-map-marginal-posterior-mode-marginal-maximum-likelihood-mml"><em>Boundary-avoiding priors for modal estimation (posterior mode, MAP, marginal posterior mode, marginal maximum likelihood, MML)</em></a> section, we read:</p>
<blockquote>
<ul>
<li>These are for parameters such as group-level scale parameters, group-level correlations, group-level covariance matrix</li>
<li>What all these parameters have in common is that (a) they’re defined on a space with a boundary, and (b) the likelihood, or marginal likelihood, can have a mode on the boundary. Most famous example is the group-level scale parameter tau for the 8-schools hierarchical model.</li>
<li>With full Bayes the boundary shouldn’t be a problem (as long as you have any proper prior).</li>
<li>But with modal estimation, the estimate can be on the boundary, which can create problems in posterior predictions. For example, consider a varying-intercept varying-slope multilevel model which has an intercept and slope for each group. Suppose you fit marginal maximum likelihood and get a modal estimate of 1 for the group-level correlation. Then in your predictions the intercept and slope will be perfectly correlated, which in general will be unrealistic.</li>
<li>For a one-dimensional parameter restricted to be positive (e.g., the scale parameter in a hierarchical model), we recommend Gamma(2,0) prior (that is, p(tau) proportional to tau) which will keep the mode away from 0 but still allows it to be arbitrarily close to the data if that is what the likelihood wants. For details see this paper by Chung et al.: <a href="http://www.stat.columbia.edu/~gelman/research/published/chung_etal_Pmetrika2013.pdf" class="uri">http://www.stat.columbia.edu/~gelman/research/published/chung_etal_Pmetrika2013.pdf</a>
<ul>
<li>Gamma(2,0) biases the estimate upward. When number of groups is small, try Gamma(2,1/A), where A is a scale parameter representing how high tau can be.</li>
</ul></li>
</ul>
</blockquote>
<p>We should walk those Gamma priors out, a bit. The paper by <span class="citation"><a href="references.html#ref-chungNondegeneratePenalizedLikelihood2013" role="doc-biblioref">Chung et al.</a> (<a href="references.html#ref-chungNondegeneratePenalizedLikelihood2013" role="doc-biblioref">2013</a>)</span> is quite helpful. We’ll first let them give us a little more background in the topic:</p>
<blockquote>
<p>Zero group-level variance estimates can cause several problems. Zero variance can go against prior knowledge of researchers and results in underestimation of uncertainty in fixed coefficient estimates. Inferences for groups are often of interest to researchers, but when the group-level variance is estimated as zero, the resulting predictions of the group-level errors will all be zero, so one fails to find unexplained differences between groups. In addition, uncertainty in predictions for new and existing groups is also understated. (p. 686)</p>
</blockquote>
<p>They expounded further on page 687.</p>
<blockquote>
<p>When a variance parameter is estimated as zero, there is typically a large amount of uncertainty about this variance. One possibility is to declare in such situations that not enough information is available to estimate a multilevel model. However, the available alternatives can be unappealing since, as noted in the introduction, discarding a variance component or setting the variance to zero understates the uncertainty. In particular, standard errors for coefficients of covariates that vary between groups will be too low as we will see in Section 2.2. The other extreme is to fit a regression with indicators for groups (a fixed-effects model), but this will overcorrect for group effects (it is mathematically equivalent to a mixed-effects model with variance set to infinity), and also does not allow predictions for new groups.</p>
<p>Degenerate variance estimates lead to complete shrinkage of predictions for new and existing groups and yield estimated prediction standard errors that understate uncertainty. This problem has been pointed out by Li and Lahiri <span class="citation">(<a href="references.html#ref-liAdjustedMaximumLikelihood2010" role="doc-biblioref">2010</a>)</span> and Morris and Tang <span class="citation">(<a href="references.html#ref-morrisEstimatingRandomEffects2011" role="doc-biblioref">2011</a>)</span> in small area estimation….</p>
<p>If zero variance is not a null hypothesis of interest, a boundary estimate, and the corresponding zero likelihood ratio test statistic, should not necessarily lead us to accept the null hypothesis and to proceed as if the true variance is zero.</p>
</blockquote>
<p>In their paper, they covered both penalized maximum likelihood and full Bayesian estimation. We’re just going to focus on Bayes, but some of the quotes will contain ML talk. Further, we read:</p>
<blockquote>
<p>We recommend a class of log-gamma penalties (or gamma priors) that in our default setting (the log-gamma(2, <span class="math inline">\(\lambda\)</span>) penalty with <span class="math inline">\(\lambda \rightarrow 0\)</span>) produce maximum penalized likelihood (MPL) estimates (or Bayes modal estimates) approximately one standard error away from zero when the maximum likelihood estimate is at zero. We consider these priors to be weakly informative in the sense that they supply some direction but still allow inference to be driven by the data. The penalty has little influence when the number of groups is large or when the data are informative about the variance, and the asymptotic mean squared error of the proposed estimator is the same as that of the maximum likelihood estimator. (p. 686)</p>
</blockquote>
<p>In the upper left panel of Figure 3, Chung and colleagues gave an example of what they mean by <span class="math inline">\(\lambda \rightarrow 0\)</span>: <span class="math inline">\(\lambda = 0.1\)</span>. Here’s an example of what <span class="math inline">\(\operatorname{Gamma}(2, 0.1)\)</span> looks like across the parameter space of 0 to 100.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="treating-time-more-flexibly.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb553-2"><a href="treating-time-more-flexibly.html#cb553-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb553-3"><a href="treating-time-more-flexibly.html#cb553-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dgamma, <span class="at">n =</span> <span class="fl">1e2</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">2</span>, <span class="at">rate =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb553-4"><a href="treating-time-more-flexibly.html#cb553-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb553-5"><a href="treating-time-more-flexibly.html#cb553-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-57-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Given we’re working with data on the log scale, that’s a massively permissive prior. Let’s zoom in and see what it means for the parameter space of possible values for our data.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="treating-time-more-flexibly.html#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb554-2"><a href="treating-time-more-flexibly.html#cb554-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb554-3"><a href="treating-time-more-flexibly.html#cb554-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dgamma, <span class="at">n =</span> <span class="fl">1e2</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">2</span>, <span class="at">rate =</span> .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb554-4"><a href="treating-time-more-flexibly.html#cb554-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb554-5"><a href="treating-time-more-flexibly.html#cb554-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-58-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Now keep that picture in mind as we read further along in the paper:</p>
<blockquote>
<p>In addition, with <span class="math inline">\(\lambda \rightarrow 0\)</span>, the gamma density function has a positive constant derivative at zero, which allows the likelihood to dominate if it is strongly curved near zero. The positive constant derivative implies that the prior is linear at zero so that there is no dead zone near zero. The top-left panel of Figure 3 shows that the gamma(2,0.1) density increases linearly from zero with a gentle slope. The shape will be even flatter with a smaller rate parameter. (p. 691)</p>
</blockquote>
<p>In case you’re not familiar with the gamma distribution, the rate parameter is what we’ve been calling <span class="math inline">\(\lambda\)</span>. Let’s test this baby out with our model. Here’s how to specify it in <strong>brms</strong>.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="treating-time-more-flexibly.html#cb555-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.9</span> <span class="ot">&lt;-</span></span>
<span id="cb555-2"><a href="treating-time-more-flexibly.html#cb555-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_small_pp, </span>
<span id="cb555-3"><a href="treating-time-more-flexibly.html#cb555-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb555-4"><a href="treating-time-more-flexibly.html#cb555-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> hgc_9 <span class="sc">+</span> exper <span class="sc">+</span> exper<span class="sc">:</span>black <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb555-5"><a href="treating-time-more-flexibly.html#cb555-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb555-6"><a href="treating-time-more-flexibly.html#cb555-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb555-7"><a href="treating-time-more-flexibly.html#cb555-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb555-8"><a href="treating-time-more-flexibly.html#cb555-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">2</span>, <span class="fl">0.1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> id, <span class="at">coef =</span> exper),</span>
<span id="cb555-9"><a href="treating-time-more-flexibly.html#cb555-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb555-10"><a href="treating-time-more-flexibly.html#cb555-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb555-11"><a href="treating-time-more-flexibly.html#cb555-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb555-12"><a href="treating-time-more-flexibly.html#cb555-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb555-13"><a href="treating-time-more-flexibly.html#cb555-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.09&quot;</span>)</span></code></pre></div>
<p>Notice that we didn’t bother fooling around with <code>adapt_delta</code> and the model fit just fine. Here are the results.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="treating-time-more-flexibly.html#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.9</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + exper + exper:black + (1 + exper | id) 
##    Data: wages_small_pp (Number of observations: 257) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 124) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.283     0.050    0.180    0.379 1.003     1143     1637
## sd(exper)               0.060     0.029    0.011    0.126 1.022      531     1271
## cor(Intercept,exper)   -0.094     0.305   -0.625    0.537 1.004     1671     2795
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept      1.733     0.048    1.638    1.826 1.000     2775     2861
## hgc_9          0.048     0.025   -0.001    0.097 1.000     3026     2864
## exper          0.051     0.024    0.005    0.099 1.002     2643     2899
## exper:black   -0.051     0.038   -0.127    0.023 1.002     3137     3215
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.344     0.023    0.302    0.392 1.002     1469     2216
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our <code>sd(exper)</code> is still quite close to zero. But notice how not the lower level of the 95% interval is higher than zero. Here’s what it looks like in both <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\sigma^2\)</span> metrics.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="treating-time-more-flexibly.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(fit5<span class="fl">.9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb558-2"><a href="treating-time-more-flexibly.html#cb558-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">sigma_1 =</span> sd_id__exper) <span class="sc">%&gt;%</span> </span>
<span id="cb558-3"><a href="treating-time-more-flexibly.html#cb558-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_2_1 =</span> sigma_1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb558-4"><a href="treating-time-more-flexibly.html#cb558-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;sigma[1]&quot;</span>, <span class="st">&quot;sigma[1]^2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb558-5"><a href="treating-time-more-flexibly.html#cb558-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb558-6"><a href="treating-time-more-flexibly.html#cb558-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb558-7"><a href="treating-time-more-flexibly.html#cb558-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb558-8"><a href="treating-time-more-flexibly.html#cb558-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb558-9"><a href="treating-time-more-flexibly.html#cb558-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">&quot;sigma[1]&quot;</span>, <span class="st">&quot;sigma[1]^2&quot;</span>))) <span class="sc">+</span></span>
<span id="cb558-10"><a href="treating-time-more-flexibly.html#cb558-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb558-11"><a href="treating-time-more-flexibly.html#cb558-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-60-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Let’s zoom in on the leftmost part of the plot.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="treating-time-more-flexibly.html#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(fit5<span class="fl">.9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb559-2"><a href="treating-time-more-flexibly.html#cb559-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">sigma_1 =</span> sd_id__exper) <span class="sc">%&gt;%</span> </span>
<span id="cb559-3"><a href="treating-time-more-flexibly.html#cb559-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_2_1 =</span> sigma_1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb559-4"><a href="treating-time-more-flexibly.html#cb559-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;sigma[1]&quot;</span>, <span class="st">&quot;sigma[1]^2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb559-5"><a href="treating-time-more-flexibly.html#cb559-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb559-6"><a href="treating-time-more-flexibly.html#cb559-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb559-7"><a href="treating-time-more-flexibly.html#cb559-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb559-8"><a href="treating-time-more-flexibly.html#cb559-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb559-9"><a href="treating-time-more-flexibly.html#cb559-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb559-10"><a href="treating-time-more-flexibly.html#cb559-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">&quot;sigma[1]&quot;</span>, <span class="st">&quot;sigma[1]^2&quot;</span>))) <span class="sc">+</span></span>
<span id="cb559-11"><a href="treating-time-more-flexibly.html#cb559-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>)) <span class="sc">+</span></span>
<span id="cb559-12"><a href="treating-time-more-flexibly.html#cb559-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-61-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Although we are still brushing up on the boundary with <span class="math inline">\(\sigma_1^2\)</span>, the mode is no longer at zero. In the discussion, Chung and colleagues pointed out “sometimes weak prior information is available about a variance parameter. When <span class="math inline">\(\alpha = 2\)</span>, the gamma density has its mode at <span class="math inline">\(1 / \lambda\)</span>, and so one can use the <span class="math inline">\(\operatorname{gamma}(\alpha, \lambda)\)</span> prior with <span class="math inline">\(1 / \lambda\)</span> set to the prior estimate of <span class="math inline">\(\sigma_\theta\)</span>” (p. 703). Let’s say we only had our <code>wages_small_pp</code>, but the results of something like the <code>wages_pp</code> data were published by some earlier group of researchers. In this case, we do have good prior data; we have the point estimate from the model of the <code>wages_pp</code> data! Here’s what that was in terms of the median.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="treating-time-more-flexibly.html#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(fit5<span class="fl">.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb560-2"><a href="treating-time-more-flexibly.html#cb560-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(sd_id__exper)</span></code></pre></div>
<pre><code>##   sd_id__exper     .lower     .upper .width .point .interval
## 1   0.04148015 0.03621395 0.04692132   0.95 median        qi</code></pre>
<p>And here’s what that value is when set as the divisor of 1.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="treating-time-more-flexibly.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="fl">0.04154273</span></span></code></pre></div>
<pre><code>## [1] 24.0716</code></pre>
<p>What does that distribution look like?</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="treating-time-more-flexibly.html#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb564-2"><a href="treating-time-more-flexibly.html#cb564-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb564-3"><a href="treating-time-more-flexibly.html#cb564-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dgamma, <span class="at">n =</span> <span class="fl">1e3</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">2</span>, <span class="at">rate =</span> <span class="fl">24.0716</span>)) <span class="sc">+</span></span>
<span id="cb564-4"><a href="treating-time-more-flexibly.html#cb564-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb564-5"><a href="treating-time-more-flexibly.html#cb564-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-64-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>So this is much more informative than our <code>gamma(2, 0.1)</code> prior from before. But given the magnitude of the estimate from <code>fit5.3</code>, it’s still fairly liberal. Let’s practice using it.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="treating-time-more-flexibly.html#cb565-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.10</span> <span class="ot">&lt;-</span></span>
<span id="cb565-2"><a href="treating-time-more-flexibly.html#cb565-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_small_pp, </span>
<span id="cb565-3"><a href="treating-time-more-flexibly.html#cb565-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb565-4"><a href="treating-time-more-flexibly.html#cb565-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> hgc_9 <span class="sc">+</span> exper <span class="sc">+</span> exper<span class="sc">:</span>black <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb565-5"><a href="treating-time-more-flexibly.html#cb565-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb565-6"><a href="treating-time-more-flexibly.html#cb565-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b),</span>
<span id="cb565-7"><a href="treating-time-more-flexibly.html#cb565-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb565-8"><a href="treating-time-more-flexibly.html#cb565-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">2</span>, <span class="fl">24.0716</span>), <span class="at">class =</span> sd, <span class="at">group =</span> id, <span class="at">coef =</span> exper),</span>
<span id="cb565-9"><a href="treating-time-more-flexibly.html#cb565-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb565-10"><a href="treating-time-more-flexibly.html#cb565-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb565-11"><a href="treating-time-more-flexibly.html#cb565-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb565-12"><a href="treating-time-more-flexibly.html#cb565-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb565-13"><a href="treating-time-more-flexibly.html#cb565-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.10&quot;</span>)</span></code></pre></div>
<p>Check out the results.</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="treating-time-more-flexibly.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.10</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + exper + exper:black + (1 + exper | id) 
##    Data: wages_small_pp (Number of observations: 257) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 124) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.286     0.048    0.190    0.378 1.007      863     1445
## sd(exper)               0.042     0.024    0.007    0.098 1.003      722     1373
## cor(Intercept,exper)   -0.042     0.314   -0.605    0.597 1.002     2872     2513
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept      1.736     0.050    1.638    1.834 1.002     2687     2552
## hgc_9          0.046     0.025   -0.004    0.094 1.002     2258     2198
## exper          0.051     0.023    0.006    0.097 1.001     2830     2570
## exper:black   -0.055     0.037   -0.124    0.018 1.001     2976     2924
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.345     0.023    0.304    0.392 1.003     1181     2317
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we compare the three ways to specify the <span class="math inline">\(\sigma_1\)</span> prior with the posterior from the original model fit with the full data set. For simplicity, we’ll just look at the results in the <strong>brms</strong>-like <span class="math inline">\(\sigma\)</span> metric. Hopefully by now you’ll know how to do the conversions to get the values into the <span class="math inline">\(\sigma^2\)</span> metric.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="treating-time-more-flexibly.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">full data, student_t(3, 0, 1) prior</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">VarCorr</span>(fit5<span class="fl">.3</span>, <span class="at">summary =</span> F)[[<span class="dv">1</span>]][[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>, <span class="dv">2</span>],</span>
<span id="cb568-2"><a href="treating-time-more-flexibly.html#cb568-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">small data, student_t(3, 0, 1) prior</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">VarCorr</span>(fit5<span class="fl">.7</span>, <span class="at">summary =</span> F)[[<span class="dv">1</span>]][[<span class="dv">1</span>]][, <span class="dv">2</span>],</span>
<span id="cb568-3"><a href="treating-time-more-flexibly.html#cb568-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">small data, gamma(2, 0.1) prior</span><span class="st">`</span>      <span class="ot">=</span> <span class="fu">VarCorr</span>(fit5<span class="fl">.9</span>, <span class="at">summary =</span> F)[[<span class="dv">1</span>]][[<span class="dv">1</span>]][, <span class="dv">2</span>],</span>
<span id="cb568-4"><a href="treating-time-more-flexibly.html#cb568-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">small data, gamma(2, 24.0716) prior</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">VarCorr</span>(fit5<span class="fl">.10</span>, <span class="at">summary =</span> F)[[<span class="dv">1</span>]][[<span class="dv">1</span>]][, <span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb568-5"><a href="treating-time-more-flexibly.html#cb568-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb568-6"><a href="treating-time-more-flexibly.html#cb568-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, </span>
<span id="cb568-7"><a href="treating-time-more-flexibly.html#cb568-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;full data, student_t(3, 0, 1) prior&quot;</span>, </span>
<span id="cb568-8"><a href="treating-time-more-flexibly.html#cb568-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;small data, student_t(3, 0, 1) prior&quot;</span>, </span>
<span id="cb568-9"><a href="treating-time-more-flexibly.html#cb568-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;small data, gamma(2, 0.1) prior&quot;</span>, </span>
<span id="cb568-10"><a href="treating-time-more-flexibly.html#cb568-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;small data, gamma(2, 24.0716) prior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb568-11"><a href="treating-time-more-flexibly.html#cb568-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb568-12"><a href="treating-time-more-flexibly.html#cb568-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">fill =</span> name <span class="sc">==</span> <span class="st">&quot;full data, student_t(3, 0, 1) prior&quot;</span>)) <span class="sc">+</span></span>
<span id="cb568-13"><a href="treating-time-more-flexibly.html#cb568-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb568-14"><a href="treating-time-more-flexibly.html#cb568-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb568-15"><a href="treating-time-more-flexibly.html#cb568-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb568-16"><a href="treating-time-more-flexibly.html#cb568-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey75&quot;</span>, <span class="st">&quot;darkgoldenrod2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb568-17"><a href="treating-time-more-flexibly.html#cb568-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb568-18"><a href="treating-time-more-flexibly.html#cb568-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb568-19"><a href="treating-time-more-flexibly.html#cb568-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-66-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>One thing to notice is that when you’re working with full Bayesian estimation with even a rather vague prior with a boundary on zero, the measure of central tendency in the posterior is away from zero. Things get more compact when you’re working in the <span class="math inline">\(\sigma^2\)</span> metric. But remember that when we’re fitting our models with <strong>brms</strong>, we’re in the <span class="math inline">\(\sigma\)</span> metric, anyway. And with either of these three options, you don’t have a compelling reason to set the <span class="math inline">\(\sigma_\theta\)</span> parameter to zero the way you would with ML. Even a rather vague prior will add enough information to the model that we can feel confident about keeping our theoretically-derived <span class="math inline">\(\sigma_1\)</span> parameter.</p>
</div>
<div id="nonconvergence-i.e.-its-time-to-talk-chains-and-such." class="section level4" number="5.2.2.2">
<h4><span class="header-section-number">5.2.2.2</span> Nonconvergence [i.e., it’s time to talk chains and such].</h4>
<p>As discussed in <a href="doing-data-analysis-with-the-multilevel-model-for-change.html#methods-of-estimation-revisited">Section 4.3</a>, all multilevel modeling programs implement iterative numeric algorithms for model fitting. (p. 155). This is also true for our Stan-propelled <strong>brms</strong> software. However, what’s going on under the hood, here, is not what’s happening with the frequentist packages discussed by Singer and Willett. We’re using Hamiltonian Monte Carlo (HMC) to draw from the posterior. To my eye, Bürkner gave in a <span class="citation">(<a href="references.html#ref-burknerBayesianItemResponse2020" role="doc-biblioref">2020a</a>)</span> preprint probably the clearest and most direct introduction to why we need fancy algorithms like HMC to fit Bayesian models. First, Bürkner warmed up by contrasting Bayes with conventional frequentist inference:</p>
<blockquote>
<p>In frequentist statistics, parameter estimates are usually obtained by finding those parameter values that maximise the likelihood. In contrast, Bayesian statistics aims to estimate the full (joint) posterior distribution of the parameters. This is not only fully consistent with probability theory, but also much more informative than a single point estimate (and an approximate measure of uncertainty commonly known as ‘standard error’). (p. 9)</p>
</blockquote>
<p>Those iterative algorithms Singer and Willett discussed in this section, that’s what they’re doing. They are maximizing the likelihood. But with Bayes, we have the more challenging goal of describing the entire posterior distribution, which is the product of the likelihood and the prior. As such,</p>
<blockquote>
<p>Obtaining the posterior distribution analytically is only possible in certain cases of carefully chosen combinations of prior and likelihood, which may considerably limit modeling flexibilty but yield a computational advantage. However, with the increased power of today’s computers, Markov-Chain Monte-Carlo (MCMC) sampling methods constitute a powerful and feasible alternative to obtaining posterior distributions for complex models in which the majority of modeling decisions is made based on theoretical and not computational grounds. Despite all the computing power, these sampling algorithms are computationally very intensive and thus fitting models using full Bayesian inference is usually much slower than in point estimation techniques. However, advantages of Bayesian inference – such as greater modeling flexibility, prior distributions, and more informative results – are often worth the increased computational cost (Gelman, Carlin, Stern, and Rubin 2013). (pp. 9–10)</p>
</blockquote>
<p>The gritty details are well beyond the scope of this project. If you’d like a more thorough walk-through on why it’s analytically and computationally challenging to get the posterior, I recommend working through the first several chapters in Kruschke’s <span class="citation">(<a href="references.html#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> <a href="http://www.indiana.edu/~kruschke/DoingBayesianDataAnalysis/"><em>Doing Bayesian data analysis: A tutorial with R, JAGS, and Stan</em></a>.</p>
<p>But so anyways, our primary algorithm is HMC as implemented by Stan. You can find all kinds of technical details at <a href="https://mc-stan.org/users/documentation/">https://mc-stan.org/users/documentation/</a>. Because it’s rather difficult to describe our Bayesian multilevel models analytically, we use HMC to draw from the posterior instead. We then summarize the marginal and joint distributions of those parameters with things like measures of central tendency (i.e., means, medians, modes) and spread (i.e., standard deviations, percentile-based intervals). We make lots of plots.</p>
<p>And somewhat like with the frequentist iterative algorithms, we need to make sure our sweet Stan-based HMC is working well, too. One way is with trace plots.</p>
<div id="trace-plots." class="section level5" number="5.2.2.2.1">
<h5><span class="header-section-number">5.2.2.2.1</span> Trace plots.</h5>
<p>We can get the trace plots for a model by placing a <code>brm()</code> fit object into the <code>plot()</code> function. Here’s an example with the full model, <code>fit5.4</code>.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="treating-time-more-flexibly.html#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit5<span class="fl">.4</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-67-1.png" width="576" style="display: block; margin: auto;" /><img src="05_files/figure-html/unnamed-chunk-67-2.png" width="576" style="display: block; margin: auto;" /></p>
<p>You’ll notice we get two plots for each of the major model parameters, the <span class="math inline">\(\gamma\)</span>’s, the <span class="math inline">\(\sigma\)</span>’s and the <span class="math inline">\(\rho\)</span>’s. The plots on the left are the density plots for each parameter. On the right, we have the actual trace plots. On the <span class="math inline">\(x\)</span>-axis, we have an ordering of the posterior draws; on the <span class="math inline">\(y\)</span>, we have the parameter space. Since we requested three HMC chains to draw from the posterior (<code>chains = 3</code>), those three chains are depicted by different colored lines. We generally like it when the lines for our chains all overlap with each other in a stable zig-zag sort of way. Trace plots are sometimes called caterpillar plots because, when things are going well, they often resemble nice multicolored fuzzy caterpillars.</p>
<p>If you’d like more control over your trace plot visuals, you might check out the <a href="https://github.com/stan-dev/bayesplot"><strong>bayesplot</strong> package</a> <span class="citation">(<a href="references.html#ref-gabry2019visualization" role="doc-biblioref">Gabry et al., 2019</a>; <a href="references.html#ref-R-bayesplot" role="doc-biblioref">Gabry &amp; Mahr, 2021</a>)</span>.</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="treating-time-more-flexibly.html#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span></code></pre></div>
<p>Our main function will be <code>mcmc_trace()</code>. Unlike with the <code>brms::plot()</code> method, <code>bayesplog::mcmc_trace()</code> takes the posterior draws themselves as input. So we’ll have to use <code>posterior_samples()</code> first. By default, <code>posterior_samples()</code> does not extract information about which chain a given draw is from. So we’ll have to add the <code>add_chain = T</code> argument.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="treating-time-more-flexibly.html#cb571-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit5<span class="fl">.4</span>, <span class="at">add_chain =</span> T)</span></code></pre></div>
<p>We can use the <code>pars</code> argument to focus on particular parameters.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="treating-time-more-flexibly.html#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(post, <span class="at">pars =</span> <span class="st">&quot;sigma&quot;</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-70-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>If we use the <code>pars = vars(...)</code> format, we can use function helpers from <strong>dplyr</strong> to select subsets of parameters. For example, here’s how we might single out the <span class="math inline">\(\gamma\)</span>’s.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="treating-time-more-flexibly.html#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(post,</span>
<span id="cb573-2"><a href="treating-time-more-flexibly.html#cb573-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">pars =</span> <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)),</span>
<span id="cb573-3"><a href="treating-time-more-flexibly.html#cb573-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">ncol =</span> <span class="dv">2</span>))</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-71-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Notice how we used the <code>facet_args</code> argument to adjust the number of columns in the output. We can also use familiar <strong>ggplot2</strong> functions to customize the plots further.</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="treating-time-more-flexibly.html#cb574-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb574-2"><a href="treating-time-more-flexibly.html#cb574-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">sigma[0]</span><span class="st">`</span>       <span class="ot">=</span> sd_id__Intercept,</span>
<span id="cb574-3"><a href="treating-time-more-flexibly.html#cb574-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span>       <span class="ot">=</span> sd_id__exper,</span>
<span id="cb574-4"><a href="treating-time-more-flexibly.html#cb574-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[epsilon]</span><span class="st">`</span> <span class="ot">=</span> sigma) <span class="sc">%&gt;%</span></span>
<span id="cb574-5"><a href="treating-time-more-flexibly.html#cb574-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-6"><a href="treating-time-more-flexibly.html#cb574-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sigma[&quot;</span>)),</span>
<span id="cb574-7"><a href="treating-time-more-flexibly.html#cb574-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">labeller =</span> label_parsed)) <span class="sc">+</span></span>
<span id="cb574-8"><a href="treating-time-more-flexibly.html#cb574-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span></span>
<span id="cb574-9"><a href="treating-time-more-flexibly.html#cb574-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb574-10"><a href="treating-time-more-flexibly.html#cb574-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;I can&#39;t wait to show these traceplots to my mom.&quot;</span>) <span class="sc">+</span></span>
<span id="cb574-11"><a href="treating-time-more-flexibly.html#cb574-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb574-12"><a href="treating-time-more-flexibly.html#cb574-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,,</span>
<span id="cb574-13"><a href="treating-time-more-flexibly.html#cb574-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb574-14"><a href="treating-time-more-flexibly.html#cb574-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>),</span>
<span id="cb574-15"><a href="treating-time-more-flexibly.html#cb574-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-72-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Trace plots are connected to other important concepts, like autocorrelation and effective sample size.</p>
</div>
<div id="autocorrelation." class="section level5" number="5.2.2.2.2">
<h5><span class="header-section-number">5.2.2.2.2</span> Autocorrelation.</h5>
<p>When using Markov chain Monte Carlo methods, of which HMC is a special case, the notions of autocorrelation and effective sample size are closely connected. Both have to do with the question, How many post-warmup draws from the posterior do I need to take? If you take too few, you won’t have a good sense of the shape of the posterior. If you take more than necessary, you’re just wasting time and computer memory. Here’s how McElreath introduced the topic in his <span class="citation">(<a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">2015</a>)</span> text:</p>
<blockquote>
<p>So how many samples do we need for accurate inference about the posterior distribution? It depends. First, what really matters is the <em>effective</em> number of samples, not the raw number. The effective number of samples is an estimate of the number of independent samples from the posterior distribution. Markov chains are typically <em>autocorrelated</em>, so that sequential samples are not entirely independent. Stan chains tend to be less autocorrelated than those produced by other engines [e.g., the Gibbs sampler], but there is always some autocorrelation. (p. 255, <em>emphasis</em> in the original)</p>
</blockquote>
<p>I’m not aware of a way to query the autocorrelations from a <code>brm()</code> fit using <strong>brms</strong> convenience functions. However, we can get those diagnostics from the <code>bayesplot::mcmc_acf()</code> function.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="treating-time-more-flexibly.html#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_acf</span>(post, <span class="at">pars =</span> <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)), <span class="at">lags =</span> <span class="dv">10</span>)  <span class="sc">+</span></span>
<span id="cb575-2"><a href="treating-time-more-flexibly.html#cb575-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb575-3"><a href="treating-time-more-flexibly.html#cb575-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-73-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The <code>mcmc_acf()</code> function gives a wealth of granular output. The columns among the plots are the specified parameters. The rows are the chains, one for each. In this particular case, the autocorrelations were quite low for all our <span class="math inline">\(\gamma\)</span> parameters by the second or third lag. That’s really quite good and not uncommon for HMC. Do note, however, that this won’t always be the case. For example, here are the plots for our variance parameters and <span class="math inline">\(\rho_{01}\)</span>.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="treating-time-more-flexibly.html#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_acf</span>(post, <span class="at">pars =</span> <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sd_&quot;</span>), <span class="st">&quot;sigma&quot;</span>, <span class="fu">starts_with</span>(<span class="st">&quot;cor&quot;</span>)), <span class="at">lags =</span> <span class="dv">10</span>)  <span class="sc">+</span></span>
<span id="cb576-2"><a href="treating-time-more-flexibly.html#cb576-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb576-3"><a href="treating-time-more-flexibly.html#cb576-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb576-4"><a href="treating-time-more-flexibly.html#cb576-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>))</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-74-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>On the whole, all of them are pretty okay. But notice how the autocorrelations for <span class="math inline">\(\sigma_1\)</span> and <span class="math inline">\(\rho_{01}\)</span> remained relatively high up until the 10<sup>th</sup> lag.</p>
<p>The plots from <code>mcmc_act()</code> are quite handy for focused diagnostics. But if you want a more global perspective, they’re too tedious. Fortunately for us, we have other diagnostic tools.</p>
</div>
<div id="effective-sample-size." class="section level5" number="5.2.2.2.3">
<h5><span class="header-section-number">5.2.2.2.3</span> Effective sample size.</h5>
<p>Above we quoted McElreath as pointing out “what really matters is the <em>effective</em> number of samples, not the raw number.” With <strong>brms</strong>, you typically get the effective number of samples in the <code>print()</code> or <code>summary()</code> output. Here it is again for <code>fit4</code>.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="treating-time-more-flexibly.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit5<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + black + exper + exper:hgc_9 + exper:black + (1 + exper | id) 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.23      0.01     0.21     0.25 1.00     1159     2598
## sd(exper)                0.04      0.00     0.04     0.05 1.00      389     1235
## cor(Intercept,exper)    -0.29      0.07    -0.42    -0.15 1.00      415     1261
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       1.72      0.01     1.69     1.74 1.00     1768     3226
## hgc_9           0.04      0.01     0.02     0.05 1.00     2316     2886
## black           0.02      0.02    -0.03     0.06 1.00     1603     2781
## exper           0.05      0.00     0.04     0.05 1.00     1796     3019
## hgc_9:exper     0.00      0.00    -0.00     0.00 1.00     1985     2872
## black:exper    -0.02      0.01    -0.03    -0.01 1.00     1799     2557
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.31      0.00     0.30     0.32 1.00     2696     2879
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>See the last two columns on the right: <code>Bulk_ESS</code> and <code>Tail_ESS</code>? Following <span class="citation"><a href="references.html#ref-vehtariRanknormalizationFoldingLocalization2019" role="doc-biblioref">Vehtari, Gelman, et al.</a> (<a href="references.html#ref-vehtariRanknormalizationFoldingLocalization2019" role="doc-biblioref">2019</a>)</span>, those describe our effective sample size in two ways. From the paper, we read:</p>
<blockquote>
<p>If you plan to report quantile estimates or posterior intervals, we strongly suggest assessing the convergence of the chains for these quantiles. In Section 4.3 we show that convergence of Markov chains is not uniform across the parameter space and propose diagnostics and effective sample sizes specifically for extreme quantiles. This is <em>different</em> from the standard ESS estimate (which we refer to as the “bulk-ESS”), which mainly assesses how well the centre of the distribution is resolved. Instead, these “tail-ESS” measures allow the user to estimate the MCSE for interval estimates. (p. 5, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For more technical details, see the paper. In short, <code>Bulk_ESS</code> indexes the number of effective samples in ‘the center of the’ posterior distribution (i.e., the posterior mean or median). But since we also care about uncertainty in our parameters, we care about stability in the 95% intervals and such. The <code>Tail_ESS</code> column allows us to gauge the effective sample size for those intervals. Like with the autocorrelations, each parameter gets its own estimate for both ESS measures. You might compare the numbers to the number of post-warmup iterations, 4,500 in this case.</p>
<p>You may wonder, how many effective samples do I need? Back to McElreath:</p>
<blockquote>
<p>If all you want are posterior means, it doesn’t take many samples at all to get very good estimates. Even a couple hundred samples will do. But if you care about the exact shape in the extreme tails of the posterior, the 99th percentile or so, then you’ll need many many more. So there is no universally useful number of samples to aim for. In most typical regression applications, you can get a very good estimate of the posterior mean with as few as 200 effective samples. And if the posterior is approximately Gaussian, then all you need in addition is a good estimate of the variance, which can be had with one order of magnitude more, in most cases. For highly skewed posteriors, you’ll have to think more about which region of the distribution interests you. (p. 255)</p>
</blockquote>
<p>At the moment, <strong>brms</strong> does not offer a convenience function that allows users to collect the <code>Bulk_ESS</code> and <code>Tail_ESS</code> values in a data frame. However you can do so with help from the <a href="https://github.com/stan-dev/posterior"><strong>posterior</strong> package</a> <span class="citation">(<a href="references.html#ref-R-posterior" role="doc-biblioref">Bürkner et al., 2020</a>)</span>, which has not made its way to CRAN, yet, but can be downloaded directly from GitHub.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="treating-time-more-flexibly.html#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install the beta release with this</span></span>
<span id="cb579-2"><a href="treating-time-more-flexibly.html#cb579-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;posterior&quot;</span>, <span class="at">repos =</span> <span class="fu">c</span>(<span class="st">&quot;https://mc-stan.org/r-packages/&quot;</span>, <span class="fu">getOption</span>(<span class="st">&quot;repos&quot;</span>)))</span>
<span id="cb579-3"><a href="treating-time-more-flexibly.html#cb579-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-4"><a href="treating-time-more-flexibly.html#cb579-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install the latest development version with this instead</span></span>
<span id="cb579-5"><a href="treating-time-more-flexibly.html#cb579-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb579-6"><a href="treating-time-more-flexibly.html#cb579-6" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;stan-dev/posterior&quot;</span>)</span></code></pre></div>
<p>For our purposes, the function of interest is <code>summarise_draws()</code>, which will take the output from <code>posterior_samples()</code> as input. We’ll save the results as <code>post_sum</code>.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="treating-time-more-flexibly.html#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb580-2"><a href="treating-time-more-flexibly.html#cb580-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-3"><a href="treating-time-more-flexibly.html#cb580-3" aria-hidden="true" tabindex="-1"></a>post_sum <span class="ot">&lt;-</span></span>
<span id="cb580-4"><a href="treating-time-more-flexibly.html#cb580-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(fit5<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb580-5"><a href="treating-time-more-flexibly.html#cb580-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>()</span>
<span id="cb580-6"><a href="treating-time-more-flexibly.html#cb580-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-7"><a href="treating-time-more-flexibly.html#cb580-7" aria-hidden="true" tabindex="-1"></a>post_sum <span class="sc">%&gt;%</span> </span>
<span id="cb580-8"><a href="treating-time-more-flexibly.html#cb580-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 10
##    variable                  mean   median      sd     mad       q5      q95  rhat ess_bulk ess_tail
##    &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 b_Intercept            1.72     1.72    0.0125  0.0124   1.70     1.74     1.00    1756.    3201.
##  2 b_hgc_9                0.0351   0.0352  0.00792 0.00808  0.0220   0.0479   1.00    2304.    2873.
##  3 b_black                0.0155   0.0155  0.0242  0.0248  -0.0250   0.0542   1.00    1599.    2734.
##  4 b_exper                0.0493   0.0493  0.00265 0.00265  0.0449   0.0537   1.00    1731.    3002.
##  5 b_hgc_9:exper          0.00122  0.00121 0.00174 0.00173 -0.00162  0.00415  1.00    1982.    2863.
##  6 b_black:exper         -0.0184  -0.0184  0.00560 0.00562 -0.0275  -0.00915  1.00    1769.    2536.
##  7 sd_id__Intercept       0.227    0.227   0.0107  0.0107   0.210    0.245    1.00    1152.    2589.
##  8 sd_id__exper           0.0403   0.0402  0.00268 0.00273  0.0361   0.0449   1.00     391.    1203.
##  9 cor_id__Intercept__e… -0.293   -0.294   0.0710  0.0720  -0.405   -0.173    1.00     409.    1264.
## 10 sigma                  0.309    0.309   0.00319 0.00319  0.304    0.314    1.00    2698.    2854.</code></pre>
<p>Note how the last two columns are the <code>ess_bulk</code> and the <code>ess_tail</code>. Here we summarize them with histograms.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="treating-time-more-flexibly.html#cb582-1" aria-hidden="true" tabindex="-1"></a>post_sum <span class="sc">%&gt;%</span> </span>
<span id="cb582-2"><a href="treating-time-more-flexibly.html#cb582-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;ess&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb582-3"><a href="treating-time-more-flexibly.html#cb582-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb582-4"><a href="treating-time-more-flexibly.html#cb582-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb582-5"><a href="treating-time-more-flexibly.html#cb582-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb582-6"><a href="treating-time-more-flexibly.html#cb582-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb582-7"><a href="treating-time-more-flexibly.html#cb582-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb582-8"><a href="treating-time-more-flexibly.html#cb582-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-78-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>If you wanted a focused plot of the effective sample sizes for our primary summary parameters, you would just wrangle the output a little. Since it’s fun, we’ll switch to a lollipop plot.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="treating-time-more-flexibly.html#cb583-1" aria-hidden="true" tabindex="-1"></a>post_sum <span class="sc">%&gt;%</span> </span>
<span id="cb583-2"><a href="treating-time-more-flexibly.html#cb583-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb583-3"><a href="treating-time-more-flexibly.html#cb583-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;ess&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb583-4"><a href="treating-time-more-flexibly.html#cb583-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ess =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;ess_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb583-5"><a href="treating-time-more-flexibly.html#cb583-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-6"><a href="treating-time-more-flexibly.html#cb583-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">reorder</span>(variable, value))) <span class="sc">+</span></span>
<span id="cb583-7"><a href="treating-time-more-flexibly.html#cb583-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> value)) <span class="sc">+</span></span>
<span id="cb583-8"><a href="treating-time-more-flexibly.html#cb583-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb583-9"><a href="treating-time-more-flexibly.html#cb583-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;effective sample size&quot;</span>,</span>
<span id="cb583-10"><a href="treating-time-more-flexibly.html#cb583-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb583-11"><a href="treating-time-more-flexibly.html#cb583-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">4000</span>) <span class="sc">+</span></span>
<span id="cb583-12"><a href="treating-time-more-flexibly.html#cb583-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb583-13"><a href="treating-time-more-flexibly.html#cb583-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb583-14"><a href="treating-time-more-flexibly.html#cb583-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb583-15"><a href="treating-time-more-flexibly.html#cb583-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ess)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-79-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>You may have noticed from the ESS histogram that many of the parameters seemed to have bulk ESS values well above the total number of posterior draws (4,500). What’s that about? As is turns out, the sampling in Stan is so good that sometimes the HMC chains for a parameter can be negatively autocorrelated. When this is the case, your effective sample size can be larger than your actual sample size. Madness, I know. This was the case for many of our random effects. Here’s a look at the parameters with ten largest values.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="treating-time-more-flexibly.html#cb584-1" aria-hidden="true" tabindex="-1"></a>post_sum <span class="sc">%&gt;%</span> </span>
<span id="cb584-2"><a href="treating-time-more-flexibly.html#cb584-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ess_bulk)) <span class="sc">%&gt;%</span> </span>
<span id="cb584-3"><a href="treating-time-more-flexibly.html#cb584-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(variable, ess_bulk) <span class="sc">%&gt;%</span> </span>
<span id="cb584-4"><a href="treating-time-more-flexibly.html#cb584-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    variable              ess_bulk
##    &lt;chr&gt;                    &lt;dbl&gt;
##  1 r_id[6432,Intercept]     8350.
##  2 r_id[7110,Intercept]     8095.
##  3 r_id[7090,Intercept]     8003.
##  4 r_id[6796,Intercept]     7921.
##  5 r_id[304,Intercept]      7889.
##  6 r_id[3941,Intercept]     7878.
##  7 r_id[8498,exper]         7860.
##  8 r_id[12151,Intercept]    7853.
##  9 r_id[8293,Intercept]     7835.
## 10 r_id[7110,exper]         7802.</code></pre>
<p>Let’s take the first 4 and check their autocorrelation plots.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="treating-time-more-flexibly.html#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_acf</span>(post, <span class="at">pars =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">r_id[12335,exper]</span><span class="st">`</span>, <span class="st">`</span><span class="at">r_id[5968,Intercept]</span><span class="st">`</span>, <span class="st">`</span><span class="at">r_id[10476,Intercept]</span><span class="st">`</span>, <span class="st">`</span><span class="at">r_id[7117,Intercept]</span><span class="st">`</span>), <span class="at">lags =</span> <span class="dv">5</span>)  <span class="sc">+</span></span>
<span id="cb586-2"><a href="treating-time-more-flexibly.html#cb586-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb586-3"><a href="treating-time-more-flexibly.html#cb586-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb586-4"><a href="treating-time-more-flexibly.html#cb586-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-81-1.png" width="576" style="display: block; margin: auto;" />
See those dips below zero for the first lag in each? That’s what a negative autocorrelation looks like. Beautiful. For more on negative autocorrelations within chains and how it influences the number of effective samples, check out <a href="https://discourse.mc-stan.org/t/n-eff-bda3-vs-stan/2608">this thread on the Stan forums</a> where many members of the Stan team chimed in.</p>
</div>
<div id="widehat-r." class="section level5" number="5.2.2.2.4">
<h5><span class="header-section-number">5.2.2.2.4</span> <span class="math inline">\(\widehat R\)</span>.</h5>
<p>Return again to the default <code>print()</code> output for a <code>brms::brm()</code> fit.</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="treating-time-more-flexibly.html#cb587-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + hgc_9 + black + exper + exper:hgc_9 + exper:black + (1 + exper | id) 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.23      0.01     0.21     0.25 1.00     1159     2598
## sd(exper)                0.04      0.00     0.04     0.05 1.00      389     1235
## cor(Intercept,exper)    -0.29      0.07    -0.42    -0.15 1.00      415     1261
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       1.72      0.01     1.69     1.74 1.00     1768     3226
## hgc_9           0.04      0.01     0.02     0.05 1.00     2316     2886
## black           0.02      0.02    -0.03     0.06 1.00     1603     2781
## exper           0.05      0.00     0.04     0.05 1.00     1796     3019
## hgc_9:exper     0.00      0.00    -0.00     0.00 1.00     1985     2872
## black:exper    -0.02      0.01    -0.03    -0.01 1.00     1799     2557
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.31      0.00     0.30     0.32 1.00     2696     2879
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The third last column for each parameter is <code>Rhat</code>. “<code>Rhat</code> is a complicated estimate of the convergence of the Markov chains to the target distribution. It should approach 1.00 from above, when all is well” <span class="citation">(<a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">McElreath, 2015, p. 250</a>)</span>. We can extract <span class="math inline">\(\widehat R\)</span> directly with the <code>brms::rhat()</code> function.</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="treating-time-more-flexibly.html#cb589-1" aria-hidden="true" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">rhat</span>(fit5<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb589-2"><a href="treating-time-more-flexibly.html#cb589-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>##  Named num [1:1787] 1 1 1 1 1 ...
##  - attr(*, &quot;names&quot;)= chr [1:1787] &quot;b_Intercept&quot; &quot;b_hgc_9&quot; &quot;b_black&quot; &quot;b_exper&quot; ...</code></pre>
<p>For our <code>fit5.4</code>, the <code>brms::rhat()</code> function returned a named numeric vector, with one row for each of the 1787 parameters in the model. You can subset the <code>rhat()</code> output to focus on a few parameters.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="treating-time-more-flexibly.html#cb591-1" aria-hidden="true" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">rhat</span>(fit5<span class="fl">.4</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##              b_Intercept                  b_hgc_9                  b_black                  b_exper 
##                0.9998094                1.0003462                1.0014199                0.9999089 
##            b_hgc_9:exper            b_black:exper         sd_id__Intercept             sd_id__exper 
##                1.0012383                1.0009947                1.0014370                1.0022911 
## cor_id__Intercept__exper                    sigma 
##                1.0029188                0.9994924</code></pre>
<p>Note also that our <code>post_sum</code> object from above has an <code>rhat</code> column, too.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="treating-time-more-flexibly.html#cb593-1" aria-hidden="true" tabindex="-1"></a>post_sum <span class="sc">%&gt;%</span> </span>
<span id="cb593-2"><a href="treating-time-more-flexibly.html#cb593-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(variable, rhat) <span class="sc">%&gt;%</span> </span>
<span id="cb593-3"><a href="treating-time-more-flexibly.html#cb593-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   variable     rhat
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 b_Intercept  1.00
## 2 b_hgc_9      1.00
## 3 b_black      1.00
## 4 b_exper      1.00</code></pre>
<p>For a more global perspective, just plot.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="treating-time-more-flexibly.html#cb595-1" aria-hidden="true" tabindex="-1"></a>post_sum <span class="sc">%&gt;%</span> </span>
<span id="cb595-2"><a href="treating-time-more-flexibly.html#cb595-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rhat)) <span class="sc">+</span></span>
<span id="cb595-3"><a href="treating-time-more-flexibly.html#cb595-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb595-4"><a href="treating-time-more-flexibly.html#cb595-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">0001</span>) <span class="sc">+</span></span>
<span id="cb595-5"><a href="treating-time-more-flexibly.html#cb595-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-86-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>The <strong>bayesplot</strong> package offers a convenience function for plotting <code>brms::rhat()</code> output. Here we’ll focus on the first 20 parameters.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="treating-time-more-flexibly.html#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_rhat</span>(brms<span class="sc">::</span><span class="fu">rhat</span>(fit5<span class="fl">.4</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]) <span class="sc">+</span></span>
<span id="cb596-2"><a href="treating-time-more-flexibly.html#cb596-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">yaxis_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-87-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>By default, <code>mcmc_rhat()</code> does not return text on the <span class="math inline">\(y\)</span>-axis. But you can retrieve that text with the <code>yaxis_text()</code> function. For more on the <span class="math inline">\(\widehat R\)</span>, you might check out the <em>Rhat: potential scale reduction statistic</em> subsection of Gabry and Modrák’s <span class="citation">(<a href="references.html#ref-gabryVisualMCMC2020" role="doc-biblioref">2020</a>)</span> vignette, <a href="https://cran.r-project.org/web/packages/bayesplot/vignettes/visual-mcmc-diagnostics.html#rhat-potential-scale-reduction-statistic"><em>Visual MCMC diagnostics using the bayesplot package</em></a>.</p>
<p>We should also point out that the Stan team has found some deficiencies with the <span class="math inline">\(\widehat R\)</span>. They’ve made recommendations that will be implemented in the Stan ecosystem sometime soon. In the meantime, you can read all about it in their preprint <span class="citation">(<a href="references.html#ref-vehtariRanknormalizationFoldingLocalization2019" role="doc-biblioref">Vehtari, Gelman, et al., 2019</a>)</span> and in Dan Simpson’s blog post, <a href="https://statmodeling.stat.columbia.edu/2019/03/19/maybe-its-time-to-let-the-old-ways-die-or-we-broke-r-hat-so-now-we-have-to-fix-it/"><em>Maybe it’s time to let the old ways die; or We broke R-hat so now we have to fix it</em></a>. If you learn best by sassy twitter banter, <a href="https://twitter.com/betanalpha/status/1108185746870030336">click through this interchange</a> among some of our Stan team all-stars.</p>
</div>
</div>
</div>
<div id="distinguishing-among-different-types-of-missingness." class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Distinguishing among different types of missingness.</h3>
<blockquote>
<p>Missingness, in and of itself, is not necessarily problematic. It all depends upon what statisticians call the type of missingness. In seminal work on this topic, <span class="citation"><a href="references.html#ref-little1995ModelingDropoutMechanism" role="doc-biblioref">R. J. Little</a> (<a href="references.html#ref-little1995ModelingDropoutMechanism" role="doc-biblioref">1995</a>)</span>, refining earlier work with Rubin <span class="citation">(<a href="references.html#ref-rubin1987statistical" role="doc-biblioref">R. J. A. Little &amp; Rubin, 1987</a>)</span>, distinguished among three types of missingness: (1) <em>missing completely at random</em> (MCAR); (2) covariate-dependent dropout (CDD); and (3) <em>missing at random</em> (MAR) <span class="citation">(see also <a href="references.html#ref-schafer1997analysis" role="doc-biblioref">Schafer, 1997</a>)</span>.</p>
<p>When we say that data are MCAR, we argue that the observed values are a random sample of all the values that could have been observed (according ot plan), had there been no missing data.</p>
<p>…Covariate dependent dropout (CDD) is a less restrictive assumption that permits associations between the probability of missingness and observed predictor values (“covariates”). Data can be CDD even if the probability of missingness is systematically related to either <em>TIME</em> or observed substantive predictors.</p>
<p>…When data are MAR, the probability of missingness can depend upon <em>any</em> observed data, for either the predictors or any outcome values. It cannot, however, depend upon an <em>un</em>observed value of either any predictor or the outcome. (pp. 157–158, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For some more current introductions to missing data methods, I recommend Enders’ <span class="citation">(<a href="references.html#ref-enders2010applied" role="doc-biblioref">2010</a>)</span> <a href="http://www.appliedmissingdata.com"><em>Applied missing data analysis</em></a>, for which you can find a free sample chapter <a href="http://www.appliedmissingdata.com/sample-chapter.pdf">here</a>, and Little and Rubin’s <span class="citation">(<a href="references.html#ref-little2019statistical" role="doc-biblioref">2019</a>)</span> <a href="https://www.wiley.com/en-us/Statistical+Analysis+with+Missing+Data%2C+3rd+Edition-p-9780470526798"><em>Statistical analysis with missing data, 3rd Edition</em></a>. You might also check out van Burren’s great <span class="citation">(<a href="references.html#ref-vanbuurenFlexibleImputationMissing2018" role="doc-biblioref">2018</a>)</span> online text <a href="https://stefvanbuuren.name/fimd/"><em>Flexible imputation of missing data. Second edition</em></a>. If you’re a fan of the podcast medium, you might listen to episode 16 from the first season of the <a href="https://quantitudethepodcast.org/">Quantitude podcast</a>, <em>IF EPISODE=16 THEN EPISODE=-999;</em>, in which Patrick Curran and Greg Hancock do a fine job introducing the basics of missing data. And very happily, <strong>brms</strong> has several ways to handle missing data, about which you can learn more from Bürkner’s <span class="citation">(<a href="references.html#ref-Bürkner2021HandleMissingValues" role="doc-biblioref">2021b</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_missings.html"><em>Handle missing values with brms</em></a>.</p>
</div>
</div>
<div id="time-varying-predictors" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Time-varying predictors</h2>
<blockquote>
<p>A time-varying predictor is a variable whose <em>values</em> may differ over time. Unlike their time-invariant cousins, which record an individual’s static status, time-varying predictors record an individual’s potentially differing status on each associated measurement occasion. Some time-varying predictors have values that change naturally; others have values that change by design. (pp. 159–160, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="including-the-main-effect-of-a-time-varying-predictor." class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Including the main effect of a time-varying predictor.</h3>
<p>You can find Ginexi and colleagues’ <span class="citation">(<a href="references.html#ref-ginexiDepressionControlBeliefs2000" role="doc-biblioref">2000</a>)</span> unemployment study data in the <code>reading_pp.csv</code> file.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="treating-time-more-flexibly.html#cb597-1" aria-hidden="true" tabindex="-1"></a>unemployment_pp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/unemployment_pp.csv&quot;</span>)</span>
<span id="cb597-2"><a href="treating-time-more-flexibly.html#cb597-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-3"><a href="treating-time-more-flexibly.html#cb597-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unemployment_pp)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##      id months  cesd unemp
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   103  1.15     25     1
## 2   103  5.95     16     1
## 3   103 12.9      33     1
## 4   641  0.789    27     1
## 5   641  4.86      7     0
## 6   641 11.8      25     0</code></pre>
<p>We have 254 unique participants.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="treating-time-more-flexibly.html#cb599-1" aria-hidden="true" tabindex="-1"></a>unemployment_pp <span class="sc">%&gt;%</span> </span>
<span id="cb599-2"><a href="treating-time-more-flexibly.html#cb599-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb599-3"><a href="treating-time-more-flexibly.html#cb599-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   254</code></pre>
<p>Here’s one way to compute the number of participants who were never employed during the study.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="treating-time-more-flexibly.html#cb601-1" aria-hidden="true" tabindex="-1"></a>unemployment_pp <span class="sc">%&gt;%</span> </span>
<span id="cb601-2"><a href="treating-time-more-flexibly.html#cb601-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(unemp <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb601-3"><a href="treating-time-more-flexibly.html#cb601-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb601-4"><a href="treating-time-more-flexibly.html#cb601-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb601-5"><a href="treating-time-more-flexibly.html#cb601-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">never_employed =</span> <span class="dv">254</span> <span class="sc">-</span> n)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   never_employed
##            &lt;dbl&gt;
## 1            132</code></pre>
<p>In case it wasn’t clear, participants had up to 3 interviews.</p>
<blockquote>
<p>By recruiting 254 participants from local unemployment offices, the researchers were able to interview individuals soon after job loss (within the first 2 months). Follow-up interviews were conducted between 3 and 8 months and 10 and 16 months after job loss. (p. 161)</p>
</blockquote>
<p>Those times were encoded in the <code>months</code> variable. Here’s what that looks like.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="treating-time-more-flexibly.html#cb603-1" aria-hidden="true" tabindex="-1"></a>unemployment_pp <span class="sc">%&gt;%</span> </span>
<span id="cb603-2"><a href="treating-time-more-flexibly.html#cb603-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months))  <span class="sc">+</span></span>
<span id="cb603-3"><a href="treating-time-more-flexibly.html#cb603-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">8</span>), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb603-4"><a href="treating-time-more-flexibly.html#cb603-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb603-5"><a href="treating-time-more-flexibly.html#cb603-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-92-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>To make some of our data questions easier, we can use those 3- and 8-<code>month</code> thresholds to make an <code>interview</code> variable to indicate the periods during which the interviews were conducted.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="treating-time-more-flexibly.html#cb604-1" aria-hidden="true" tabindex="-1"></a>unemployment_pp <span class="ot">&lt;-</span> </span>
<span id="cb604-2"><a href="treating-time-more-flexibly.html#cb604-2" aria-hidden="true" tabindex="-1"></a>  unemployment_pp <span class="sc">%&gt;%</span> </span>
<span id="cb604-3"><a href="treating-time-more-flexibly.html#cb604-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">interview =</span> <span class="fu">ifelse</span>(months <span class="sc">&lt;</span> <span class="dv">3</span>, <span class="dv">1</span>,</span>
<span id="cb604-4"><a href="treating-time-more-flexibly.html#cb604-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(months <span class="sc">&gt;</span> <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">2</span>))) </span>
<span id="cb604-5"><a href="treating-time-more-flexibly.html#cb604-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb604-6"><a href="treating-time-more-flexibly.html#cb604-6" aria-hidden="true" tabindex="-1"></a>unemployment_pp <span class="sc">%&gt;%</span> </span>
<span id="cb604-7"><a href="treating-time-more-flexibly.html#cb604-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> interview))  <span class="sc">+</span></span>
<span id="cb604-8"><a href="treating-time-more-flexibly.html#cb604-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb604-9"><a href="treating-time-more-flexibly.html#cb604-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-93-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>With a little wrangling, we can display all possible employment patterns along with counts on how many followed them.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="treating-time-more-flexibly.html#cb605-1" aria-hidden="true" tabindex="-1"></a>unemployment_pp <span class="sc">%&gt;%</span></span>
<span id="cb605-2"><a href="treating-time-more-flexibly.html#cb605-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>months, <span class="sc">-</span>cesd) <span class="sc">%&gt;%</span></span>
<span id="cb605-3"><a href="treating-time-more-flexibly.html#cb605-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">interview =</span> <span class="fu">str_c</span>(<span class="st">&quot;int_&quot;</span>, interview)) <span class="sc">%&gt;%</span></span>
<span id="cb605-4"><a href="treating-time-more-flexibly.html#cb605-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> interview, <span class="at">value =</span> unemp) <span class="sc">%&gt;%</span></span>
<span id="cb605-5"><a href="treating-time-more-flexibly.html#cb605-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(int_1, int_2, int_3) <span class="sc">%&gt;%</span></span>
<span id="cb605-6"><a href="treating-time-more-flexibly.html#cb605-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb605-7"><a href="treating-time-more-flexibly.html#cb605-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb605-8"><a href="treating-time-more-flexibly.html#cb605-8" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>()</span></code></pre></div>
<template id="447cb428-e300-4a16-beba-8ab0facf342c"><style>
.tabwid table{
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-spacing: 0;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-3ee11f34{border-collapse:collapse;}.cl-3edc1da4{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-3edc3186{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3edc6476{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3edc648a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3edc649e{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-3ee11f34'><thead><tr style="overflow-wrap:break-word;"><td class="cl-3edc649e"><p class="cl-3edc3186"><span class="cl-3edc1da4">int_1</span></p></td><td class="cl-3edc649e"><p class="cl-3edc3186"><span class="cl-3edc1da4">int_2</span></p></td><td class="cl-3edc649e"><p class="cl-3edc3186"><span class="cl-3edc1da4">int_3</span></p></td><td class="cl-3edc649e"><p class="cl-3edc3186"><span class="cl-3edc1da4">n</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">78</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">0</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">0</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">55</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">0</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">41</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">27</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">22</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">0</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">19</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">0</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">4</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">4</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">0</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">2</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">0</span></p></td><td class="cl-3edc6476"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3edc648a"><p class="cl-3edc3186"><span class="cl-3edc1da4"></span></p></td><td class="cl-3edc648a"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc648a"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td><td class="cl-3edc648a"><p class="cl-3edc3186"><span class="cl-3edc1da4">1</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="9feb610e-6f56-487e-aebf-8df9bca361a1"></div>
<script>
var dest = document.getElementById("9feb610e-6f56-487e-aebf-8df9bca361a1");
var template = document.getElementById("447cb428-e300-4a16-beba-8ab0facf342c");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>It takes a little work to see how Singer and Willett came to the conclusion “62 were always working after the first interview” (p. 161). Based on an analysis of those who had complete data, that corresponds to the pattern in the top row, [1, 0, 0], which we have counted as 55 (i.e., row 2). If you add to that the two rows with missingness on one of the critical values (i.e., [1, 0, NA], [1, NA, 0], and [NA, 1, 1]), that gets you <span class="math inline">\(55 + 4 + 2 + 1 = 62\)</span>.</p>
<p>We can confirm that “41 were still unemployed at the second interview but working by the third” (p. 161). That’s our pattern [1, 1, 0], shown in row 3. We can also confirm “19 were working by the second interview but unemployed at the third” (p. 161). That’s shown in our pattern [1, 0, 1], shown in row 6.</p>
<p>Before we configure our unconditional growth model, we might familiarize ourselves with our criterion variable, <code>cesd</code>. Singer and Willett informed us:</p>
<blockquote>
<p>Each time participants completed the Center for Epidemiologic Studies’ Depression (CES-D) scale <span class="citation">(<a href="references.html#ref-radloffCESDScaleSelfreport1977" role="doc-biblioref">Radloff, 1977</a>)</span>, which asks them to rate, on a four-point scale, the frequency with which they experience each of the 20 depressive symptoms. The CES-D scores can vary from a low or 0 for someone with no symptoms to a high of 80 for someone in serious distress. (p. 161)</p>
</blockquote>
<p>In addition to Radloff’s original article, you can get a copy of the CES-D <a href="http://www.chcr.brown.edu/pcoc/cesdscale.pdf">here</a>.</p>
<p>To help us pick our priors, [Brown and Gary <span class="citation">(<a href="references.html#ref-brownPredictorsDepressiveSymptoms1985" role="doc-biblioref">1985</a>)</span> listed the means and standard deviations of the CES-D scores for unemployed African-American adults. They gave the summary statistics broken down by sex:</p>
<ul>
<li>Males: 14.05 (8.86), <span class="math inline">\(n = 37\)</span></li>
<li>Females: 15.35 (9.39), <span class="math inline">\(n = 72\)</span></li>
</ul>
<p>Based the variables in the data set and the descriptions of it in the text, we don’t have a good sense of the demographic backgrounds of the participants. But with the information we have in hand, a reasonable empirically-based but nonetheless noncommittal prior for baseline CES-D might be something like <code>normal(14.5, 20)</code>. A weakly-regularizing prior on change over 1 month might be <code>normal(0, 10)</code>. It’d be fair if you wanted to argue about these priors. Try your own! But if you are willing to go along with me, we might write the statistical formula for the unconditional growth model as</p>
<p><span class="math display">\[\begin{align*}
\text{cesd}_{ij} &amp; = \gamma_{00} + \gamma_{10} \text{months}_{ij} + \zeta_{0i} + \zeta_{1i} \text{months}_{ij} + \epsilon_{ij} \\
\epsilon_{ij}    &amp; \sim \operatorname{Normal} (0, \sigma_\epsilon) \\

\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{1i} 
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix} 
\begin{bmatrix} 0 \\ 0 \end{bmatrix},
\mathbf D \mathbf\Omega \mathbf D&#39;
\end{pmatrix} \\

\mathbf D       &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \\ 

\mathbf \Omega  &amp; = \begin{bmatrix} 1 &amp; \rho_{01} \\ \rho_{01} &amp; 1 \end{bmatrix} \\

\gamma_{00}                                      &amp; \sim \operatorname{Normal}(14.5, 20) \\
\gamma_{10}                                      &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma_\epsilon, \sigma_0, \text{ and } \sigma_1 &amp; \sim \operatorname{Student-t}(3, 0, 11.9) \\
\rho_{01}                                        &amp; \sim \operatorname{LKJ} (4).
\end{align*}\]</span></p>
<p>Those <span class="math inline">\(\operatorname{Student-t}(3, 0, 11.9)\)</span> priors for the <span class="math inline">\(\sigma\)</span>’s are the defaults, which you can confirm with <code>get_prior()</code>. The <span class="math inline">\(\operatorname{LKJ} (4)\)</span> for <span class="math inline">\(\rho_{01}\)</span> will weakly regularize the correlation towards zero.</p>
<p>Here’s how we might fit that model.</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="treating-time-more-flexibly.html#cb606-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.11</span> <span class="ot">&lt;-</span></span>
<span id="cb606-2"><a href="treating-time-more-flexibly.html#cb606-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> unemployment_pp, </span>
<span id="cb606-3"><a href="treating-time-more-flexibly.html#cb606-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb606-4"><a href="treating-time-more-flexibly.html#cb606-4" aria-hidden="true" tabindex="-1"></a>      cesd <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> months <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> months <span class="sc">|</span> id),</span>
<span id="cb606-5"><a href="treating-time-more-flexibly.html#cb606-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">14.5</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb606-6"><a href="treating-time-more-flexibly.html#cb606-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb606-7"><a href="treating-time-more-flexibly.html#cb606-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sd),</span>
<span id="cb606-8"><a href="treating-time-more-flexibly.html#cb606-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sigma),</span>
<span id="cb606-9"><a href="treating-time-more-flexibly.html#cb606-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb606-10"><a href="treating-time-more-flexibly.html#cb606-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb606-11"><a href="treating-time-more-flexibly.html#cb606-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb606-12"><a href="treating-time-more-flexibly.html#cb606-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb606-13"><a href="treating-time-more-flexibly.html#cb606-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.11&quot;</span>)</span></code></pre></div>
<p>Here are the results.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="treating-time-more-flexibly.html#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.11</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: cesd ~ 0 + Intercept + months + (1 + months | id) 
##    Data: unemployment_pp (Number of observations: 674) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 254) 
##                       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            8.764     0.843    7.225   10.445 1.007      358     1132
## sd(months)               0.449     0.203    0.034    0.802 1.013      181      301
## cor(Intercept,months)   -0.382     0.217   -0.676    0.199 1.003      530      863
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept   17.669     0.766   16.152   19.141 1.003     1546     2455
## months      -0.419     0.082   -0.583   -0.261 1.001     3486     2734
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    8.526     0.409    7.738    9.328 1.008      331     1323
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here are the posteriors for the CES-D at the first day of job loss (i.e., <span class="math inline">\(\gamma_{00}\)</span>) and the expected rate of change over one month (i.e., <span class="math inline">\(\gamma_{10}\)</span>).</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="treating-time-more-flexibly.html#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(fit5<span class="fl">.11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb609-2"><a href="treating-time-more-flexibly.html#cb609-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">first day of job loss</span><span class="st">`</span> <span class="ot">=</span> b_Intercept,</span>
<span id="cb609-3"><a href="treating-time-more-flexibly.html#cb609-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">linear decline by month</span><span class="st">`</span> <span class="ot">=</span> b_months) <span class="sc">%&gt;%</span> </span>
<span id="cb609-4"><a href="treating-time-more-flexibly.html#cb609-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb609-5"><a href="treating-time-more-flexibly.html#cb609-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb609-6"><a href="treating-time-more-flexibly.html#cb609-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb609-7"><a href="treating-time-more-flexibly.html#cb609-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb609-8"><a href="treating-time-more-flexibly.html#cb609-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb609-9"><a href="treating-time-more-flexibly.html#cb609-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;CES-D composite score&quot;</span>) <span class="sc">+</span></span>
<span id="cb609-10"><a href="treating-time-more-flexibly.html#cb609-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb609-11"><a href="treating-time-more-flexibly.html#cb609-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-96-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We might use <code>conditional_effects()</code> to get a quick view on what that might looks like.</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="treating-time-more-flexibly.html#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(fit5<span class="fl">.11</span>),</span>
<span id="cb610-2"><a href="treating-time-more-flexibly.html#cb610-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]] <span class="sc">+</span></span>
<span id="cb610-3"><a href="treating-time-more-flexibly.html#cb610-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">14.5</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb610-4"><a href="treating-time-more-flexibly.html#cb610-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb610-5"><a href="treating-time-more-flexibly.html#cb610-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-97-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>For reference, the dashed gray line is the value we centered our prior for initial status on.</p>
<div id="using-a-composite-specification." class="section level4" number="5.3.1.1">
<h4><span class="header-section-number">5.3.1.1</span> Using a composite specification.</h4>
<p>We might specify Model B, our first model with a time-varying covariate, like this:</p>
<p><span class="math display">\[\begin{align*}
\text{cesd}_{ij} &amp; = \big [ \gamma_{00} + \gamma_{10} \text{months}_{ij} + \gamma_{20} \text{unemp}_{ij} \big ] + \big [  \zeta_{0i} + \zeta_{1i} \text{months}_{ij} + \epsilon_{ij} \big ]\\
\epsilon_{ij}    &amp; \sim \operatorname{Normal}(0, \sigma_\epsilon) \\

\begin{bmatrix}
\zeta_{0i} \\ \zeta_{1i} 
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix}
\begin{bmatrix} 0 \\ 0 \end{bmatrix},
\mathbf D \mathbf\Omega \mathbf D&#39;
\end{pmatrix} \\

\mathbf D      &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \\ 

\mathbf \Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{01} \\ \rho_{01} &amp; 1 \end{bmatrix} \\

\gamma_{00}                                      &amp; \sim \operatorname{Normal}(14.5, 20) \\
\gamma_{10} \text{ and } \gamma_{20}             &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma_\epsilon, \sigma_0, \text{ and } \sigma_1 &amp; \sim \operatorname{Student-t}(3, 0, 11.9) \\
\rho_{01}                                        &amp; \sim \operatorname{LKJ}(4).
\end{align*}\]</span></p>
<p>Note a few things about the priors. First, we haven’t changed any of the priors from the previous model. All we did was add <span class="math inline">\(\gamma_{20} \sim \text{Normal}(0, 10)\)</span> for our new parameter. Given how weakly-informative our other priors have been for these data, this isn’t an unreasonable approach. However, the meaning for our intercept, <span class="math inline">\(\gamma_{01}\)</span>, has changed. Now it’s the initial status for someone who is <em>employed</em> at baseline. But remember that for Model A, we set that prior with unemployed people in mind. A careful researcher might want to dive back into the literature to see if some lower value than 14.5 would be more reasonable to set for the mean of that prior. However, since the standard deviations for our intercepts priors and the covariate priors are all rather wide and permissive, this just won’t be much of a problem, for us. Buy anyway, second, note that we’ve centered our prior for <span class="math inline">\(\gamma_{20}\)</span> on zero. This is a weakly-regularizing prior, slightly favoring smaller effects over larger ones. And like before, one could easily argue for different priors.</p>
<p>Here’s how to fit the model in <strong>brms</strong>.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="treating-time-more-flexibly.html#cb611-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.12</span> <span class="ot">&lt;-</span></span>
<span id="cb611-2"><a href="treating-time-more-flexibly.html#cb611-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> unemployment_pp, </span>
<span id="cb611-3"><a href="treating-time-more-flexibly.html#cb611-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb611-4"><a href="treating-time-more-flexibly.html#cb611-4" aria-hidden="true" tabindex="-1"></a>      cesd <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> months <span class="sc">+</span> unemp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> months <span class="sc">|</span> id),</span>
<span id="cb611-5"><a href="treating-time-more-flexibly.html#cb611-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">14.5</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb611-6"><a href="treating-time-more-flexibly.html#cb611-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb611-7"><a href="treating-time-more-flexibly.html#cb611-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sd),</span>
<span id="cb611-8"><a href="treating-time-more-flexibly.html#cb611-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sigma),</span>
<span id="cb611-9"><a href="treating-time-more-flexibly.html#cb611-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb611-10"><a href="treating-time-more-flexibly.html#cb611-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb611-11"><a href="treating-time-more-flexibly.html#cb611-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb611-12"><a href="treating-time-more-flexibly.html#cb611-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb611-13"><a href="treating-time-more-flexibly.html#cb611-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.12&quot;</span>)</span></code></pre></div>
<p>If you compare our results to those in Table 5.7, you’ll see they’re quite similar.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="treating-time-more-flexibly.html#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.12</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: cesd ~ 0 + Intercept + months + unemp + (1 + months | id) 
##    Data: unemployment_pp (Number of observations: 674) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 254) 
##                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)             9.10      0.88     7.39    10.82 1.02      367      714
## sd(months)                0.54      0.21     0.05     0.86 1.03      185      326
## cor(Intercept,months)    -0.46      0.19    -0.71     0.07 1.01      720      602
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    12.79      1.24    10.42    15.21 1.00     2220     2919
## months       -0.21      0.09    -0.39    -0.02 1.00     2758     3134
## unemp         4.99      1.02     2.91     6.91 1.00     2653     3008
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     8.17      0.43     7.37     9.03 1.02      282      853
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Before we make our versions of Figure 5.3, let’s first compare <span class="math inline">\(\gamma_{01}\)</span> posteriors by model. On page 166 of the text, Singer and Willett reported the monthly rate of decline “had been cut in half (to 0.20 from 0.42 in Model A).”</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="treating-time-more-flexibly.html#cb614-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit5<span class="fl">.11</span>)[<span class="st">&quot;months&quot;</span>, ]</span></code></pre></div>
<pre><code>##    Estimate   Est.Error        Q2.5       Q97.5 
## -0.41939121  0.08219635 -0.58326498 -0.26099457</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="treating-time-more-flexibly.html#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="st">&quot;months&quot;</span>, ]</span></code></pre></div>
<pre><code>##    Estimate   Est.Error        Q2.5       Q97.5 
## -0.20514104  0.09149029 -0.38731834 -0.02449475</code></pre>
<p>You might be wondering why the quote from Singer and Willett used positive numbers while our parameter estimates have negative ones. No, there’s no mistake, there. Negative parameter estimates for monthly trajectories are then same thing as expressing a rate of <em>decline</em> with a positive number. But anyways, you see our estimates are on par with theirs. With our Bayesian paradigm, it’s also easy to get a formal difference distribution.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="treating-time-more-flexibly.html#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">fit5.11 =</span> <span class="fu">posterior_samples</span>(fit5<span class="fl">.11</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">&quot;b_months&quot;</span>),</span>
<span id="cb618-2"><a href="treating-time-more-flexibly.html#cb618-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">fit5.12 =</span> <span class="fu">posterior_samples</span>(fit5<span class="fl">.12</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">&quot;b_months&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4,000 x 2
##    fit5.11 fit5.12
##      &lt;dbl&gt;   &lt;dbl&gt;
##  1  -0.598 -0.200 
##  2  -0.465 -0.303 
##  3  -0.586 -0.279 
##  4  -0.486 -0.295 
##  5  -0.453 -0.0517
##  6  -0.416 -0.278 
##  7  -0.412 -0.204 
##  8  -0.384 -0.247 
##  9  -0.404 -0.131 
## 10  -0.506 -0.215 
## # … with 3,990 more rows</code></pre>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="treating-time-more-flexibly.html#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">fit5.11 =</span> <span class="fu">posterior_samples</span>(fit5<span class="fl">.11</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">&quot;b_months&quot;</span>),</span>
<span id="cb620-2"><a href="treating-time-more-flexibly.html#cb620-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">fit5.12 =</span> <span class="fu">posterior_samples</span>(fit5<span class="fl">.12</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">&quot;b_months&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb620-3"><a href="treating-time-more-flexibly.html#cb620-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif =</span> fit5<span class="fl">.12</span> <span class="sc">-</span> fit5<span class="fl">.11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb620-4"><a href="treating-time-more-flexibly.html#cb620-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb620-5"><a href="treating-time-more-flexibly.html#cb620-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dif, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb620-6"><a href="treating-time-more-flexibly.html#cb620-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb620-7"><a href="treating-time-more-flexibly.html#cb620-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb620-8"><a href="treating-time-more-flexibly.html#cb620-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Difference in &quot;</span>, gamma[<span class="dv">1</span>][<span class="dv">0</span>]))) <span class="sc">+</span></span>
<span id="cb620-9"><a href="treating-time-more-flexibly.html#cb620-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-101-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Here’s our posterior for <span class="math inline">\(\gamma_{20}\)</span>, <code>b_unemp</code>.</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="treating-time-more-flexibly.html#cb621-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(fit5<span class="fl">.12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb621-2"><a href="treating-time-more-flexibly.html#cb621-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_unemp, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb621-3"><a href="treating-time-more-flexibly.html#cb621-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb621-4"><a href="treating-time-more-flexibly.html#cb621-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb621-5"><a href="treating-time-more-flexibly.html#cb621-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-102-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Let’s compute our WAIC estimates for <code>fit5.11</code> and <code>fit5.12</code>.</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="treating-time-more-flexibly.html#cb622-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.11</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb622-2"><a href="treating-time-more-flexibly.html#cb622-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.12</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<p>Now we’ll compare the models by both their WAIC differences and their WAIC weights.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="treating-time-more-flexibly.html#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.11</span>, fit5<span class="fl">.12</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb623-2"><a href="treating-time-more-flexibly.html#cb623-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit5.12     0.0       0.0 -2492.3      21.4        196.1    10.6    4984.6    42.7
## fit5.11   -19.3       4.5 -2511.6      21.5        182.2    10.1    5023.2    43.0</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="treating-time-more-flexibly.html#cb625-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.11</span>, fit5<span class="fl">.12</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb625-2"><a href="treating-time-more-flexibly.html#cb625-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.11 fit5.12 
##       0       1</code></pre>
<p>By both metrics, <code>fit5.12</code> came out as the clear favorite.</p>
<p>It’s finally time to make our version of the upper left panel of Figure 5.3. We’ll do so using <code>fitted()</code>.</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="treating-time-more-flexibly.html#cb627-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb627-2"><a href="treating-time-more-flexibly.html#cb627-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">unemp =</span> <span class="dv">1</span>,</span>
<span id="cb627-3"><a href="treating-time-more-flexibly.html#cb627-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">months =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>))</span>
<span id="cb627-4"><a href="treating-time-more-flexibly.html#cb627-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-5"><a href="treating-time-more-flexibly.html#cb627-5" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb627-6"><a href="treating-time-more-flexibly.html#cb627-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.12</span>,</span>
<span id="cb627-7"><a href="treating-time-more-flexibly.html#cb627-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb627-8"><a href="treating-time-more-flexibly.html#cb627-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb627-9"><a href="treating-time-more-flexibly.html#cb627-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb627-10"><a href="treating-time-more-flexibly.html#cb627-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb627-11"><a href="treating-time-more-flexibly.html#cb627-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-12"><a href="treating-time-more-flexibly.html#cb627-12" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb627-13"><a href="treating-time-more-flexibly.html#cb627-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months)) <span class="sc">+</span></span>
<span id="cb627-14"><a href="treating-time-more-flexibly.html#cb627-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb627-15"><a href="treating-time-more-flexibly.html#cb627-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb627-16"><a href="treating-time-more-flexibly.html#cb627-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb627-17"><a href="treating-time-more-flexibly.html#cb627-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Months since job loss&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb627-18"><a href="treating-time-more-flexibly.html#cb627-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;CES-D&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb627-19"><a href="treating-time-more-flexibly.html#cb627-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Remain unemployed&quot;</span>) <span class="sc">+</span></span>
<span id="cb627-20"><a href="treating-time-more-flexibly.html#cb627-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-105-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>The upper right panel will take more care. We’ll still use <code>fitted()</code>, but we’ll have to be tricky with how we define the two segments. When we defined the sequence of <code>months</code> values over which we wanted to plot the model trajectory, we just casually set <code>length.out = 30</code> within the <code>seq()</code> function. But now we need to make sure two of those sequential points are at 5. One way to do so is to use the <code>by = .5</code> argument within <code>seq()</code>, instead. Since we’ll be defining the end points in our range with integer values, dividing up the sequence by every .5<sup>th</sup> value will ensure we’ll both be able to stop at 5 and that we’ll have a reasonable amount of values in the sequence to ensure the bowtie-shaped 95% intervals don’t look chunky.</p>
<p>But anyway, that also means we’ll need to do a good job determining how many values we’ll need to repeat our desired <code>unemp</code> values over. So here’s a quick way to do the math. Since we’re using every .5 in the sequence, you just subtract the integer at the beginning of the sequence from the integer at the end of the sequence, multiply that value by 2, and then add 1 to the product. Like this:</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="treating-time-more-flexibly.html#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">5</span> <span class="sc">-</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="treating-time-more-flexibly.html#cb630-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">14</span> <span class="sc">-</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<p>Those are the number of times we need to repeat <code>unemp == 1</code> and <code>unemp == 0</code>, respectively. You’ll see. Now wrangle and plot.</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="treating-time-more-flexibly.html#cb632-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb632-2"><a href="treating-time-more-flexibly.html#cb632-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">unemp  =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">19</span>)),</span>
<span id="cb632-3"><a href="treating-time-more-flexibly.html#cb632-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">months =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">5</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb632-4"><a href="treating-time-more-flexibly.html#cb632-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>)))</span>
<span id="cb632-5"><a href="treating-time-more-flexibly.html#cb632-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-6"><a href="treating-time-more-flexibly.html#cb632-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb632-7"><a href="treating-time-more-flexibly.html#cb632-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.12</span>,</span>
<span id="cb632-8"><a href="treating-time-more-flexibly.html#cb632-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb632-9"><a href="treating-time-more-flexibly.html#cb632-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb632-10"><a href="treating-time-more-flexibly.html#cb632-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb632-11"><a href="treating-time-more-flexibly.html#cb632-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb632-12"><a href="treating-time-more-flexibly.html#cb632-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-13"><a href="treating-time-more-flexibly.html#cb632-13" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb632-14"><a href="treating-time-more-flexibly.html#cb632-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months, <span class="at">group =</span> unemp)) <span class="sc">+</span></span>
<span id="cb632-15"><a href="treating-time-more-flexibly.html#cb632-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb632-16"><a href="treating-time-more-flexibly.html#cb632-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb632-17"><a href="treating-time-more-flexibly.html#cb632-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb632-18"><a href="treating-time-more-flexibly.html#cb632-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">5</span>, <span class="at">xend =</span> <span class="dv">5</span>,</span>
<span id="cb632-19"><a href="treating-time-more-flexibly.html#cb632-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">5</span>,</span>
<span id="cb632-20"><a href="treating-time-more-flexibly.html#cb632-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">yend =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">3</span>, <span class="dv">1</span>],</span>
<span id="cb632-21"><a href="treating-time-more-flexibly.html#cb632-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb632-22"><a href="treating-time-more-flexibly.html#cb632-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb632-23"><a href="treating-time-more-flexibly.html#cb632-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fl">14.5</span>, <span class="at">label =</span> <span class="st">&quot;gamma[2][0]&quot;</span>,</span>
<span id="cb632-24"><a href="treating-time-more-flexibly.html#cb632-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb632-25"><a href="treating-time-more-flexibly.html#cb632-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">7</span>, <span class="at">xend =</span> <span class="fl">5.5</span>,</span>
<span id="cb632-26"><a href="treating-time-more-flexibly.html#cb632-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fl">14.5</span>, <span class="at">yend =</span> <span class="fl">14.5</span>,</span>
<span id="cb632-27"><a href="treating-time-more-flexibly.html#cb632-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">&quot;inches&quot;</span>))) <span class="sc">+</span></span>
<span id="cb632-28"><a href="treating-time-more-flexibly.html#cb632-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Months since job loss&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb632-29"><a href="treating-time-more-flexibly.html#cb632-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;CES-D&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb632-30"><a href="treating-time-more-flexibly.html#cb632-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Reemployed at 5 months&quot;</span>) <span class="sc">+</span></span>
<span id="cb632-31"><a href="treating-time-more-flexibly.html#cb632-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-107-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Same deal for the lower left panel of Figure 5.3.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="treating-time-more-flexibly.html#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">10</span> <span class="sc">-</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 21</code></pre>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="treating-time-more-flexibly.html#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">14</span> <span class="sc">-</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>Now wrangle and plot.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="treating-time-more-flexibly.html#cb637-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb637-2"><a href="treating-time-more-flexibly.html#cb637-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">unemp  =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">9</span>)),</span>
<span id="cb637-3"><a href="treating-time-more-flexibly.html#cb637-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">months =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb637-4"><a href="treating-time-more-flexibly.html#cb637-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>)))</span>
<span id="cb637-5"><a href="treating-time-more-flexibly.html#cb637-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-6"><a href="treating-time-more-flexibly.html#cb637-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb637-7"><a href="treating-time-more-flexibly.html#cb637-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.12</span>,</span>
<span id="cb637-8"><a href="treating-time-more-flexibly.html#cb637-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb637-9"><a href="treating-time-more-flexibly.html#cb637-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb637-10"><a href="treating-time-more-flexibly.html#cb637-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb637-11"><a href="treating-time-more-flexibly.html#cb637-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb637-12"><a href="treating-time-more-flexibly.html#cb637-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-13"><a href="treating-time-more-flexibly.html#cb637-13" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb637-14"><a href="treating-time-more-flexibly.html#cb637-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months, <span class="at">group =</span> unemp)) <span class="sc">+</span></span>
<span id="cb637-15"><a href="treating-time-more-flexibly.html#cb637-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb637-16"><a href="treating-time-more-flexibly.html#cb637-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-17"><a href="treating-time-more-flexibly.html#cb637-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb637-18"><a href="treating-time-more-flexibly.html#cb637-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">xend =</span> <span class="dv">10</span>,</span>
<span id="cb637-19"><a href="treating-time-more-flexibly.html#cb637-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">10</span>,</span>
<span id="cb637-20"><a href="treating-time-more-flexibly.html#cb637-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">yend =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">3</span>, <span class="dv">1</span>],</span>
<span id="cb637-21"><a href="treating-time-more-flexibly.html#cb637-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-22"><a href="treating-time-more-flexibly.html#cb637-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb637-23"><a href="treating-time-more-flexibly.html#cb637-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">7</span>, <span class="at">y =</span> <span class="fl">13.5</span>, <span class="at">label =</span> <span class="st">&quot;gamma[2][0]&quot;</span>,</span>
<span id="cb637-24"><a href="treating-time-more-flexibly.html#cb637-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb637-25"><a href="treating-time-more-flexibly.html#cb637-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">8</span>, <span class="at">xend =</span> <span class="fl">9.5</span>,</span>
<span id="cb637-26"><a href="treating-time-more-flexibly.html#cb637-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fl">13.5</span>, <span class="at">yend =</span> <span class="fl">13.5</span>,</span>
<span id="cb637-27"><a href="treating-time-more-flexibly.html#cb637-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">&quot;inches&quot;</span>))) <span class="sc">+</span></span>
<span id="cb637-28"><a href="treating-time-more-flexibly.html#cb637-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Months since job loss&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb637-29"><a href="treating-time-more-flexibly.html#cb637-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;CES-D&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb637-30"><a href="treating-time-more-flexibly.html#cb637-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Reemployed at 10 months&quot;</span>) <span class="sc">+</span></span>
<span id="cb637-31"><a href="treating-time-more-flexibly.html#cb637-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-109-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>It’s just a little bit trickier to get that lower right panel. Now we need to calculate three values.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="treating-time-more-flexibly.html#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">5</span> <span class="sc">-</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="treating-time-more-flexibly.html#cb640-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">10</span> <span class="sc">-</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="treating-time-more-flexibly.html#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">14</span> <span class="sc">-</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>Get that plot.</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="treating-time-more-flexibly.html#cb644-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb644-2"><a href="treating-time-more-flexibly.html#cb644-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">unemp  =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">11</span>, <span class="dv">9</span>)),</span>
<span id="cb644-3"><a href="treating-time-more-flexibly.html#cb644-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">months =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">5</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb644-4"><a href="treating-time-more-flexibly.html#cb644-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb644-5"><a href="treating-time-more-flexibly.html#cb644-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>)),</span>
<span id="cb644-6"><a href="treating-time-more-flexibly.html#cb644-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">group  =</span> <span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">11</span>, <span class="dv">9</span>)))</span>
<span id="cb644-7"><a href="treating-time-more-flexibly.html#cb644-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-8"><a href="treating-time-more-flexibly.html#cb644-8" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb644-9"><a href="treating-time-more-flexibly.html#cb644-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.12</span>,</span>
<span id="cb644-10"><a href="treating-time-more-flexibly.html#cb644-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb644-11"><a href="treating-time-more-flexibly.html#cb644-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb644-12"><a href="treating-time-more-flexibly.html#cb644-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb644-13"><a href="treating-time-more-flexibly.html#cb644-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb644-14"><a href="treating-time-more-flexibly.html#cb644-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-15"><a href="treating-time-more-flexibly.html#cb644-15" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span></span>
<span id="cb644-16"><a href="treating-time-more-flexibly.html#cb644-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">group =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],</span>
<span id="cb644-17"><a href="treating-time-more-flexibly.html#cb644-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">x     =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb644-18"><a href="treating-time-more-flexibly.html#cb644-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xend =</span> x,</span>
<span id="cb644-19"><a href="treating-time-more-flexibly.html#cb644-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> x,</span>
<span id="cb644-20"><a href="treating-time-more-flexibly.html#cb644-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb644-21"><a href="treating-time-more-flexibly.html#cb644-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-22"><a href="treating-time-more-flexibly.html#cb644-22" aria-hidden="true" tabindex="-1"></a>arrow <span class="ot">&lt;-</span></span>
<span id="cb644-23"><a href="treating-time-more-flexibly.html#cb644-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> <span class="fu">c</span>(<span class="fl">6.75</span>, <span class="fl">8.25</span>),</span>
<span id="cb644-24"><a href="treating-time-more-flexibly.html#cb644-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="dv">14</span>,</span>
<span id="cb644-25"><a href="treating-time-more-flexibly.html#cb644-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> <span class="fu">c</span>(<span class="fl">5.5</span>, <span class="fl">9.5</span>),</span>
<span id="cb644-26"><a href="treating-time-more-flexibly.html#cb644-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="fu">c</span>(<span class="fl">14.5</span>, <span class="fl">13.5</span>))</span>
<span id="cb644-27"><a href="treating-time-more-flexibly.html#cb644-27" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb644-28"><a href="treating-time-more-flexibly.html#cb644-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months)) <span class="sc">+</span></span>
<span id="cb644-29"><a href="treating-time-more-flexibly.html#cb644-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>, <span class="at">group =</span> group),</span>
<span id="cb644-30"><a href="treating-time-more-flexibly.html#cb644-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb644-31"><a href="treating-time-more-flexibly.html#cb644-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb644-32"><a href="treating-time-more-flexibly.html#cb644-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> lines,</span>
<span id="cb644-33"><a href="treating-time-more-flexibly.html#cb644-33" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb644-34"><a href="treating-time-more-flexibly.html#cb644-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> y, <span class="at">yend =</span> yend, </span>
<span id="cb644-35"><a href="treating-time-more-flexibly.html#cb644-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">group =</span> group),</span>
<span id="cb644-36"><a href="treating-time-more-flexibly.html#cb644-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb644-37"><a href="treating-time-more-flexibly.html#cb644-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb644-38"><a href="treating-time-more-flexibly.html#cb644-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="dv">14</span>, <span class="at">label =</span> <span class="st">&quot;gamma[2][0]&quot;</span>,</span>
<span id="cb644-39"><a href="treating-time-more-flexibly.html#cb644-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb644-40"><a href="treating-time-more-flexibly.html#cb644-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> arrow,</span>
<span id="cb644-41"><a href="treating-time-more-flexibly.html#cb644-41" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb644-42"><a href="treating-time-more-flexibly.html#cb644-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> y, <span class="at">yend =</span> yend),</span>
<span id="cb644-43"><a href="treating-time-more-flexibly.html#cb644-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">&quot;inches&quot;</span>))) <span class="sc">+</span></span>
<span id="cb644-44"><a href="treating-time-more-flexibly.html#cb644-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Months since job loss&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb644-45"><a href="treating-time-more-flexibly.html#cb644-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;CES-D&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb644-46"><a href="treating-time-more-flexibly.html#cb644-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Reemployed at 5 months</span><span class="sc">\n</span><span class="st">unemployed again at 10&quot;</span>) <span class="sc">+</span></span>
<span id="cb644-47"><a href="treating-time-more-flexibly.html#cb644-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-111-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Now we’ve been on a plotting roll, let’s knock out the leftmost panel of Figure 5.4. It’s just a small extension of what we’ve been doing.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="treating-time-more-flexibly.html#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">14</span> <span class="sc">-</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 29</code></pre>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="treating-time-more-flexibly.html#cb647-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="fl">3.5</span> <span class="sc">-</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="treating-time-more-flexibly.html#cb649-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">14</span> <span class="sc">-</span> <span class="fl">3.5</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="treating-time-more-flexibly.html#cb651-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb651-2"><a href="treating-time-more-flexibly.html#cb651-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">unemp  =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">29</span>, <span class="dv">22</span>)),</span>
<span id="cb651-3"><a href="treating-time-more-flexibly.html#cb651-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">months =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb651-4"><a href="treating-time-more-flexibly.html#cb651-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">3.5</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>)))</span>
<span id="cb651-5"><a href="treating-time-more-flexibly.html#cb651-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb651-6"><a href="treating-time-more-flexibly.html#cb651-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb651-7"><a href="treating-time-more-flexibly.html#cb651-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.12</span>,</span>
<span id="cb651-8"><a href="treating-time-more-flexibly.html#cb651-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb651-9"><a href="treating-time-more-flexibly.html#cb651-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb651-10"><a href="treating-time-more-flexibly.html#cb651-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb651-11"><a href="treating-time-more-flexibly.html#cb651-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb651-12"><a href="treating-time-more-flexibly.html#cb651-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;unemp = &quot;</span>, unemp))</span>
<span id="cb651-13"><a href="treating-time-more-flexibly.html#cb651-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb651-14"><a href="treating-time-more-flexibly.html#cb651-14" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb651-15"><a href="treating-time-more-flexibly.html#cb651-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months, <span class="at">group =</span> unemp)) <span class="sc">+</span></span>
<span id="cb651-16"><a href="treating-time-more-flexibly.html#cb651-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># new trick</span></span>
<span id="cb651-17"><a href="treating-time-more-flexibly.html#cb651-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb651-18"><a href="treating-time-more-flexibly.html#cb651-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="fu">fixef</span>(fit5<span class="fl">.12</span>)[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb651-19"><a href="treating-time-more-flexibly.html#cb651-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb651-20"><a href="treating-time-more-flexibly.html#cb651-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb651-21"><a href="treating-time-more-flexibly.html#cb651-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb651-22"><a href="treating-time-more-flexibly.html#cb651-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb651-23"><a href="treating-time-more-flexibly.html#cb651-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># another new trick</span></span>
<span id="cb651-24"><a href="treating-time-more-flexibly.html#cb651-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> f <span class="sc">%&gt;%</span> <span class="fu">filter</span>(months <span class="sc">==</span> <span class="dv">14</span>), </span>
<span id="cb651-25"><a href="treating-time-more-flexibly.html#cb651-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">y =</span> Estimate), <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">05</span>) <span class="sc">+</span></span>
<span id="cb651-26"><a href="treating-time-more-flexibly.html#cb651-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Months since job loss&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb651-27"><a href="treating-time-more-flexibly.html#cb651-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;CES-D&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb651-28"><a href="treating-time-more-flexibly.html#cb651-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Main effects of unemp and time&quot;</span>) <span class="sc">+</span></span>
<span id="cb651-29"><a href="treating-time-more-flexibly.html#cb651-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># don&#39;t forget this part</span></span>
<span id="cb651-30"><a href="treating-time-more-flexibly.html#cb651-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">&quot;off&quot;</span>) <span class="sc">+</span></span>
<span id="cb651-31"><a href="treating-time-more-flexibly.html#cb651-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb651-32"><a href="treating-time-more-flexibly.html#cb651-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">55</span>, <span class="dv">6</span>, <span class="dv">6</span>))</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-113-1.png" width="350.4" style="display: block; margin: auto;" /></p>
</div>
<div id="using-a-level-1level-2-specification." class="section level4" number="5.3.1.2">
<h4><span class="header-section-number">5.3.1.2</span> Using a level-1/level-2 specification.</h4>
<p>If we wanted to reexpress our composite equation for <code>fit5.12</code> using the level-1/level-2 form, the level-1 model would be</p>
<p><span class="math display">\[
\text{cesd}_{ij} = \pi_{0i} + \pi_{1i} \text{months}_{ij} + \pi_{2i} \text{unemp}_{ij} + \epsilon_{ij}.
\]</span></p>
<p>Here’s the corresponding level-2 model:</p>
<p><span class="math display">\[\begin{align*}
\pi_{0i} &amp; = \gamma_{00} + \zeta_{0i} \\
\pi_{1i} &amp; = \gamma_{10} + \zeta_{1i} \\
\pi_{2i} &amp; = \gamma_{20}.
\end{align*}\]</span></p>
<p>If we wanted the effects of the time-varying covariate <code>unemp</code> to vary across individuals, then we’d expand the definition of <span class="math inline">\(\pi_{2i}\)</span> to be</p>
<p><span class="math display">\[
\pi_{2i} = \gamma_{20} + \zeta_{2i}.
\]</span></p>
<p>Although this doesn’t change the way we model <span class="math inline">\(\epsilon_{ij}\)</span>, which remains</p>
<p><span class="math display">\[
\epsilon_{ij} \sim \text{Normal} (0, \sigma_\epsilon),
\]</span></p>
<p>it does change the model for the <span class="math inline">\(\zeta\)</span>s. Within our Stan/<strong>brms</strong> paradigm, that would now be</p>
<p><span class="math display">\[\begin{align*}
\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{1i} \\ \zeta_{2i}
\end{bmatrix} &amp; \sim \text{Normal} 
\begin{pmatrix}
\begin{bmatrix} 0 \\ 0 \\ 0 \end{bmatrix},
\mathbf D \mathbf\Omega \mathbf D&#39;
\end{pmatrix}, \text{where} \\

\mathbf D      &amp; = \begin{bmatrix} \sigma_0 &amp; 0 &amp; 0 \\ 0 &amp; \sigma_1 &amp; 0 \\ 0 &amp; 0 &amp; \sigma_2 \end{bmatrix} \text{and} \\

\mathbf \Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{01} &amp; \rho_{02} \\ \rho_{01} &amp; 1 &amp; \rho_{12} \\ \rho_{02} &amp; \rho_{12} &amp; 1 \end{bmatrix}.

\end{align*}\]</span></p>
<p>Reworded slightly from the text (p. 169), by adding one residual parameter, <span class="math inline">\(\zeta_{2i}\)</span>, we got an additional corresponding standard deviation parameter, <span class="math inline">\(\sigma_2\)</span>, and two more correlation parameters, <span class="math inline">\(\rho_{02}\)</span> and <span class="math inline">\(\rho_{12}\)</span>. Staying with our weakly-regularizing prior approach, the priors for the updated model might look like</p>
<p><span class="math display">\[\begin{align*}
\gamma_{00}                          &amp; \sim \operatorname{Normal}(14.5, 20) \\
\gamma_{10} \text{ and } \gamma_{20} &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma_\epsilon,..., \sigma_2        &amp; \sim \operatorname{Student-t}(3, 0, 11.9) \\
\Omega                               &amp; \sim \operatorname{LKJ} (4).
\end{align*}\]</span></p>
<p>Singer and Willett then cautioned readers about hastily adding <span class="math inline">\(\zeta\)</span> parameters to their models, particularly in cases where you’re likely to run into estimation issues, such as boundary constraints. Within our Stan/<strong>brms</strong> paradigm, we still have to be aware of these difficulties. However, with skillfully-chosen priors, I think you’ll find we can fit more ambitious models than would typically be possible with frequentist estimators. But do beware that as you stretch your data further and further, your choices in likelihoods and priors more heavily influence the results. For more on the topic, check out <a href="https://twitter.com/mcxfrank?lang=en">Michael Frank</a>’s blog post, <a href="http://babieslearninglanguage.blogspot.com/2018/02/mixed-effects-models-is-it-time-to-go.html"><em>Mixed effects models: Is it time to go Bayesian by default?</em></a>, and make sure not to miss the action in the comments section.</p>
</div>
<div id="time-varying-predictors-and-variance-components." class="section level4" number="5.3.1.3">
<h4><span class="header-section-number">5.3.1.3</span> Time-varying predictors and variance components.</h4>
<p>When you add a time-varying predictor, it’s not uncommon to see a reduction in <span class="math inline">\(\sigma_\epsilon^2\)</span>. Here we compare <code>fit5.11</code> and <code>fit5.12</code>.</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="treating-time-more-flexibly.html#cb652-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span></span>
<span id="cb652-2"><a href="treating-time-more-flexibly.html#cb652-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">VarCorr</span>(fit5<span class="fl">.11</span>, <span class="at">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]],</span>
<span id="cb652-3"><a href="treating-time-more-flexibly.html#cb652-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">VarCorr</span>(fit5<span class="fl">.12</span>, <span class="at">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb652-4"><a href="treating-time-more-flexibly.html#cb652-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb652-5"><a href="treating-time-more-flexibly.html#cb652-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;fit5.&quot;</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">12</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb652-6"><a href="treating-time-more-flexibly.html#cb652-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">fit5.11 =</span> fit5<span class="fl">.11</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb652-7"><a href="treating-time-more-flexibly.html#cb652-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">fit5.12 =</span> fit5<span class="fl">.12</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb652-8"><a href="treating-time-more-flexibly.html#cb652-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">fit5.11 - fit5.12</span><span class="st">`</span> <span class="ot">=</span> fit5<span class="fl">.11</span> <span class="sc">-</span> fit5<span class="fl">.12</span>)</span>
<span id="cb652-9"><a href="treating-time-more-flexibly.html#cb652-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-10"><a href="treating-time-more-flexibly.html#cb652-10" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb652-11"><a href="treating-time-more-flexibly.html#cb652-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb652-12"><a href="treating-time-more-flexibly.html#cb652-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;fit5.11&quot;</span>, <span class="st">&quot;fit5.12&quot;</span>, <span class="st">&quot;fit5.11 - fit5.12&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb652-13"><a href="treating-time-more-flexibly.html#cb652-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb652-14"><a href="treating-time-more-flexibly.html#cb652-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb652-15"><a href="treating-time-more-flexibly.html#cb652-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb652-16"><a href="treating-time-more-flexibly.html#cb652-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb652-17"><a href="treating-time-more-flexibly.html#cb652-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[epsilon]<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb652-18"><a href="treating-time-more-flexibly.html#cb652-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb652-19"><a href="treating-time-more-flexibly.html#cb652-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-114-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Using the full posterior for both models, here is the percent variance in CES-D explained by <code>unemp</code>.</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="treating-time-more-flexibly.html#cb653-1" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb653-2"><a href="treating-time-more-flexibly.html#cb653-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">percent =</span> (fit5<span class="fl">.11</span> <span class="sc">-</span> fit5<span class="fl">.12</span>) <span class="sc">/</span> fit5<span class="fl">.11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb653-3"><a href="treating-time-more-flexibly.html#cb653-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb653-4"><a href="treating-time-more-flexibly.html#cb653-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   percent .lower .upper .width .point .interval
## 1   0.086 -0.223  0.304   0.95 median        qi</code></pre>
<p>When you go beyond point estimates and factor in full posterior uncertainty, it becomes clear how fragile ad hoc statistics like this can be. Interpret them with caution.</p>
</div>
</div>
<div id="allowing-the-effect-of-a-time-varying-predictor-to-vary-over-time." class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Allowing the effect of a time-varying predictor to vary over time.</h3>
<p>“Might unemployment status also affect the trajectory’s slope” (p. 171)? Here’s the statistical model:</p>
<p><span class="math display">\[\begin{align*}
\text{cesd}_{ij} &amp; = \big [ \gamma_{00} + \gamma_{10} \text{months}_{ij} + \gamma_{20} \text{unemp}_{ij} + \gamma_{30} \text{months}_{ij} \times \text{unemp}_{ij} \big ] \\
&amp; \;\;\; + \big [  \zeta_{0i} + \zeta_{1i} \text{months}_{ij} + \epsilon_{ij} \big ] \\

\epsilon_{ij}    &amp; \sim \operatorname{Normal}(0, \sigma_\epsilon) \\

\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{1i} 
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix}
\begin{bmatrix} 0 \\ 0 \end{bmatrix},
\mathbf D \mathbf \Omega \mathbf D&#39;
\end{pmatrix}\\

\mathbf D      &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \\ 
\mathbf \Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{01} \\ \rho_{01} &amp; 1 \end{bmatrix} \\

\gamma_{00}                                        &amp; \sim \operatorname{Normal}(14.5, 20) \\
\gamma_{10}, \gamma_{20}, \text{ and } \gamma_{30} &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma_\epsilon, \sigma_0, \text{ and } \sigma_1   &amp; \sim \operatorname{Student-t}(3, 0, 11.9) \\
\rho_{01}                                          &amp; \sim \operatorname{LKJ}(4).
\end{align*}\]</span></p>
<p>Since <span class="math inline">\(\gamma_{30}\)</span> is an interaction term, it might make sense to give it an ever tighter prior, something like <span class="math inline">\(\text{Normal}(0, 5)\)</span>. Here we’ll just stay wide and loose.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="treating-time-more-flexibly.html#cb655-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.13</span> <span class="ot">&lt;-</span></span>
<span id="cb655-2"><a href="treating-time-more-flexibly.html#cb655-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> unemployment_pp, </span>
<span id="cb655-3"><a href="treating-time-more-flexibly.html#cb655-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb655-4"><a href="treating-time-more-flexibly.html#cb655-4" aria-hidden="true" tabindex="-1"></a>      cesd <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> months <span class="sc">+</span> unemp <span class="sc">+</span> months<span class="sc">:</span>unemp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> months <span class="sc">|</span> id),</span>
<span id="cb655-5"><a href="treating-time-more-flexibly.html#cb655-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">14.5</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb655-6"><a href="treating-time-more-flexibly.html#cb655-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb655-7"><a href="treating-time-more-flexibly.html#cb655-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sd),</span>
<span id="cb655-8"><a href="treating-time-more-flexibly.html#cb655-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sigma),</span>
<span id="cb655-9"><a href="treating-time-more-flexibly.html#cb655-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb655-10"><a href="treating-time-more-flexibly.html#cb655-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb655-11"><a href="treating-time-more-flexibly.html#cb655-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb655-12"><a href="treating-time-more-flexibly.html#cb655-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">9</span>),</span>
<span id="cb655-13"><a href="treating-time-more-flexibly.html#cb655-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.13&quot;</span>)</span></code></pre></div>
<p>Here are the results.</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="treating-time-more-flexibly.html#cb656-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.13</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: cesd ~ 0 + Intercept + months + unemp + months:unemp + (1 + months | id) 
##    Data: unemployment_pp (Number of observations: 674) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 254) 
##                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)             9.14      0.84     7.49    10.77 1.00      430      662
## sd(months)                0.55      0.19     0.10     0.86 1.02      190      167
## cor(Intercept,months)    -0.47      0.18    -0.70    -0.01 1.01      593      314
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept        9.98      1.88     6.19    13.58 1.00     1194     1860
## months           0.13      0.19    -0.24     0.52 1.00     1270     1931
## unemp            8.14      1.88     4.49    11.89 1.00     1300     2053
## months:unemp    -0.43      0.22    -0.86    -0.01 1.00     1375     2207
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     8.13      0.42     7.35     9.01 1.01      349      811
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s how we might make our version of the middle panel of Figure 5.4.</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="treating-time-more-flexibly.html#cb658-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb658-2"><a href="treating-time-more-flexibly.html#cb658-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">unemp  =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">29</span>, <span class="dv">22</span>)),</span>
<span id="cb658-3"><a href="treating-time-more-flexibly.html#cb658-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">months =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb658-4"><a href="treating-time-more-flexibly.html#cb658-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">3.5</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">5</span>)))</span>
<span id="cb658-5"><a href="treating-time-more-flexibly.html#cb658-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-6"><a href="treating-time-more-flexibly.html#cb658-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb658-7"><a href="treating-time-more-flexibly.html#cb658-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.13</span>,</span>
<span id="cb658-8"><a href="treating-time-more-flexibly.html#cb658-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb658-9"><a href="treating-time-more-flexibly.html#cb658-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb658-10"><a href="treating-time-more-flexibly.html#cb658-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb658-11"><a href="treating-time-more-flexibly.html#cb658-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb658-12"><a href="treating-time-more-flexibly.html#cb658-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;unemp = &quot;</span>, unemp))</span>
<span id="cb658-13"><a href="treating-time-more-flexibly.html#cb658-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-14"><a href="treating-time-more-flexibly.html#cb658-14" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb658-15"><a href="treating-time-more-flexibly.html#cb658-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months, <span class="at">group =</span> unemp)) <span class="sc">+</span></span>
<span id="cb658-16"><a href="treating-time-more-flexibly.html#cb658-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(fit5<span class="fl">.13</span>)[<span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb658-17"><a href="treating-time-more-flexibly.html#cb658-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="fu">fixef</span>(fit5<span class="fl">.13</span>)[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb658-18"><a href="treating-time-more-flexibly.html#cb658-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb658-19"><a href="treating-time-more-flexibly.html#cb658-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb658-20"><a href="treating-time-more-flexibly.html#cb658-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb658-21"><a href="treating-time-more-flexibly.html#cb658-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb658-22"><a href="treating-time-more-flexibly.html#cb658-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> f <span class="sc">%&gt;%</span> <span class="fu">filter</span>(months <span class="sc">==</span> <span class="dv">14</span>), </span>
<span id="cb658-23"><a href="treating-time-more-flexibly.html#cb658-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">y =</span> Estimate), <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">05</span>) <span class="sc">+</span></span>
<span id="cb658-24"><a href="treating-time-more-flexibly.html#cb658-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Months since job loss&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb658-25"><a href="treating-time-more-flexibly.html#cb658-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;CES-D&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb658-26"><a href="treating-time-more-flexibly.html#cb658-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Main effects of unemp and time&quot;</span>) <span class="sc">+</span></span>
<span id="cb658-27"><a href="treating-time-more-flexibly.html#cb658-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">&quot;off&quot;</span>) <span class="sc">+</span></span>
<span id="cb658-28"><a href="treating-time-more-flexibly.html#cb658-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb658-29"><a href="treating-time-more-flexibly.html#cb658-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">55</span>, <span class="dv">6</span>, <span class="dv">6</span>))</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-117-1.png" width="350.4" style="display: block; margin: auto;" /></p>
<p>Here’s the posterior for <span class="math inline">\(\gamma_{10}\)</span>.</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="treating-time-more-flexibly.html#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(fit5<span class="fl">.13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb659-2"><a href="treating-time-more-flexibly.html#cb659-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_months, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb659-3"><a href="treating-time-more-flexibly.html#cb659-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb659-4"><a href="treating-time-more-flexibly.html#cb659-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb659-5"><a href="treating-time-more-flexibly.html#cb659-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(gamma[<span class="dv">1</span>][<span class="dv">0</span>], <span class="st">&quot;, the main effect for time&quot;</span>))) <span class="sc">+</span></span>
<span id="cb659-6"><a href="treating-time-more-flexibly.html#cb659-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-118-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>It’s quite uncertain and almost symmetrically straddles the parameter space between -0.5 and 0.5.</p>
<p>The next model follows the form</p>
<p><span class="math display">\[\begin{align*}
\text{cesd}_{ij} &amp; = \big [ \gamma_{00} + \gamma_{20} \text{unemp}_{ij} + \gamma_{30} \text{unemp}_{ij} \times \text{months}_{ij} \big ] \\
&amp; \;\;\; + \big [  \zeta_{0i} + \zeta_{3i} \text{unemp}_{ij} \times \text{months}_{ij} + \epsilon_{ij} \big ] \\

\epsilon_{ij}    &amp; \sim \operatorname{Normal}(0, \sigma_\epsilon) \\

\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{3i} 
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix}
\begin{bmatrix} 0 \\ 0 \end{bmatrix},
\mathbf D \mathbf\Omega \mathbf D&#39;
\end{pmatrix} \\

\mathbf D     &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_3 \end{bmatrix} \\ 

\mathbf\Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{03} \\ \rho_{03} &amp; 1 \end{bmatrix} \\

\gamma_{00}                                      &amp; \sim \operatorname{Normal}(14.5, 20) \\
\gamma_{20} \text{ and } \gamma_{30}             &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma_\epsilon, \sigma_0, \text{ and } \sigma_3 &amp; \sim \operatorname{Student-t}(3, 0, 11.9) \\
\rho_{03}                                        &amp; \sim \operatorname{LKJ}(4).

\end{align*}\]</span></p>
<p>Here’s how to fit it with <code>brms::brm()</code>.</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="treating-time-more-flexibly.html#cb660-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.14</span> <span class="ot">&lt;-</span></span>
<span id="cb660-2"><a href="treating-time-more-flexibly.html#cb660-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> unemployment_pp, </span>
<span id="cb660-3"><a href="treating-time-more-flexibly.html#cb660-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb660-4"><a href="treating-time-more-flexibly.html#cb660-4" aria-hidden="true" tabindex="-1"></a>      cesd <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> unemp <span class="sc">+</span> months<span class="sc">:</span>unemp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> months<span class="sc">:</span>unemp <span class="sc">|</span> id),</span>
<span id="cb660-5"><a href="treating-time-more-flexibly.html#cb660-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">14.5</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb660-6"><a href="treating-time-more-flexibly.html#cb660-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb660-7"><a href="treating-time-more-flexibly.html#cb660-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sd),</span>
<span id="cb660-8"><a href="treating-time-more-flexibly.html#cb660-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sigma),</span>
<span id="cb660-9"><a href="treating-time-more-flexibly.html#cb660-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb660-10"><a href="treating-time-more-flexibly.html#cb660-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb660-11"><a href="treating-time-more-flexibly.html#cb660-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb660-12"><a href="treating-time-more-flexibly.html#cb660-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb660-13"><a href="treating-time-more-flexibly.html#cb660-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.14&quot;</span>)</span></code></pre></div>
<p>It’s easy to miss this if you’re not following along quite carefully with the text, but this model, which corresponds to Equation 5.9 in the text, is NOT Model D. Rather, it’s an intermediary model between Model C and Model D. All this means we can’t compare our results with those in Table 5.7. But here they are, anyway.</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="treating-time-more-flexibly.html#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.14</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: cesd ~ 0 + Intercept + unemp + months:unemp + (1 + months:unemp | id) 
##    Data: unemployment_pp (Number of observations: 674) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 254) 
##                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)                   8.02      0.64     6.85     9.33 1.00     1086     2205
## sd(months:unemp)                0.43      0.21     0.03     0.81 1.01      334      982
## cor(Intercept,months:unemp)    -0.12      0.25    -0.52     0.45 1.00     1538     2212
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       11.18      0.89     9.44    12.93 1.00     2086     2362
## unemp            6.94      0.92     5.13     8.70 1.00     4207     3213
## unemp:months    -0.30      0.11    -0.51    -0.10 1.00     4701     2848
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     8.51      0.35     7.86     9.19 1.00      852     1621
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We’ve already computed the WAIC for <code>fit5.11</code> and <code>fit5.12</code>. Here we do so for <code>fit5.13</code> and <code>fit5.14</code>.</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="treating-time-more-flexibly.html#cb663-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.13</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.13</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb663-2"><a href="treating-time-more-flexibly.html#cb663-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.14</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.14</span>, <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="treating-time-more-flexibly.html#cb664-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.11</span>, fit5<span class="fl">.12</span>, fit5<span class="fl">.13</span>, fit5<span class="fl">.14</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb664-2"><a href="treating-time-more-flexibly.html#cb664-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit5.13     0.0       0.0 -2490.0      21.5        197.2    10.7    4980.0    43.0
## fit5.12    -2.3       2.1 -2492.3      21.4        196.1    10.6    4984.6    42.7
## fit5.14   -13.3       3.4 -2503.3      21.8        172.0     9.8    5006.6    43.5
## fit5.11   -21.6       4.9 -2511.6      21.5        182.2    10.1    5023.2    43.0</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="treating-time-more-flexibly.html#cb666-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.11</span>, fit5<span class="fl">.12</span>, fit5<span class="fl">.13</span>, fit5<span class="fl">.14</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb666-2"><a href="treating-time-more-flexibly.html#cb666-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.11 fit5.12 fit5.13 fit5.14 
##   0.000   0.091   0.909   0.000</code></pre>
<p>Yep, it appears <code>fit5.14</code> is not an improvement on <code>fit5.13</code> (i.e., our analogue to Model C in the text). Here’s our version of Model D:</p>
<p><span class="math display">\[\begin{align*}
\text{cesd}_{ij} &amp; = \big [ \gamma_{00} + \gamma_{20} \text{unemp}_{ij} + \gamma_{30} \text{unemp}_{ij} \times \text{months}_{ij} \big ] \\
&amp; \;\;\; + \big [  \zeta_{0i} + \zeta_{3i} \text{unemp}_{ij} \times \text{months}_{ij} + \epsilon_{ij} \big ] \\

\epsilon_{ij}    &amp; \sim \operatorname{Normal}(0, \sigma_\epsilon) \\

\begin{bmatrix} 
\zeta_{0i} \\ \zeta_{2i} \\ \zeta_{3i}
\end{bmatrix} &amp; \sim \operatorname{Normal} 
\begin{pmatrix}
\begin{bmatrix} 0 \\ 0 \\ 0 \end{bmatrix},
\mathbf D \mathbf\Omega \mathbf D&#39;
\end{pmatrix} \\

\mathbf D     &amp; = \begin{bmatrix} \sigma_0 &amp; 0 &amp; 0 \\ 0 &amp; \sigma_2 &amp; 0 \\ 0 &amp; 0 &amp; \sigma_3 \end{bmatrix} \\

\mathbf\Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{02} &amp; \rho_{03} \\ \rho_{02} &amp; 1 &amp; \rho_{23} \\ \rho_{03} &amp; \rho_{23} &amp; 1 \end{bmatrix} \\

\gamma_{00}                          &amp; \sim \operatorname{Normal}(14.5, 20) \\
\gamma_{20} \text{ and } \gamma_{30} &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma_\epsilon,..., \sigma_3        &amp; \sim \operatorname{Student-t}(3, 0, 11.9) \\
\mathbf\Omega                        &amp; \sim \operatorname{LKJ}(4).
\end{align*}\]</span></p>
<p>We’ll call it <code>fit5.15</code>. Here’s the <code>brm()</code> code.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="treating-time-more-flexibly.html#cb668-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.15</span> <span class="ot">&lt;-</span></span>
<span id="cb668-2"><a href="treating-time-more-flexibly.html#cb668-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> unemployment_pp, </span>
<span id="cb668-3"><a href="treating-time-more-flexibly.html#cb668-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb668-4"><a href="treating-time-more-flexibly.html#cb668-4" aria-hidden="true" tabindex="-1"></a>      cesd <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> unemp <span class="sc">+</span> months<span class="sc">:</span>unemp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> unemp <span class="sc">+</span> months<span class="sc">:</span>unemp <span class="sc">|</span> id),</span>
<span id="cb668-5"><a href="treating-time-more-flexibly.html#cb668-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">14.5</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb668-6"><a href="treating-time-more-flexibly.html#cb668-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb668-7"><a href="treating-time-more-flexibly.html#cb668-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sd),</span>
<span id="cb668-8"><a href="treating-time-more-flexibly.html#cb668-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">11.9</span>), <span class="at">class =</span> sigma),</span>
<span id="cb668-9"><a href="treating-time-more-flexibly.html#cb668-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb668-10"><a href="treating-time-more-flexibly.html#cb668-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb668-11"><a href="treating-time-more-flexibly.html#cb668-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb668-12"><a href="treating-time-more-flexibly.html#cb668-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">95</span>),</span>
<span id="cb668-13"><a href="treating-time-more-flexibly.html#cb668-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.15&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="treating-time-more-flexibly.html#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.15</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: cesd ~ 0 + Intercept + unemp + months:unemp + (1 + unemp + months:unemp | id) 
##    Data: unemployment_pp (Number of observations: 674) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 254) 
##                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)                   6.86      0.86     5.17     8.55 1.00     1707     2658
## sd(unemp)                       4.94      1.68     1.43     8.07 1.01      253      568
## sd(unemp:months)                0.62      0.24     0.08     1.01 1.00      281      529
## cor(Intercept,unemp)            0.22      0.22    -0.21     0.66 1.00      865     1576
## cor(Intercept,unemp:months)    -0.18      0.22    -0.57     0.30 1.00     1108     2027
## cor(unemp,unemp:months)        -0.37      0.28    -0.79     0.29 1.00      496     1282
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       11.22      0.83     9.63    12.83 1.00     3606     3239
## unemp            6.90      0.96     5.04     8.78 1.00     4964     3279
## unemp:months    -0.29      0.11    -0.50    -0.08 1.00     4634     3409
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     8.07      0.43     7.26     8.91 1.01      299     1375
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now we can finally make our version of the right panel of Figure 5.4.</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="treating-time-more-flexibly.html#cb671-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb671-2"><a href="treating-time-more-flexibly.html#cb671-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit5<span class="fl">.15</span>,</span>
<span id="cb671-3"><a href="treating-time-more-flexibly.html#cb671-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb671-4"><a href="treating-time-more-flexibly.html#cb671-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb671-5"><a href="treating-time-more-flexibly.html#cb671-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb671-6"><a href="treating-time-more-flexibly.html#cb671-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb671-7"><a href="treating-time-more-flexibly.html#cb671-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;unemp = &quot;</span>, unemp))</span>
<span id="cb671-8"><a href="treating-time-more-flexibly.html#cb671-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-9"><a href="treating-time-more-flexibly.html#cb671-9" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb671-10"><a href="treating-time-more-flexibly.html#cb671-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> months, <span class="at">group =</span> unemp)) <span class="sc">+</span></span>
<span id="cb671-11"><a href="treating-time-more-flexibly.html#cb671-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(fit5<span class="fl">.15</span>)[<span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb671-12"><a href="treating-time-more-flexibly.html#cb671-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">0</span>,</span>
<span id="cb671-13"><a href="treating-time-more-flexibly.html#cb671-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb671-14"><a href="treating-time-more-flexibly.html#cb671-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb671-15"><a href="treating-time-more-flexibly.html#cb671-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb671-16"><a href="treating-time-more-flexibly.html#cb671-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb671-17"><a href="treating-time-more-flexibly.html#cb671-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> f <span class="sc">%&gt;%</span> <span class="fu">filter</span>(months <span class="sc">==</span> <span class="dv">14</span>), </span>
<span id="cb671-18"><a href="treating-time-more-flexibly.html#cb671-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">y =</span> Estimate), <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">05</span>) <span class="sc">+</span></span>
<span id="cb671-19"><a href="treating-time-more-flexibly.html#cb671-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Months since job loss&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb671-20"><a href="treating-time-more-flexibly.html#cb671-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;CES-D&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb671-21"><a href="treating-time-more-flexibly.html#cb671-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Constraining the effects time</span><span class="sc">\n</span><span class="st">among the re-employed&quot;</span>) <span class="sc">+</span></span>
<span id="cb671-22"><a href="treating-time-more-flexibly.html#cb671-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">&quot;off&quot;</span>) <span class="sc">+</span></span>
<span id="cb671-23"><a href="treating-time-more-flexibly.html#cb671-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb671-24"><a href="treating-time-more-flexibly.html#cb671-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">55</span>, <span class="dv">6</span>, <span class="dv">6</span>))</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-123-1.png" width="350.4" style="display: block; margin: auto;" /></p>
<p>By carefully using <code>filter()</code>, we can extract the posterior for summary the expected CES-D value for “the average unemployed person in the population,” “immediately upon layoff” (p. 173).</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="treating-time-more-flexibly.html#cb672-1" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb672-2"><a href="treating-time-more-flexibly.html#cb672-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(unemp <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> months <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##   Estimate Est.Error     Q2.5  Q97.5 unemp months     label
## 1 18.12189 0.7771384 16.56997 19.655     1      0 unemp = 1</code></pre>
<p>To get the decline rate per month, just use <code>fixef()</code> and subset.</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="treating-time-more-flexibly.html#cb674-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit5<span class="fl">.15</span>)[<span class="st">&quot;unemp:months&quot;</span>, ]</span></code></pre></div>
<pre><code>##    Estimate   Est.Error        Q2.5       Q97.5 
## -0.28944738  0.10844073 -0.50100896 -0.07609864</code></pre>
<p>How much lower, on average, are “CES-D scores among those who find a job” right after layoff (p. 173)? Again, just use <code>fixef()</code>.</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="treating-time-more-flexibly.html#cb676-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit5<span class="fl">.15</span>)[<span class="st">&quot;unemp&quot;</span>, ]</span></code></pre></div>
<pre><code>##  Estimate Est.Error      Q2.5     Q97.5 
##  6.904897  0.959163  5.035973  8.784006</code></pre>
<p>But if we’d like to get the posterior for the difference at 12 months later, we’ll need to go back to <code>fitted()</code>.</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="treating-time-more-flexibly.html#cb678-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb678-2"><a href="treating-time-more-flexibly.html#cb678-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">unemp  =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>,</span>
<span id="cb678-3"><a href="treating-time-more-flexibly.html#cb678-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">months =</span> <span class="dv">12</span>)</span>
<span id="cb678-4"><a href="treating-time-more-flexibly.html#cb678-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-5"><a href="treating-time-more-flexibly.html#cb678-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit5<span class="fl">.15</span>,</span>
<span id="cb678-6"><a href="treating-time-more-flexibly.html#cb678-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd,</span>
<span id="cb678-7"><a href="treating-time-more-flexibly.html#cb678-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">re_formula =</span> <span class="cn">NA</span>,</span>
<span id="cb678-8"><a href="treating-time-more-flexibly.html#cb678-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">summary =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb678-9"><a href="treating-time-more-flexibly.html#cb678-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb678-10"><a href="treating-time-more-flexibly.html#cb678-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="fu">c</span>(<span class="st">&quot;un&quot;</span>, <span class="st">&quot;&quot;</span>), <span class="st">&quot;employed_cesd_at_12&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb678-11"><a href="treating-time-more-flexibly.html#cb678-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">difference =</span> unemployed_cesd_at_12 <span class="sc">-</span> employed_cesd_at_12) <span class="sc">%&gt;%</span> </span>
<span id="cb678-12"><a href="treating-time-more-flexibly.html#cb678-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-13"><a href="treating-time-more-flexibly.html#cb678-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb678-14"><a href="treating-time-more-flexibly.html#cb678-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   difference .lower .upper .width .point .interval
## 1      3.439  0.836  5.976   0.95 median        qi</code></pre>
<p>There’s more posterior uncertainty, there, that you might expect from simply using the point estimates. <em>Always beware the posterior uncertainty</em>. We may as well finish off with a little WAIC.</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="treating-time-more-flexibly.html#cb680-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.15</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.15</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb680-2"><a href="treating-time-more-flexibly.html#cb680-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-3"><a href="treating-time-more-flexibly.html#cb680-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.11</span>, fit5<span class="fl">.12</span>, fit5<span class="fl">.13</span>, fit5<span class="fl">.14</span>, fit5<span class="fl">.15</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb680-4"><a href="treating-time-more-flexibly.html#cb680-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit5.15     0.0       0.0 -2488.8      21.8        201.9    11.2    4977.6    43.6
## fit5.13    -1.2       3.5 -2490.0      21.5        197.2    10.7    4980.0    43.0
## fit5.12    -3.5       3.5 -2492.3      21.4        196.1    10.6    4984.6    42.7
## fit5.14   -14.5       3.5 -2503.3      21.8        172.0     9.8    5006.6    43.5
## fit5.11   -22.8       6.5 -2511.6      21.5        182.2    10.1    5023.2    43.0</code></pre>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="treating-time-more-flexibly.html#cb682-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.11</span>, fit5<span class="fl">.12</span>, fit5<span class="fl">.13</span>, fit5<span class="fl">.14</span>, fit5<span class="fl">.15</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb682-2"><a href="treating-time-more-flexibly.html#cb682-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.11 fit5.12 fit5.13 fit5.14 fit5.15 
##   0.000   0.023   0.229   0.000   0.748</code></pre>
<p><code>fit5.15</code>, <code>fit5.13</code>, and <code>fit5.12</code> are all very close, with a modest edge for <code>fit5.15</code>.</p>
</div>
<div id="recentering-time-varying-predictors." class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Recentering time-varying predictors.</h3>
<p>Back to the <code>wages_pp</code> data! Here’s the generic statistical model we’ll be fooling with:</p>
<p><span class="math display">\[\begin{align*}
\text{lnw}_{ij} &amp; = \gamma_{00} + \gamma_{10} \text{exper}_{ij} + \gamma_{01} (\text{hgc}_i - 9) + \gamma_{12} \text{black}_i \times \text{exper}_{ij} \\
                &amp; \;\;\; + \zeta_{0i} + \zeta_{1i} \text{exper}_{ij} + \epsilon_{ij}.
\end{align*}\]</span></p>
<p>We will fit the model with three versions of <code>uerate</code>. If you execute <code>head(wages_pp)</code>, you’ll discover they’re already in the data. But it might be worth walking out how to compute those variables. First, centering <code>uerate</code> at 7 is easy enough. Just subtract.</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="treating-time-more-flexibly.html#cb684-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="ot">&lt;-</span></span>
<span id="cb684-2"><a href="treating-time-more-flexibly.html#cb684-2" aria-hidden="true" tabindex="-1"></a>  wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb684-3"><a href="treating-time-more-flexibly.html#cb684-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uerate_7 =</span> uerate <span class="sc">-</span> <span class="dv">7</span>)</span></code></pre></div>
<p>Continuing on with the same priors from before, here’s how to fit the new model, our version of Model A on page 175.</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="treating-time-more-flexibly.html#cb685-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.16</span> <span class="ot">&lt;-</span></span>
<span id="cb685-2"><a href="treating-time-more-flexibly.html#cb685-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_pp, </span>
<span id="cb685-3"><a href="treating-time-more-flexibly.html#cb685-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb685-4"><a href="treating-time-more-flexibly.html#cb685-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> exper <span class="sc">+</span> hgc_9 <span class="sc">+</span> black<span class="sc">:</span>exper <span class="sc">+</span> uerate_7 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb685-5"><a href="treating-time-more-flexibly.html#cb685-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb685-6"><a href="treating-time-more-flexibly.html#cb685-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb685-7"><a href="treating-time-more-flexibly.html#cb685-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb685-8"><a href="treating-time-more-flexibly.html#cb685-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb685-9"><a href="treating-time-more-flexibly.html#cb685-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb685-10"><a href="treating-time-more-flexibly.html#cb685-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb685-11"><a href="treating-time-more-flexibly.html#cb685-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb685-12"><a href="treating-time-more-flexibly.html#cb685-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.16&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="treating-time-more-flexibly.html#cb686-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.16</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + exper + hgc_9 + black:exper + uerate_7 + (1 + exper | id) 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.224     0.011    0.203    0.245 1.001     1768     2591
## sd(exper)               0.040     0.003    0.035    0.045 1.005      574     1338
## cor(Intercept,exper)   -0.299     0.068   -0.425   -0.156 1.003      736     1710
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept      1.749     0.011    1.727    1.772 1.000     3293     3660
## exper          0.044     0.003    0.039    0.049 1.000     2947     3578
## hgc_9          0.040     0.006    0.028    0.053 1.001     2423     2782
## uerate_7      -0.012     0.002   -0.015   -0.008 1.000     5544     4052
## exper:black   -0.018     0.004   -0.027   -0.010 1.001     2889     3524
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.308     0.003    0.302    0.315 1.001     3162     2941
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="treating-time-more-flexibly.html#cb688-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="ot">&lt;-</span></span>
<span id="cb688-2"><a href="treating-time-more-flexibly.html#cb688-2" aria-hidden="true" tabindex="-1"></a>  wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb688-3"><a href="treating-time-more-flexibly.html#cb688-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb688-4"><a href="treating-time-more-flexibly.html#cb688-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uerate_id_mu  =</span> <span class="fu">mean</span>(uerate)) <span class="sc">%&gt;%</span> </span>
<span id="cb688-5"><a href="treating-time-more-flexibly.html#cb688-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb688-6"><a href="treating-time-more-flexibly.html#cb688-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uerate_id_dev =</span> uerate <span class="sc">-</span> uerate_id_mu)</span></code></pre></div>
<p>In the original data set, these were the <code>ue.mean</code> and <code>ue.person.cen</code> variables, respectively. Here’s how to fit the model.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="treating-time-more-flexibly.html#cb689-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.17</span> <span class="ot">&lt;-</span></span>
<span id="cb689-2"><a href="treating-time-more-flexibly.html#cb689-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> wages_pp, </span>
<span id="cb689-3"><a href="treating-time-more-flexibly.html#cb689-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb689-4"><a href="treating-time-more-flexibly.html#cb689-4" aria-hidden="true" tabindex="-1"></a>      lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> exper <span class="sc">+</span> hgc_9 <span class="sc">+</span> black<span class="sc">:</span>exper <span class="sc">+</span> uerate_id_mu <span class="sc">+</span> uerate_id_dev <span class="sc">+</span> </span>
<span id="cb689-5"><a href="treating-time-more-flexibly.html#cb689-5" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb689-6"><a href="treating-time-more-flexibly.html#cb689-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">1.335</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb689-7"><a href="treating-time-more-flexibly.html#cb689-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),   <span class="at">class =</span> b),</span>
<span id="cb689-8"><a href="treating-time-more-flexibly.html#cb689-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb689-9"><a href="treating-time-more-flexibly.html#cb689-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb689-10"><a href="treating-time-more-flexibly.html#cb689-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb689-11"><a href="treating-time-more-flexibly.html#cb689-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb689-12"><a href="treating-time-more-flexibly.html#cb689-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb689-13"><a href="treating-time-more-flexibly.html#cb689-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.17&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="treating-time-more-flexibly.html#cb690-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.17</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ 0 + Intercept + exper + hgc_9 + black:exper + uerate_id_mu + uerate_id_dev + (1 + exper | id) 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.225     0.011    0.205    0.247 1.001     1942     2899
## sd(exper)               0.040     0.003    0.035    0.045 1.003      749     1690
## cor(Intercept,exper)   -0.313     0.066   -0.435   -0.179 1.002      918     1704
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept        1.873     0.030    1.815    1.933 1.001     1940     2804
## exper            0.045     0.003    0.040    0.050 1.001     2298     3173
## hgc_9            0.040     0.006    0.028    0.052 1.000     2605     3069
## uerate_id_mu    -0.018     0.004   -0.025   -0.011 1.001     2069     3096
## uerate_id_dev   -0.010     0.002   -0.014   -0.006 1.000     5776     3452
## exper:black     -0.019     0.005   -0.028   -0.009 1.000     2332     2956
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.308     0.003    0.302    0.314 1.001     3695     3162
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Within the <strong>tidyverse</strong>, probably the easiest way to center on the first value for each <code>id</code> is to first <code>group_by(id)</code> and then make use of the <code>dplyr::first()</code> function, which you can learn more about <a href="https://dplyr.tidyverse.org/reference/nth.html">here</a>.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="treating-time-more-flexibly.html#cb692-1" aria-hidden="true" tabindex="-1"></a>wages_pp <span class="ot">&lt;-</span></span>
<span id="cb692-2"><a href="treating-time-more-flexibly.html#cb692-2" aria-hidden="true" tabindex="-1"></a>  wages_pp <span class="sc">%&gt;%</span> </span>
<span id="cb692-3"><a href="treating-time-more-flexibly.html#cb692-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb692-4"><a href="treating-time-more-flexibly.html#cb692-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uerate_id_1 =</span> <span class="fu">first</span>(uerate)) <span class="sc">%&gt;%</span> </span>
<span id="cb692-5"><a href="treating-time-more-flexibly.html#cb692-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb692-6"><a href="treating-time-more-flexibly.html#cb692-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uerate_id_1_dev =</span> uerate <span class="sc">-</span> uerate_id_1)</span></code></pre></div>
<p>In the original data set, these were the <code>ue1</code> and <code>ue.centert1</code> variables, respectively. Here’s how to fit the updated model.</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="treating-time-more-flexibly.html#cb693-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.18</span> <span class="ot">&lt;-</span></span>
<span id="cb693-2"><a href="treating-time-more-flexibly.html#cb693-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(fit5<span class="fl">.16</span>,</span>
<span id="cb693-3"><a href="treating-time-more-flexibly.html#cb693-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> wages_pp,</span>
<span id="cb693-4"><a href="treating-time-more-flexibly.html#cb693-4" aria-hidden="true" tabindex="-1"></a>         lnw <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> exper <span class="sc">+</span> hgc_9 <span class="sc">+</span> black<span class="sc">:</span>exper <span class="sc">+</span> uerate_id_1 <span class="sc">+</span> uerate_id_1_dev <span class="sc">+</span> </span>
<span id="cb693-5"><a href="treating-time-more-flexibly.html#cb693-5" aria-hidden="true" tabindex="-1"></a>           (<span class="dv">1</span> <span class="sc">+</span> exper <span class="sc">|</span> id),</span>
<span id="cb693-6"><a href="treating-time-more-flexibly.html#cb693-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb693-7"><a href="treating-time-more-flexibly.html#cb693-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb693-8"><a href="treating-time-more-flexibly.html#cb693-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/fit05.18&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="treating-time-more-flexibly.html#cb694-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.18</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: lnw ~ Intercept + exper + hgc_9 + uerate_id_1 + uerate_id_1_dev + (1 + exper | id) + exper:black - 1 
##    Data: wages_pp (Number of observations: 6402) 
## Samples: 3 chains, each with iter = 2500; warmup = 1000; thin = 1;
##          total post-warmup samples = 4500
## 
## Group-Level Effects: 
## ~id (Number of levels: 888) 
##                      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)           0.224     0.011    0.204    0.245 1.001     1860     3112
## sd(exper)               0.041     0.003    0.035    0.046 1.000      747     1587
## cor(Intercept,exper)   -0.309     0.067   -0.434   -0.170 1.000      831     1576
## 
## Population-Level Effects: 
##                 Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept          1.869     0.026    1.819    1.921 1.001     3029     3061
## exper              0.045     0.003    0.039    0.050 1.001     3128     3319
## hgc_9              0.040     0.006    0.027    0.053 1.000     3510     3400
## uerate_id_1       -0.016     0.003   -0.021   -0.011 1.000     2996     3301
## uerate_id_1_dev   -0.010     0.002   -0.014   -0.006 1.000     6136     3853
## exper:black       -0.018     0.005   -0.027   -0.009 1.000     3147     3685
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.308     0.003    0.302    0.314 1.000     4134     3303
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here are the WAIC comparisons.</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="treating-time-more-flexibly.html#cb696-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.16</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.16</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb696-2"><a href="treating-time-more-flexibly.html#cb696-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.17</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.17</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb696-3"><a href="treating-time-more-flexibly.html#cb696-3" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.18</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.18</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb696-4"><a href="treating-time-more-flexibly.html#cb696-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-5"><a href="treating-time-more-flexibly.html#cb696-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.16</span>, fit5<span class="fl">.17</span>, fit5<span class="fl">.18</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb696-6"><a href="treating-time-more-flexibly.html#cb696-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit5.18     0.0       0.0 -2035.6     104.3        865.0    27.0    4071.1   208.5
## fit5.16    -1.4       1.8 -2037.0     104.2        862.0    26.9    4073.9   208.3
## fit5.17    -3.8       1.3 -2039.3     104.4        866.9    27.1    4078.7   208.7</code></pre>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="treating-time-more-flexibly.html#cb698-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.16</span>, fit5<span class="fl">.17</span>, fit5<span class="fl">.18</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb698-2"><a href="treating-time-more-flexibly.html#cb698-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.16 fit5.17 fit5.18 
##   0.196   0.018   0.786</code></pre>
<p>Like in the text, these three models are all close with respect to the WAIC. Based on their WAIC weights, <code>fit5.18</code> (Model C) and <code>fit5.16</code> (Model A) seen the be the best depictions of the data.</p>
</div>
<div id="an-important-caveat-the-problem-of-reciprocal-causation." class="section level3" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> An important caveat: The problem of reciprocal causation.</h3>
<p>In this section, Singer and Willett gave a typology for time-varying covariates.</p>
<ul>
<li>A variable is <em>defined</em> if, “in advance to data collection, its values are predetermined for everyone under study” (p. 177). Examples are time and the seasons.</li>
<li>A variable is <em>ancillary</em> if “its values cannot be influenced by study participants because they are determined by a stochastic process totally external to them” (p. 178). Within the context of a study on people within monogamous relationships, the availability of potential mates within the region would be an example.</li>
<li>A variable is <em>contextual</em> if “it describes an ‘external’ stochastic process, but the connection between units is closer–between husbands and wives, parents and children, teachers and students, employers and employees. Because of this proximity, contextual predictors can be influenced by an individual’s contemporaneous outcome values; if so, they are susceptible to issues of reciprocal causation” (p. 179).</li>
<li>A variable is <em>internal</em> if it describes an “individual’s potentially changeable status over time” (p. 179). Examples include mood, psychiatric syndromes, and employment status.</li>
</ul>
</div>
</div>
<div id="recentering-the-effect-of-time" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Recentering the effect of <em>TIME</em></h2>
<p>Our version of the data from Tomarken, Shelton, Elkins, and Anderson <span class="citation">(<a href="references.html#ref-tomarken1997sleep" role="doc-biblioref">1997</a>)</span> is saved as <code>medication_pp.csv</code>.</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="treating-time-more-flexibly.html#cb700-1" aria-hidden="true" tabindex="-1"></a>medication_pp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/medication_pp.csv&quot;</span>)</span>
<span id="cb700-2"><a href="treating-time-more-flexibly.html#cb700-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb700-3"><a href="treating-time-more-flexibly.html#cb700-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(medication_pp)</span></code></pre></div>
<pre><code>## Rows: 1,242
## Columns: 11
## $ id          &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 10, 10, 10, 10, 10…
## $ treat       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ wave        &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19, 20, 21, 1, 2, 3…
## $ day         &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 6, 6, 6, 0, 0, 0, 1, 1, 1, …
## $ time.of.day &lt;dbl&gt; 0.0000000, 0.3333333, 0.6666667, 0.0000000, 0.3333333, 0.6666667, 0.0000000, 0…
## $ time        &lt;dbl&gt; 0.0000000, 0.3333333, 0.6666667, 1.0000000, 1.3333333, 1.6666667, 2.0000000, 2…
## $ time333     &lt;dbl&gt; -3.3333333, -3.0000000, -2.6666667, -2.3333333, -2.0000000, -1.6666667, -1.333…
## $ time667     &lt;dbl&gt; -6.6666667, -6.3333333, -6.0000000, -5.6666667, -5.3333333, -5.0000000, -4.666…
## $ initial     &lt;dbl&gt; 1.00, 0.95, 0.90, 0.85, 0.80, 0.75, 0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, …
## $ final       &lt;dbl&gt; 0.00, 0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, …
## $ pos         &lt;dbl&gt; 106.6667, 100.0000, 100.0000, 100.0000, 100.0000, 100.0000, 100.0000, 100.0000…</code></pre>
<p>The <code>medication_pp</code> data do not come with a <code>reading</code> variable, as in Table 5.9. Here we’ll make one and display the time variables highlighted in Table 5.9.</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="treating-time-more-flexibly.html#cb702-1" aria-hidden="true" tabindex="-1"></a>medication_pp <span class="ot">&lt;-</span></span>
<span id="cb702-2"><a href="treating-time-more-flexibly.html#cb702-2" aria-hidden="true" tabindex="-1"></a>  medication_pp <span class="sc">%&gt;%</span> </span>
<span id="cb702-3"><a href="treating-time-more-flexibly.html#cb702-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reading =</span> <span class="fu">ifelse</span>(time.of.day <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;8 am&quot;</span>,</span>
<span id="cb702-4"><a href="treating-time-more-flexibly.html#cb702-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(time.of.day <span class="sc">&lt;</span> .<span class="dv">6</span>, <span class="st">&quot;3 pm&quot;</span>, <span class="st">&quot;10 pm&quot;</span>)))</span>
<span id="cb702-5"><a href="treating-time-more-flexibly.html#cb702-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb702-6"><a href="treating-time-more-flexibly.html#cb702-6" aria-hidden="true" tabindex="-1"></a>medication_pp <span class="sc">%&gt;%</span> </span>
<span id="cb702-7"><a href="treating-time-more-flexibly.html#cb702-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(wave, day, reading, time.of.day<span class="sc">:</span>time667) <span class="sc">%&gt;%</span> </span>
<span id="cb702-8"><a href="treating-time-more-flexibly.html#cb702-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     wave   day reading time.of.day  time time333 time667
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     0 8 am          0     0      -3.33    -6.67
##  2     2     0 3 pm          0.333 0.333  -3       -6.33
##  3     3     0 10 pm         0.667 0.667  -2.67    -6   
##  4     4     1 8 am          0     1      -2.33    -5.67
##  5     5     1 3 pm          0.333 1.33   -2       -5.33
##  6     6     1 10 pm         0.667 1.67   -1.67    -5   
##  7     7     2 8 am          0     2      -1.33    -4.67
##  8     8     2 3 pm          0.333 2.33   -1       -4.33
##  9     9     2 10 pm         0.667 2.67   -0.667   -4   
## 10    10     3 8 am          0     3      -0.333   -3.67</code></pre>
<p>To help get a sense of the balance in the data, here is a bar plot of the distribution of the numbers of measurement occasions within participants. It’s color coded by treatment status.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="treating-time-more-flexibly.html#cb704-1" aria-hidden="true" tabindex="-1"></a>medication_pp <span class="sc">%&gt;%</span> </span>
<span id="cb704-2"><a href="treating-time-more-flexibly.html#cb704-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treat =</span> <span class="fu">str_c</span>(<span class="st">&quot;treat = &quot;</span>, treat)) <span class="sc">%&gt;%</span> </span>
<span id="cb704-3"><a href="treating-time-more-flexibly.html#cb704-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, id) <span class="sc">%&gt;%</span> </span>
<span id="cb704-4"><a href="treating-time-more-flexibly.html#cb704-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb704-5"><a href="treating-time-more-flexibly.html#cb704-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb704-6"><a href="treating-time-more-flexibly.html#cb704-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">fill =</span> treat)) <span class="sc">+</span></span>
<span id="cb704-7"><a href="treating-time-more-flexibly.html#cb704-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb704-8"><a href="treating-time-more-flexibly.html#cb704-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">12</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">21</span>)) <span class="sc">+</span></span>
<span id="cb704-9"><a href="treating-time-more-flexibly.html#cb704-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb704-10"><a href="treating-time-more-flexibly.html#cb704-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;count of cases&quot;</span>,</span>
<span id="cb704-11"><a href="treating-time-more-flexibly.html#cb704-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;# measurement occasions&quot;</span>) <span class="sc">+</span></span>
<span id="cb704-12"><a href="treating-time-more-flexibly.html#cb704-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) </span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-140-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>For this section, our basic model will be</p>
<p><span class="math display">\[\begin{align*}
\text{pos}_{ij} &amp; = \pi_{0i} + \pi_{1i} (\text{time}_{ij} - c) + \epsilon_{ij} \\
\pi_{0i}        &amp; = \gamma_{00} + \gamma_{01} \text{treat}_i + \zeta_{0i} \\
\pi_{1i}        &amp; = \gamma_{10} + \gamma_{11} \text{treat}_i + \zeta_{1i},
\end{align*}\]</span></p>
<p>where <span class="math inline">\(c\)</span> is a generic constant. For our three variants of <span class="math inline">\(\text{time}_{ij}\)</span>, <span class="math inline">\(c\)</span> will be</p>
<ul>
<li>0 for <code>time</code>,</li>
<li>3.3333333 for <code>time333</code>, and</li>
<li>6.666667 for <code>time667</code>.</li>
</ul>
<p>Our criterion variable is <code>pos</code>, positive mood rating. The text told us these were from “a package of mood diaries (which use a five-point scale to assess positive and negative moods)” (p. 182). However, we don’t know what numerals were assigned to the points on the scale, we don’t know how many items were used, and we don’t even know whether the items were taken from an existing questionnaire. And unfortunately, the citation Singer and Willett gave for the study is from a conference presentation, making it a pain to track down background information on the internet. In such a situation, it’s difficult to figure out how to set our priors. Though suboptimal, we might first get a sense of the <code>pos</code> data with a histogram.</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="treating-time-more-flexibly.html#cb705-1" aria-hidden="true" tabindex="-1"></a>medication_pp <span class="sc">%&gt;%</span> </span>
<span id="cb705-2"><a href="treating-time-more-flexibly.html#cb705-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pos)) <span class="sc">+</span></span>
<span id="cb705-3"><a href="treating-time-more-flexibly.html#cb705-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb705-4"><a href="treating-time-more-flexibly.html#cb705-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-141-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Here’s the <code>range()</code>.</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="treating-time-more-flexibly.html#cb706-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(medication_pp<span class="sc">$</span>pos)</span></code></pre></div>
<pre><code>## [1] 100.0000 466.6667</code></pre>
<p>Starting with the prior for our intercept, I think there’s a lot of room for argument, here. To keep with our weakly-regularizing approach to priors, it might make sense to use something like <code>normal(200, 100)</code>. But then again, we know something about the study design. At the beginning, participants were in treatment for depression, so we’d expect the starting point to be closer to the lower end of the scale. In that case, we might update our approach to something like <code>normal(150, 50)</code>. Feel free to play with alternatives. What I hope this illustrates is that our task would be much easier with more domain knowledge.</p>
<p>Anyway, given the scale of the data, weakly-regularizing priors for the predictor variables might take the form of something like <code>normal(0, 25)</code>. We’ll use <code>student_t(0, 50)</code> on the <span class="math inline">\(\sigma\)</span>s and stay steady with <code>lkj(4)</code> on <span class="math inline">\(\rho_{01}\)</span>.</p>
<p>Here we fit the model with all three versions of <code>time</code>.</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="treating-time-more-flexibly.html#cb708-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.19</span> <span class="ot">&lt;-</span></span>
<span id="cb708-2"><a href="treating-time-more-flexibly.html#cb708-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> medication_pp, </span>
<span id="cb708-3"><a href="treating-time-more-flexibly.html#cb708-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb708-4"><a href="treating-time-more-flexibly.html#cb708-4" aria-hidden="true" tabindex="-1"></a>      pos <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time <span class="sc">+</span> treat <span class="sc">+</span> time<span class="sc">:</span>treat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> id),</span>
<span id="cb708-5"><a href="treating-time-more-flexibly.html#cb708-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">150</span>, <span class="dv">50</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept),</span>
<span id="cb708-6"><a href="treating-time-more-flexibly.html#cb708-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="at">class =</span> b),</span>
<span id="cb708-7"><a href="treating-time-more-flexibly.html#cb708-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sd),</span>
<span id="cb708-8"><a href="treating-time-more-flexibly.html#cb708-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma),</span>
<span id="cb708-9"><a href="treating-time-more-flexibly.html#cb708-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb708-10"><a href="treating-time-more-flexibly.html#cb708-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb708-11"><a href="treating-time-more-flexibly.html#cb708-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb708-12"><a href="treating-time-more-flexibly.html#cb708-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.19&quot;</span>)</span>
<span id="cb708-13"><a href="treating-time-more-flexibly.html#cb708-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb708-14"><a href="treating-time-more-flexibly.html#cb708-14" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.20</span> <span class="ot">&lt;-</span></span>
<span id="cb708-15"><a href="treating-time-more-flexibly.html#cb708-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(fit5<span class="fl">.19</span>,</span>
<span id="cb708-16"><a href="treating-time-more-flexibly.html#cb708-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> medication_pp,</span>
<span id="cb708-17"><a href="treating-time-more-flexibly.html#cb708-17" aria-hidden="true" tabindex="-1"></a>         pos <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time333 <span class="sc">+</span> treat <span class="sc">+</span> time333<span class="sc">:</span>treat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time333 <span class="sc">|</span> id),</span>
<span id="cb708-18"><a href="treating-time-more-flexibly.html#cb708-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb708-19"><a href="treating-time-more-flexibly.html#cb708-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb708-20"><a href="treating-time-more-flexibly.html#cb708-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/fit05.20&quot;</span>)</span>
<span id="cb708-21"><a href="treating-time-more-flexibly.html#cb708-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb708-22"><a href="treating-time-more-flexibly.html#cb708-22" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.21</span> <span class="ot">&lt;-</span></span>
<span id="cb708-23"><a href="treating-time-more-flexibly.html#cb708-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(fit5<span class="fl">.19</span>,</span>
<span id="cb708-24"><a href="treating-time-more-flexibly.html#cb708-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> medication_pp,</span>
<span id="cb708-25"><a href="treating-time-more-flexibly.html#cb708-25" aria-hidden="true" tabindex="-1"></a>         pos <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time667 <span class="sc">+</span> treat <span class="sc">+</span> time667<span class="sc">:</span>treat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time667 <span class="sc">|</span> id),</span>
<span id="cb708-26"><a href="treating-time-more-flexibly.html#cb708-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb708-27"><a href="treating-time-more-flexibly.html#cb708-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb708-28"><a href="treating-time-more-flexibly.html#cb708-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/fit05.21&quot;</span>)</span></code></pre></div>
<p>Given the size of our posterior standard deviations, our <span class="math inline">\(\gamma\)</span> posteriors are quite comparable to the point estimates (and their standard errors) in the text.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="treating-time-more-flexibly.html#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.19</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: pos ~ 0 + Intercept + time + treat + time:treat + (1 + time | id) 
##    Data: medication_pp (Number of observations: 1242) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 64) 
##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)          47.05      4.72    38.61    56.99 1.00     1296     1706
## sd(time)                8.25      0.93     6.55    10.21 1.00     1412     2099
## cor(Intercept,time)    -0.28      0.13    -0.52    -0.03 1.00     1311     1813
## 
## Population-Level Effects: 
##            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    166.33      8.76   148.57   183.23 1.00      806     1598
## time          -2.35      1.73    -5.96     0.97 1.00     1317     2098
## treat         -1.60     10.99   -22.78    20.59 1.01      918     1533
## time:treat     5.39      2.25     0.89     9.74 1.00     1177     1863
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    35.12      0.75    33.70    36.61 1.00     5705     2934
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Given the scales we’re working with, it’s difficult to compare our <span class="math inline">\(\sigma\)</span> summaries with the <span class="math inline">\(\sigma^2\)</span> summaries in Table 5.10 of the text. Here we convert and resummarize.</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="treating-time-more-flexibly.html#cb711-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span></span>
<span id="cb711-2"><a href="treating-time-more-flexibly.html#cb711-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(fit5<span class="fl">.19</span>) <span class="sc">%&gt;%</span></span>
<span id="cb711-3"><a href="treating-time-more-flexibly.html#cb711-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">sigma_2_0 =</span> sd_id__Intercept<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb711-4"><a href="treating-time-more-flexibly.html#cb711-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sigma_2_1 =</span> sd_id__time<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb711-5"><a href="treating-time-more-flexibly.html#cb711-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sigma_2_epsilon =</span> sigma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb711-6"><a href="treating-time-more-flexibly.html#cb711-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb711-7"><a href="treating-time-more-flexibly.html#cb711-7" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb711-8"><a href="treating-time-more-flexibly.html#cb711-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb711-9"><a href="treating-time-more-flexibly.html#cb711-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb711-10"><a href="treating-time-more-flexibly.html#cb711-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb711-11"><a href="treating-time-more-flexibly.html#cb711-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   name             value .lower .upper .width .point .interval
##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 sigma_2_0       2189.  1491.   3248.   0.95 median qi       
## 2 sigma_2_1         67.2   42.9   104.   0.95 median qi       
## 3 sigma_2_epsilon 1233.  1136.   1340.   0.95 median qi</code></pre>
<p>Turns out the posterior medians are quite similar to the ML estimates in the text. Here’s what the entire distributions looks like.</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="treating-time-more-flexibly.html#cb713-1" aria-hidden="true" tabindex="-1"></a>v <span class="sc">%&gt;%</span> </span>
<span id="cb713-2"><a href="treating-time-more-flexibly.html#cb713-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;sigma[0]^2&quot;</span>, <span class="st">&quot;sigma[1]^2&quot;</span>, <span class="st">&quot;sigma[epsilon]^2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb713-3"><a href="treating-time-more-flexibly.html#cb713-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb713-4"><a href="treating-time-more-flexibly.html#cb713-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb713-5"><a href="treating-time-more-flexibly.html#cb713-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb713-6"><a href="treating-time-more-flexibly.html#cb713-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb713-7"><a href="treating-time-more-flexibly.html#cb713-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb713-8"><a href="treating-time-more-flexibly.html#cb713-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb713-9"><a href="treating-time-more-flexibly.html#cb713-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb713-10"><a href="treating-time-more-flexibly.html#cb713-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb713-11"><a href="treating-time-more-flexibly.html#cb713-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-145-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Here’s our version of Figure 5.5.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="treating-time-more-flexibly.html#cb714-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span></span>
<span id="cb714-2"><a href="treating-time-more-flexibly.html#cb714-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">treat =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb714-3"><a href="treating-time-more-flexibly.html#cb714-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">time  =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">7</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb714-4"><a href="treating-time-more-flexibly.html#cb714-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-5"><a href="treating-time-more-flexibly.html#cb714-5" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb714-6"><a href="treating-time-more-flexibly.html#cb714-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">treat =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb714-7"><a href="treating-time-more-flexibly.html#cb714-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">time  =</span> <span class="dv">4</span>,</span>
<span id="cb714-8"><a href="treating-time-more-flexibly.html#cb714-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">y     =</span> <span class="fu">c</span>(<span class="dv">135</span>, <span class="dv">197</span>),</span>
<span id="cb714-9"><a href="treating-time-more-flexibly.html#cb714-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;control&quot;</span>, <span class="st">&quot;treatment&quot;</span>),</span>
<span id="cb714-10"><a href="treating-time-more-flexibly.html#cb714-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">angle =</span> <span class="fu">c</span>(<span class="dv">350</span>, <span class="dv">15</span>))</span>
<span id="cb714-11"><a href="treating-time-more-flexibly.html#cb714-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-12"><a href="treating-time-more-flexibly.html#cb714-12" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit5<span class="fl">.19</span>,</span>
<span id="cb714-13"><a href="treating-time-more-flexibly.html#cb714-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd,</span>
<span id="cb714-14"><a href="treating-time-more-flexibly.html#cb714-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">re_formula =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb714-15"><a href="treating-time-more-flexibly.html#cb714-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb714-16"><a href="treating-time-more-flexibly.html#cb714-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb714-17"><a href="treating-time-more-flexibly.html#cb714-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb714-18"><a href="treating-time-more-flexibly.html#cb714-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">fill =</span> treat, <span class="at">color =</span> treat, <span class="at">group =</span> treat)) <span class="sc">+</span></span>
<span id="cb714-19"><a href="treating-time-more-flexibly.html#cb714-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb714-20"><a href="treating-time-more-flexibly.html#cb714-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb714-21"><a href="treating-time-more-flexibly.html#cb714-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb714-22"><a href="treating-time-more-flexibly.html#cb714-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb714-23"><a href="treating-time-more-flexibly.html#cb714-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> angle)) <span class="sc">+</span></span>
<span id="cb714-24"><a href="treating-time-more-flexibly.html#cb714-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">begin =</span> .<span class="dv">3</span>, <span class="at">end =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb714-25"><a href="treating-time-more-flexibly.html#cb714-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">begin =</span> .<span class="dv">3</span>, <span class="at">end =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb714-26"><a href="treating-time-more-flexibly.html#cb714-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;days&quot;</span>,</span>
<span id="cb714-27"><a href="treating-time-more-flexibly.html#cb714-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;pos&quot;</span>) <span class="sc">+</span></span>
<span id="cb714-28"><a href="treating-time-more-flexibly.html#cb714-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb714-29"><a href="treating-time-more-flexibly.html#cb714-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-146-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Although we still have clear evidence of an interaction, adding those 95% intervals makes it look less impressive, doesn’t it?</p>
<p>Here are the summaries for the models with the alternative versions of <span class="math inline">\((\text{time}_{ij} - c)\)</span>.</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="treating-time-more-flexibly.html#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.20</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: pos ~ Intercept + time333 + treat + (1 + time333 | id) + time333:treat - 1 
##    Data: medication_pp (Number of observations: 1242) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 64) 
##                        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)             46.19      4.37    38.66    55.51 1.01      364      731
## sd(time333)                8.34      0.94     6.66    10.30 1.00      848     1714
## cor(Intercept,time333)     0.22      0.13    -0.04     0.46 1.01      902     1624
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       161.22      8.20   144.75   176.91 1.02      230      377
## time333          -2.31      1.77    -5.80     1.19 1.00      619     1122
## treat            13.00     10.71    -8.92    33.76 1.03      271      436
## time333:treat     5.47      2.33     0.89    10.14 1.00      566     1111
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    35.10      0.73    33.64    36.56 1.00     2845     2793
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="treating-time-more-flexibly.html#cb717-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.21</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: pos ~ Intercept + time667 + treat + (1 + time667 | id) + time667:treat - 1 
##    Data: medication_pp (Number of observations: 1242) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 64) 
##                        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)             57.54      5.32    48.11    68.97 1.00     1051     1749
## sd(time667)                8.02      0.88     6.43     9.92 1.00     1265     2637
## cor(Intercept,time667)     0.59      0.09     0.39     0.74 1.00     1673     2374
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept       156.30      9.90   136.66   176.03 1.01      887     1542
## time667          -1.97      1.68    -5.27     1.38 1.00     1193     1737
## treat            24.31     12.68    -0.72    48.98 1.00     1023     1765
## time667:treat     4.63      2.18     0.35     9.01 1.00     1235     1659
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    35.12      0.77    33.64    36.71 1.00     4998     2923
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>It might be easier to compare the <span class="math inline">\(\gamma\)</span> summaries across models with a well-designed coefficient plot. Here’s an attempt.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="treating-time-more-flexibly.html#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">&quot;fit5.&quot;</span>, <span class="dv">19</span><span class="sc">:</span><span class="dv">21</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb719-2"><a href="treating-time-more-flexibly.html#cb719-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fixef =</span> <span class="fu">map</span>(name, <span class="sc">~</span><span class="fu">get</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb719-3"><a href="treating-time-more-flexibly.html#cb719-3" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">fixef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb719-4"><a href="treating-time-more-flexibly.html#cb719-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb719-5"><a href="treating-time-more-flexibly.html#cb719-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rownames_to_column</span>(<span class="st">&quot;parameter&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb719-6"><a href="treating-time-more-flexibly.html#cb719-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(fixef) <span class="sc">%&gt;%</span> </span>
<span id="cb719-7"><a href="treating-time-more-flexibly.html#cb719-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gamma =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;gamma[0][0]&quot;</span>, <span class="st">&quot;gamma[1][0]&quot;</span>, <span class="st">&quot;gamma[0][1]&quot;</span>, <span class="st">&quot;gamma[1][1]&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb719-8"><a href="treating-time-more-flexibly.html#cb719-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb719-9"><a href="treating-time-more-flexibly.html#cb719-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb719-10"><a href="treating-time-more-flexibly.html#cb719-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb719-11"><a href="treating-time-more-flexibly.html#cb719-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb719-12"><a href="treating-time-more-flexibly.html#cb719-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb719-13"><a href="treating-time-more-flexibly.html#cb719-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb719-14"><a href="treating-time-more-flexibly.html#cb719-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb719-15"><a href="treating-time-more-flexibly.html#cb719-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb719-16"><a href="treating-time-more-flexibly.html#cb719-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>gamma, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">labeller =</span> label_parsed, <span class="at">ncol =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-148-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Since we’re juggling less information, we might compare the posteriors for <span class="math inline">\(\sigma_1^2\)</span> across the three models with good old <code>tidybayes::geom_halfeyeh()</code>.</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="treating-time-more-flexibly.html#cb720-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">&quot;fit5.&quot;</span>, <span class="dv">19</span><span class="sc">:</span><span class="dv">21</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb720-2"><a href="treating-time-more-flexibly.html#cb720-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">map</span>(name, get)) <span class="sc">%&gt;%</span> </span>
<span id="cb720-3"><a href="treating-time-more-flexibly.html#cb720-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_2_1 =</span> <span class="fu">map</span>(fit, <span class="sc">~</span><span class="fu">VarCorr</span>(., <span class="at">summary =</span> F)[[<span class="dv">1</span>]][[<span class="dv">1</span>]][, <span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span> <span class="sc">%&gt;%</span> </span>
<span id="cb720-4"><a href="treating-time-more-flexibly.html#cb720-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb720-5"><a href="treating-time-more-flexibly.html#cb720-5" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">set_names</span>(<span class="st">&quot;sigma_2_1&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb720-6"><a href="treating-time-more-flexibly.html#cb720-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(sigma_2_1) <span class="sc">%&gt;%</span> </span>
<span id="cb720-7"><a href="treating-time-more-flexibly.html#cb720-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb720-8"><a href="treating-time-more-flexibly.html#cb720-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma_2_1, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb720-9"><a href="treating-time-more-flexibly.html#cb720-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb720-10"><a href="treating-time-more-flexibly.html#cb720-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(sigma[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb720-11"><a href="treating-time-more-flexibly.html#cb720-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb720-12"><a href="treating-time-more-flexibly.html#cb720-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb720-13"><a href="treating-time-more-flexibly.html#cb720-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-149-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>For kicks and giggles, we marked off both 50% and 95% intervals for each. Here’s the same for <span class="math inline">\(\rho_{01}\)</span>.</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="treating-time-more-flexibly.html#cb721-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">&quot;fit5.&quot;</span>, <span class="dv">19</span><span class="sc">:</span><span class="dv">21</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb721-2"><a href="treating-time-more-flexibly.html#cb721-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">map</span>(name, get)) <span class="sc">%&gt;%</span> </span>
<span id="cb721-3"><a href="treating-time-more-flexibly.html#cb721-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rho =</span> <span class="fu">map</span>(fit, <span class="sc">~</span><span class="fu">VarCorr</span>(., <span class="at">summary =</span> F)[[<span class="dv">1</span>]][[<span class="dv">2</span>]][, <span class="dv">2</span>, <span class="st">&quot;Intercept&quot;</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb721-4"><a href="treating-time-more-flexibly.html#cb721-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb721-5"><a href="treating-time-more-flexibly.html#cb721-5" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">set_names</span>(<span class="st">&quot;rho&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb721-6"><a href="treating-time-more-flexibly.html#cb721-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(rho) <span class="sc">%&gt;%</span> </span>
<span id="cb721-7"><a href="treating-time-more-flexibly.html#cb721-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb721-8"><a href="treating-time-more-flexibly.html#cb721-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rho, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb721-9"><a href="treating-time-more-flexibly.html#cb721-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb721-10"><a href="treating-time-more-flexibly.html#cb721-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(rho[<span class="dv">0</span>][<span class="dv">1</span>]),</span>
<span id="cb721-11"><a href="treating-time-more-flexibly.html#cb721-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb721-12"><a href="treating-time-more-flexibly.html#cb721-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb721-13"><a href="treating-time-more-flexibly.html#cb721-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb721-14"><a href="treating-time-more-flexibly.html#cb721-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-150-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>“As Rogosa and Willett <span class="citation">(<a href="references.html#ref-rogosaUnderstandingCorrelatesChange1985" role="doc-biblioref">1985</a>)</span> demonstrate, you can always alter the correlation between the level-1 growth parameters simply by changing the centering constant” (p. 186).</p>
<p>Here are the WAIC comparisons.</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="treating-time-more-flexibly.html#cb722-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.19</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.19</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb722-2"><a href="treating-time-more-flexibly.html#cb722-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.20</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.20</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb722-3"><a href="treating-time-more-flexibly.html#cb722-3" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.21</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.21</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb722-4"><a href="treating-time-more-flexibly.html#cb722-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb722-5"><a href="treating-time-more-flexibly.html#cb722-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.19</span>, fit5<span class="fl">.20</span>, fit5<span class="fl">.21</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb722-6"><a href="treating-time-more-flexibly.html#cb722-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit5.20     0.0       0.0 -6242.0      41.5        110.3     7.6   12484.0    83.1
## fit5.19    -0.9       0.5 -6242.9      41.5        110.9     7.5   12485.7    83.0
## fit5.21    -0.9       0.5 -6242.9      41.5        111.2     7.6   12485.7    83.0</code></pre>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="treating-time-more-flexibly.html#cb724-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.19</span>, fit5<span class="fl">.20</span>, fit5<span class="fl">.21</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb724-2"><a href="treating-time-more-flexibly.html#cb724-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.19 fit5.20 fit5.21 
##   0.228   0.545   0.227</code></pre>
<p>As one might hope, not much going on.</p>
<p>As Singer and Willett alluded to in the text (p. 187), the final model in this chapter is an odd one. Do note the <code>initial</code> and <code>final</code> columns in the data.</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="treating-time-more-flexibly.html#cb726-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(medication_pp)</span></code></pre></div>
<pre><code>## Rows: 1,242
## Columns: 12
## $ id          &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 10, 10, 10, 10, 10…
## $ treat       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ wave        &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19, 20, 21, 1, 2, 3…
## $ day         &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 6, 6, 6, 0, 0, 0, 1, 1, 1, …
## $ time.of.day &lt;dbl&gt; 0.0000000, 0.3333333, 0.6666667, 0.0000000, 0.3333333, 0.6666667, 0.0000000, 0…
## $ time        &lt;dbl&gt; 0.0000000, 0.3333333, 0.6666667, 1.0000000, 1.3333333, 1.6666667, 2.0000000, 2…
## $ time333     &lt;dbl&gt; -3.3333333, -3.0000000, -2.6666667, -2.3333333, -2.0000000, -1.6666667, -1.333…
## $ time667     &lt;dbl&gt; -6.6666667, -6.3333333, -6.0000000, -5.6666667, -5.3333333, -5.0000000, -4.666…
## $ initial     &lt;dbl&gt; 1.00, 0.95, 0.90, 0.85, 0.80, 0.75, 0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, …
## $ final       &lt;dbl&gt; 0.00, 0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, …
## $ pos         &lt;dbl&gt; 106.6667, 100.0000, 100.0000, 100.0000, 100.0000, 100.0000, 100.0000, 100.0000…
## $ reading     &lt;chr&gt; &quot;8 am&quot;, &quot;3 pm&quot;, &quot;10 pm&quot;, &quot;8 am&quot;, &quot;3 pm&quot;, &quot;10 pm&quot;, &quot;8 am&quot;, &quot;3 pm&quot;, &quot;10 pm&quot;, &quot;8 …</code></pre>
<p>With this model</p>
<p><span class="math display">\[\begin{align*}
\text{pos}_{ij} &amp; = \pi_{0i} \bigg (\frac{6.67 - \text{time}_{ij}}{6.67} \bigg ) + \pi_{1i} \bigg (\frac {\text{time}_{ij}}{6.67} \bigg ) + \epsilon_{ij} \\
\pi_{0i}        &amp; = \gamma_{00} + \gamma_{01} \text{treat}_i + \zeta_{0i} \\
\pi_{1i}        &amp; = \gamma_{10} + \gamma_{11} \text{treat}_i + \zeta_{1i}.
\end{align*}\]</span></p>
<p>Because of the parameterization, we’ll use both variables simultaneously to indicate time. In the code, below, you’ll notice we no longer have an intercept parameter. Rather, we just have <code>initial</code> and <code>final</code>. As such, both of those parameters get the same prior we’ve been using for the intercept in the previous models.</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="treating-time-more-flexibly.html#cb728-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.22</span> <span class="ot">&lt;-</span></span>
<span id="cb728-2"><a href="treating-time-more-flexibly.html#cb728-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> medication_pp, </span>
<span id="cb728-3"><a href="treating-time-more-flexibly.html#cb728-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb728-4"><a href="treating-time-more-flexibly.html#cb728-4" aria-hidden="true" tabindex="-1"></a>      pos <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> initial <span class="sc">+</span> final <span class="sc">+</span> initial<span class="sc">:</span>treat <span class="sc">+</span> final<span class="sc">:</span>treat <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> initial <span class="sc">+</span> final <span class="sc">|</span> id),</span>
<span id="cb728-5"><a href="treating-time-more-flexibly.html#cb728-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">150</span>, <span class="dv">50</span>), <span class="at">class =</span> b, <span class="at">coef =</span> initial),</span>
<span id="cb728-6"><a href="treating-time-more-flexibly.html#cb728-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">150</span>, <span class="dv">50</span>), <span class="at">class =</span> b, <span class="at">coef =</span> final),</span>
<span id="cb728-7"><a href="treating-time-more-flexibly.html#cb728-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="at">class =</span> b),</span>
<span id="cb728-8"><a href="treating-time-more-flexibly.html#cb728-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sd),</span>
<span id="cb728-9"><a href="treating-time-more-flexibly.html#cb728-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma),</span>
<span id="cb728-10"><a href="treating-time-more-flexibly.html#cb728-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">4</span>), <span class="at">class =</span> cor)),</span>
<span id="cb728-11"><a href="treating-time-more-flexibly.html#cb728-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb728-12"><a href="treating-time-more-flexibly.html#cb728-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb728-13"><a href="treating-time-more-flexibly.html#cb728-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit05.22&quot;</span>)</span></code></pre></div>
<p>Our results are quite similar to those in the text.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="treating-time-more-flexibly.html#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit5<span class="fl">.22</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: pos ~ 0 + initial + final + initial:treat + final:treat + (0 + initial + final | id) 
##    Data: medication_pp (Number of observations: 1242) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 64) 
##                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(initial)           46.93      4.73    38.56    57.08 1.00     2421     2842
## sd(final)             58.96      5.80    48.87    71.54 1.00     2164     2463
## cor(initial,final)     0.42      0.11     0.18     0.62 1.00     1683     2387
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## initial         167.89      8.80   150.95   185.55 1.00     2118     2477
## final           156.07     10.73   134.81   177.52 1.00     2830     2777
## initial:treat    -4.04     11.09   -25.95    17.92 1.00     2452     2939
## final:treat      25.45     12.97     0.36    50.88 1.00     3018     2590
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    35.13      0.75    33.68    36.59 1.00     5283     2987
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Let’s finish up with the WAIC.</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="treating-time-more-flexibly.html#cb731-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit5<span class="fl">.22</span>, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb731-2"><a href="treating-time-more-flexibly.html#cb731-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb731-3"><a href="treating-time-more-flexibly.html#cb731-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit5<span class="fl">.19</span>, fit5<span class="fl">.20</span>, fit5<span class="fl">.21</span>, fit5<span class="fl">.22</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb731-4"><a href="treating-time-more-flexibly.html#cb731-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit5.20     0.0       0.0 -6242.0      41.5        110.3     7.6   12484.0    83.1
## fit5.22    -0.2       0.5 -6242.2      41.4        111.0     7.6   12484.4    82.9
## fit5.19    -0.9       0.5 -6242.9      41.5        110.9     7.5   12485.7    83.0
## fit5.21    -0.9       0.5 -6242.9      41.5        111.2     7.6   12485.7    83.0</code></pre>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="treating-time-more-flexibly.html#cb733-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit5<span class="fl">.19</span>, fit5<span class="fl">.20</span>, fit5<span class="fl">.21</span>, fit5<span class="fl">.22</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb733-2"><a href="treating-time-more-flexibly.html#cb733-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## fit5.19 fit5.20 fit5.21 fit5.22 
##   0.157   0.376   0.156   0.311</code></pre>
<p>All about the same.</p>
</div>
<div id="session-info-4" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="treating-time-more-flexibly.html#cb735-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.4 (2021-02-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] posterior_0.1.3      bayesplot_1.8.0      tidybayes_2.3.1      brms_2.15.0         
##  [5] Rcpp_1.0.6           rstan_2.21.2         StanHeaders_2.21.0-7 forcats_0.5.1       
##  [9] stringr_1.4.0        dplyr_1.0.5          purrr_0.3.4          readr_1.4.0         
## [13] tidyr_1.1.3          tibble_3.1.0         ggplot2_3.3.3        tidyverse_1.3.0     
## 
## loaded via a namespace (and not attached):
##   [1] uuid_0.1-4           readxl_1.3.1         backports_1.2.1      systemfonts_1.0.1   
##   [5] plyr_1.8.6           igraph_1.2.6         splines_4.0.4        svUnit_1.0.3        
##   [9] crosstalk_1.1.0.1    TH.data_1.0-10       rstantools_2.1.1     inline_0.3.17       
##  [13] digest_0.6.27        htmltools_0.5.1.1    rsconnect_0.8.16     fansi_0.4.2         
##  [17] checkmate_2.0.0      magrittr_2.0.1       modelr_0.1.8         RcppParallel_5.0.2  
##  [21] matrixStats_0.57.0   officer_0.3.17       xts_0.12.1           sandwich_3.0-0      
##  [25] prettyunits_1.1.1    colorspace_2.0-0     rvest_0.3.6          ggdist_2.4.0.9000   
##  [29] haven_2.3.1          xfun_0.22            callr_3.5.1          crayon_1.4.1        
##  [33] jsonlite_1.7.2       lme4_1.1-25          survival_3.2-10      zoo_1.8-8           
##  [37] glue_1.4.2           gtable_0.3.0         emmeans_1.5.2-1      V8_3.4.0            
##  [41] distributional_0.2.2 pkgbuild_1.2.0       shape_1.4.5          abind_1.4-5         
##  [45] scales_1.1.1         mvtnorm_1.1-1        DBI_1.1.0            miniUI_0.1.1.1      
##  [49] viridisLite_0.3.0    xtable_1.8-4         stats4_4.0.4         DT_0.16             
##  [53] htmlwidgets_1.5.2    httr_1.4.2           threejs_0.3.3        arrayhelpers_1.1-0  
##  [57] ellipsis_0.3.1       pkgconfig_2.0.3      loo_2.4.1            farver_2.0.3        
##  [61] dbplyr_2.0.0         utf8_1.1.4           tidyselect_1.1.0     labeling_0.4.2      
##  [65] rlang_0.4.10         reshape2_1.4.4       later_1.1.0.1        munsell_0.5.0       
##  [69] cellranger_1.1.0     tools_4.0.4          cli_2.3.1            generics_0.1.0      
##  [73] broom_0.7.5          ggridges_0.5.2       evaluate_0.14        fastmap_1.0.1       
##  [77] processx_3.4.5       knitr_1.31           fs_1.5.0             zip_2.1.1           
##  [81] nlme_3.1-152         mime_0.10            projpred_2.0.2       xml2_1.3.2          
##  [85] compiler_4.0.4       shinythemes_1.1.2    rstudioapi_0.13      curl_4.3            
##  [89] gamm4_0.2-6          reprex_0.3.0         statmod_1.4.35       stringi_1.5.3       
##  [93] highr_0.8            ps_1.6.0             Brobdingnag_1.2-6    gdtools_0.2.2       
##  [97] lattice_0.20-41      Matrix_1.3-2         nloptr_1.2.2.2       markdown_1.1        
## [101] shinyjs_2.0.0        vctrs_0.3.6          pillar_1.5.1         lifecycle_1.0.0     
## [105] bridgesampling_1.0-0 estimability_1.3     data.table_1.14.0    flextable_0.6.4     
## [109] httpuv_1.5.4         R6_2.5.0             bookdown_0.21        promises_1.1.1      
## [113] gridExtra_2.3        codetools_0.2-18     boot_1.3-26          colourpicker_1.1.0  
## [117] MASS_7.3-53          gtools_3.8.2         assertthat_0.2.1     withr_2.4.1         
## [121] shinystan_2.5.0      multcomp_1.4-16      mgcv_1.8-33          hms_0.5.3           
## [125] grid_4.0.4           coda_0.19-4          minqa_1.2.4          rmarkdown_2.7       
## [129] shiny_1.5.0          lubridate_1.7.9.2    base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="doing-data-analysis-with-the-multilevel-model-for-change.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modeling-discontinuous-and-nonlinear-change.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
