<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Describing Continuous-Time Event Occurrence Data | Applied longitudinal data analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Describing Continuous-Time Event Occurrence Data | Applied longitudinal data analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="github-repo" content="ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Describing Continuous-Time Event Occurrence Data | Applied longitudinal data analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2021-04-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="extending-the-discrete-time-hazard-model.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li><a href="index.html#r-setup"><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html"><i class="fa fa-check"></i><b>1</b> A Framework for Investigating Change over Time</a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#when-might-you-study-change-over-time"><i class="fa fa-check"></i><b>1.1</b> When might you study change over time?</a></li>
<li class="chapter" data-level="1.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#distinguishing-between-two-types-of-questions-about-change"><i class="fa fa-check"></i><b>1.2</b> Distinguishing between two types of questions about change</a></li>
<li class="chapter" data-level="1.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#three-important-features-of-a-study-of-change"><i class="fa fa-check"></i><b>1.3</b> Three important features of a study of change</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#multiple-waves-of-data."><i class="fa fa-check"></i><b>1.3.1</b> Multiple waves of data.</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-sensible-metric-for-time."><i class="fa fa-check"></i><b>1.3.2</b> A sensible metric for time.</a></li>
<li class="chapter" data-level="1.3.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-continuous-outcome-that-changes-systematically-over-time."><i class="fa fa-check"></i><b>1.3.3</b> A continuous outcome that changes systematically over time.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html"><i class="fa fa-check"></i><b>2</b> Exploring Longitudinal Data on Change</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#creating-a-longitudinal-data-set"><i class="fa fa-check"></i><b>2.1</b> Creating a longitudinal data set</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-level-data-set."><i class="fa fa-check"></i><b>2.1.1</b> The person-level data set.</a></li>
<li class="chapter" data-level="2.1.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-period-data-set."><i class="fa fa-check"></i><b>2.1.2</b> The person-period data set.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#descriptive-analysis-of-individual-change-over-time"><i class="fa fa-check"></i><b>2.2</b> Descriptive analysis of individual change over time</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#empirical-growth-plots."><i class="fa fa-check"></i><b>2.2.1</b> Empirical growth plots.</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-a-trajectory-to-summarize-each-persons-empirical-growth-record."><i class="fa fa-check"></i><b>2.2.2</b> Using a trajectory to summarize each person’s empirical growth record.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-differences-in-change-across-people"><i class="fa fa-check"></i><b>2.3</b> Exploring differences in change across people</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#examining-the-entire-set-of-smooth-trajectories."><i class="fa fa-check"></i><b>2.3.1</b> Examining the entire set of smooth trajectories.</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-the-results-of-model-fitting-to-frame-questions-about-change."><i class="fa fa-check"></i><b>2.3.2</b> Using the results of model fitting to frame questions about change.</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-the-relationship-between-change-and-time-invariant-predictors."><i class="fa fa-check"></i><b>2.3.3</b> Exploring the relationship between change and time-invariant predictors.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#improving-the-precision-and-reliability-of-ols-single-level-bayesian-estimated-rates-of-change-lessons-for-research-design"><i class="fa fa-check"></i><b>2.4</b> Improving the precision and reliability of <del>OLS</del> single-level-Bayesian-estimated rates of change: Lessons for research design</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>3</b> Introducing the Multilevel Model for Change</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#what-is-the-purpose-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>3.1</b> What is the purpose of the multilevel model for change?</a></li>
<li class="chapter" data-level="3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-1-submodel-for-individual-change"><i class="fa fa-check"></i><b>3.2</b> The level-1 submodel for individual change</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-structural-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.1</b> The structural part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-stochastic-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.2</b> The stochastic part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#relating-the-level-1-submodel-to-the-ols-exploratory-methods-of-chapter-2."><i class="fa fa-check"></i><b>3.2.3</b> Relating the level-1 submodel to the OLS exploratory methods of chapter 2.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-2-submodel-for-systematic-interindividual-differences-in-change"><i class="fa fa-check"></i><b>3.3</b> The level-2 submodel for systematic interindividual differences in change</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#structural-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.1</b> Structural components of the level-2 submodel.</a></li>
<li class="chapter" data-level="3.3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#stochastic-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.2</b> Stochastic components of the level-2 submodel.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#fitting-the-multilevel-model-for-change-to-data"><i class="fa fa-check"></i><b>3.4</b> Fitting the multilevel model for change to data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-advantages-of-maximum-likelihood-bayesian-estimation."><i class="fa fa-check"></i><b>3.4.1</b> The advantages of <del>maximum likelihood</del> Bayesian estimation.</a></li>
<li class="chapter" data-level="3.4.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#using-maximum-likelihood-modern-bayesian-methods-to-fit-a-multilevel-model."><i class="fa fa-check"></i><b>3.4.2</b> Using <del>maximum likelihood</del> modern Bayesian methods to fit a multilevel model.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-fixed-effects"><i class="fa fa-check"></i><b>3.5</b> Examining estimated fixed effects</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-estimated-fixed-effects."><i class="fa fa-check"></i><b>3.5.1</b> Interpreting estimated fixed effects.</a></li>
<li class="chapter" data-level="3.5.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-fixed-effects."><i class="fa fa-check"></i><b>3.5.2</b> Single parameter tests for the fixed effects.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-variance-components"><i class="fa fa-check"></i><b>3.6</b> Examining estimated variance components</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-the-estimated-variance-components."><i class="fa fa-check"></i><b>3.6.1</b> Interpreting the estimated variance components.</a></li>
<li class="chapter" data-level="3.6.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-variance-components."><i class="fa fa-check"></i><b>3.6.2</b> Single parameter tests for the variance components.</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#bonus-how-did-you-simulate-that-data"><i class="fa fa-check"></i><b>3.7</b> Bonus: How did you simulate that data?</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>4</b> Doing Data Analysis with the Multilevel Model for Change</a>
<ul>
<li class="chapter" data-level="4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#example-changes-in-adolescent-alcohol-use"><i class="fa fa-check"></i><b>4.1</b> Example: Changes in adolescent alcohol use</a></li>
<li class="chapter" data-level="4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-composite-specification-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>4.2</b> The composite specification of the multilevel model for change</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-structural-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.1</b> The structural component of the composite model.</a></li>
<li class="chapter" data-level="4.2.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-stochastic-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.2</b> The stochastic component of the composite model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#methods-of-estimation-revisited"><i class="fa fa-check"></i><b>4.3</b> Methods of estimation, revisited</a></li>
<li class="chapter" data-level="4.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#first-steps-fitting-two-unconditional-multilevel-models-for-change"><i class="fa fa-check"></i><b>4.4</b> First steps: Fitting two unconditional multilevel models for change</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-means-model."><i class="fa fa-check"></i><b>4.4.1</b> The unconditional means model.</a></li>
<li class="chapter" data-level="4.4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-growth-model."><i class="fa fa-check"></i><b>4.4.2</b> The unconditional growth model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#quantifying-the-proportion-of-outcome-variation-explained."><i class="fa fa-check"></i><b>4.4.3</b> Quantifying the proportion of outcome variation “explained.”</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#practical-data-analytic-strategies-for-model-building"><i class="fa fa-check"></i><b>4.5</b> Practical data analytic strategies for model building</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#a-taxonomy-of-statistical-models."><i class="fa fa-check"></i><b>4.5.1</b> A taxonomy of statistical models.</a></li>
<li class="chapter" data-level="4.5.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#interpreting-fitted-models."><i class="fa fa-check"></i><b>4.5.2</b> Interpreting fitted models.</a></li>
<li class="chapter" data-level="4.5.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#displaying-prototypical-change-trajectories."><i class="fa fa-check"></i><b>4.5.3</b> Displaying prototypical change trajectories.</a></li>
<li class="chapter" data-level="4.5.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#recentering-predictors-to-improve-interpretation."><i class="fa fa-check"></i><b>4.5.4</b> Recentering predictors to improve interpretation.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#comparing-models-using-deviance-statistics"><i class="fa fa-check"></i><b>4.6</b> Comparing models using deviance statistics</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-deviance-statistic."><i class="fa fa-check"></i><b>4.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="4.6.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#when-and-how-can-you-compare-deviance-statistics"><i class="fa fa-check"></i><b>4.6.2</b> When and how can you compare deviance statistics?</a></li>
<li class="chapter" data-level="4.6.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#implementing-deviance-based-hypothesis-tests."><i class="fa fa-check"></i><b>4.6.3</b> Implementing deviance-based hypothesis tests.</a></li>
<li class="chapter" data-level="4.6.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#aic-and-bic-waic-and-loo-statistics-comparing-nonnested-models-using-information-criteria-and-cross-validation."><i class="fa fa-check"></i><b>4.6.4</b> <del>AIC and BIC</del> WAIC and LOO statistics: Comparing nonnested models using information criteria [and cross validation].</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#using-wald-statistics-to-test-composite-hypotheses-about-fixed-effects"><i class="fa fa-check"></i><b>4.7</b> Using Wald statistics to test composite hypotheses about fixed effects</a></li>
<li class="chapter" data-level="4.8" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#evaluating-the-tenability-of-a-models-assumptions"><i class="fa fa-check"></i><b>4.8</b> Evaluating the tenability of a model’s assumptions</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-functional-form."><i class="fa fa-check"></i><b>4.8.1</b> Checking functional form.</a></li>
<li class="chapter" data-level="4.8.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-normality."><i class="fa fa-check"></i><b>4.8.2</b> Checking normality.</a></li>
<li class="chapter" data-level="4.8.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-homoscedasticity."><i class="fa fa-check"></i><b>4.8.3</b> Checking homoscedasticity.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#model-based-empirical-bayes-estimates-of-the-individual-growth-parameters"><i class="fa fa-check"></i><b>4.9</b> Model-based (Empirical Bayes) estimates of the individual growth parameters</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html"><i class="fa fa-check"></i><b>5</b> Treating Time More Flexibly</a>
<ul>
<li class="chapter" data-level="5.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#variably-spaced-measurement-occasions"><i class="fa fa-check"></i><b>5.1</b> Variably spaced measurement occasions</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#the-structure-of-variably-spaced-data-sets."><i class="fa fa-check"></i><b>5.1.1</b> The structure of variably spaced data sets.</a></li>
<li class="chapter" data-level="5.1.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#postulating-and-fitting-multilevel-models-with-variably-spaced-waves-of-data."><i class="fa fa-check"></i><b>5.1.2</b> Postulating and fitting multilevel models with variably spaced waves of data.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#varying-numbers-of-measurement-occasions"><i class="fa fa-check"></i><b>5.2</b> Varying numbers of measurement occasions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#analyzing-data-sets-in-which-the-number-of-waves-per-person-varies."><i class="fa fa-check"></i><b>5.2.1</b> Analyzing data sets in which the number of waves per person varies.</a></li>
<li class="chapter" data-level="5.2.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#practical-problems-that-may-arise-when-analyzing-unbalanced-data-sets."><i class="fa fa-check"></i><b>5.2.2</b> Practical problems that may arise when analyzing unbalanced data sets.</a></li>
<li class="chapter" data-level="5.2.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#distinguishing-among-different-types-of-missingness."><i class="fa fa-check"></i><b>5.2.3</b> Distinguishing among different types of missingness.</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#time-varying-predictors"><i class="fa fa-check"></i><b>5.3</b> Time-varying predictors</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#including-the-main-effect-of-a-time-varying-predictor."><i class="fa fa-check"></i><b>5.3.1</b> Including the main effect of a time-varying predictor.</a></li>
<li class="chapter" data-level="5.3.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#allowing-the-effect-of-a-time-varying-predictor-to-vary-over-time."><i class="fa fa-check"></i><b>5.3.2</b> Allowing the effect of a time-varying predictor to vary over time.</a></li>
<li class="chapter" data-level="5.3.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-time-varying-predictors."><i class="fa fa-check"></i><b>5.3.3</b> Recentering time-varying predictors.</a></li>
<li class="chapter" data-level="5.3.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#an-important-caveat-the-problem-of-reciprocal-causation."><i class="fa fa-check"></i><b>5.3.4</b> An important caveat: The problem of reciprocal causation.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-the-effect-of-time"><i class="fa fa-check"></i><b>5.4</b> Recentering the effect of <em>TIME</em></a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html"><i class="fa fa-check"></i><b>6</b> Modeling Discontinuous and Nonlinear Change</a>
<ul>
<li class="chapter" data-level="6.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#discontinuous-individual-change"><i class="fa fa-check"></i><b>6.1</b> Discontinuous individual change</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#alternative-discontinuous-level-1-models-for-change."><i class="fa fa-check"></i><b>6.1.1</b> Alternative discontinuous level-1 models for change.</a></li>
<li class="chapter" data-level="6.1.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#selecting-among-the-alternative-discontinuous-models."><i class="fa fa-check"></i><b>6.1.2</b> Selecting among the alternative discontinuous models.</a></li>
<li class="chapter" data-level="6.1.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#further-extensions-of-the-discontinuous-growth-model."><i class="fa fa-check"></i><b>6.1.3</b> Further extensions of the discontinuous growth model.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#using-transformations-to-model-nonlinear-individual-change"><i class="fa fa-check"></i><b>6.2</b> Using transformations to model nonlinear individual change</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#the-ladder-of-transformations-and-the-rule-of-the-bulge."><i class="fa fa-check"></i><b>6.2.1</b> The ladder of transformations and the rule of the bulge.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#representing-individual-change-using-a-polynomial-function-of-time"><i class="fa fa-check"></i><b>6.3</b> Representing individual change using a polynomial function of TIME</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#the-shapes-of-polynomial-individual-change-trajectories."><i class="fa fa-check"></i><b>6.3.1</b> The shapes of polynomial individual change trajectories.</a></li>
<li class="chapter" data-level="6.3.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#selecting-a-suitable-level-1-polynomial-trajectory-for-change."><i class="fa fa-check"></i><b>6.3.2</b> Selecting a suitable level-1 polynomial trajectory for change.</a></li>
<li class="chapter" data-level="6.3.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#testing-higher-order-terms-in-a-polynomial-level-1-model."><i class="fa fa-check"></i><b>6.3.3</b> Testing higher order terms in a polynomial level-1 model.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#truly-nonlinear-trajectories"><i class="fa fa-check"></i><b>6.4</b> Truly nonlinear trajectories</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#what-do-we-mean-by-truly-nonlinear-models"><i class="fa fa-check"></i><b>6.4.1</b> What do we mean by truly nonlinear models?</a></li>
<li class="chapter" data-level="6.4.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#the-logistic-individual-growth-curve."><i class="fa fa-check"></i><b>6.4.2</b> The logistic individual growth curve.</a></li>
<li class="chapter" data-level="6.4.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#a-survey-of-truly-nonlinear-change-trajectories."><i class="fa fa-check"></i><b>6.4.3</b> A survey of truly nonlinear change trajectories.</a></li>
<li class="chapter" data-level="6.4.4" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#from-substantive-theory-to-mathematical-representations-of-individual-growth."><i class="fa fa-check"></i><b>6.4.4</b> From substantive theory to mathematical representations of individual growth.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#bonus-the-logistic-growth-model"><i class="fa fa-check"></i><b>6.5</b> Bonus: The logistic growth model</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#we-need-data."><i class="fa fa-check"></i><b>6.5.1</b> We need data.</a></li>
<li class="chapter" data-level="6.5.2" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#have-you-heard-of-the-generalized-linear-mixed-model"><i class="fa fa-check"></i><b>6.5.2</b> Have you heard of the generalized linear [mixed] model?</a></li>
<li class="chapter" data-level="6.5.3" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#define-the-simple-logistic-multilevel-growth-model."><i class="fa fa-check"></i><b>6.5.3</b> Define the simple logistic multilevel growth model.</a></li>
<li class="chapter" data-level="6.5.4" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#ease-into-the-model-with-a-prior-predictive-check."><i class="fa fa-check"></i><b>6.5.4</b> Ease into the model with a prior predictive check.</a></li>
<li class="chapter" data-level="6.5.5" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#you-may-want-more."><i class="fa fa-check"></i><b>6.5.5</b> You may want more.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html"><i class="fa fa-check"></i><b>7</b> Examining the Multilevel Model’s Error Covariance Structure</a>
<ul>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html"><i class="fa fa-check"></i><b>8</b> Modeling Change Using Covariance Structure Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html"><i class="fa fa-check"></i><b>9</b> A Framework for Investigating Event Occurrence</a>
<ul>
<li class="chapter" data-level="9.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#should-you-conduct-a-survival-analysis-the-whether-and-when-test"><i class="fa fa-check"></i><b>9.1</b> Should you conduct a survival analysis? The “whether” and “when” test</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#time-to-relapse-among-recently-treated-alcoholics."><i class="fa fa-check"></i><b>9.1.1</b> Time to relapse among recently treated alcoholics.</a></li>
<li class="chapter" data-level="9.1.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#length-of-stay-in-teaching."><i class="fa fa-check"></i><b>9.1.2</b> Length of stay in teaching.</a></li>
<li class="chapter" data-level="9.1.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#age-at-first-suicide-ideation."><i class="fa fa-check"></i><b>9.1.3</b> Age at first suicide ideation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#framing-a-research-question-about-event-occurrence"><i class="fa fa-check"></i><b>9.2</b> Framing a research question about event occurrence</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#defining-event-occurrence."><i class="fa fa-check"></i><b>9.2.1</b> Defining event occurrence.</a></li>
<li class="chapter" data-level="9.2.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#identifying-the-beginning-of-time."><i class="fa fa-check"></i><b>9.2.2</b> Identifying the “beginning of time.”</a></li>
<li class="chapter" data-level="9.2.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#specifying-a-metric-for-time."><i class="fa fa-check"></i><b>9.2.3</b> Specifying a metric for time.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#censoring-how-complete-are-the-data-on-event-occurrence"><i class="fa fa-check"></i><b>9.3</b> Censoring: How complete are the data on event occurrence?</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-and-why-does-censoring-arise"><i class="fa fa-check"></i><b>9.3.1</b> How and why does censoring arise?</a></li>
<li class="chapter" data-level="9.3.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#different-types-of-censoring."><i class="fa fa-check"></i><b>9.3.2</b> Different types of censoring.</a></li>
<li class="chapter" data-level="9.3.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-does-censoring-affect-statistical-analysis"><i class="fa fa-check"></i><b>9.3.3</b> How does censoring affect statistical analysis?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html"><i class="fa fa-check"></i><b>10</b> Describing Discrete-Time Event Occurrence Data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-life-table"><i class="fa fa-check"></i><b>10.1</b> The life table</a></li>
<li class="chapter" data-level="10.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data"><i class="fa fa-check"></i><b>10.2</b> A framework for characterizing the distribution of discrete-time event occurrence data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-function."><i class="fa fa-check"></i><b>10.2.1</b> Survivor function.</a></li>
<li class="chapter" data-level="10.2.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#median-lifetime."><i class="fa fa-check"></i><b>10.2.2</b> Median lifetime.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes"><i class="fa fa-check"></i><b>10.3</b> Developing intuition about hazard functions, survivor functions, and median lifetimes</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#identifying-periods-of-high-and-low-risk-using-hazard-functions."><i class="fa fa-check"></i><b>10.3.1</b> Identifying periods of high and low risk using hazard functions.</a></li>
<li class="chapter" data-level="10.3.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard."><i class="fa fa-check"></i><b>10.3.2</b> Survivor functions as a context for evaluating the magnitude of hazard.</a></li>
<li class="chapter" data-level="10.3.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#strengths-and-limitations-of-estimated-median-lifetimes."><i class="fa fa-check"></i><b>10.3.3</b> Strengths and limitations of estimated median lifetimes.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#quantifying-the-effects-of-sampling-variation"><i class="fa fa-check"></i><b>10.4</b> Quantifying the effects of sampling variation</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-standard-error-of-the-estimated-hazard-probabilities."><i class="fa fa-check"></i><b>10.4.1</b> The standard error of the estimated hazard probabilities.</a></li>
<li class="chapter" data-level="10.4.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#standard-error-of-the-estimated-survival-probabilities."><i class="fa fa-check"></i><b>10.4.2</b> Standard error of the estimated survival probabilities.</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-simple-and-useful-strategy-for-constructing-the-life-table"><i class="fa fa-check"></i><b>10.5</b> A simple and useful strategy for constructing the life table</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-person-period-data-set.-1"><i class="fa fa-check"></i><b>10.5.1</b> The person-period data set.</a></li>
<li class="chapter" data-level="10.5.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#using-the-person-period-data-set-to-construct-the-life-table."><i class="fa fa-check"></i><b>10.5.2</b> Using the person-period data set to construct the life table.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#bonus-fit-the-discrete-time-hazard-models-with-brms"><i class="fa fa-check"></i><b>10.6</b> Bonus: Fit the discrete-time hazard models with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html"><i class="fa fa-check"></i><b>11</b> Fitting Basic Discrete-Time Hazard Models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#toward-a-statistical-model-for-discrete-time-hazard"><i class="fa fa-check"></i><b>11.1</b> Toward a statistical model for discrete-time hazard</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#plots-of-within-group-hazard-functions-and-survivor-functions."><i class="fa fa-check"></i><b>11.1.1</b> Plots of within-group hazard functions and survivor functions.</a></li>
<li class="chapter" data-level="11.1.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-kind-of-statistical-model-do-these-graphs-suggest"><i class="fa fa-check"></i><b>11.1.2</b> What kind of statistical model do these graphs suggest?</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#formal-representation-of-the-population-discrete-time-hazard-model"><i class="fa fa-check"></i><b>11.2</b> Formal representation of the population discrete-time hazard model</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-do-the-parameters-represent"><i class="fa fa-check"></i><b>11.2.1</b> What do the parameters represent?</a></li>
<li class="chapter" data-level="11.2.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#an-alternative-representation-of-the-model."><i class="fa fa-check"></i><b>11.2.2</b> An alternative representation of the model.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-a-discrete-time-hazard-model-to-data"><i class="fa fa-check"></i><b>11.3</b> Fitting a discrete-time hazard model to data</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#adding-predictors-to-the-person-period-data-set."><i class="fa fa-check"></i><b>11.3.1</b> Adding predictors to the person-period data set.</a></li>
<li class="chapter" data-level="11.3.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model."><i class="fa fa-check"></i><b>11.3.2</b> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model.</a></li>
<li class="chapter" data-level="11.3.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-the-discrete-time-hazard-model-to-data."><i class="fa fa-check"></i><b>11.3.3</b> Fitting the discrete-time hazard model to data.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#interpreting-parameter-estimates"><i class="fa fa-check"></i><b>11.4</b> Interpreting parameter estimates</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-time-indicators."><i class="fa fa-check"></i><b>11.4.1</b> The time indicators.</a></li>
<li class="chapter" data-level="11.4.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#dichotomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.2</b> Dichotomous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#continuous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.3</b> Continuous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#polytomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.4</b> Polytomous substantive predictors.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#displaying-fitted-hazard-and-survivor-functions"><i class="fa fa-check"></i><b>11.5</b> Displaying fitted hazard and survivor functions</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#a-strategy-for-a-single-categorical-substantive-predictor."><i class="fa fa-check"></i><b>11.5.1</b> A strategy for a single categorical substantive predictor.</a></li>
<li class="chapter" data-level="11.5.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous."><i class="fa fa-check"></i><b>11.5.2</b> Extending this strategy to multiple predictors (some of which are continuous).</a></li>
<li class="chapter" data-level="11.5.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#two-cautions-when-interpreting-fitted-hazard-and-survivor-functions."><i class="fa fa-check"></i><b>11.5.3</b> Two cautions when interpreting fitted hazard and survivor functions.</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-models-using-deviance-statistics-and-information-criteria"><i class="fa fa-check"></i><b>11.6</b> Comparing models using <del>deviance statistics and</del> information criteria</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-deviance-statistic.-1"><i class="fa fa-check"></i><b>11.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="11.6.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-individual-predictors."><i class="fa fa-check"></i><b>11.6.2</b> Deviance-based hypothesis tests for individual predictors.</a></li>
<li class="chapter" data-level="11.6.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-groups-of-predictors."><i class="fa fa-check"></i><b>11.6.3</b> Deviance-based hypothesis tests for groups of predictors.</a></li>
<li class="chapter" data-level="11.6.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-nonnested-models-using-waic-and-loo."><i class="fa fa-check"></i><b>11.6.4</b> Comparing nonnested models using [WAIC and LOO].</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#statistical-inference-using-uncertainty-in-the-bayesian-posterior"><i class="fa fa-check"></i><b>11.7</b> Statistical inference using [uncertainty in the Bayesian posterior]</a>
<ul>
<li class="chapter" data-level="11.7.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-wald-chi-square-statistic."><i class="fa fa-check"></i><b>11.7.1</b> The <del>Wald chi-square statistic</del>.</a></li>
<li class="chapter" data-level="11.7.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#asymmetric-credible-intervals-for-parameters-and-odds-ratios."><i class="fa fa-check"></i><b>11.7.2</b> [Asymmetric credible intervals] for parameters and odds ratios.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#footnote-1"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html"><i class="fa fa-check"></i><b>12</b> Extending the Discrete-Time Hazard Model</a>
<ul>
<li class="chapter" data-level="12.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#alternative-specification-for-the-main-effect-of-time"><i class="fa fa-check"></i><b>12.1</b> Alternative specification for the “main effect” of <em>TIME</em></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#an-ordered-series-of-polynomial-specifications-for-time."><i class="fa fa-check"></i><b>12.1.1</b> An ordered series of polynomial specifications for <em>TIME</em>.</a></li>
<li class="chapter" data-level="12.1.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#criteria-for-comparing-alternative-specification."><i class="fa fa-check"></i><b>12.1.2</b> Criteria for comparing alternative specification.</a></li>
<li class="chapter" data-level="12.1.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-parameters-from-linear-quadratic-and-cubic-specifications."><i class="fa fa-check"></i><b>12.1.3</b> Interpreting parameters from linear, quadratic, and cubic specifications.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model"><i class="fa fa-check"></i><b>12.2</b> Using the complementary log-log link to specify a discrete-time hazard model</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-clog-log-transformation-when-and-why-it-is-useful."><i class="fa fa-check"></i><b>12.2.1</b> The clog-log transformation: When and why it is useful.</a></li>
<li class="chapter" data-level="12.2.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#a-discrete-time-hazard-model-using-the-complementary-log-log-link."><i class="fa fa-check"></i><b>12.2.2</b> A discrete-time hazard model using the complementary log-log link.</a></li>
<li class="chapter" data-level="12.2.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#choosing-between-logit-and-clog-log-links-for-discrete-time-hazard-models."><i class="fa fa-check"></i><b>12.2.3</b> Choosing between logit and clog-log links for discrete-time hazard models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#time-varying-predictors-1"><i class="fa fa-check"></i><b>12.3</b> Time-varying predictors</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#assumptions-underlying-a-model-with-time-varying-predictors."><i class="fa fa-check"></i><b>12.3.1</b> Assumptions underlying a model with time-varying predictors.</a></li>
<li class="chapter" data-level="12.3.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-and-displaying-time-varying-predictors-effects."><i class="fa fa-check"></i><b>12.3.2</b> Interpreting and displaying time-varying predictors’ effects.</a></li>
<li class="chapter" data-level="12.3.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#two-caveats-the-problems-of-state-and-rate-dependence."><i class="fa fa-check"></i><b>12.3.3</b> Two caveats: The problems of state and rate dependence.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-linear-additivity-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.4</b> The linear additivity assumption: Uncovering violations and simple solutions</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interactions-between-substantive-predictors."><i class="fa fa-check"></i><b>12.4.1</b> Interactions between substantive predictors.</a></li>
<li class="chapter" data-level="12.4.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#nonlinear-effects."><i class="fa fa-check"></i><b>12.4.2</b> Nonlinear effects.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-proportionality-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.5</b> The proportionality assumption: Uncovering violations and simple solutions</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#discrete-time-hazard-models-that-do-not-invoke-a-proportionality-assumption."><i class="fa fa-check"></i><b>12.5.1</b> Discrete-time hazard models that do not invoke a proportionality assumption.</a></li>
<li class="chapter" data-level="12.5.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#investigating-the-proportionality-assumption-in-practice."><i class="fa fa-check"></i><b>12.5.2</b> Investigating the proportionality assumption in practice.</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-no-unobserved-heterogeneity-assumption-no-simple-solution"><i class="fa fa-check"></i><b>12.6</b> The no unobserved heterogeneity assumption: No simple solution</a></li>
<li class="chapter" data-level="12.7" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#residual-analysis"><i class="fa fa-check"></i><b>12.7</b> Residual analysis</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#footnote-2"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html"><i class="fa fa-check"></i><b>13</b> Describing Continuous-Time Event Occurrence Data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#a-framework-for-characterizing-the-distribution-of-continuous-time-event-data"><i class="fa fa-check"></i><b>13.1</b> A framework for characterizing the distribution of continuous-time event data</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#salient-features-of-continuous-time-event-occurrence-data."><i class="fa fa-check"></i><b>13.1.1</b> Salient features of continuous-time event occurrence data.</a></li>
<li class="chapter" data-level="13.1.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-survivor-function."><i class="fa fa-check"></i><b>13.1.2</b> The survivor function.</a></li>
<li class="chapter" data-level="13.1.3" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-hazard-function."><i class="fa fa-check"></i><b>13.1.3</b> The hazard function.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#grouped-methods-for-estimating-continuous-time-survivor-and-hazard-functions"><i class="fa fa-check"></i><b>13.2</b> Grouped methods for estimating continuous-time survivor and hazard functions</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#constructing-a-grouped-life-table."><i class="fa fa-check"></i><b>13.2.1</b> Constructing a grouped life table.</a></li>
<li class="chapter" data-level="13.2.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-discrete-time-method."><i class="fa fa-check"></i><b>13.2.2</b> The discrete-time method.</a></li>
<li class="chapter" data-level="13.2.3" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-actuarial-method."><i class="fa fa-check"></i><b>13.2.3</b> The actuarial method.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-kaplan-meier-method-of-estimating-the-continuous-time-survivor-function"><i class="fa fa-check"></i><b>13.3</b> The Kaplan-Meier method of estimating the continuous-time survivor function</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#fitting-a-bayesian-kaplan-meier-model"><i class="fa fa-check"></i><b>13.3.1</b> Fitting a Bayesian Kaplan-Meier model</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#the-cumulative-hazard-function"><i class="fa fa-check"></i><b>13.4</b> The cumulative hazard function</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#understanding-the-meaning-of-cumulative-hazard."><i class="fa fa-check"></i><b>13.4.1</b> Understanding the meaning of cumulative hazard.</a></li>
<li class="chapter" data-level="13.4.2" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#estimating-the-cumulative-hazard-function."><i class="fa fa-check"></i><b>13.4.2</b> Estimating the cumulative hazard function.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#kernel-smoothed-estimates-of-the-hazard-function"><i class="fa fa-check"></i><b>13.5</b> Kernel-smoothed estimates of the hazard function</a></li>
<li class="chapter" data-level="13.6" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#developing-an-intuition-about-continuous-time-survivor-cumulative-hazard-and-kernel-smoothed-hazard-functions"><i class="fa fa-check"></i><b>13.6</b> Developing an intuition about continuous-time survivor, cumulative hazard, and kernel-smoothed hazard functions</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#bonus-bayesians-can-compare-continuous-time-survivor-cumulative-hazard-and-kernel-smoothed-hazard-functions-too."><i class="fa fa-check"></i><b>13.6.1</b> Bonus: Bayesians can compare continuous-time survivor, cumulative hazard, and kernel-smoothed hazard functions, too.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="describing-continuous-time-event-occurrence-data.html"><a href="describing-continuous-time-event-occurrence-data.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Applied longitudinal data analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="describing-continuous-time-event-occurrence-data" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Describing Continuous-Time Event Occurrence Data</h1>
<blockquote>
<p>In this chapter, we present strategies for describing continuous-time event data. Although survivor and hazard functions continue to form the cornerstone of our work, the challenge in the time scale from discrete to continuous demands that we revise our fundamental definitions and modify estimation strategies….</p>
<p>In the [second half of the chapter], we offer solutions to the core conundrum embedded in contentious-time event data: our inability to estimate the hazard function well. This is a concern as it leads some researchers to conclude that they should not even <em>try</em> to ascertain the pattern of risk over time. <span class="citation">(<a href="references.html#ref-singerAppliedLongitudinalData2003" role="doc-biblioref">Singer &amp; Willett, 2003</a>, pp, 468–469, <em>emphasis</em> in the original)</span></p>
</blockquote>
<div id="a-framework-for-characterizing-the-distribution-of-continuous-time-event-data" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> A framework for characterizing the distribution of continuous-time event data</h2>
<blockquote>
<p>Variables measured with greater precision contain more information than those measured with less precision… Finer distinctions, as long as they can be made reliably, lead to more subtle interpretations and more powerful analyses.</p>
<p>Unfortunately, a switch from discrete- to continuous-time survival analysis is not as trivial as you might hope. In discrete time, the definition of the hazard function is intuitive, its values are easily estimated, and simple graphic displays can illuminate its behavior. In continuous time, although the survivor function is easily defined and estimated, the hazard function is not. As explained below, we must revise its definition and develop new methods for its estimation and exploration. (p. 469)</p>
</blockquote>
<div id="salient-features-of-continuous-time-event-occurrence-data." class="section level3" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Salient features of continuous-time event occurrence data.</h3>
<blockquote>
<p>Because continuous time is infinitely divisible, the distribution of event times displays two highly salient properties:</p>
<ul>
<li><em>The probability of observing</em> any particular event time <em>is infinitesimally small</em>. In continuous time, the probability that an event will occur <em>at any specific instant</em> approaches 0. The probability may nor reach 0, but as time’s divisions become finer and finer, it becomes smaller and smaller.</li>
<li><em>The probability that two or more individuals will share the same event time is also infinitesimally small</em>. If the probability of event occurrence at each instant is infinitesimally small, the probability of <em>co</em>occurrence (a tie) must be smaller still. (p. 470, <em>emphasis</em> in the original)</li>
</ul>
</blockquote>
<p>Load the horn honking data from Diekmann, Jungbauer-Gans, Krassing, and Lorenz <span class="citation">(<a href="references.html#ref-diekmann1996social" role="doc-biblioref">1996</a>)</span>.</p>
<div class="sourceCode" id="cb1380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1380-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1380-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1380-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-3" aria-hidden="true" tabindex="-1"></a>honking <span class="ot">&lt;-</span> </span>
<span id="cb1380-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">&quot;data/honking.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1380-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make all names lower case</span></span>
<span id="cb1380-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>(str_to_lower) <span class="sc">%&gt;%</span> </span>
<span id="cb1380-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">censor_1 =</span> <span class="fu">abs</span>(censor <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb1380-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1380-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1380-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(honking)</span></code></pre></div>
<pre><code>## Rows: 57
## Columns: 4
## $ id       &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23…
## $ seconds  &lt;dbl&gt; 2.88, 4.63, 2.36, 2.68, 2.50, 4.30, 1.86, 4.01, 1.41, 9.59, 4.44, 3.14, 2.83, 12.…
## $ censor   &lt;dbl&gt; 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, …
## $ censor_1 &lt;dbl&gt; 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, …</code></pre>
<p>Here’s a quick way to arrange the <code>seconds</code> values and <code>censor</code> status of each case in a similar way to how they appear in Table 13.1.</p>
<div class="sourceCode" id="cb1382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1382-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1382-1" aria-hidden="true" tabindex="-1"></a>honking <span class="sc">%&gt;%</span> </span>
<span id="cb1382-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1382-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(seconds) <span class="sc">%&gt;%</span> </span>
<span id="cb1382-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1382-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">seconds =</span> <span class="fu">ifelse</span>(censor <span class="sc">==</span> <span class="dv">0</span>, seconds, <span class="fu">str_c</span>(seconds, <span class="st">&quot;*&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 57 x 1
##    seconds
##    &lt;chr&gt;  
##  1 1.41   
##  2 1.41*  
##  3 1.51   
##  4 1.67   
##  5 1.68   
##  6 1.86   
##  7 2.12   
##  8 2.19   
##  9 2.36*  
## 10 2.48   
## # … with 47 more rows</code></pre>
<p>For kicks, here’s a tile-plot version of Table 13.1.</p>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1384-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-1" aria-hidden="true" tabindex="-1"></a>honking <span class="sc">%&gt;%</span> </span>
<span id="cb1384-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(seconds) <span class="sc">%&gt;%</span> </span>
<span id="cb1384-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `formatC()` allows us to retain the trailing zeros when converting the numbers to text</span></span>
<span id="cb1384-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">formatC</span>(seconds, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">&quot;f&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1384-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">ifelse</span>(censor <span class="sc">==</span> <span class="dv">0</span>, text, <span class="fu">str_c</span>(text, <span class="st">&quot;*&quot;</span>)),</span>
<span id="cb1384-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">row  =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">times =</span> <span class="dv">9</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb1384-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">col  =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">6</span>, <span class="at">times =</span> <span class="dv">9</span>), <span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1384-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1384-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> col, <span class="at">y =</span> row)) <span class="sc">+</span></span>
<span id="cb1384-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> seconds)) <span class="sc">+</span></span>
<span id="cb1384-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> time, <span class="at">color =</span> seconds <span class="sc">&lt;</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb1384-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;B&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1384-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1384-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>() <span class="sc">+</span></span>
<span id="cb1384-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Table 13.1: Known and censored (*) event times for 57 motorists blocked by another</span><span class="sc">\n</span><span class="st">automobile (reaction times are recorded to the nearest hundredth of a second)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1384-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb1384-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1384-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="the-survivor-function." class="section level3" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> The survivor function.</h3>
<p>“In continuous time, the survival probability for individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(t_j\)</span> is the probability that his or her event time, <span class="math inline">\(T_i\)</span> will exceed <span class="math inline">\(t_j\)</span>” (p. 472). This follows the equation</p>
<p><span class="math display">\[S(t_{ij}) = \operatorname{Pr} [T_i &gt; t_j].\]</span></p>
<p>Heads up: When Singer and Willett “do not distinguish individuals on the basis of predictors, [they] remove the subscript <span class="math inline">\(i\)</span>, letting <span class="math inline">\(S(t_j)\)</span> represent the survivor function for a randomly selected member of the population” (p. 472).</p>
</div>
<div id="the-hazard-function." class="section level3" number="13.1.3">
<h3><span class="header-section-number">13.1.3</span> The hazard function.</h3>
<blockquote>
<p>The hazard function assesses the <em>risk</em>–at a particular moment–that an individual who has not yet done so will experience the target event. In discrete time, the moments are time periods, which allows us to express hazard as a conditional probability. In continuous time, the moments are the infinite numbers of infinitesimally small instants of time that exist within any finite time period, a change that requires us to alter our definition. (pp. 472–473, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Singer and Willett the went on to demonstrate the notion of “infinitesimally small instants of time” by dividing a year into days, hours, minutes, and seconds. Here’s how we might use <strong>R</strong> to practice dividing up a year into smaller and smaller units.</p>
<div class="sourceCode" id="cb1385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1385-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1385-1" aria-hidden="true" tabindex="-1"></a>year    <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1385-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1385-2" aria-hidden="true" tabindex="-1"></a>days    <span class="ot">&lt;-</span> <span class="dv">365</span></span>
<span id="cb1385-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1385-3" aria-hidden="true" tabindex="-1"></a>hours   <span class="ot">&lt;-</span> <span class="dv">24</span></span>
<span id="cb1385-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1385-4" aria-hidden="true" tabindex="-1"></a>minutes <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb1385-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1385-5" aria-hidden="true" tabindex="-1"></a>seconds <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb1385-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1385-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1385-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1385-7" aria-hidden="true" tabindex="-1"></a>year <span class="sc">*</span> days</span></code></pre></div>
<pre><code>## [1] 365</code></pre>
<div class="sourceCode" id="cb1387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1387-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1387-1" aria-hidden="true" tabindex="-1"></a>year <span class="sc">*</span> days <span class="sc">*</span> hours</span></code></pre></div>
<pre><code>## [1] 8760</code></pre>
<div class="sourceCode" id="cb1389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1389-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1389-1" aria-hidden="true" tabindex="-1"></a>year <span class="sc">*</span> days <span class="sc">*</span> hours <span class="sc">*</span> minutes</span></code></pre></div>
<pre><code>## [1] 525600</code></pre>
<div class="sourceCode" id="cb1391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1391-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1391-1" aria-hidden="true" tabindex="-1"></a>year <span class="sc">*</span> days <span class="sc">*</span> hours <span class="sc">*</span> minutes <span class="sc">*</span> seconds</span></code></pre></div>
<pre><code>## [1] 31536000</code></pre>
<p>Building, we define the continuous-time hazard function as</p>
<p><span class="math display">\[h(t_{ij}) = \text{limit as } \Delta t \rightarrow 0 \left \{ \frac{\text{Pr}[T_i \text{ is in the interval } (t_j, t_j + \Delta t) | T_i \geq t_j]}{\Delta t} \right \},\]</span></p>
<p>where <span class="math inline">\([t_j, t_j + \Delta t)\)</span> is the <span class="math inline">\(j\)</span>th time interval and “the opening phrase ‘<span class="math inline">\(\text{limit as } \Delta t \rightarrow 0\)</span>’ indicates that we evaluate the conditional probability in brackets as the interval width modes closer and closer to 0” (p. 474).</p>
<blockquote>
<p>Because the definitions of hazard differ in continuous and discrete time, their interpretations differ as well. Most important, <em>continuous-time hazard is not a probability</em>. Instead, it is a <em>rate</em>, assessing the conditional probability of event occurrence <em>per unit of time</em>. No matter how tempted you might be to use the nomenclature of probability to describe rates in continuous time, please resist the urge. Rates and probabilities are not the same, and so the interpretive language is not interchangeable. (p. 474, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Closing out this section, we read:</p>
<blockquote>
<p>An important difference between continuous-time hazard rates and discrete-time hazard probabilities is that rates are not bounded from above. Although neither can be negative, rates can easily exceed 1.0…. The possibility that continuous-time hazard rate can exceed 1 has serious consequences because it requires that we revise the statistical models that incorporate the effects of predictors. We cannot posit a model in terms of <em>logit</em> hazard (as in discrete time) because that transformation is defined only for values of hazard between 0 and 1. As a result, when we specify continuous-time hazard models in chapter 14, our specification will focus on the <em>logarithm</em> of hazard, a transformation that is defines for all values of hazard greater than 0. (p. 475, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
</div>
<div id="grouped-methods-for-estimating-continuous-time-survivor-and-hazard-functions" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Grouped methods for estimating continuous-time survivor and hazard functions</h2>
<blockquote>
<p>In principle, in continuous time, we would like to estimate a value for the survivor and hazard functions at every possible instant when an event could occur. In practice, we can do so only if we are willing to adopt constraining parametric assumptions about the distribution of event times. To support this approach, statisticians have identified dozens of different distributions–Weibull, Gompertz, gamma, and log-logistic, to name a few–that event times might follow, and in some fields—industrial product testing, for example–parametric estimation is the dominant mode of analysis <span class="citation">(see, e.g., <a href="references.html#ref-lawless1982StatisticalModels" role="doc-biblioref">Lawless, 1982</a>)</span>.</p>
<p>In many other fields, including most of the social, behavioral, and medical sciences, nonparametric methods are more popular. The fundamental advantage of nonparametric methods is that we need not make constraining assumptions about the distribution of event times. This flexibility is important because: (1) few researchers have a sound basis for preferring one distribution over another; and (2) adopting an <em>incorrect</em> assumption can lead to erroneous conclusions. With a nonparametric approach, you essentially trade the <em>possibility</em> of a minor increase in efficiency if a particular assumption holds for the guarantee of doing nearly as well for most data sets, regardless of its tenability.</p>
<p>For decades, in a kind of mathematic irony, statisticians obtained nonparametric estimates of the continuous-time survivor and hazard functions by grouping event times into a small number of intervals, constructing a life table, and applying the discrete-time strategies of chapter 10 (with some minor revisions noted below). In this section we describe two of the most popular of these grouped strategies: the <em>discrete-time</em> method (section 13.2.1) and the <em>actuarial</em> method (section 13.2.2). (pp. 475–476, <em>emphasis</em> in the original)</p>
</blockquote>
<p>As we’ll see, <strong>brms</strong> supports parametric and nonparametric continuous-time survival models. In the sections and chapters to come, we will make extensive use of the Cox model, which is nonparametric. However, if you look through the <em>Time-to-event models</em> section of Bürkner’s <span class="citation">(<a href="references.html#ref-Bürkner2021Parameterization" role="doc-biblioref">2021c</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_families.html"><em>Parameterization of response distributions in brms</em></a>, you’ll see <strong>brms</strong> supports survival models with the exponential, inverse-Gaussian, gamma, log-normal, and Weibull likelihoods.</p>
<div id="constructing-a-grouped-life-table." class="section level3" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Constructing a grouped life table.</h3>
<blockquote>
<p>Grouped estimation strategies begin with a life table that partitions continuous time into a manageable number of contiguous intervals. When choosing a partition, you should seek one that is: (1) substantively meaningful; (2) coarse enough to yield stable estimates; and (3) fine enough to reveal discernible patterns. (p. 476)</p>
</blockquote>
<p>For the first step in making the life table of Table 13.2, we’ll make variables that partition the <code>seconds</code> column of the <code>honking</code> data into lower and upper bounds.</p>
<div class="sourceCode" id="cb1393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1393-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-1" aria-hidden="true" tabindex="-1"></a>honking <span class="ot">&lt;-</span></span>
<span id="cb1393-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-2" aria-hidden="true" tabindex="-1"></a>  honking <span class="sc">%&gt;%</span> </span>
<span id="cb1393-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lb =</span> <span class="fu">case_when</span>(</span>
<span id="cb1393-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-4" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1393-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-5" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb1393-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-6" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb1393-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-7" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb1393-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-8" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb1393-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-9" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb1393-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-10" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&lt;</span> <span class="dv">8</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb1393-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-11" aria-hidden="true" tabindex="-1"></a>    seconds <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">~</span> <span class="dv">8</span></span>
<span id="cb1393-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb1393-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ub =</span> <span class="fu">if_else</span>(lb <span class="sc">==</span> <span class="dv">8</span>, <span class="dv">18</span>, lb <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1393-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_interval =</span> <span class="fu">str_c</span>(<span class="st">&quot;[&quot;</span>, lb, <span class="st">&quot;, &quot;</span>, ub, <span class="st">&quot;)&quot;</span>))</span>
<span id="cb1393-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1393-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1393-16" aria-hidden="true" tabindex="-1"></a>honking <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##      id seconds censor censor_1    lb    ub time_interval
##   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        
## 1     1    2.88      0        1     2     3 [2, 3)       
## 2     2    4.63      1        0     4     5 [4, 5)       
## 3     3    2.36      1        0     2     3 [2, 3)       
## 4     4    2.68      0        1     2     3 [2, 3)       
## 5     5    2.5       0        1     2     3 [2, 3)       
## 6     6    4.3       1        0     4     5 [4, 5)</code></pre>
<p>Now we’ll transform the data into a life-table format, which we’ll save as <code>honking_aggregated</code>.</p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1395-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-1" aria-hidden="true" tabindex="-1"></a> honking_aggregated <span class="ot">&lt;-</span></span>
<span id="cb1395-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-2" aria-hidden="true" tabindex="-1"></a>  honking <span class="sc">%&gt;%</span> </span>
<span id="cb1395-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="fu">ifelse</span>(censor <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;n_events&quot;</span>, <span class="st">&quot;n_censored&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(lb, event) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> event,</span>
<span id="cb1395-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ub =</span> <span class="fu">if_else</span>(lb <span class="sc">==</span> <span class="dv">8</span>, <span class="dv">18</span>, lb <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_interval =</span> <span class="fu">str_c</span>(<span class="st">&quot;[&quot;</span>, lb, <span class="st">&quot;, &quot;</span>, ub, <span class="st">&quot;)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_censored =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_censored), <span class="dv">0</span>, n_censored)) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> n_censored <span class="sc">+</span> n_events) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_at_risk =</span> <span class="fu">sum</span>(total) <span class="sc">-</span> <span class="fu">cumsum</span>(<span class="fu">lag</span>(total, <span class="at">default =</span> <span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lb, ub, time_interval, n_at_risk, n_events, n_censored) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">p(t)</span><span class="st">`</span> <span class="ot">=</span> n_events <span class="sc">/</span> n_at_risk)</span>
<span id="cb1395-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1395-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1395-15" aria-hidden="true" tabindex="-1"></a>honking_aggregated</span></code></pre></div>
<pre><code>## # A tibble: 8 x 7
##      lb    ub time_interval n_at_risk n_events n_censored `p(t)`
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1     1     2 [1, 2)               57        5          1 0.0877
## 2     2     3 [2, 3)               51       14          3 0.275 
## 3     3     4 [3, 4)               34        9          2 0.265 
## 4     4     5 [4, 5)               23        6          4 0.261 
## 5     5     6 [5, 6)               13        2          2 0.154 
## 6     6     7 [6, 7)                9        2          2 0.222 
## 7     7     8 [7, 8)                5        1          0 0.2   
## 8     8    18 [8, 18)               4        3          1 0.75</code></pre>
</div>
<div id="the-discrete-time-method." class="section level3" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> The discrete-time method.</h3>
<p>Here we simply apply the discrete-time hazard model to our discretized continuous-time data. Before we fit the model, we’ll define a new term, <span class="math inline">\(\hat p(t_j)\)</span>. Recall back to Section 10.2 where we defined the hazard function <span class="math inline">\(\hat h(t_{j})\)</span> as</p>
<p><span class="math display">\[\hat h(t_{j}) = \frac{n \text{ events}_j}{n \text{ at risk}_j}.\]</span></p>
<p>Now we’re working with continuous-time data (even if they’re momentarily discretized), we focus instead on <span class="math inline">\(\hat p(t_{j})\)</span>. In words, <span class="math inline">\(\hat p(t_{j})\)</span> is the conditional probability that a member of the risk set at the beginning of the interval <span class="math inline">\(j\)</span> will experience the target event during that interval. In discrete time we labeled this quantity “hazard,” but now we use the term “<em>conditional probability</em>” to distinguish it from a continuous time <em>hazard rate</em>. Our conditional probability follows the formula</p>
<p><span class="math display">\[\hat p(t_{j}) = \frac{n \text{ events}_j}{n \text{ at risk}_j},\]</span></p>
<p>where <span class="math inline">\(n \text{ events}_j\)</span> is the number of individuals who experienced the event in the <span class="math inline">\(j^{th}\)</span> period and <span class="math inline">\(n \text{ at risk}_j\)</span> is the number of those at risk at the beginning of the interval <span class="math inline">\(j\)</span>.</p>
<p>Time to fire up <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1397-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1397-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1397-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span></code></pre></div>
<p>For our first model, we will use the binomial likelihood with the aggregated version of the <code>honking</code> data, <code>honking_aggregated</code>. The main time variable in those data is <code>time_interval</code>, the lower and upper bounds for which are identified in the <code>lb</code> and <code>ub</code> columns, respectively. In anticipation of the upcoming plots, we’ll use the <code>ub</code> variable for time. But to make fitting the model easier with the <code>brm()</code> function, we’ll first save a factor version of the variable.</p>
<div class="sourceCode" id="cb1398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1398-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1398-1" aria-hidden="true" tabindex="-1"></a>honking_aggregated <span class="ot">&lt;-</span></span>
<span id="cb1398-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1398-2" aria-hidden="true" tabindex="-1"></a>  honking_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb1398-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1398-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ub_f =</span> <span class="fu">factor</span>(ub))</span></code></pre></div>
<p>In the last chapter, we used the <code>normal(0, 4)</code> prior, which was permissive in the log-odds metric. Here we’ll be more conservative and use <code>normal(0, 1.5)</code>, which is weakly-regularizing on the log-odds metric, but flat in the probability metric. A plot might help show this.</p>
<div class="sourceCode" id="cb1399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1399-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb1399-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1399-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fl">1e6</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1399-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1399-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb1399-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1399-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;prior predictive distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb1399-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1399-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1399-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Otherwise, this model is just like any of the other unconditional discrete-time models we’ve fit with <code>brm()</code>.</p>
<div class="sourceCode" id="cb1400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1400-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-1" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb1400-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> honking_aggregated,</span>
<span id="cb1400-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1400-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-4" aria-hidden="true" tabindex="-1"></a>      n_events <span class="sc">|</span> <span class="fu">trials</span>(n_at_risk) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> ub_f,</span>
<span id="cb1400-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1400-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">1</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1400-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb1400-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1400-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit13.01&quot;</span>)</span></code></pre></div>
<p>Check the parameter summary.</p>
<div class="sourceCode" id="cb1401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1401-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit13<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: n_events | trials(n_at_risk) ~ 0 + ub_f 
##    Data: honking_aggregated (Number of observations: 8) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## ub_f2     -2.22      0.43    -3.15    -1.43 1.00     6804     2874
## ub_f3     -0.95      0.31    -1.55    -0.37 1.00     7543     3101
## ub_f4     -0.98      0.37    -1.71    -0.29 1.00     6630     3183
## ub_f5     -0.98      0.46    -1.93    -0.10 1.00     7123     2773
## ub_f6     -1.46      0.66    -2.85    -0.25 1.00     6758     2695
## ub_f7     -1.06      0.72    -2.61     0.33 1.00     7165     2471
## ub_f8     -1.04      0.88    -2.84     0.61 1.00     7283     2954
## ub_f18     0.79      0.91    -0.90     2.66 1.00     7227     2779
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As will become apparent in a bit, our <code>normal(0, 1.5)</code> prior was not inconsequential. Our aggregated data were composed of the event/censoring information of 57 cases, spread across 8 time periods. This left little information in the likelihood, particularly for the later time periods. As a consequence, the prior left clear marks in the posterior.</p>
<p>As with the discrete-time model, we can formally define the survivor function for the continuous-time model as</p>
<p><span class="math display">\[\hat S(t_j) =  \big(1 - \hat p(t_1)\big) \big(1 - \hat p(t_2)\big)... \big(1 - \hat p(t_j)\big).\]</span></p>
<p>It’ll take a little wrangling effort to transform the output from <code>posterior_samples(fit13.1)</code> into a useful form for plotting and summarizing <span class="math inline">\(\hat S(t_j)\)</span>. We’ll save it as <code>s</code>.</p>
<div class="sourceCode" id="cb1403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1403-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span></span>
<span id="cb1403-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(fit13<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(inv_logit_scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">b_ub_f0 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_ub_f0, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">18</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter,</span>
<span id="cb1403-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb1403-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> time <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">survivor =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> p)) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1403-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Now we can make the first 6 columns of Table 13.2 by combining a subset of the <code>honking_aggregated</code> data with a summary of our <code>s</code>.</p>
<div class="sourceCode" id="cb1404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1404-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb1404-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select the first 5 columns for Table 13.2</span></span>
<span id="cb1404-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-3" aria-hidden="true" tabindex="-1"></a>  honking_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb1404-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(time_interval<span class="sc">:</span><span class="st">`</span><span class="at">p(t)</span><span class="st">`</span>),</span>
<span id="cb1404-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the 6th column</span></span>
<span id="cb1404-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-6" aria-hidden="true" tabindex="-1"></a>  s <span class="sc">%&gt;%</span> </span>
<span id="cb1404-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1404-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb1404-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">median =</span> <span class="fu">median</span>(survivor),</span>
<span id="cb1404-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd     =</span> <span class="fu">sd</span>(survivor)) <span class="sc">%&gt;%</span> </span>
<span id="cb1404-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1404-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">S(t)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_c</span>(median, <span class="st">&quot; (&quot;</span>, sd, <span class="st">&quot;)&quot;</span>))</span>
<span id="cb1404-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1404-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 6
##   time_interval n_at_risk n_events n_censored `p(t)` `S(t)`         
##   &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          
## 1 [1, 2)               57        5          1 0.0877 0.8999 (0.0388)
## 2 [2, 3)               51       14          3 0.275  0.6437 (0.0615)
## 3 [3, 4)               34        9          2 0.265  0.4633 (0.066) 
## 4 [4, 5)               23        6          4 0.261  0.3322 (0.0626)
## 5 [5, 6)               13        2          2 0.154  0.2617 (0.0601)
## 6 [6, 7)                9        2          2 0.222  0.1875 (0.0549)
## 7 [7, 8)                5        1          0 0.2    0.1316 (0.0503)
## 8 [8, 18)               4        3          1 0.75   0.039 (0.0299)</code></pre>
<p>You’ll note that our posterior summary values in <code>S(t)</code> differ a little from those in the text. Remember, the likelihood was weak and we used a regularizing prior. If we had more cases spread across fewer discretized time periods, the likelihood would have done a better job updating the prior.</p>
<p>Now let’s take a look at the posterior of our survivor function, <span class="math inline">\(\hat S(t_j)\)</span>, in our version of the upper left panel of Figure 13.1.</p>
<div class="sourceCode" id="cb1406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1406-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&gt;%</span> </span>
<span id="cb1406-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survivor)) <span class="sc">+</span></span>
<span id="cb1406-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb1406-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1406-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the ML-based survival estimates</span></span>
<span id="cb1406-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> honking_aggregated <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">s =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">p(t)</span><span class="st">`</span>)),</span>
<span id="cb1406-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> ub, <span class="at">y =</span> s),</span>
<span id="cb1406-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1406-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="st">&quot;CI level&quot;</span>, <span class="at">start =</span> .<span class="dv">7</span>, <span class="at">end =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1406-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;seconds after light turns green&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1406-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1406-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1406-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1406-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-14-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>For a little context, we superimposed the sample (ML) estimates of the survivor function in red. Based on the posterior median, our median lifetime appears to be between the time intervals of <span class="math inline">\([2, 3)\)</span> and <span class="math inline">\([3, 4)\)</span>. Sticking with those medians, here’s the exact number using Miller’s <span class="citation">(<a href="references.html#ref-miller1981SurvivalAnalysis" role="doc-biblioref">1981</a>)</span> interpolation approach from <a href="describing-discrete-time-event-occurrence-data.html#median-lifetime.">Section 10.2.2</a>.</p>
<div class="sourceCode" id="cb1407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1407-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-1" aria-hidden="true" tabindex="-1"></a>s_medians <span class="ot">&lt;-</span></span>
<span id="cb1407-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-2" aria-hidden="true" tabindex="-1"></a>  s <span class="sc">%&gt;%</span> </span>
<span id="cb1407-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lb =</span> time <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb1407-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ub =</span> time) <span class="sc">%&gt;%</span> </span>
<span id="cb1407-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_interval =</span> <span class="fu">str_c</span>(<span class="st">&quot;[&quot;</span>, lb, <span class="st">&quot;, &quot;</span>, ub, <span class="st">&quot;)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1407-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ub <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1407-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time_interval) <span class="sc">%&gt;%</span> </span>
<span id="cb1407-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median =</span> <span class="fu">median</span>(survivor)) <span class="sc">%&gt;%</span> </span>
<span id="cb1407-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(median)</span>
<span id="cb1407-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1407-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1407-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">+</span> (s_medians[<span class="dv">1</span>] <span class="sc">-</span> .<span class="dv">5</span>) <span class="sc">/</span> (s_medians[<span class="dv">1</span>] <span class="sc">-</span> s_medians[<span class="dv">2</span>]) <span class="sc">*</span> (<span class="dv">4</span> <span class="sc">-</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 3.796706</code></pre>
<p>Here’s how we might convert the output of <code>posterior_samples(fit13.1)</code> into a useful format for our hazard function.</p>
<div class="sourceCode" id="cb1409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1409-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span></span>
<span id="cb1409-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(fit13<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(inv_logit_scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">18</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter,</span>
<span id="cb1409-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb1409-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> time <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>())</span>
<span id="cb1409-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1409-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1409-12" aria-hidden="true" tabindex="-1"></a>h</span></code></pre></div>
<pre><code>## # A tibble: 32,000 x 3
##     iter  time      p
##    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
##  1     1     2 0.0909
##  2     1     3 0.317 
##  3     1     4 0.161 
##  4     1     5 0.289 
##  5     1     6 0.118 
##  6     1     7 0.142 
##  7     1     8 0.393 
##  8     1    18 0.329 
##  9     2     2 0.121 
## 10     2     3 0.267 
## # … with 31,990 more rows</code></pre>
<p>For continuous-time data, hazard is a rate, which is</p>
<blockquote>
<p>the limit of the conditional probability of event occurrence in a (vanishingly small) interval divided by the interval’s width. A logical estimator is thus the ratio of the conditional probability of event occurrence in an interval to the interval’s width. (p. 479)</p>
</blockquote>
<p>Thus, our new definition of hazard is</p>
<p><span class="math display">\[\hat h(t_j) = \frac{\hat p(t_j)}{\text{width}_j},\]</span></p>
<p>where <span class="math inline">\(\text{width}_j\)</span> denotes the width of the <span class="math inline">\(j\)</span>th interval. The widths of most of our intervals were 1 (seconds). The final interval, <span class="math inline">\([8, 18)\)</span>, had a width of ten. Once we add that information to the <code>h</code> data, we can use the formula above to convert <span class="math inline">\(\hat p(t_j)\)</span> to <span class="math inline">\(\hat h(t_j)\)</span>.</p>
<div class="sourceCode" id="cb1411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1411-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1411-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span></span>
<span id="cb1411-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1411-2" aria-hidden="true" tabindex="-1"></a>  h <span class="sc">%&gt;%</span> </span>
<span id="cb1411-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1411-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">width =</span> <span class="fu">if_else</span>(time <span class="sc">&lt;=</span> <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1411-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1411-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hazard =</span> p <span class="sc">/</span> width)</span></code></pre></div>
<p>Now we can make the first 7 columns of Table 13.2 by adding an cleaned-up version of our <code>h</code> object to what we had before.</p>
<div class="sourceCode" id="cb1412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1412-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb1412-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select the first 5 columns for Table 13.2</span></span>
<span id="cb1412-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-3" aria-hidden="true" tabindex="-1"></a>  honking_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb1412-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(time_interval<span class="sc">:</span><span class="st">`</span><span class="at">p(t)</span><span class="st">`</span>),</span>
<span id="cb1412-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the 6th column</span></span>
<span id="cb1412-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-6" aria-hidden="true" tabindex="-1"></a>  s <span class="sc">%&gt;%</span> </span>
<span id="cb1412-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1412-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb1412-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">median =</span> <span class="fu">median</span>(survivor),</span>
<span id="cb1412-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd     =</span> <span class="fu">sd</span>(survivor)) <span class="sc">%&gt;%</span> </span>
<span id="cb1412-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1412-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">S(t)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_c</span>(median, <span class="st">&quot; (&quot;</span>, sd, <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb1412-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the 7th column</span></span>
<span id="cb1412-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-14" aria-hidden="true" tabindex="-1"></a>  h <span class="sc">%&gt;%</span> </span>
<span id="cb1412-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb1412-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">median =</span> <span class="fu">median</span>(hazard),</span>
<span id="cb1412-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd     =</span> <span class="fu">sd</span>(hazard)) <span class="sc">%&gt;%</span> </span>
<span id="cb1412-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1412-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">h(t)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_c</span>(median, <span class="st">&quot; (&quot;</span>, sd, <span class="st">&quot;)&quot;</span>))</span>
<span id="cb1412-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1412-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 7
##   time_interval n_at_risk n_events n_censored `p(t)` `S(t)`          `h(t)`         
##   &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;          
## 1 [1, 2)               57        5          1 0.0877 0.8999 (0.0388) 0.1001 (0.0388)
## 2 [2, 3)               51       14          3 0.275  0.6437 (0.0615) 0.2797 (0.061) 
## 3 [3, 4)               34        9          2 0.265  0.4633 (0.066)  0.274 (0.0721) 
## 4 [4, 5)               23        6          4 0.261  0.3322 (0.0626) 0.2737 (0.0891)
## 5 [5, 6)               13        2          2 0.154  0.2617 (0.0601) 0.1922 (0.0991)
## 6 [6, 7)                9        2          2 0.222  0.1875 (0.0549) 0.2616 (0.1304)
## 7 [7, 8)                5        1          0 0.2    0.1316 (0.0503) 0.2706 (0.1587)
## 8 [8, 18)               4        3          1 0.75   0.039 (0.0299)  0.068 (0.0175)</code></pre>
<p>Perhaps even more so than with our estimates for the survivor function, our hazard estimates show the influence of our prior on the posterior. For example, note how our posterior standard deviations tend to be a bit smaller than the standard errors reported in the text. To my mind, plotting the marginal posteriors for the intervals of our hazard function really helps hit this home.</p>
<div class="sourceCode" id="cb1414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1414-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-1" aria-hidden="true" tabindex="-1"></a>h <span class="sc">%&gt;%</span> </span>
<span id="cb1414-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">factor</span>(time)) <span class="sc">%&gt;%</span> </span>
<span id="cb1414-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1414-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hazard, <span class="at">y =</span> time)) <span class="sc">+</span></span>
<span id="cb1414-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb1414-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>), <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb1414-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1414-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1414-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-19-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>As wide and sloppy as those distributions look, they’re more precise than the estimates returned by Maximum Likelihood (ML). To finish this section out with the lower left panel of Figure 13.1, here’s what our hazard function looks like.</p>
<div class="sourceCode" id="cb1415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1415-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-1" aria-hidden="true" tabindex="-1"></a>h <span class="sc">%&gt;%</span> </span>
<span id="cb1415-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard)) <span class="sc">+</span></span>
<span id="cb1415-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1415-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="st">&quot;CI level&quot;</span>, <span class="at">start =</span> .<span class="dv">7</span>, <span class="at">end =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1415-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;seconds after light turns green&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1415-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">h</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1415-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">35</span>)) <span class="sc">+</span></span>
<span id="cb1415-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1415-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-20-1.png" width="384" style="display: block; margin: auto;" /></p>
</div>
<div id="the-actuarial-method." class="section level3" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> The actuarial method.</h3>
<p>I’m not going to dive into a full explanation of the actuarial method. For that, read the book. However, the actuarial method presents a challenge for our <strong>brms</strong> paradigm. To appreciate the challenge, we’ll need a couple block quotes:</p>
<blockquote>
<p>For the survivor function, we ask: What does it mean to be “at risk of surviving” past the end of an interval? Because a censored individual is no longer “at risk of surviving” once censoring occurs, we redefine each interval’s risk set to account for the censoring we assume to occur equally throughout. This implies that half the censored individuals would no longer be at risk half-way through, so we redefine the number of individuals “at risk of surviving past interval <span class="math inline">\(j\)</span>” to be:</p>
<p><span class="math display">\[n&#39; \; at \; risk_j = n \; at \; risk_j - \frac{n \; censored_j}{2}.\]</span></p>
<p>The actuarial estimate of the survivor function is obtained by substituting <span class="math inline">\(n&#39; \; at \; risk_j\)</span> for <span class="math inline">\(n \; at \; risk_j\)</span> in the discrete-time formulas just presented in section 13.2.2 (equations 13.3 and 13.4). (pp. 480–481, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Further:</p>
<blockquote>
<p>To estimate the hazard function using the actuarial approach, we again redefine what it means to be “at risk.” Now, however, we ask about the “risk of event occurrence” <em>during</em> the interval, not the “risk of survival” <em>past</em> the interval. This change of definition suggests that each interval’s risk set should be diminished not just by censoring but also by event occurrence, because either eliminates the possibility of subsequent event occurrence. Because categorization continues to prevent us from knowing precisely when people leave the risk set, we assume that exits are scattered at random throughout the interval. This implies that half these individuals are no longer at risk of event occurrence halfway through, so we redefine the number of individuals “at risk of event occurrence” in interval <span class="math inline">\(j\)</span> to be:</p>
<p><span class="math display">\[n&#39;&#39; \; at \; risk_j = n \; at \; risk_j - \frac{n \; censored_j}{2} - \frac{n \; events_j}{2}.\]</span></p>
<p>The actuarial estimator of the continuous-time hazard function is then obtained by substituting <span class="math inline">\(n&#39;&#39; \; at \; risk_j\)</span> for <span class="math inline">\(n \; at \; risk_j\)</span> in discrete-time formulas of section 13.2.2 (equations 13.3 and 13.5). (pp. 481–481, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Here’s how we might implement the equations for <span class="math inline">\(n&#39; \; at \; risk_j\)</span> and <span class="math inline">\(n&#39;&#39; \; at \; risk_j\)</span> in our <code>honking_aggregated</code> data.</p>
<div class="sourceCode" id="cb1416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1416-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1416-1" aria-hidden="true" tabindex="-1"></a>honking_aggregated <span class="ot">&lt;-</span></span>
<span id="cb1416-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1416-2" aria-hidden="true" tabindex="-1"></a>  honking_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb1416-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1416-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p_at_risk_a  =</span> n_at_risk <span class="sc">-</span> (n_censored <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb1416-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1416-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_pp_at_risk_a =</span> n_at_risk <span class="sc">-</span> (n_censored <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> (n_events <span class="sc">/</span> <span class="dv">2</span>))</span>
<span id="cb1416-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1416-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1416-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1416-6" aria-hidden="true" tabindex="-1"></a>honking_aggregated</span></code></pre></div>
<pre><code>## # A tibble: 8 x 10
##      lb    ub time_interval n_at_risk n_events n_censored `p(t)` ub_f  n_p_at_risk_a n_pp_at_risk_a
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt;          &lt;dbl&gt;
## 1     1     2 [1, 2)               57        5          1 0.0877 2              56.5           54  
## 2     2     3 [2, 3)               51       14          3 0.275  3              49.5           42.5
## 3     3     4 [3, 4)               34        9          2 0.265  4              33             28.5
## 4     4     5 [4, 5)               23        6          4 0.261  5              21             18  
## 5     5     6 [5, 6)               13        2          2 0.154  6              12             11  
## 6     6     7 [6, 7)                9        2          2 0.222  7               8              7  
## 7     7     8 [7, 8)                5        1          0 0.2    8               5              4.5
## 8     8    18 [8, 18)               4        3          1 0.75   18              3.5            2</code></pre>
<p>The essence of our problem is we’ve been using the binomial likelihood to fit discrete-time hazard functions with <strong>brms</strong>. In this paradigm, we feed in data composed of the number of <em>successes</em> and the corresponding number of trials to compute probability <span class="math inline">\(p\)</span> of a <em>success</em> within a given trial. Although <span class="math inline">\(p\)</span> is a continuous value ranging from 0 to 1, the binomial likelihood takes the numbers of successes and trials to be non-negative integers. If you try to feed our actuarial <span class="math inline">\(n&#39;&#39; \; at \; risk_j\)</span> variable, <code>n_at_risk_pp</code> into the <code>formula</code> argument for <code>brms::brm()</code> (e.g., <code>n_events | trials(n_at_risk_pp) ~ 0 + ub_f</code>), <strong>brms</strong> will return the warning:</p>
<blockquote>
<p>Error: Number of trials must be positive integers.</p>
</blockquote>
<p>We can, however, follow along and compute the ML estimates by hand.</p>
<div class="sourceCode" id="cb1418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1418-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-1" aria-hidden="true" tabindex="-1"></a>honking_aggregated <span class="ot">&lt;-</span></span>
<span id="cb1418-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-2" aria-hidden="true" tabindex="-1"></a>  honking_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb1418-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">S(t)_a</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> n_events <span class="sc">/</span> n_p_at_risk_a),</span>
<span id="cb1418-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">p(t)_a</span><span class="st">`</span> <span class="ot">=</span> n_events <span class="sc">/</span> n_pp_at_risk_a,</span>
<span id="cb1418-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">width    =</span> <span class="fu">if_else</span>(lb <span class="sc">==</span> <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1418-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">h(t)_a</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">p(t)_a</span><span class="st">`</span> <span class="sc">/</span> width)</span>
<span id="cb1418-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1418-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1418-8" aria-hidden="true" tabindex="-1"></a>honking_aggregated</span></code></pre></div>
<pre><code>## # A tibble: 8 x 14
##      lb    ub time_interval n_at_risk n_events n_censored `p(t)` ub_f  n_p_at_risk_a n_pp_at_risk_a
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt;          &lt;dbl&gt;
## 1     1     2 [1, 2)               57        5          1 0.0877 2              56.5           54  
## 2     2     3 [2, 3)               51       14          3 0.275  3              49.5           42.5
## 3     3     4 [3, 4)               34        9          2 0.265  4              33             28.5
## 4     4     5 [4, 5)               23        6          4 0.261  5              21             18  
## 5     5     6 [5, 6)               13        2          2 0.154  6              12             11  
## 6     6     7 [6, 7)                9        2          2 0.222  7               8              7  
## 7     7     8 [7, 8)                5        1          0 0.2    8               5              4.5
## 8     8    18 [8, 18)               4        3          1 0.75   18              3.5            2  
## # … with 4 more variables: S(t)_a &lt;dbl&gt;, p(t)_a &lt;dbl&gt;, width &lt;dbl&gt;, h(t)_a &lt;dbl&gt;</code></pre>
<p>Before we make our version of the right-hand side of Figure 13.1, we’ll need to augment the data a little. Then <code>geom_step()</code> will do most of the magic.</p>
<div class="sourceCode" id="cb1420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1420-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1420-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add `S(t)_a` values for `lb = c(0, 18)`</span></span>
<span id="cb1420-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-3" aria-hidden="true" tabindex="-1"></a>  honking_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb1420-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lb, <span class="st">`</span><span class="at">S(t)_a</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">lb       =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">18</span>),</span>
<span id="cb1420-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">`</span><span class="at">S(t)_a</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, honking_aggregated<span class="sc">$</span><span class="st">`</span><span class="at">S(t)_a</span><span class="st">`</span>[<span class="dv">8</span>]))) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reorder</span></span>
<span id="cb1420-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lb) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1420-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1420-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lb, <span class="at">y =</span> <span class="st">`</span><span class="at">S(t)_a</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1420-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb1420-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1420-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j])))), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb1420-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1420-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1420-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add `h(t)_a` values for `lb = 18`</span></span>
<span id="cb1420-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-18" aria-hidden="true" tabindex="-1"></a>  honking_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb1420-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lb, <span class="st">`</span><span class="at">h(t)_a</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">lb       =</span> <span class="dv">18</span>, </span>
<span id="cb1420-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-21" aria-hidden="true" tabindex="-1"></a>                   <span class="st">`</span><span class="at">h(t)_a</span><span class="st">`</span> <span class="ot">=</span> honking_aggregated<span class="sc">$</span><span class="st">`</span><span class="at">h(t)_a</span><span class="st">`</span>[<span class="dv">8</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lb) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1420-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lb, <span class="at">y =</span> <span class="st">`</span><span class="at">h(t)_a</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1420-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb1420-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;seconds after light turns green&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1420-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1420-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">h</span>(t[j])))), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">35</span>))</span></code></pre></div>
<p>Combine the subplots and make our version of the right-hand side of Figure 13.1.</p>
<div class="sourceCode" id="cb1421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1421-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1421-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1421-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1421-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1421-3" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb1421-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1421-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-24-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>I’m not going to bother with computing the ML standard errors for the actuarial survivor and hazard estimates. You can reference page 482 in the text for more on those.</p>
</div>
</div>
<div id="the-kaplan-meier-method-of-estimating-the-continuous-time-survivor-function" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> The Kaplan-Meier method of estimating the continuous-time survivor function</h2>
<blockquote>
<p>A fundamental problem with grouped estimation methods is that they artificially categorize what is now, by definition, a continuous variable…. Shouldn’t it be possible to use the <em>observed</em> data–the actual event times–to describe the distribution of event occurrences? This compelling idea underlies the Kaplan-Meier method, named for the statisticians who demonstrated <span class="citation">(in <a href="references.html#ref-kaplan1958NonparametricEstimation" role="doc-biblioref">1958</a>)</span> that the intuitive approach–also known as the <em>product-limit method</em>–has maximum likelihood properties as well. Below, we explain how this approach works and why it is preferable.</p>
<p>The Kaplan-Meier method is a simple extension of the discrete-time method with a fundamental change: instead of rounding event times to construct the intervals, capitalize on the raw event times and construct intervals so that each contains just <em>one observed event time</em> (as shown in table 13.3). Each Kaplan-Meier interval begins at one observed event time and ends just before the next. (p. 483, <em>emphasis</em> in the original)</p>
</blockquote>
<p>As discussed in the prose in the middle of page 483, here are the first three event times.</p>
<div class="sourceCode" id="cb1422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1422-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1422-1" aria-hidden="true" tabindex="-1"></a>honking <span class="sc">%&gt;%</span> </span>
<span id="cb1422-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1422-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(censor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1422-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1422-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">3</span>, seconds)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##      id seconds censor censor_1    lb    ub time_interval
##   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        
## 1     9    1.41      0        1     1     2 [1, 2)       
## 2    40    1.51      0        1     1     2 [1, 2)       
## 3    50    1.67      0        1     1     2 [1, 2)</code></pre>
<blockquote>
<p>The Kaplan-Meier estimate of the survivor function is obtained by applying the discrete-time estimator of section 13.2.2 to the data of these intervals. [Most] statistical packages include a routine for computing and plotting the estimates. Numerically, the process is simple: first compute the conditional probability of event occurrence (column 7) and then successively multiply the complements of these probabilities together to obtain the Kaplan-Meier estimate of the survivor function (column 8). Because the Kaplan-Meier estimator of the survivor function is identical to the discrete-time estimator of chapter 10, its standard errors (column 9) are estimated using the same formula (pp. 483–485).</p>
</blockquote>
<p>To walk this out, we’ll first use the frequentist <strong>survival</strong> package.</p>
<div class="sourceCode" id="cb1424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1424-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code></pre></div>
<p>Use the <code>survival::survfit()</code> function to fit the unconditional model with the Kaplan-Meier estimator.</p>
<div class="sourceCode" id="cb1425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1425-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1425-1" aria-hidden="true" tabindex="-1"></a> fit13<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb1425-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1425-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survfit</span>(<span class="at">data =</span> honking,</span>
<span id="cb1425-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1425-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">Surv</span>(seconds, censor_1) <span class="sc">~</span> <span class="dv">1</span>)</span></code></pre></div>
<p>The <code>summary()</code> returns a lot of output.</p>
<div class="sourceCode" id="cb1426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1426-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit13<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(seconds, censor_1) ~ 1, data = honking)
## 
##   time n.risk n.event survival std.err lower 95% CI upper 95% CI
##   1.41     57       1   0.9825  0.0174      0.94896        1.000
##   1.51     55       1   0.9646  0.0246      0.91758        1.000
##   1.67     54       1   0.9467  0.0299      0.88985        1.000
##   1.68     53       1   0.9289  0.0343      0.86405        0.999
##   1.86     52       1   0.9110  0.0380      0.83950        0.989
##   2.12     51       1   0.8931  0.0412      0.81587        0.978
##   2.19     50       1   0.8753  0.0441      0.79296        0.966
##   2.48     48       1   0.8570  0.0468      0.77004        0.954
##   2.50     47       1   0.8388  0.0492      0.74765        0.941
##   2.53     46       1   0.8206  0.0514      0.72572        0.928
##   2.54     45       1   0.8023  0.0534      0.70418        0.914
##   2.56     44       1   0.7841  0.0552      0.68299        0.900
##   2.62     43       1   0.7659  0.0569      0.66212        0.886
##   2.68     42       1   0.7476  0.0584      0.64154        0.871
##   2.83     39       1   0.7285  0.0599      0.61996        0.856
##   2.88     38       1   0.7093  0.0614      0.59868        0.840
##   2.89     37       1   0.6901  0.0626      0.57769        0.824
##   2.92     36       1   0.6710  0.0637      0.55695        0.808
##   2.98     35       1   0.6518  0.0647      0.53648        0.792
##   3.14     33       1   0.6320  0.0657      0.51549        0.775
##   3.17     32       1   0.6123  0.0666      0.49477        0.758
##   3.21     31       1   0.5925  0.0673      0.47429        0.740
##   3.22     30       1   0.5728  0.0679      0.45405        0.723
##   3.24     29       1   0.5530  0.0684      0.43404        0.705
##   3.56     27       1   0.5325  0.0688      0.41338        0.686
##   3.57     26       1   0.5121  0.0692      0.39297        0.667
##   3.58     25       1   0.4916  0.0694      0.37282        0.648
##   3.78     24       1   0.4711  0.0694      0.35291        0.629
##   4.10     22       1   0.4497  0.0695      0.33217        0.609
##   4.18     21       1   0.4283  0.0694      0.31172        0.588
##   4.44     19       1   0.4057  0.0693      0.29028        0.567
##   4.51     18       1   0.3832  0.0690      0.26919        0.545
##   4.52     17       1   0.3606  0.0686      0.24847        0.523
##   4.96     14       1   0.3349  0.0683      0.22451        0.500
##   5.39     12       1   0.3070  0.0681      0.19875        0.474
##   5.73     11       1   0.2791  0.0674      0.17386        0.448
##   6.03      9       1   0.2481  0.0666      0.14651        0.420
##   6.30      7       1   0.2126  0.0659      0.11585        0.390
##   7.20      5       1   0.1701  0.0650      0.08044        0.360
##   9.59      4       1   0.1276  0.0611      0.04991        0.326
##  12.29      3       1   0.0851  0.0535      0.02478        0.292
##  13.18      2       1   0.0425  0.0403      0.00665        0.272</code></pre>
<p>Taking a cue from the good folks at <a href="https://stats.idre.ucla.edu/r/examples/alda/r-applied-longitudinal-data-analysis-ch-13/">IDRE</a>, saving the summary results as an object will make it easy to subset and augment that information into our version of Table 13.1.</p>
<div class="sourceCode" id="cb1428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1428-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the summary as t</span></span>
<span id="cb1428-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit13<span class="fl">.2</span>)</span>
<span id="cb1428-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1428-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-4" aria-hidden="true" tabindex="-1"></a><span class="co"># subset, augment, and save as honking_km</span></span>
<span id="cb1428-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-5" aria-hidden="true" tabindex="-1"></a>honking_km <span class="ot">&lt;-</span></span>
<span id="cb1428-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">seconds  =</span> t<span class="sc">$</span>time,</span>
<span id="cb1428-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_risk   =</span> t<span class="sc">$</span>n.risk,</span>
<span id="cb1428-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_events =</span> t<span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb1428-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">p(t)</span><span class="st">`</span>     <span class="ot">=</span> n_events <span class="sc">/</span> n_risk,</span>
<span id="cb1428-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_censored =</span> n_risk <span class="sc">-</span> n_events <span class="sc">-</span> <span class="fu">lead</span>(n_risk, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb1428-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">interval   =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1428-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">interval_f =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb1428-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">start      =</span> seconds,</span>
<span id="cb1428-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">end        =</span> <span class="fu">lead</span>(seconds, <span class="at">default =</span> <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1428-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(interval<span class="sc">:</span>interval_f, seconds, start<span class="sc">:</span>end, n_risk<span class="sc">:</span>n_events, n_censored, <span class="st">`</span><span class="at">p(t)</span><span class="st">`</span>)</span>
<span id="cb1428-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1428-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1428-17" aria-hidden="true" tabindex="-1"></a>honking_km</span></code></pre></div>
<pre><code>## # A tibble: 42 x 9
##    interval interval_f seconds start   end n_risk n_events n_censored `p(t)`
##       &lt;int&gt; &lt;fct&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
##  1        1 1             1.41  1.41  1.51     57        1          1 0.0175
##  2        2 2             1.51  1.51  1.67     55        1          0 0.0182
##  3        3 3             1.67  1.67  1.68     54        1          0 0.0185
##  4        4 4             1.68  1.68  1.86     53        1          0 0.0189
##  5        5 5             1.86  1.86  2.12     52        1          0 0.0192
##  6        6 6             2.12  2.12  2.19     51        1          0 0.0196
##  7        7 7             2.19  2.19  2.48     50        1          1 0.02  
##  8        8 8             2.48  2.48  2.5      48        1          0 0.0208
##  9        9 9             2.5   2.5   2.53     47        1          0 0.0213
## 10       10 10            2.53  2.53  2.54     46        1          0 0.0217
## # … with 32 more rows</code></pre>
<p>We haven’t bothered adding the top <code>interval == 0</code> row, but one could add that information with a little <code>bind_rows()</code> labor. Note how we slipped in a few extra columns (e.g., <code>interval_f</code>) because they’ll come in handy, later. We compute the Kaplan-Meier estimates for the survivor function by serially multiplying the compliments for the estimates of the conditional probability values, <span class="math inline">\(\hat p(t)\)</span>. As in other examples, that’s just a little <code>cumprod()</code> code.</p>
<div class="sourceCode" id="cb1430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1430-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1430-1" aria-hidden="true" tabindex="-1"></a>honking_km <span class="ot">&lt;-</span></span>
<span id="cb1430-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1430-2" aria-hidden="true" tabindex="-1"></a>  honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1430-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1430-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">S(t)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">p(t)</span><span class="st">`</span>))</span></code></pre></div>
<p>Instead of doing that by hand, we could have just subset the <code>surv</code> vector within <code>t</code>.</p>
<div class="sourceCode" id="cb1431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1431-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1431-1" aria-hidden="true" tabindex="-1"></a>t<span class="sc">$</span>surv</span></code></pre></div>
<pre><code>##  [1] 0.98245614 0.96459330 0.94673046 0.92886762 0.91100478 0.89314195 0.87527911 0.85704413
##  [9] 0.83880914 0.82057416 0.80233918 0.78410420 0.76586922 0.74763424 0.72846413 0.70929402
## [17] 0.69012391 0.67095380 0.65178369 0.63203267 0.61228165 0.59253063 0.57277961 0.55302859
## [25] 0.53254605 0.51206351 0.49158097 0.47109843 0.44968486 0.42827130 0.40573070 0.38319011
## [33] 0.36064951 0.33488883 0.30698143 0.27907403 0.24806580 0.21262783 0.17010227 0.12757670
## [41] 0.08505113 0.04252557</code></pre>
<p>Here we subset the standard errors for <span class="math inline">\(\hat S(t)\)</span>.</p>
<div class="sourceCode" id="cb1433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1433-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1433-1" aria-hidden="true" tabindex="-1"></a>honking_km <span class="ot">&lt;-</span></span>
<span id="cb1433-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1433-2" aria-hidden="true" tabindex="-1"></a>  honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1433-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1433-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">se[S(t)]</span><span class="st">`</span> <span class="ot">=</span> t<span class="sc">$</span>std.err)</span>
<span id="cb1433-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1433-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1433-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1433-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(honking_km)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   interval interval_f seconds start   end n_risk n_events n_censored `p(t)` `S(t)` `se[S(t)]`
##      &lt;int&gt; &lt;fct&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1        1 1             1.41  1.41  1.51     57        1          1 0.0175  0.982     0.0174
## 2        2 2             1.51  1.51  1.67     55        1          0 0.0182  0.965     0.0246
## 3        3 3             1.67  1.67  1.68     54        1          0 0.0185  0.947     0.0299
## 4        4 4             1.68  1.68  1.86     53        1          0 0.0189  0.929     0.0343
## 5        5 5             1.86  1.86  2.12     52        1          0 0.0192  0.911     0.0380
## 6        6 6             2.12  2.12  2.19     51        1          0 0.0196  0.893     0.0412</code></pre>
<p>We can plot the fitted <span class="math inline">\(\hat S(t)\)</span> values with `geom_step() to make our version of the top half of Figure 13.2.</p>
<div class="sourceCode" id="cb1435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1435-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1435-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-2" aria-hidden="true" tabindex="-1"></a>  honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1435-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seconds, <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1435-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">seconds =</span> <span class="fl">17.15</span>, </span>
<span id="cb1435-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>  <span class="ot">=</span> <span class="fl">0.04252557</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1435-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1435-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> seconds, <span class="at">y =</span> <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1435-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb1435-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1435-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</span></code></pre></div>
<p>Now add the actuarial and discrete-time estimates to make our version of the lower panel of Figure 13.2.</p>
<div class="sourceCode" id="cb1436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1436-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-1" aria-hidden="true" tabindex="-1"></a>arrow <span class="ot">&lt;-</span> </span>
<span id="cb1436-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">8.7</span>, <span class="fl">2.7</span>),</span>
<span id="cb1436-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">4</span>, .<span class="dv">23</span>),</span>
<span id="cb1436-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> <span class="fu">c</span>(<span class="fl">2.6</span>, <span class="dv">7</span>, <span class="fl">3.9</span>),</span>
<span id="cb1436-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="fu">c</span>(.<span class="dv">875</span>, .<span class="dv">25</span>, .<span class="dv">33</span>))</span>
<span id="cb1436-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-7" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> </span>
<span id="cb1436-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x     =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">8.7</span>, <span class="fl">2.7</span>),</span>
<span id="cb1436-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y     =</span> <span class="fu">c</span>(.<span class="dv">77</span>, .<span class="dv">43</span>, .<span class="dv">2</span>),</span>
<span id="cb1436-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Kaplan Meier&quot;</span>, <span class="st">&quot;Discrete-time&quot;</span>, <span class="st">&quot;Actuarial&quot;</span>))</span>
<span id="cb1436-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1436-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-13" aria-hidden="true" tabindex="-1"></a>  honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1436-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seconds, <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1436-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">seconds =</span> <span class="fl">17.15</span>, </span>
<span id="cb1436-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>  <span class="ot">=</span> <span class="fl">0.04252557</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1436-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1436-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> seconds, <span class="at">y =</span> <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1436-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb1436-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">data =</span> honking_aggregated,</span>
<span id="cb1436-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> ub, <span class="at">y =</span> <span class="st">`</span><span class="at">S(t)_a</span><span class="st">`</span>), </span>
<span id="cb1436-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">direction =</span> <span class="st">&quot;vh&quot;</span>) <span class="sc">+</span></span>
<span id="cb1436-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> honking_aggregated <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">s =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">p(t)</span><span class="st">`</span>)),</span>
<span id="cb1436-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> ub, <span class="at">y =</span> s),</span>
<span id="cb1436-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1436-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> arrow,</span>
<span id="cb1436-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-27" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb1436-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> y, <span class="at">yend =</span> yend),</span>
<span id="cb1436-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>,<span class="st">&quot;cm&quot;</span>), <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1436-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb1436-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb1436-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1436-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;seconds after light turns green&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</span></code></pre></div>
<p>Combine and plot.</p>
<div class="sourceCode" id="cb1437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1437-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1437-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb1437-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1437-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j])))), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">&amp;</span></span>
<span id="cb1437-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1437-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-35-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Did you notice how in both subplots we used <code>bind_rows()</code> to add in an <code>S(t)</code> value for <code>seconds = 17.15</code>? In the text, we read:</p>
<blockquote>
<p>As for actuarial estimates, we plot Kaplan-Meier estimates as a step function that associates the estimated probability with the entire interval. If the largest event time is censored, as it is here (17.15), we extend the step for the last estimate out to that largest censored value. (pp. 485–486)</p>
</blockquote>
<p>Those <code>bind_rows()</code> lines are what extended “the step for the last estimate.” Since that last estimate for <span class="math inline">\(\hat S(t_j) = 0.04252557\)</span>, we set <code>S(t) = 0.04252557</code> in the plot data.</p>
<p>We can get the median lifetime by executing <code>print(fit13.2)</code>.</p>
<div class="sourceCode" id="cb1438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1438-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit13<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(seconds, censor_1) ~ 1, data = honking)
## 
##       n  events  median 0.95LCL 0.95UCL 
##   57.00   42.00    3.58    3.17    4.96</code></pre>
<p>Like in the text, it’s 3.58.</p>
<p>Even though there is no Kaplan-Meier estimate for hazard, we can compute a Kaplan-Meier type hazard with the formula</p>
<p><span class="math display">\[\hat h_\text{KM} (t_j) = \frac{\hat p_\text{KM} (t_j)}{\text{width}_j}.\]</span></p>
<p>Here we compute both the <span class="math inline">\(\text{width}_j\)</span> and <span class="math inline">\(\hat h_\text{KM} (t_j)\)</span> values by hand.</p>
<div class="sourceCode" id="cb1440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1440-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1440-1" aria-hidden="true" tabindex="-1"></a>honking_km <span class="ot">&lt;-</span></span>
<span id="cb1440-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1440-2" aria-hidden="true" tabindex="-1"></a>  honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1440-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1440-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">width =</span> end <span class="sc">-</span> start) <span class="sc">%&gt;%</span> </span>
<span id="cb1440-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1440-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">width =</span> <span class="fu">if_else</span>(end <span class="sc">==</span> <span class="cn">Inf</span>, <span class="fl">17.15</span> <span class="sc">-</span> start, width)) <span class="sc">%&gt;%</span>  <span class="co"># this might be wrong</span></span>
<span id="cb1440-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1440-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">h[km](t)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">p(t)</span><span class="st">`</span> <span class="sc">/</span> width)</span>
<span id="cb1440-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1440-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1440-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1440-7" aria-hidden="true" tabindex="-1"></a>honking_km</span></code></pre></div>
<pre><code>## # A tibble: 42 x 13
##    interval interval_f seconds start   end n_risk n_events n_censored `p(t)` `S(t)` `se[S(t)]`
##       &lt;int&gt; &lt;fct&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
##  1        1 1             1.41  1.41  1.51     57        1          1 0.0175  0.982     0.0174
##  2        2 2             1.51  1.51  1.67     55        1          0 0.0182  0.965     0.0246
##  3        3 3             1.67  1.67  1.68     54        1          0 0.0185  0.947     0.0299
##  4        4 4             1.68  1.68  1.86     53        1          0 0.0189  0.929     0.0343
##  5        5 5             1.86  1.86  2.12     52        1          0 0.0192  0.911     0.0380
##  6        6 6             2.12  2.12  2.19     51        1          0 0.0196  0.893     0.0412
##  7        7 7             2.19  2.19  2.48     50        1          1 0.02    0.875     0.0441
##  8        8 8             2.48  2.48  2.5      48        1          0 0.0208  0.857     0.0468
##  9        9 9             2.5   2.5   2.53     47        1          0 0.0213  0.839     0.0492
## 10       10 10            2.53  2.53  2.54     46        1          0 0.0217  0.821     0.0514
## # … with 32 more rows, and 2 more variables: width &lt;dbl&gt;, h[km](t) &lt;dbl&gt;</code></pre>
<p>Singer and Willett remarked that “because the interval width varies widely (and is itself a function of the distribution of event times), the resulting estimates vary from one interval to the next. Their values are usually so erratic that pattern identification is nearly impossible” (p. 487). That sounds fun. Let’s explore them in a plot!</p>
<div class="sourceCode" id="cb1442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1442-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1442-1" aria-hidden="true" tabindex="-1"></a>honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1442-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1442-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> start, <span class="at">y =</span> <span class="st">`</span><span class="at">h[km](t)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1442-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1442-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb1442-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1442-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1442-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1442-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;seconds after light turns green&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb1442-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1442-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">hat</span>(<span class="fu">italic</span>(h))[KM](<span class="fu">italic</span>(t[j])))) <span class="sc">+</span></span>
<span id="cb1442-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1442-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Erratic, indeed.</p>
<div id="fitting-a-bayesian-kaplan-meier-model" class="section level3" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Fitting a Bayesian Kaplan-Meier model</h3>
<p>It’s worth repeating one of the quotes from earlier:</p>
<blockquote>
<p>The Kaplan-Meier method is a simple extension of the discrete-time method with a fundamental change: instead of rounding event times to construct the intervals, capitalize on the raw event times and construct intervals so that each contains just <em>one observed event time</em> (as shown in table 13.3). Each Kaplan-Meier interval begins at one observed event time and ends just before the next. (p. 483, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Whether we’re working with one event occurrence at a time or binning them in intervals, the basic product of the model is a conditional probability. The binomial likelihood served us well when we binned the event occurrences into largish time intervals, and it will work just the same when we work them in serial fashion. The biggest obstacle is properly setting up the data. After some experimentation, the easiest way to format the data properly is to just use the summary results from <code>survfit(data = honking, Surv(seconds, censor_1) ~ 1)</code>, which we saved as <code>honking_km</code>. Take another look.</p>
<div class="sourceCode" id="cb1443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1443-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1443-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(honking_km)</span></code></pre></div>
<pre><code>## Rows: 42
## Columns: 13
## $ interval   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, …
## $ interval_f &lt;fct&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, …
## $ seconds    &lt;dbl&gt; 1.41, 1.51, 1.67, 1.68, 1.86, 2.12, 2.19, 2.48, 2.50, 2.53, 2.54, 2.56, 2.62, 2…
## $ start      &lt;dbl&gt; 1.41, 1.51, 1.67, 1.68, 1.86, 2.12, 2.19, 2.48, 2.50, 2.53, 2.54, 2.56, 2.62, 2…
## $ end        &lt;dbl&gt; 1.51, 1.67, 1.68, 1.86, 2.12, 2.19, 2.48, 2.50, 2.53, 2.54, 2.56, 2.62, 2.68, 2…
## $ n_risk     &lt;dbl&gt; 57, 55, 54, 53, 52, 51, 50, 48, 47, 46, 45, 44, 43, 42, 39, 38, 37, 36, 35, 33,…
## $ n_events   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ n_censored &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0…
## $ `p(t)`     &lt;dbl&gt; 0.01754386, 0.01818182, 0.01851852, 0.01886792, 0.01923077, 0.01960784, 0.02000…
## $ `S(t)`     &lt;dbl&gt; 0.9824561, 0.9645933, 0.9467305, 0.9288676, 0.9110048, 0.8931419, 0.8752791, 0.…
## $ `se[S(t)]` &lt;dbl&gt; 0.01738929, 0.02459209, 0.02992911, 0.03428307, 0.03799347, 0.04123439, 0.04410…
## $ width      &lt;dbl&gt; 0.10, 0.16, 0.01, 0.18, 0.26, 0.07, 0.29, 0.02, 0.03, 0.01, 0.02, 0.06, 0.06, 0…
## $ `h[km](t)` &lt;dbl&gt; 0.17543860, 0.11363636, 1.85185185, 0.10482180, 0.07396450, 0.28011204, 0.06896…</code></pre>
<p>In the <code>n_events</code> column we have the number of cases that experienced the event in a given moment in continuous time. In the <code>n_risk</code> column we have the number of possible cases that could have experienced the event at that moment. In the <code>interval_f</code> column we’ve saved each moment as a factor, conveniently named <span class="math inline">\(1, 2,..., 42\)</span>. Thus we can fit a simple Bayesian Kaplan-Meier model with <code>brms::brm()</code> by specifying <code>formula = n_events | trials(n_risk) ~ 0 + interval_f</code>.</p>
<p>Consider the implications for our priors. Because we’re treating each instance in time as a factor, that means the number of cases experiencing the event in one of those factors will always be 1 or some other small number in the unusual case of a tie. But the number in the denominator, <code>n_risk</code>, will tend to be relatively large, which means the probabilities will tend to be small. The weakly regularizing prior approach centered on zero might not make sense in this context.</p>
<p>In earlier models, we used <code>normal(0, 4)</code> and <code>normal(0, 1.5)</code>. Here’s what those look like when we convert them to the probability metric.</p>
<div class="sourceCode" id="cb1445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1445-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb1445-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1445-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">1.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1445-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior    =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;normal(0, &quot;</span>, sd, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb1445-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">&quot;normal(0, &quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">4</span>), <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb1445-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_odds =</span> <span class="fu">map</span>(sd, rnorm, <span class="at">n =</span> <span class="fl">1e5</span>, <span class="at">mean =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1445-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(log_odds) <span class="sc">%&gt;%</span> </span>
<span id="cb1445-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p  =</span> <span class="fu">inv_logit_scaled</span>(log_odds)) <span class="sc">%&gt;%</span> </span>
<span id="cb1445-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1445-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p, <span class="at">y =</span> prior)) <span class="sc">+</span></span>
<span id="cb1445-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>), <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb1445-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(p)),</span>
<span id="cb1445-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;prior (log-odds scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1445-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb1445-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1445-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-40-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The <code>normal(0, 4)</code> prior does not reflect our expectation that the probabilities will tend to be small. Interestingly, <code>normal(0, 4)</code> pushes a lot of the prior mass to the edges. What we want is a prior that pushed the mass to the left. Here are some options:</p>
<div class="sourceCode" id="cb1446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1446-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">mean =</span> <span class="sc">-</span><span class="dv">4</span><span class="sc">:-</span><span class="dv">1</span>,</span>
<span id="cb1446-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1446-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_odds =</span> <span class="fu">map2</span>(mean, sd, rnorm, <span class="at">n =</span> <span class="fl">1e5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1446-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(log_odds) <span class="sc">%&gt;%</span> </span>
<span id="cb1446-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p    =</span> <span class="fu">inv_logit_scaled</span>(log_odds),</span>
<span id="cb1446-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;mean = &quot;</span>, mean),</span>
<span id="cb1446-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">&quot;mean = &quot;</span>, <span class="sc">-</span><span class="dv">4</span><span class="sc">:-</span><span class="dv">1</span>)),</span>
<span id="cb1446-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd   =</span> <span class="fu">str_c</span>(<span class="st">&quot;sd = &quot;</span>, sd)) <span class="sc">%&gt;%</span> </span>
<span id="cb1446-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1446-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1446-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>), <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb1446-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1446-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p))) <span class="sc">+</span></span>
<span id="cb1446-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1446-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1446-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sd<span class="sc">~</span>mean)</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-41-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>As you decrease the prior mean, the mass in the probability metric heads to zero. Increasing or shrinking the prior standard deviation accelerates or attenuates that leftward concentration. To my way of thinking, we want a prior that, while concentrating the mass toward zero, still offers a good spread toward the middle. Let’s try <code>normal(-4, 3)</code>.</p>
<div class="sourceCode" id="cb1447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1447-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-1" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.3</span> <span class="ot">&lt;-</span></span>
<span id="cb1447-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> honking_km,</span>
<span id="cb1447-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1447-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-4" aria-hidden="true" tabindex="-1"></a>      n_events <span class="sc">|</span> <span class="fu">trials</span>(n_risk) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> interval_f,</span>
<span id="cb1447-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">3</span>), <span class="at">class =</span> b),</span>
<span id="cb1447-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">1</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1447-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb1447-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1447-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;~/Dropbox/Recoding Applied Longitudinal Data Analysis/fits/fit13.03&quot;</span>)</span></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb1448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1448-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit13<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: n_events | trials(n_risk) ~ 0 + interval_f 
##    Data: honking_km (Number of observations: 42) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## interval_f1     -4.40      1.07    -6.85    -2.73 1.00     4851     2250
## interval_f2     -4.41      1.10    -7.01    -2.67 1.00     5073     2356
## interval_f3     -4.39      1.08    -6.84    -2.68 1.00     4579     2227
## interval_f4     -4.36      1.14    -7.03    -2.62 1.00     5234     2319
## interval_f5     -4.34      1.10    -6.89    -2.64 1.00     5263     1951
## interval_f6     -4.32      1.06    -6.69    -2.58 1.00     5825     2498
## interval_f7     -4.33      1.10    -6.85    -2.57 1.00     4535     2355
## interval_f8     -4.27      1.07    -6.71    -2.60 1.00     5061     2615
## interval_f9     -4.23      1.07    -6.68    -2.50 1.00     6059     2750
## interval_f10    -4.24      1.10    -6.76    -2.51 1.00     5991     2424
## interval_f11    -4.20      1.07    -6.65    -2.48 1.00     5522     2809
## interval_f12    -4.20      1.12    -6.89    -2.45 1.00     6217     2517
## interval_f13    -4.13      1.05    -6.57    -2.44 1.00     5775     2378
## interval_f14    -4.21      1.16    -6.86    -2.37 1.00     4467     2049
## interval_f15    -4.08      1.12    -6.76    -2.34 1.00     5296     2476
## interval_f16    -4.07      1.11    -6.56    -2.33 1.00     4818     2174
## interval_f17    -4.04      1.11    -6.60    -2.27 1.00     5283     2442
## interval_f18    -4.01      1.07    -6.43    -2.29 1.00     5855     2882
## interval_f19    -4.02      1.11    -6.49    -2.23 1.00     4193     1994
## interval_f20    -3.93      1.12    -6.58    -2.17 1.00     4731     2114
## interval_f21    -3.86      1.09    -6.41    -2.16 1.00     5282     2270
## interval_f22    -3.85      1.08    -6.35    -2.15 1.00     5359     2372
## interval_f23    -3.83      1.10    -6.34    -2.08 1.00     5769     2478
## interval_f24    -3.84      1.17    -6.48    -1.98 1.00     4814     2123
## interval_f25    -3.73      1.11    -6.30    -1.98 1.00     5487     2548
## interval_f26    -3.74      1.16    -6.39    -1.88 1.00     5960     2687
## interval_f27    -3.71      1.16    -6.40    -1.85 1.00     4960     2439
## interval_f28    -3.67      1.14    -6.29    -1.87 1.00     5930     2472
## interval_f29    -3.58      1.17    -6.29    -1.73 1.00     4903     2065
## interval_f30    -3.54      1.16    -6.18    -1.66 1.00     5540     2453
## interval_f31    -3.45      1.18    -6.21    -1.56 1.00     5916     2484
## interval_f32    -3.39      1.19    -6.23    -1.51 1.00     5074     2436
## interval_f33    -3.31      1.18    -5.99    -1.42 1.00     5864     2438
## interval_f34    -3.13      1.19    -5.87    -1.24 1.00     5287     2505
## interval_f35    -3.02      1.23    -5.78    -1.04 1.00     5889     2654
## interval_f36    -2.94      1.20    -5.68    -1.00 1.00     4637     2248
## interval_f37    -2.73      1.22    -5.44    -0.73 1.00     5377     2237
## interval_f38    -2.49      1.26    -5.38    -0.43 1.00     5537     2254
## interval_f39    -2.12      1.29    -5.10     0.04 1.00     5342     2543
## interval_f40    -1.93      1.42    -5.03     0.45 1.00     5757     2406
## interval_f41    -1.56      1.47    -4.71     0.95 1.00     6246     2396
## interval_f42    -1.02      1.57    -4.34     1.87 1.00     7836     2634
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our parameter diagnostics look excellent. It might be helpful to inspect their posteriors in a plot. Here we show them in both the log-odds and probability metrics.</p>
<div class="sourceCode" id="cb1450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1450-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span></span>
<span id="cb1450-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(fit13<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1450-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb1450-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>) </span>
<span id="cb1450-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1450-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-6" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1450-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1450-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>,</span>
<span id="cb1450-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;log_odds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1450-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parameter   =</span> <span class="fu">factor</span>(parameter, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>),</span>
<span id="cb1450-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">probability =</span> <span class="fu">inv_logit_scaled</span>(log_odds)) <span class="sc">%&gt;%</span> </span>
<span id="cb1450-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(probability<span class="sc">:</span>log_odds) <span class="sc">%&gt;%</span> </span>
<span id="cb1450-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1450-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> parameter)) <span class="sc">+</span></span>
<span id="cb1450-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1450-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(<span class="fu">italic</span>(p))[Bayes](<span class="fu">italic</span>(t[j]))),</span>
<span id="cb1450-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(j))) <span class="sc">+</span></span>
<span id="cb1450-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1450-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1450-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-43-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Let’s wrangle our <code>post</code> object a little to put it in a more useful format.</p>
<div class="sourceCode" id="cb1451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1451-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span></span>
<span id="cb1451-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-2" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1451-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(inv_logit_scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter,</span>
<span id="cb1451-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;interval&quot;</span>,</span>
<span id="cb1451-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">interval =</span> interval <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(interval) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">survivor =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> p)) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb1451-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1451-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1451-15" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(post)</span></code></pre></div>
<pre><code>## Rows: 172,000
## Columns: 4
## $ iter     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23…
## $ interval &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ p        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ survivor &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
<p>We might want to compare our Bayesian <span class="math inline">\(\hat p(t_j)\)</span> estimates with their Maximum Likelihood counterparts. Since the Bayesian marginal posteriors are rather asymmetrical, we’ll summarize <span class="math inline">\(\hat p_\text{Bayes} (t_j)\)</span> with means, medians, and modes.</p>
<div class="sourceCode" id="cb1453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1453-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1453-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">interval =</span> <span class="fu">factor</span>(interval, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">42</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1453-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval) <span class="sc">%&gt;%</span> </span>
<span id="cb1453-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean   =</span> <span class="fu">mean</span>(survivor),</span>
<span id="cb1453-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(survivor),</span>
<span id="cb1453-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode   =</span> <span class="fu">Mode</span>(survivor)) <span class="sc">%&gt;%</span> </span>
<span id="cb1453-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>interval,</span>
<span id="cb1453-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;posterior estimate&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1453-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1453-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> interval, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1453-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">`</span><span class="at">posterior estimate</span><span class="st">`</span>),</span>
<span id="cb1453-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1453-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1453-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">interval =</span> <span class="fu">factor</span>(interval, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">42</span>)),</span>
<span id="cb1453-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1453-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb1453-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">hat</span>(<span class="fu">italic</span>(p))(<span class="fu">italic</span>(t[j])))) <span class="sc">+</span></span>
<span id="cb1453-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1453-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;grey92&quot;</span>),</span>
<span id="cb1453-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, .<span class="dv">8</span>),</span>
<span id="cb1453-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1453-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-45-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The black dots were the ML estimates and the colored circles were the Bayesian counterparts. Overall, it looks like they matched up pretty well! Building on those sensibilities, here’s an alternative version of the top panel from Figure 13.2, this time comparing the frequentist <span class="math inline">\(\hat S (t_j)\)</span> with our Bayesian counterpart.</p>
<div class="sourceCode" id="cb1454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1454-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1454-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval) <span class="sc">%&gt;%</span> </span>
<span id="cb1454-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean   =</span> <span class="fu">mean</span>(survivor),</span>
<span id="cb1454-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(survivor),</span>
<span id="cb1454-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode   =</span> <span class="fu">Mode</span>(survivor)) <span class="sc">%&gt;%</span> </span>
<span id="cb1454-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>interval,</span>
<span id="cb1454-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;posterior estimate&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1454-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1454-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">distinct</span>(interval, seconds),</span>
<span id="cb1454-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;interval&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1454-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seconds =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(seconds), <span class="dv">0</span>, seconds)) <span class="sc">%&gt;%</span> </span>
<span id="cb1454-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1454-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> seconds, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1454-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">`</span><span class="at">posterior estimate</span><span class="st">`</span>),</span>
<span id="cb1454-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1454-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">data =</span> honking_km,</span>
<span id="cb1454-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1454-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb1454-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;time&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1454-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1454-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1454-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;grey92&quot;</span>),</span>
<span id="cb1454-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, .<span class="dv">8</span>),</span>
<span id="cb1454-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1454-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-46-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Again, we showed the ML <span class="math inline">\(\hat S (t_j)\)</span> in black and the Bayesian counterpart as summarized by three alternative measures of central tendency in color. Overall, the results were very similar across methods. What this plot makes clear is that it’s the last few estimates for that where our Bayesian estimates diverge from ML. If you compare this plot with the previous one, it appears that the nature of the divergence is our Bayesian estimates are shrunk a bit toward <span class="math inline">\(p = .5\)</span>, though the modes shrank less than the medians and means. Also recall how uncertain our posteriors were for the last few intervals. This is because the likelihoods for those intervals were incredibly weak. Take a glance at the last few rows in the data.</p>
<div class="sourceCode" id="cb1455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1455-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(honking_km)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##   interval interval_f seconds start    end n_risk n_events n_censored `p(t)` `S(t)` `se[S(t)]` width
##      &lt;int&gt; &lt;fct&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1       37 37            6.03  6.03   6.3       9        1          1  0.111 0.248      0.0666 0.270
## 2       38 38            6.3   6.3    7.2       7        1          1  0.143 0.213      0.0659 0.9  
## 3       39 39            7.2   7.2    9.59      5        1          0  0.2   0.170      0.0650 2.39 
## 4       40 40            9.59  9.59  12.3       4        1          0  0.25  0.128      0.0611 2.70 
## 5       41 41           12.3  12.3   13.2       3        1          0  0.333 0.0851     0.0535 0.89 
## 6       42 42           13.2  13.2  Inf         2        1          1  0.5   0.0425     0.0403 3.97 
## # … with 1 more variable: h[km](t) &lt;dbl&gt;</code></pre>
<p>Based on the <code>n_risk</code> column, the number of trials ranged from <span class="math inline">\(n = 9\)</span> at <code>interval == 37</code> to <span class="math inline">\(n = 2\)</span> fpr <code>interval == 42</code>. With so little information informing the likelihood, you largely get back the prior. Moving forward, here’s another version of the survivor function of Figure 13.2, but this time using posterior intervals to highlight uncertainty in the estimates.</p>
<div class="sourceCode" id="cb1457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1457-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># augment post</span></span>
<span id="cb1457-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-2" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span></span>
<span id="cb1457-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-3" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1457-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb1457-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-5" aria-hidden="true" tabindex="-1"></a>    post <span class="sc">%&gt;%</span> </span>
<span id="cb1457-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(interval <span class="sc">==</span> <span class="dv">42</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1457-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">interval =</span> <span class="dv">43</span>)</span>
<span id="cb1457-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1457-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1457-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-10" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1457-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1457-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb1457-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(honking_km, interval, seconds),</span>
<span id="cb1457-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(<span class="at">interval =</span> <span class="dv">43</span>, <span class="at">seconds =</span> <span class="fl">17.15</span>)),</span>
<span id="cb1457-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;interval&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1457-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seconds =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(seconds), <span class="dv">0</span>, seconds)) <span class="sc">%&gt;%</span> </span>
<span id="cb1457-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1457-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> seconds, <span class="at">y =</span> survivor)) <span class="sc">+</span> </span>
<span id="cb1457-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">step =</span> <span class="st">&quot;hv&quot;</span>, <span class="at">size =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb1457-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb1457-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">5.3</span>, <span class="at">y =</span> .<span class="dv">54</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">3.5</span>,</span>
<span id="cb1457-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;This time the black line is the Bayesian posterior median,</span><span class="sc">\n</span><span class="st">which is the `stat_lineribbon()` default.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1457-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="fl">5.3</span>, <span class="at">xend =</span> <span class="fl">4.2</span>,</span>
<span id="cb1457-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> .<span class="dv">55</span>, <span class="at">yend =</span> .<span class="dv">475</span>,</span>
<span id="cb1457-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>,<span class="st">&quot;cm&quot;</span>), <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1457-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="st">&quot;CI&quot;</span>, <span class="at">start =</span> .<span class="dv">8</span>, <span class="at">end =</span> .<span class="dv">6</span>,</span>
<span id="cb1457-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;95%&quot;</span>, <span class="st">&quot;50%&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1457-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;time&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1457-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1457-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1457-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;grey92&quot;</span>),</span>
<span id="cb1457-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">925</span>, .<span class="dv">85</span>),</span>
<span id="cb1457-33"><a href="describing-continuous-time-event-occurrence-data.html#cb1457-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-48-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Just for giggles, here’s how you might depict our <span class="math inline">\(\hat S_\text{Bayes} (t_j)\)</span> with more of a 3D approach.</p>
<div class="sourceCode" id="cb1458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1458-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1458-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1458-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb1458-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(honking_km, interval, seconds),</span>
<span id="cb1458-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(<span class="at">interval =</span> <span class="dv">43</span>, <span class="at">seconds =</span> <span class="fl">17.15</span>)),</span>
<span id="cb1458-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;interval&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1458-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seconds =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(seconds), <span class="dv">0</span>, seconds)) <span class="sc">%&gt;%</span> </span>
<span id="cb1458-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1458-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> seconds, <span class="at">y =</span> survivor)) <span class="sc">+</span> </span>
<span id="cb1458-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">01</span>, <span class="at">to =</span> .<span class="dv">99</span>, <span class="at">by =</span> .<span class="dv">01</span>),</span>
<span id="cb1458-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">step =</span> <span class="st">&quot;hv&quot;</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb1458-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> .<span class="dv">89</span>, <span class="at">end =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1458-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;time&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1458-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1458-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1458-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-49-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="the-cumulative-hazard-function" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> The cumulative hazard function</h2>
<blockquote>
<p>Kaplan-Meier type estimates of hazard are simply too erratic to be meaningful.</p>
<p>This is where the <em>cumulative hazard function</em> comes in. Denoted <span class="math inline">\(H (t_{ij})\)</span>, the cumulative hazard function assesses, at each point in time, the <em>total amount of accumulated risk</em> that individual <span class="math inline">\(i\)</span> has faced from the beginning of time until the present. (p. 488, <em>emphasis</em> in the original)</p>
</blockquote>
<p>The cumulative hazard function follows the equation</p>
<p><span class="math display">\[H (t_{ij}) = \underset{\text{between } t_0 \text{ and } t_j}{\text{cumulation}} [h(t_{ij})],\]</span></p>
<p>“where the phrase ‘cumulation between <span class="math inline">\(t_0\)</span> and <span class="math inline">\(t_j\)</span>’ indicates that cumulative hazard totals the infinite number of specific values of <span class="math inline">\(h(t_{ij})\)</span> that exist between <span class="math inline">\(t_0\)</span> and <span class="math inline">\(t_j\)</span>” (p. 488).</p>
<div id="understanding-the-meaning-of-cumulative-hazard." class="section level3" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> Understanding the meaning of cumulative hazard.</h3>
<p>Although the absolute values of the cumulative hazard function aren’t particularly illuminating, the overall shape is. Figure 13.3 gives several examples. We don’t have the data or the exact specifications for the functions expressed in Figure 13.3. But if you’re okay with a little imprecision, we can make a few good guesses. Before diving in, it’ll help simplify our subplot code if we make two custom geoms. We’ll call them <code>geom_h()</code> and <code>geom_H()</code>.</p>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1459-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-1" aria-hidden="true" tabindex="-1"></a>geom_h <span class="ot">&lt;-</span> <span class="cf">function</span>(subtitle, ...) {</span>
<span id="cb1459-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1459-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1459-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(...),</span>
<span id="cb1459-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>),</span>
<span id="cb1459-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(h)(<span class="fu">italic</span>(t[ij]))),</span>
<span id="cb1459-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="fl">0.02</span>),</span>
<span id="cb1459-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> subtitle),</span>
<span id="cb1459-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>))</span>
<span id="cb1459-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1459-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1459-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1459-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1459-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-14" aria-hidden="true" tabindex="-1"></a>geom_H <span class="ot">&lt;-</span> <span class="cf">function</span>(y_ul, ...) {</span>
<span id="cb1459-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1459-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1459-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(...),</span>
<span id="cb1459-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(H)(<span class="fu">italic</span>(t[ij])))),</span>
<span id="cb1459-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, y_ul))</span>
<span id="cb1459-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1459-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1459-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1459-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we have our custom geoms, here’s the code to make Figure 13.3.</p>
<div class="sourceCode" id="cb1460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1460-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a: constant hazard</span></span>
<span id="cb1460-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb1460-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">time =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1460-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb1460-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">H =</span> <span class="fu">cumsum</span>(h))</span>
<span id="cb1460-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> h)) <span class="sc">+</span></span>
<span id="cb1460-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">subtitle =</span> <span class="st">&quot;A: Constant hazard&quot;</span>)</span>
<span id="cb1460-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1460-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">y_ul =</span> <span class="dv">6</span>)</span>
<span id="cb1460-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-15" aria-hidden="true" tabindex="-1"></a><span class="co"># b: increasing hazard</span></span>
<span id="cb1460-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-16" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb1460-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">time =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1460-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fl">0.001</span> <span class="sc">*</span> time) <span class="sc">%&gt;%</span>  </span>
<span id="cb1460-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">H =</span> <span class="fu">cumsum</span>(h))</span>
<span id="cb1460-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-21" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> h)) <span class="sc">+</span> </span>
<span id="cb1460-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">subtitle =</span> <span class="st">&quot;B: Increasing hazard&quot;</span>)</span>
<span id="cb1460-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1460-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-25" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1460-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">y_ul =</span> <span class="dv">5</span>)</span>
<span id="cb1460-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-29" aria-hidden="true" tabindex="-1"></a><span class="co"># decreasing hazard</span></span>
<span id="cb1460-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-30" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb1460-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">time =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">2</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1460-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note out use of the gamma distribution (see )</span></span>
<span id="cb1460-33"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fu">dgamma</span>(time, <span class="at">shape =</span> .<span class="dv">02</span>, <span class="at">rate =</span> .<span class="dv">001</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb1460-34"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">H =</span> <span class="fu">cumsum</span>(h))</span>
<span id="cb1460-35"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-36"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-36" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-37"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> h)) <span class="sc">+</span></span>
<span id="cb1460-38"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">subtitle =</span> <span class="st">&quot;C: Decreasing hazard&quot;</span>)</span>
<span id="cb1460-39"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-40"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-40" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-41"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1460-42"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">y_ul =</span> <span class="fl">1.2</span>)</span>
<span id="cb1460-43"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-44"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-44" aria-hidden="true" tabindex="-1"></a><span class="co"># increasing &amp; decreasing hazard</span></span>
<span id="cb1460-45"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-45" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb1460-46"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">time =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1460-47"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note our use of the Fréchet distribution</span></span>
<span id="cb1460-48"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fu">dfrechet</span>(time, <span class="at">loc =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">250</span>, <span class="at">shape =</span> .<span class="dv">5</span>) <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb1460-49"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">H =</span> <span class="fu">cumsum</span>(h))</span>
<span id="cb1460-50"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-51"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-51" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-52"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> h)) <span class="sc">+</span></span>
<span id="cb1460-53"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">subtitle =</span> <span class="st">&quot;D: Increasing &amp;</span><span class="sc">\n</span><span class="st"> decreasing hazard&quot;</span>)</span>
<span id="cb1460-54"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-55"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-55" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb1460-56"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1460-57"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">y_ul =</span> <span class="dv">5</span>)</span>
<span id="cb1460-58"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1460-59"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-59" aria-hidden="true" tabindex="-1"></a><span class="co"># combine with patchwork and plot!</span></span>
<span id="cb1460-60"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-60" aria-hidden="true" tabindex="-1"></a>((p1 <span class="sc">/</span> p2) <span class="sc">|</span> (p3 <span class="sc">/</span> p4) <span class="sc">|</span> (p5 <span class="sc">/</span> p6) <span class="sc">|</span> (p7 <span class="sc">/</span> p8)) <span class="sc">&amp;</span></span>
<span id="cb1460-61"><a href="describing-continuous-time-event-occurrence-data.html#cb1460-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-51-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>Did you notice our use of the gamma and Fréchet distributions? Both are supported for continuous-time survival models in <strong>brms</strong> (see Bürkner’s vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_families.html#time-to-event-models"><em>Parameterization of response distributions in brms</em></a>).</p>
</div>
<div id="estimating-the-cumulative-hazard-function." class="section level3" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> Estimating the cumulative hazard function.</h3>
<p>The two methods to estimate the cumulative hazard function are the Nelson-Aalen method and the negative log survivor function method. The Nelson-Aalen method used Kaplan-Meier-type hazard estimates as follows:</p>
<p><span class="math display">\[\hat H_\text{NA} (t_j) = \hat h_\text{KM} (t_1) \text{width}_1 + \hat h_\text{KM} (t_2) \text{width}_2 + \dots + \hat h_\text{KM} (t_j) \text{width}_j,\]</span></p>
<p>where <span class="math inline">\(\hat h_\text{KM} (t_j) \text{width}_j\)</span> is the total hazard during the <span class="math inline">\(j\)</span>th interval. The negative log survivor function method makes use of the estimates of the Kaplan-Meier survivor function with the formula</p>
<p><span class="math display">\[\hat H_{- \text{LS}} (t_j) = - \log \hat S_\text{KM} (t_{ij}),\]</span></p>
<p>where <span class="math inline">\(\hat S_\text{KM} (t_{ij})\)</span>, recall, is the cumulative survivor function for the Kaplan-Meier estimator. Here we put both formulas to use and make our version of Figure 13.4.</p>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1461-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for annotation</span></span>
<span id="cb1461-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb1461-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">seconds =</span> <span class="fu">c</span>(<span class="fl">13.15</span>, <span class="fl">13.4</span>),</span>
<span id="cb1461-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y       =</span> <span class="fu">c</span>(<span class="fl">3.275</span>, <span class="fl">2.65</span>),</span>
<span id="cb1461-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">label   =</span> <span class="fu">c</span>(<span class="st">&quot;Negative~log~survivor*&#39;,&#39;*~hat(italic(H))[-LS](italic(t[j]))&quot;</span>, <span class="st">&quot;Nelson-Aalen*&#39;,&#39;*~hat(italic(H))[N][A](italic(t[j]))&quot;</span>))</span>
<span id="cb1461-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1461-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-7" aria-hidden="true" tabindex="-1"></a><span class="co"># top plot</span></span>
<span id="cb1461-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1461-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-9" aria-hidden="true" tabindex="-1"></a>  honking_km <span class="sc">%&gt;%</span> </span>
<span id="cb1461-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">width =</span> <span class="fu">if_else</span>(width <span class="sc">==</span> <span class="cn">Inf</span>, <span class="fl">17.15</span> <span class="sc">-</span> start, width)) <span class="sc">%&gt;%</span> </span>
<span id="cb1461-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">H[na](t)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">cumsum</span>(<span class="st">`</span><span class="at">h[km](t)</span><span class="st">`</span> <span class="sc">*</span> width),</span>
<span id="cb1461-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">H[ls](t)</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span> <span class="fu">log</span>(<span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1461-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seconds, <span class="st">`</span><span class="at">H[na](t)</span><span class="st">`</span>, <span class="st">`</span><span class="at">H[ls](t)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1461-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">seconds    =</span> <span class="fl">17.15</span>, </span>
<span id="cb1461-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-15" aria-hidden="true" tabindex="-1"></a>                   <span class="st">`</span><span class="at">H[na](t)</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">2.78499694</span>, </span>
<span id="cb1461-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">`</span><span class="at">H[ls](t)</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">3.15764982</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1461-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a line index</span></span>
<span id="cb1461-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">line =</span> <span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">21</span>, <span class="dv">7</span>, <span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1461-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1461-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1461-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> seconds)) <span class="sc">+</span></span>
<span id="cb1461-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">H[ls](t)</span><span class="st">`</span>),</span>
<span id="cb1461-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb1461-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">H[na](t)</span><span class="st">`</span>),</span>
<span id="cb1461-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1461-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb1461-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb1461-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb1461-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;time&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1461-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(H)(<span class="fu">italic</span>(t[j])))), </span>
<span id="cb1461-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">3.5</span>, <span class="at">by =</span> .<span class="dv">5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">3.5</span>)) <span class="sc">+</span></span>
<span id="cb1461-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1461-33"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1461-34"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-34" aria-hidden="true" tabindex="-1"></a><span class="co"># bottom plot</span></span>
<span id="cb1461-35"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-35" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> </span>
<span id="cb1461-36"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-36" aria-hidden="true" tabindex="-1"></a>  p1 <span class="sc">+</span></span>
<span id="cb1461-37"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(line <span class="sc">!=</span> <span class="st">&quot;d&quot;</span>),</span>
<span id="cb1461-38"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-38" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> (<span class="st">`</span><span class="at">H[ls](t)</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">H[na](t)</span><span class="st">`</span>) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">color =</span> line, <span class="at">fill =</span> line),</span>
<span id="cb1461-39"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb1461-40"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">begin =</span> .<span class="dv">2</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb1461-41"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">begin =</span> .<span class="dv">2</span>, <span class="at">end =</span> .<span class="dv">8</span>)</span>
<span id="cb1461-42"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1461-43"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-43" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb1461-44"><a href="describing-continuous-time-event-occurrence-data.html#cb1461-44" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))) <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Visualizing the cumulative hazard function from our Bayesian <code>fit13.3</code> is a minor extension to the approach we used for the survivor function, above. As an example, here’s our plot for <span class="math inline">\(\hat H_{- \text{LS}} (t_j)\)</span>. The biggest change in the code is the last line in the second <code>mutate()</code> statement, <code>hazard = -log(survivor)</code>.</p>
<div class="sourceCode" id="cb1462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1462-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1462-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1462-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb1462-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(honking_km, interval, seconds),</span>
<span id="cb1462-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(<span class="at">interval =</span> <span class="dv">43</span>, <span class="at">seconds =</span> <span class="fl">17.15</span>)),</span>
<span id="cb1462-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;interval&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1462-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seconds =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(seconds), <span class="dv">0</span>, seconds),</span>
<span id="cb1462-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-8" aria-hidden="true" tabindex="-1"></a>         <span class="co"># convert S to H</span></span>
<span id="cb1462-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">hazard =</span> <span class="sc">-</span><span class="fu">log</span>(survivor)) <span class="sc">%&gt;%</span> </span>
<span id="cb1462-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1462-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> seconds, <span class="at">y =</span> hazard)) <span class="sc">+</span> </span>
<span id="cb1462-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">step =</span> <span class="st">&quot;hv&quot;</span>, <span class="at">size =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">8</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb1462-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="st">&quot;CI&quot;</span>, <span class="at">start =</span> .<span class="dv">85</span>, <span class="at">end =</span> .<span class="dv">6</span>,</span>
<span id="cb1462-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;95%&quot;</span>, <span class="st">&quot;80%&quot;</span>, <span class="st">&quot;50%&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1462-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;time&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1462-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(H)[<span class="sc">-</span>LS](<span class="fu">italic</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1462-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1462-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;grey92&quot;</span>),</span>
<span id="cb1462-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">925</span>, .<span class="dv">73</span>),</span>
<span id="cb1462-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1462-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-53-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="kernel-smoothed-estimates-of-the-hazard-function" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> Kernel-smoothed estimates of the hazard function</h2>
<blockquote>
<p>The idea behind kernel smoothing is simple. At each of many distinct points in time, estimate a function’s average value by aggregating together all the point estimates available within the focal time’s temporal vicinity. Conceptually, kernel-smoothed estimates are a type of moving average. They do not identify precise values of hazard at each point in time but rather approximate values based on the estimates nearby. Even though each smoothed value only approximates the underlying true value, a plot over time can help reveal the underlying function’s shape.</p>
<p>Kernel smoothing requires a set of point estimates to smooth. For the hazard function, one way of obtaining these point estimates is by computing successive differences in the estimated cumulative hazard function from each observed even time until the next. Each difference acts as a pseudo-slope, a measure of the local rate of change in cumulative hazard during that period. Either Nelson-Aalen estimates or negative log survivor function estimates of cumulative hazard can be used. (pp. 495–496)</p>
</blockquote>
<p>Singer and Willett showed examples of this smoothing in Figure 13.5, in which they applied a smoothing algorithm to the <span class="math inline">\(H_{- \text{LS}} (t_j)\)</span> estimates. The good folks at <a href="https://stats.idre.ucla.edu/r/examples/alda/r-applied-longitudinal-data-analysis-ch-13/">IDRE</a> have already worked out the code to reproduce Singer and Willette’s smoothing algorithm. The IDRE folks called their custom function <code>smooth()</code>.</p>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1463-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-1" aria-hidden="true" tabindex="-1"></a>my_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(width, time, survive) { </span>
<span id="cb1463-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1463-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-3" aria-hidden="true" tabindex="-1"></a>  n   <span class="ot">&lt;-</span> <span class="fu">length</span>(time)</span>
<span id="cb1463-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-4" aria-hidden="true" tabindex="-1"></a>  lo  <span class="ot">&lt;-</span> time[<span class="dv">1</span>] <span class="sc">+</span> width</span>
<span id="cb1463-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-5" aria-hidden="true" tabindex="-1"></a>  hi  <span class="ot">&lt;-</span> time[n] <span class="sc">-</span> width</span>
<span id="cb1463-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-6" aria-hidden="true" tabindex="-1"></a>  npt <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1463-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-7" aria-hidden="true" tabindex="-1"></a>  inc <span class="ot">&lt;-</span> (hi <span class="sc">-</span> lo) <span class="sc">/</span> npt</span>
<span id="cb1463-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1463-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-9" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">t</span>(lo <span class="sc">+</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>npt)) <span class="sc">*</span> inc)</span>
<span id="cb1463-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1463-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-11" aria-hidden="true" tabindex="-1"></a>  slag <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, survive[<span class="dv">1</span><span class="sc">:</span>n <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb1463-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-12" aria-hidden="true" tabindex="-1"></a>  h    <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> survive <span class="sc">/</span> slag</span>
<span id="cb1463-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-13" aria-hidden="true" tabindex="-1"></a>  x1   <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rep</span>(<span class="dv">1</span>, npt)) <span class="sc">%*%</span> (<span class="fu">t</span>(time))</span>
<span id="cb1463-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-14" aria-hidden="true" tabindex="-1"></a>  x2   <span class="ot">&lt;-</span> s <span class="sc">%*%</span> <span class="fu">as.vector</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n))</span>
<span id="cb1463-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-15" aria-hidden="true" tabindex="-1"></a>  x    <span class="ot">&lt;-</span> (x1 <span class="sc">-</span> x2) <span class="sc">/</span> width</span>
<span id="cb1463-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-16" aria-hidden="true" tabindex="-1"></a>  k    <span class="ot">&lt;-</span> .<span class="dv">75</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x <span class="sc">*</span> x) <span class="sc">*</span> (<span class="fu">abs</span>(x) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb1463-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1463-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-18" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> (k <span class="sc">%*%</span> h) <span class="sc">/</span> width</span>
<span id="cb1463-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1463-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-20" aria-hidden="true" tabindex="-1"></a>  smoothed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> s, <span class="at">y =</span> lambda)</span>
<span id="cb1463-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1463-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(smoothed)</span>
<span id="cb1463-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1463-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We’ve renamed the function <code>my_smooth()</code> to avoid overwriting the already existing <code>smooth()</code> function. The code for <code>my_smooth()</code> is a mild update from the one in the link above in that it returns its results in a data frame. Let’s give it a quick whirl.</p>
<div class="sourceCode" id="cb1464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1464-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">1</span>, </span>
<span id="cb1464-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1464-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">time =</span> honking_km<span class="sc">$</span>seconds,</span>
<span id="cb1464-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1464-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">survive =</span> honking_km<span class="sc">$</span><span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1464-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1464-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 50
## Columns: 2
## $ x &lt;dbl&gt; 2.6054, 2.8008, 2.9962, 3.1916, 3.3870, 3.5824, 3.7778, 3.9732, 4.1686, 4.3640, 4.5594, …
## $ y &lt;dbl&gt; 0.32686176, 0.36745825, 0.38958042, 0.38516865, 0.37093732, 0.34810198, 0.33956166, 0.31…</code></pre>
<p>The <code>time</code> and <code>survive</code> arguments take <code>seconds</code> and <code>S(t)</code> values, respectively. The <code>width</code> argument determines over how many values we would like to smooth over on a given point. For example, <code>width = 1</code> would, for a given point on the <code>time</code> axis, aggregate over all values <span class="math inline">\(\pm1\)</span> that point. Larger <code>width</code> values result in more aggressive smoothing. Also notice <code>my_smooth()</code> returned a data frame containing 50 rows for two columns, <code>x</code> and <code>y</code>. Those columns are the coordinates for the <em>TIME</em> and smoothed hazard, respectively. Here we put <code>my_smooth()</code> to work and make our version of Figure 13.5.</p>
<div class="sourceCode" id="cb1466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1466-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1466-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xy =</span> <span class="fu">map</span>(width, <span class="sc">~</span><span class="fu">my_smooth</span>(<span class="at">width =</span> ., </span>
<span id="cb1466-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">time =</span> honking_km<span class="sc">$</span>seconds, </span>
<span id="cb1466-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">survive =</span> honking_km<span class="sc">$</span><span class="st">`</span><span class="at">S(t)</span><span class="st">`</span>)),</span>
<span id="cb1466-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="fu">str_c</span>(<span class="st">&quot;width = &quot;</span>, width)) <span class="sc">%&gt;%</span> </span>
<span id="cb1466-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(xy) <span class="sc">%&gt;%</span> </span>
<span id="cb1466-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1466-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1466-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1466-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;seconds after light turns green&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1466-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;smoothed hazard&quot;</span>) <span class="sc">+</span></span>
<span id="cb1466-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1466-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1466-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>width, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-56-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="developing-an-intuition-about-continuous-time-survivor-cumulative-hazard-and-kernel-smoothed-hazard-functions" class="section level2" number="13.6">
<h2><span class="header-section-number">13.6</span> Developing an intuition about continuous-time survivor, cumulative hazard, and kernel-smoothed hazard functions</h2>
<p>Buckle up and load the relapse data from Cooney and colleagues <span class="citation">(<a href="references.html#ref-cooney1991MatchingAlcoholics" role="doc-biblioref">1991</a>)</span>; the US Supreme Court tenure data from Zorn and van Winkle <span class="citation">(<a href="references.html#ref-zorn2000CompetingRisks" role="doc-biblioref">2000</a>)</span>; the first depressive episode data from Sorenson, Rutter, and Aneshensel <span class="citation">(<a href="references.html#ref-sorenson1991DepressionInTheComunity" role="doc-biblioref">1991</a>)</span>; and the health-workers employment data from Singer and colleagues <span class="citation">(<a href="references.html#ref-singer1998PhysicianRetention" role="doc-biblioref">1998</a>)</span>.</p>
<div class="sourceCode" id="cb1467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1467-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1467-1" aria-hidden="true" tabindex="-1"></a>alcohol_relapse  <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/alcohol_relapse.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">rename_all</span>(str_to_lower)</span>
<span id="cb1467-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1467-2" aria-hidden="true" tabindex="-1"></a>judges           <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/judges.csv&quot;</span>)</span>
<span id="cb1467-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1467-3" aria-hidden="true" tabindex="-1"></a>first_depression <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/firstdepression.csv&quot;</span>)</span>
<span id="cb1467-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1467-4" aria-hidden="true" tabindex="-1"></a>health_workers   <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/healthworkers.csv&quot;</span>)</span>
<span id="cb1467-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1467-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1467-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1467-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(alcohol_relapse)</span></code></pre></div>
<pre><code>## Rows: 89
## Columns: 3
## $ weeks  &lt;dbl&gt; 0.7142857, 0.7142857, 1.1428571, 1.4285714, 1.7142857, 1.7142857, 2.1428571, 2.7142…
## $ censor &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ id     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, …</code></pre>
<div class="sourceCode" id="cb1469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1469-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1469-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(judges)</span></code></pre></div>
<pre><code>## Rows: 109
## Columns: 7
## $ id     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, …
## $ tenure &lt;dbl&gt; 1, 6, 6, 9, 21, 9, 1, 13, 4, 15, 31, 4, 34, 30, 16, 19, 23, 34, 20, 2, 32, 14, 32, …
## $ dead   &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ retire &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ leave  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ age    &lt;dbl&gt; 50, 57, 44, 47, 57, 38, 59, 47, 51, 55, 36, 44, 45, 32, 49, 42, 58, 32, 55, 49, 44,…
## $ year   &lt;dbl&gt; 1789, 1789, 1789, 1789, 1789, 1790, 1791, 1793, 1796, 1796, 1798, 1799, 1801, 1804,…</code></pre>
<div class="sourceCode" id="cb1471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1471-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(first_depression)</span></code></pre></div>
<pre><code>## Rows: 2,974
## Columns: 3
## $ id     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, …
## $ age    &lt;dbl&gt; 4, 6, 8, 8, 9, 9, 10, 10, 11, 12, 12, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 1…
## $ censor &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</code></pre>
<div class="sourceCode" id="cb1473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1473-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1473-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(health_workers)</span></code></pre></div>
<pre><code>## Rows: 2,074
## Columns: 3
## $ id     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, …
## $ weeks  &lt;dbl&gt; 0.14, 0.42, 1.00, 1.28, 1.28, 1.71, 1.85, 1.85, 1.85, 2.00, 2.14, 2.14, 2.14, 2.28,…
## $ censor &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1,…</code></pre>
<p>For our first go, just fit the models with <code>survfit()</code>.</p>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1475-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-1" aria-hidden="true" tabindex="-1"></a> fit13<span class="fl">.4</span> <span class="ot">&lt;-</span></span>
<span id="cb1475-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survfit</span>(<span class="at">data =</span> alcohol_relapse,</span>
<span id="cb1475-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">Surv</span>(weeks, <span class="fu">abs</span>(censor <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb1475-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1475-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-5" aria-hidden="true" tabindex="-1"></a> fit13<span class="fl">.5</span> <span class="ot">&lt;-</span></span>
<span id="cb1475-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survfit</span>(<span class="at">data =</span> judges,</span>
<span id="cb1475-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">Surv</span>(tenure, leave) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb1475-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1475-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-9" aria-hidden="true" tabindex="-1"></a> fit13<span class="fl">.6</span> <span class="ot">&lt;-</span></span>
<span id="cb1475-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survfit</span>(<span class="at">data =</span> first_depression,</span>
<span id="cb1475-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">Surv</span>(age, <span class="fu">abs</span>(censor <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb1475-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1475-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-13" aria-hidden="true" tabindex="-1"></a> fit13<span class="fl">.7</span> <span class="ot">&lt;-</span></span>
<span id="cb1475-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survfit</span>(<span class="at">data =</span> health_workers,</span>
<span id="cb1475-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1475-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">Surv</span>(weeks, <span class="fu">abs</span>(censor <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">~</span> <span class="dv">1</span>)</span></code></pre></div>
<p>With the model from Section 13.3, we organized the Kaplan-Meier output in a tibble following the outline of Table 13.3 (p. 484). That layout was useful for plotting the frequentist results and for fitting the Bayesian version of the model with <strong>brms</strong>. Since we’re juggling four models, let’s make a convenience function to do that with a single line of code. Call it <code>km_tibble()</code>.</p>
<div class="sourceCode" id="cb1476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1476-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-1" aria-hidden="true" tabindex="-1"></a>km_tibble <span class="ot">&lt;-</span> <span class="cf">function</span>(surv_fit) {</span>
<span id="cb1476-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1476-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-3" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">summary</span>(surv_fit)</span>
<span id="cb1476-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1476-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-5" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> <span class="fu">length</span>(t<span class="sc">$</span>time)</span>
<span id="cb1476-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1476-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-7" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span></span>
<span id="cb1476-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">time     =</span> <span class="fu">c</span>(<span class="dv">0</span>, t<span class="sc">$</span>time),</span>
<span id="cb1476-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_risk   =</span> <span class="fu">c</span>(t<span class="sc">$</span>n.risk[<span class="dv">1</span>], t<span class="sc">$</span>n.risk),</span>
<span id="cb1476-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_events =</span> <span class="fu">c</span>(<span class="dv">0</span>, t<span class="sc">$</span>n.event)) <span class="sc">%&gt;%</span> </span>
<span id="cb1476-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">p        =</span> n_events <span class="sc">/</span> n_risk,</span>
<span id="cb1476-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_censored =</span> n_risk <span class="sc">-</span> n_events <span class="sc">-</span> <span class="fu">lead</span>(n_risk, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb1476-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">interval   =</span> <span class="dv">0</span><span class="sc">:</span>length,</span>
<span id="cb1476-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">interval_f =</span> <span class="fu">factor</span>(<span class="dv">0</span><span class="sc">:</span>length, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">c</span>(length <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1476-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(interval<span class="sc">:</span>interval_f, time, n_risk<span class="sc">:</span>n_events, n_censored, p) <span class="sc">%&gt;%</span> </span>
<span id="cb1476-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">S =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> p)) <span class="sc">%&gt;%</span> </span>
<span id="cb1476-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">H =</span> <span class="fu">ifelse</span>(interval <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, </span>
<span id="cb1476-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-18" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(S <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>,</span>
<span id="cb1476-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-19" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">-</span><span class="fu">log</span>(S))),</span>
<span id="cb1476-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">p =</span> <span class="fu">ifelse</span>(interval <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, p))</span>
<span id="cb1476-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1476-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-22" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span></span>
<span id="cb1476-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb1476-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-24" aria-hidden="true" tabindex="-1"></a>      d, </span>
<span id="cb1476-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-25" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">%&gt;%</span> </span>
<span id="cb1476-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1476-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">interval   =</span> length <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb1476-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">interval_f =</span> <span class="fu">factor</span>(length <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb1476-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-29" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">c</span>(length <span class="sc">+</span> <span class="dv">1</span>)),</span>
<span id="cb1476-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">time       =</span> surv_fit<span class="sc">$</span>time <span class="sc">%&gt;%</span> <span class="fu">max</span>()))</span>
<span id="cb1476-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1476-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(d)</span>
<span id="cb1476-33"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1476-34"><a href="describing-continuous-time-event-occurrence-data.html#cb1476-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here’s an example of our custom <code>km_tibble()</code> function works based on our earlier model of the <code>honking</code> data, <code>fit13.2</code>.</p>
<div class="sourceCode" id="cb1477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1477-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1477-1" aria-hidden="true" tabindex="-1"></a><span class="fu">km_tibble</span>(fit13<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 44 x 9
##    interval interval_f  time n_risk n_events n_censored       p     S       H
##       &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1        0 0           0        57        0          0 NA      1     NA     
##  2        1 1           1.41     57        1          1  0.0175 0.982  0.0177
##  3        2 2           1.51     55        1          0  0.0182 0.965  0.0360
##  4        3 3           1.67     54        1          0  0.0185 0.947  0.0547
##  5        4 4           1.68     53        1          0  0.0189 0.929  0.0738
##  6        5 5           1.86     52        1          0  0.0192 0.911  0.0932
##  7        6 6           2.12     51        1          0  0.0196 0.893  0.113 
##  8        7 7           2.19     50        1          1  0.02   0.875  0.133 
##  9        8 8           2.48     48        1          0  0.0208 0.857  0.154 
## 10        9 9           2.5      47        1          0  0.0213 0.839  0.176 
## # … with 34 more rows</code></pre>
<p>Now apply <code>km_tibble()</code> to our four new fits.</p>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1479-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1479-1" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span></span>
<span id="cb1479-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1479-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">ml_fit =</span> <span class="fu">str_c</span>(<span class="st">&quot;fit13.&quot;</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1479-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">map</span>(ml_fit, <span class="sc">~</span><span class="fu">get</span>(.) <span class="sc">%&gt;%</span> <span class="fu">km_tibble</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1479-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(d)</span></code></pre></div>
<p>If we want the settings in our <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-axes to differ across subplots, good old <code>facet_wrap()</code> and <code>facet_grid()</code> aren’t going to cut it for our version of Figure 13.6. To avoid needless repetition in the settings across subplot code, we’ll make a few custom geoms.</p>
<div class="sourceCode" id="cb1480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1480-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-1" aria-hidden="true" tabindex="-1"></a>geom_S <span class="ot">&lt;-</span> <span class="cf">function</span>(x_ul, <span class="at">y_lab =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb1480-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1480-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1480-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb1480-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_step</span>(...),</span>
<span id="cb1480-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, x_ul)),</span>
<span id="cb1480-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(y_lab, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb1480-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1480-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1480-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1480-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-12" aria-hidden="true" tabindex="-1"></a>geom_H <span class="ot">&lt;-</span> <span class="cf">function</span>(x_ul, <span class="at">y_lab =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb1480-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1480-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1480-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_step</span>(...),</span>
<span id="cb1480-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, x_ul)),</span>
<span id="cb1480-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(y_lab, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))</span>
<span id="cb1480-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1480-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1480-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1480-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-22" aria-hidden="true" tabindex="-1"></a>geom_h <span class="ot">&lt;-</span> <span class="cf">function</span>(x_lab, x_ul, <span class="at">y_lab =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb1480-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1480-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1480-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(...),</span>
<span id="cb1480-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(x_lab, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, x_ul)),</span>
<span id="cb1480-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(y_lab, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))</span>
<span id="cb1480-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1480-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1480-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1480-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Use <code>geom_S()</code> to make and save the top row, the <span class="math inline">\(\widehat{S (t_j)}\)</span> plots.</p>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1481-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1481-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-2" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1481-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.4&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1481-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">110</span>, <span class="at">y_lab =</span> <span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1481-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Cooney et al (1991)&quot;</span>)</span>
<span id="cb1481-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1481-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-9" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1481-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.5&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1481-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">36</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1481-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Zorn &amp;  Van Winkle (2000)&quot;</span>)</span>
<span id="cb1481-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb1481-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-16" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1481-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.6&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1481-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">102</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1481-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Sorenson et al (1991)&quot;</span>)</span>
<span id="cb1481-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-22" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb1481-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-23" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1481-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.7&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1481-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">150</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1481-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1481-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Singer et al (1998)&quot;</span>)</span></code></pre></div>
<p>Use <code>geom_H()</code> to make and save the middle row, the <span class="math inline">\(\widehat{H (t_j)}\)</span> plots.</p>
<div class="sourceCode" id="cb1482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1482-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-1" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span></span>
<span id="cb1482-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-2" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1482-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.4&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1482-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1482-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">110</span>, <span class="at">y_lab =</span> <span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">H</span>(t[j])))))</span>
<span id="cb1482-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1482-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-7" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span></span>
<span id="cb1482-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-8" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1482-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.5&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1482-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1482-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">36</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1482-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1482-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-13" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span></span>
<span id="cb1482-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-14" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1482-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.6&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1482-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1482-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">102</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1482-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1482-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-19" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span></span>
<span id="cb1482-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-20" aria-hidden="true" tabindex="-1"></a>  km <span class="sc">%&gt;%</span> </span>
<span id="cb1482-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.7&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1482-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1482-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1482-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">150</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>Use <code>geom_h()</code> to make and save the bottom row, the <span class="math inline">\(\widehat{h (t_j)}\)</span> plots.</p>
<div class="sourceCode" id="cb1483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1483-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-1" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span></span>
<span id="cb1483-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">time =</span> fit13<span class="fl">.4</span><span class="sc">$</span>time, <span class="at">survive =</span> fit13<span class="fl">.4</span><span class="sc">$</span>surv) <span class="sc">%&gt;%</span> </span>
<span id="cb1483-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1483-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;weeks after discharge&quot;</span>, <span class="at">x_ul =</span> <span class="dv">110</span>, <span class="at">y_lab =</span> <span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">h</span>(t[j])))))</span>
<span id="cb1483-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1483-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-6" aria-hidden="true" tabindex="-1"></a>p10 <span class="ot">&lt;-</span></span>
<span id="cb1483-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">5</span>, <span class="at">time =</span> fit13<span class="fl">.5</span><span class="sc">$</span>time, <span class="at">survive =</span> fit13<span class="fl">.5</span><span class="sc">$</span>surv) <span class="sc">%&gt;%</span> </span>
<span id="cb1483-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1483-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;years on court&quot;</span>, <span class="at">x_ul =</span> <span class="dv">36</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1483-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1483-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-11" aria-hidden="true" tabindex="-1"></a>p11 <span class="ot">&lt;-</span></span>
<span id="cb1483-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">7</span>, <span class="at">time =</span> fit13<span class="fl">.6</span><span class="sc">$</span>time, <span class="at">survive =</span> fit13<span class="fl">.6</span><span class="sc">$</span>surv) <span class="sc">%&gt;%</span> </span>
<span id="cb1483-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1483-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;age (in years)&quot;</span>, <span class="at">x_ul =</span> <span class="dv">102</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1483-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1483-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-16" aria-hidden="true" tabindex="-1"></a>p12 <span class="ot">&lt;-</span></span>
<span id="cb1483-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">time =</span> fit13<span class="fl">.7</span><span class="sc">$</span>time, <span class="at">survive =</span> fit13<span class="fl">.7</span><span class="sc">$</span>surv) <span class="sc">%&gt;%</span> </span>
<span id="cb1483-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1483-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1483-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;weeks since hired&quot;</span>, <span class="at">x_ul =</span> <span class="dv">150</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>Finally, combine the subplots and behold our version of Figure 13.6!</p>
<div class="sourceCode" id="cb1484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1484-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1484-1" aria-hidden="true" tabindex="-1"></a>((p1 <span class="sc">/</span> p5 <span class="sc">/</span> p9) <span class="sc">|</span> (p2 <span class="sc">/</span> p6 <span class="sc">/</span> p10) <span class="sc">|</span> (p3 <span class="sc">/</span> p7 <span class="sc">/</span> p11) <span class="sc">|</span> (p4 <span class="sc">/</span> p8 <span class="sc">/</span> p12)) <span class="sc">&amp;</span></span>
<span id="cb1484-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1484-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-66-1.png" width="960" style="display: block; margin: auto;" /></p>
<div id="bonus-bayesians-can-compare-continuous-time-survivor-cumulative-hazard-and-kernel-smoothed-hazard-functions-too." class="section level3" number="13.6.1">
<h3><span class="header-section-number">13.6.1</span> Bonus: Bayesians can compare continuous-time survivor, cumulative hazard, and kernel-smoothed hazard functions, too.</h3>
<p>Now let’s repeat that process as Bayesians. Here we fit those last four models with <code>brm()</code>. Note the <code>data</code> statements. Filtering by <code>ml_fit</code> allowed us to select the correct subset of data saved in <code>km</code>. The two filtering statements by <code>interval</code> allowed us to focus on the actual data instead of including the two rows we added for plotting conveniences. Otherwise the <code>brm()</code> code is just like what we used before.</p>
<div class="sourceCode" id="cb1485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1485-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-1" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.8</span> <span class="ot">&lt;-</span></span>
<span id="cb1485-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">filter</span>(km, ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.4&quot;</span> <span class="sc">&amp;</span> interval <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> interval <span class="sc">&lt;</span> <span class="dv">61</span>),</span>
<span id="cb1485-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1485-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-4" aria-hidden="true" tabindex="-1"></a>      n_events <span class="sc">|</span> <span class="fu">trials</span>(n_risk) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> interval_f,</span>
<span id="cb1485-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">3</span>), <span class="at">class =</span> b),</span>
<span id="cb1485-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1485-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb1485-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit13.08&quot;</span>)</span>
<span id="cb1485-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1485-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-10" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.9</span> <span class="ot">&lt;-</span></span>
<span id="cb1485-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">filter</span>(km, ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.5&quot;</span> <span class="sc">&amp;</span> interval <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> interval <span class="sc">&lt;</span> <span class="dv">34</span>),</span>
<span id="cb1485-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1485-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-13" aria-hidden="true" tabindex="-1"></a>      n_events <span class="sc">|</span> <span class="fu">trials</span>(n_risk) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> interval_f,</span>
<span id="cb1485-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">3</span>), <span class="at">class =</span> b),</span>
<span id="cb1485-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1485-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb1485-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit13.09&quot;</span>)</span>
<span id="cb1485-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1485-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-19" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.10</span> <span class="ot">&lt;-</span></span>
<span id="cb1485-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">filter</span>(km, ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.6&quot;</span> <span class="sc">&amp;</span> interval <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> interval <span class="sc">&lt;</span> <span class="dv">44</span>),</span>
<span id="cb1485-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1485-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-22" aria-hidden="true" tabindex="-1"></a>      n_events <span class="sc">|</span> <span class="fu">trials</span>(n_risk) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> interval_f,</span>
<span id="cb1485-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">3</span>), <span class="at">class =</span> b),</span>
<span id="cb1485-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1485-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb1485-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit13.10&quot;</span>)</span>
<span id="cb1485-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1485-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-28" aria-hidden="true" tabindex="-1"></a>fit13<span class="fl">.11</span> <span class="ot">&lt;-</span></span>
<span id="cb1485-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">filter</span>(km, ml_fit <span class="sc">==</span> <span class="st">&quot;fit13.7&quot;</span> <span class="sc">&amp;</span> interval <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> interval <span class="sc">&lt;</span> <span class="dv">306</span>),</span>
<span id="cb1485-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1485-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-31" aria-hidden="true" tabindex="-1"></a>      n_events <span class="sc">|</span> <span class="fu">trials</span>(n_risk) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> interval_f,</span>
<span id="cb1485-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">3</span>), <span class="at">class =</span> b),</span>
<span id="cb1485-33"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1485-34"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb1485-35"><a href="describing-continuous-time-event-occurrence-data.html#cb1485-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit13.11&quot;</span>)</span></code></pre></div>
<p>For the sake of space, I’m not going to show all the summary output. If you’re following along, I still recommend you give them a look. Spoiler alert: the parameter diagnostics look great.</p>
<div class="sourceCode" id="cb1486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1486-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit13<span class="fl">.8</span>)</span>
<span id="cb1486-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1486-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit13<span class="fl">.9</span>)</span>
<span id="cb1486-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1486-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit13<span class="fl">.10</span>)</span>
<span id="cb1486-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1486-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit13<span class="fl">.11</span>)</span></code></pre></div>
<p>Since we’re working with four <code>brm()</code> fits, it might make sense to bundle the steps and keep the results in one place. Here we make something of a super function. With <code>wrangle_samples()</code>, we’ll extract the posterior draws from each model; add a couple interval columns; convert the results to the <span class="math inline">\(\widehat{p (t_j)}\)</span>, <span class="math inline">\(\widehat{S (t_j)}\)</span>, and <span class="math inline">\(\widehat{H (t_j)}\)</span> metrics; and join the results to the data stored in <code>km</code>. If the steps seem overwhelming, just flip back to the ends of Sections 13.3 and 13.4. This is a small extension of the data wrangling steps we took to make the <span class="math inline">\(\widehat{S (t_j)}\)</span> and <span class="math inline">\(\widehat{H (t_j)}\)</span> plots for our <strong>brms</strong> model <code>fit13.3</code>.</p>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1487-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-1" aria-hidden="true" tabindex="-1"></a>wrangle_samples <span class="ot">&lt;-</span> <span class="cf">function</span>(brms, survfit) {</span>
<span id="cb1487-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1487-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the samples</span></span>
<span id="cb1487-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-4" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span></span>
<span id="cb1487-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(brms) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_samples</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1487-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>lp__)</span>
<span id="cb1487-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1487-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># how many columns?</span></span>
<span id="cb1487-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-10" aria-hidden="true" tabindex="-1"></a>  n_col <span class="ot">&lt;-</span> <span class="fu">ncol</span>(post)  </span>
<span id="cb1487-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1487-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform to the p metric, add a 0 interval, make it long, and add S</span></span>
<span id="cb1487-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-13" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> </span>
<span id="cb1487-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-14" aria-hidden="true" tabindex="-1"></a>    post <span class="sc">%&gt;%</span> </span>
<span id="cb1487-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span>n_col) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_all</span>(inv_logit_scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter,</span>
<span id="cb1487-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;interval&quot;</span>,</span>
<span id="cb1487-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">interval =</span> interval <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(interval) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">S =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> p)) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1487-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">H =</span> <span class="sc">-</span><span class="fu">log</span>(S))</span>
<span id="cb1487-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1487-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the final interval, join the data, and return()</span></span>
<span id="cb1487-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(post,</span>
<span id="cb1487-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-31" aria-hidden="true" tabindex="-1"></a>            post <span class="sc">%&gt;%</span> <span class="fu">filter</span>(interval <span class="sc">==</span> n_col) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">interval =</span> n_col <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(km <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ml_fit <span class="sc">==</span> survfit) <span class="sc">%&gt;%</span> <span class="fu">select</span>(interval<span class="sc">:</span>n_censored),</span>
<span id="cb1487-33"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="st">&quot;interval&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-34"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>()</span>
<span id="cb1487-35"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1487-36"><a href="describing-continuous-time-event-occurrence-data.html#cb1487-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Our <code>wrangle_samples()</code> function takes two arguments, <code>brms</code> and <code>survfit</code>, which indicate the desired <strong>brms</strong> model and the corresponding index within <code>km</code> that contains the associated survival data. Let’s put it to work.</p>
<div class="sourceCode" id="cb1488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1488-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1488-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span></span>
<span id="cb1488-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1488-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">brms    =</span> <span class="fu">str_c</span>(<span class="st">&quot;fit13.&quot;</span>, <span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>),</span>
<span id="cb1488-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1488-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">survfit =</span> <span class="fu">str_c</span>(<span class="st">&quot;fit13.&quot;</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1488-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1488-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> <span class="fu">map2</span>(brms, survfit, wrangle_samples)) <span class="sc">%&gt;%</span> </span>
<span id="cb1488-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1488-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post)</span>
<span id="cb1488-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1488-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1488-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1488-7" aria-hidden="true" tabindex="-1"></a>post</span></code></pre></div>
<pre><code>## # A tibble: 1,796,000 x 12
##    brms    survfit  iter interval     p     S     H interval_f  time n_risk n_events n_censored
##    &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1 fit13.8 fit13.4     1        0     0     1     0 0              0     89        0          0
##  2 fit13.8 fit13.4     2        0     0     1     0 0              0     89        0          0
##  3 fit13.8 fit13.4     3        0     0     1     0 0              0     89        0          0
##  4 fit13.8 fit13.4     4        0     0     1     0 0              0     89        0          0
##  5 fit13.8 fit13.4     5        0     0     1     0 0              0     89        0          0
##  6 fit13.8 fit13.4     6        0     0     1     0 0              0     89        0          0
##  7 fit13.8 fit13.4     7        0     0     1     0 0              0     89        0          0
##  8 fit13.8 fit13.4     8        0     0     1     0 0              0     89        0          0
##  9 fit13.8 fit13.4     9        0     0     1     0 0              0     89        0          0
## 10 fit13.8 fit13.4    10        0     0     1     0 0              0     89        0          0
## # … with 1,795,990 more rows</code></pre>
<p>Like before, we have 12 subplots to make and we can reduce redundancies in the code by working with custom geoms. To accommodate our Bayesian fits, we’ll redefine <code>geom_S()</code> and <code>geom_H()</code> to depict the step functions with <code>tidybayes::stat_lineribbon()</code>. Happily, our <code>geom_h()</code> is good to go as is.</p>
<div class="sourceCode" id="cb1490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1490-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-1" aria-hidden="true" tabindex="-1"></a>geom_S <span class="ot">&lt;-</span> <span class="cf">function</span>(x_ul, <span class="at">y_lab =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb1490-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1490-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1490-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb1490-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_lineribbon</span>(<span class="at">step =</span> <span class="st">&quot;hv&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>),</span>
<span id="cb1490-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">show.legend =</span> F, ...),</span>
<span id="cb1490-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> .<span class="dv">8</span>, <span class="at">end =</span> .<span class="dv">6</span>),</span>
<span id="cb1490-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, x_ul)),</span>
<span id="cb1490-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(y_lab, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb1490-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1490-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1490-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1490-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1490-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-14" aria-hidden="true" tabindex="-1"></a>geom_H <span class="ot">&lt;-</span> <span class="cf">function</span>(x_ul, <span class="at">y_lab =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb1490-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1490-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1490-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_lineribbon</span>(<span class="at">step =</span> <span class="st">&quot;hv&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>),</span>
<span id="cb1490-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">show.legend =</span> F, ...),</span>
<span id="cb1490-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> .<span class="dv">8</span>, <span class="at">end =</span> .<span class="dv">6</span>),</span>
<span id="cb1490-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, x_ul)),</span>
<span id="cb1490-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(y_lab, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))</span>
<span id="cb1490-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1490-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1490-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1490-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Make and save the subplots.</p>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1491-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use `geom_S()` to make and save the top row</span></span>
<span id="cb1491-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1491-3"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-3" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-4"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.8&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-5"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1491-6"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">110</span>, <span class="at">y_lab =</span> <span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb1491-7"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Cooney et al (1991)&quot;</span>)</span>
<span id="cb1491-8"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-9"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1491-10"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-10" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-11"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.9&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-12"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1491-13"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">36</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1491-14"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Zorn &amp;  Van Winkle (2000)&quot;</span>)</span>
<span id="cb1491-15"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-16"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-16" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb1491-17"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-17" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-18"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.10&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-19"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1491-20"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">102</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1491-21"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Sorenson et al (1991)&quot;</span>)</span>
<span id="cb1491-22"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-23"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-23" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb1491-24"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-24" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-25"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.11&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-26"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> S)) <span class="sc">+</span></span>
<span id="cb1491-27"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_S</span>(<span class="at">x_ul =</span> <span class="dv">150</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1491-28"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Singer et al (1998)&quot;</span>)</span>
<span id="cb1491-29"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1491-30"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-30" aria-hidden="true" tabindex="-1"></a><span class="co"># use `geom_H()` to make and save the middle row</span></span>
<span id="cb1491-31"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-31" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span></span>
<span id="cb1491-32"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-32" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-33"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.8&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-34"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1491-35"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">110</span>, <span class="at">y_lab =</span> <span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">H</span>(t[j])))))</span>
<span id="cb1491-36"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-37"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-37" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span></span>
<span id="cb1491-38"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-38" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-39"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.9&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-40"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1491-41"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">36</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1491-42"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-43"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-43" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span></span>
<span id="cb1491-44"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-44" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-45"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.10&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-46"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1491-47"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">102</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1491-48"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-49"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-49" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span></span>
<span id="cb1491-50"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-50" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-51"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.11&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-52"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> H)) <span class="sc">+</span></span>
<span id="cb1491-53"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_H</span>(<span class="at">x_ul =</span> <span class="dv">150</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1491-54"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1491-55"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-55" aria-hidden="true" tabindex="-1"></a><span class="co"># use `geom_h()` to make and save the bottom row</span></span>
<span id="cb1491-56"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-56" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span></span>
<span id="cb1491-57"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-57" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-58"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.8&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-59"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval, time) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-60"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median =</span> <span class="fu">median</span>(S)) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-61"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-62"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smooth =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">time =</span> .<span class="sc">$</span>time, <span class="at">survive =</span> .<span class="sc">$</span>median))) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-63"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(smooth) <span class="sc">%&gt;%</span></span>
<span id="cb1491-64"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1491-65"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;weeks after discharge&quot;</span>, <span class="at">x_ul =</span> <span class="dv">110</span>, <span class="at">y_lab =</span> <span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">h</span>(t[j])))))</span>
<span id="cb1491-66"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-67"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-67" aria-hidden="true" tabindex="-1"></a>p10 <span class="ot">&lt;-</span></span>
<span id="cb1491-68"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-68" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-69"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.9&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-70"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval, time) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-71"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median =</span> <span class="fu">median</span>(S)) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-72"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-73"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smooth =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">time =</span> .<span class="sc">$</span>time, <span class="at">survive =</span> .<span class="sc">$</span>median))) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-74"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(smooth) <span class="sc">%&gt;%</span></span>
<span id="cb1491-75"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1491-76"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;years on court&quot;</span>, <span class="at">x_ul =</span> <span class="dv">36</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1491-77"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-78"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-78" aria-hidden="true" tabindex="-1"></a>p11 <span class="ot">&lt;-</span></span>
<span id="cb1491-79"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-79" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-80"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.10&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-81"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval, time) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-82"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median =</span> <span class="fu">median</span>(S)) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-83"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-84"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smooth =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">time =</span> .<span class="sc">$</span>time, <span class="at">survive =</span> .<span class="sc">$</span>median))) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-85"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(smooth) <span class="sc">%&gt;%</span></span>
<span id="cb1491-86"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1491-87"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;age (in years)&quot;</span>, <span class="at">x_ul =</span> <span class="dv">102</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span>
<span id="cb1491-88"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-89"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-89" aria-hidden="true" tabindex="-1"></a>p12 <span class="ot">&lt;-</span></span>
<span id="cb1491-90"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-90" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1491-91"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brms <span class="sc">==</span> <span class="st">&quot;fit13.11&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-92"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval, time) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-93"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median =</span> <span class="fu">median</span>(S)) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-94"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-95"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smooth =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">my_smooth</span>(<span class="at">width =</span> <span class="dv">12</span>, <span class="at">time =</span> .<span class="sc">$</span>time, <span class="at">survive =</span> .<span class="sc">$</span>median))) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-96"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(smooth) <span class="sc">%&gt;%</span></span>
<span id="cb1491-97"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1491-98"><a href="describing-continuous-time-event-occurrence-data.html#cb1491-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_h</span>(<span class="at">x_lab =</span> <span class="st">&quot;weeks since hired&quot;</span>, <span class="at">x_ul =</span> <span class="dv">150</span>, <span class="at">y_lab =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>Finally, combine the subplots and behold our Bayesian alternative version of Figure 13.6!</p>
<div class="sourceCode" id="cb1492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1492-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1492-1" aria-hidden="true" tabindex="-1"></a>((p1 <span class="sc">/</span> p5 <span class="sc">/</span> p9) <span class="sc">|</span> (p2 <span class="sc">/</span> p6 <span class="sc">/</span> p10) <span class="sc">|</span> (p3 <span class="sc">/</span> p7 <span class="sc">/</span> p11) <span class="sc">|</span> (p4 <span class="sc">/</span> p8 <span class="sc">/</span> p12)) <span class="sc">&amp;</span></span>
<span id="cb1492-2"><a href="describing-continuous-time-event-occurrence-data.html#cb1492-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="13_files/figure-html/unnamed-chunk-72-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="session-info-12" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1493-1"><a href="describing-continuous-time-event-occurrence-data.html#cb1493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.4 (2021-02-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] survival_3.2-10 patchwork_1.1.1 tidybayes_2.3.1 brms_2.15.0     Rcpp_1.0.6      forcats_0.5.1  
##  [7] stringr_1.4.0   dplyr_1.0.5     purrr_0.3.4     readr_1.4.0     tidyr_1.1.3     tibble_3.1.0   
## [13] ggplot2_3.3.3   tidyverse_1.3.0
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1         backports_1.2.1      plyr_1.8.6           igraph_1.2.6        
##   [5] svUnit_1.0.3         splines_4.0.4        crosstalk_1.1.0.1    TH.data_1.0-10      
##   [9] rstantools_2.1.1     inline_0.3.17        digest_0.6.27        htmltools_0.5.1.1   
##  [13] rsconnect_0.8.16     fansi_0.4.2          magrittr_2.0.1       modelr_0.1.8        
##  [17] RcppParallel_5.0.2   matrixStats_0.57.0   xts_0.12.1           sandwich_3.0-0      
##  [21] prettyunits_1.1.1    colorspace_2.0-0     rvest_0.3.6          ggdist_2.4.0.9000   
##  [25] haven_2.3.1          xfun_0.22            callr_3.5.1          crayon_1.4.1        
##  [29] jsonlite_1.7.2       lme4_1.1-25          zoo_1.8-8            glue_1.4.2          
##  [33] gtable_0.3.0         emmeans_1.5.2-1      V8_3.4.0             distributional_0.2.2
##  [37] pkgbuild_1.2.0       rstan_2.21.2         abind_1.4-5          scales_1.1.1        
##  [41] mvtnorm_1.1-1        DBI_1.1.0            miniUI_0.1.1.1       viridisLite_0.3.0   
##  [45] xtable_1.8-4         stats4_4.0.4         StanHeaders_2.21.0-7 DT_0.16             
##  [49] htmlwidgets_1.5.2    httr_1.4.2           threejs_0.3.3        arrayhelpers_1.1-0  
##  [53] ellipsis_0.3.1       pkgconfig_2.0.3      loo_2.4.1            farver_2.0.3        
##  [57] dbplyr_2.0.0         utf8_1.1.4           tidyselect_1.1.0     labeling_0.4.2      
##  [61] rlang_0.4.10         reshape2_1.4.4       later_1.1.0.1        munsell_0.5.0       
##  [65] cellranger_1.1.0     tools_4.0.4          cli_2.3.1            generics_0.1.0      
##  [69] broom_0.7.5          ggridges_0.5.2       evaluate_0.14        fastmap_1.0.1       
##  [73] processx_3.4.5       knitr_1.31           fs_1.5.0             nlme_3.1-152        
##  [77] mime_0.10            projpred_2.0.2       xml2_1.3.2           compiler_4.0.4      
##  [81] bayesplot_1.8.0      shinythemes_1.1.2    rstudioapi_0.13      gamm4_0.2-6         
##  [85] curl_4.3             reprex_0.3.0         statmod_1.4.35       stringi_1.5.3       
##  [89] highr_0.8            ps_1.6.0             Brobdingnag_1.2-6    lattice_0.20-41     
##  [93] Matrix_1.3-2         nloptr_1.2.2.2       markdown_1.1         shinyjs_2.0.0       
##  [97] vctrs_0.3.6          pillar_1.5.1         lifecycle_1.0.0      bridgesampling_1.0-0
## [101] estimability_1.3     httpuv_1.5.4         R6_2.5.0             bookdown_0.21       
## [105] promises_1.1.1       gridExtra_2.3        codetools_0.2-18     boot_1.3-26         
## [109] colourpicker_1.1.0   MASS_7.3-53          gtools_3.8.2         assertthat_0.2.1    
## [113] withr_2.4.1          shinystan_2.5.0      multcomp_1.4-16      mgcv_1.8-33         
## [117] parallel_4.0.4       hms_0.5.3            grid_4.0.4           coda_0.19-4         
## [121] minqa_1.2.4          rmarkdown_2.7        shiny_1.5.0          lubridate_1.7.9.2   
## [125] base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="extending-the-discrete-time-hazard-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
