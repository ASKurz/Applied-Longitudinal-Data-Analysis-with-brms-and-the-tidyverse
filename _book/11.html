<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11&nbsp; Fitting Basic Discrete-Time Hazard Models – *Applied longitudinal data analysis* in brms and the tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12.html" rel="next">
<link href="./10.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7d082c015fa132ca880f975003d7bf2f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="site_libs/tabwid-1.1.3/tabwid.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="11&nbsp; Fitting Basic Discrete-Time Hazard Models – Applied longitudinal data analysis in brms and the tidyverse">
<meta property="og:description" content="">
<meta property="og:image" content="https://solomon.quarto.pub/alda/11_files/figure-html/unnamed-chunk-11-1.png">
<meta property="og:site_name" content="*Applied longitudinal data analysis* in brms and the tidyverse">
<meta property="og:image:height" content="998">
<meta property="og:image:width" content="1152">
</head>

<body class="nav-sidebar floating slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fitting Basic Discrete-Time Hazard Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"><em>Applied longitudinal data analysis</em> in brms and the tidyverse</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What and why</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">A Framework for Investigating Change over Time</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploring Longitudinal Data on Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introducing the Multilevel Model for Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Doing Data Analysis with the Multilevel Model for Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Treating Time More Flexibly</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modeling Discontinuous and Nonlinear Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Examining the Multilevel Model’s Error Covariance Structure</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Change Using Covariance Structure Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">A Framework for Investigating Event Occurrence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Describing Discrete-Time Event Occurrence Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fitting Basic Discrete-Time Hazard Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Extending the Discrete-Time Hazard Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Describing Continuous-Time Event Occurrence Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#toward-a-statistical-model-for-discrete-time-hazard" id="toc-toward-a-statistical-model-for-discrete-time-hazard" class="nav-link active" data-scroll-target="#toward-a-statistical-model-for-discrete-time-hazard"><span class="header-section-number">11.1</span> Toward a statistical model for discrete-time hazard</a>
  <ul>
  <li><a href="#plots-of-within-group-hazard-functions-and-survivor-functions" id="toc-plots-of-within-group-hazard-functions-and-survivor-functions" class="nav-link" data-scroll-target="#plots-of-within-group-hazard-functions-and-survivor-functions"><span class="header-section-number">11.1.1</span> Plots of within-group hazard functions and survivor functions</a></li>
  <li><a href="#what-kind-of-statistical-model-do-these-graphs-suggest" id="toc-what-kind-of-statistical-model-do-these-graphs-suggest" class="nav-link" data-scroll-target="#what-kind-of-statistical-model-do-these-graphs-suggest"><span class="header-section-number">11.1.2</span> What kind of statistical model do these graphs suggest?</a>
  <ul>
  <li><a href="#the-bounded-nature-of-hazard" id="toc-the-bounded-nature-of-hazard" class="nav-link" data-scroll-target="#the-bounded-nature-of-hazard"><span class="header-section-number">11.1.2.1</span> The bounded nature of hazard</a></li>
  <li><a href="#what-statistical-model-could-have-generated-these-sample-data" id="toc-what-statistical-model-could-have-generated-these-sample-data" class="nav-link" data-scroll-target="#what-statistical-model-could-have-generated-these-sample-data"><span class="header-section-number">11.1.2.2</span> What statistical model could have generated these sample data?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#formal-representation-of-the-population-discrete-time-hazard-model" id="toc-formal-representation-of-the-population-discrete-time-hazard-model" class="nav-link" data-scroll-target="#formal-representation-of-the-population-discrete-time-hazard-model"><span class="header-section-number">11.2</span> Formal representation of the population discrete-time hazard model</a>
  <ul>
  <li><a href="#what-do-the-parameters-represent" id="toc-what-do-the-parameters-represent" class="nav-link" data-scroll-target="#what-do-the-parameters-represent"><span class="header-section-number">11.2.1</span> What do the parameters represent?</a></li>
  <li><a href="#an-alternative-representation-of-the-model" id="toc-an-alternative-representation-of-the-model" class="nav-link" data-scroll-target="#an-alternative-representation-of-the-model"><span class="header-section-number">11.2.2</span> An alternative representation of the model</a></li>
  </ul></li>
  <li><a href="#fitting-a-discrete-time-hazard-model-to-data" id="toc-fitting-a-discrete-time-hazard-model-to-data" class="nav-link" data-scroll-target="#fitting-a-discrete-time-hazard-model-to-data"><span class="header-section-number">11.3</span> Fitting a discrete-time hazard model to data</a>
  <ul>
  <li><a href="#adding-predictors-to-the-person-period-data-set" id="toc-adding-predictors-to-the-person-period-data-set" class="nav-link" data-scroll-target="#adding-predictors-to-the-person-period-data-set"><span class="header-section-number">11.3.1</span> Adding predictors to the person-period data set</a></li>
  <li><a href="#maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model" id="toc-maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model" class="nav-link" data-scroll-target="#maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model"><span class="header-section-number">11.3.2</span> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model</a></li>
  <li><a href="#fitting-the-discrete-time-hazard-model-to-data" id="toc-fitting-the-discrete-time-hazard-model-to-data" class="nav-link" data-scroll-target="#fitting-the-discrete-time-hazard-model-to-data"><span class="header-section-number">11.3.3</span> Fitting the discrete-time hazard model to data</a></li>
  </ul></li>
  <li><a href="#interpreting-parameter-estimates" id="toc-interpreting-parameter-estimates" class="nav-link" data-scroll-target="#interpreting-parameter-estimates"><span class="header-section-number">11.4</span> Interpreting parameter estimates</a>
  <ul>
  <li><a href="#the-time-indicators" id="toc-the-time-indicators" class="nav-link" data-scroll-target="#the-time-indicators"><span class="header-section-number">11.4.1</span> The time indicators</a></li>
  <li><a href="#dichotomous-substantive-predictors" id="toc-dichotomous-substantive-predictors" class="nav-link" data-scroll-target="#dichotomous-substantive-predictors"><span class="header-section-number">11.4.2</span> Dichotomous substantive predictors</a></li>
  <li><a href="#continuous-substantive-predictors" id="toc-continuous-substantive-predictors" class="nav-link" data-scroll-target="#continuous-substantive-predictors"><span class="header-section-number">11.4.3</span> Continuous substantive predictors</a></li>
  <li><a href="#polytomous-substantive-predictors" id="toc-polytomous-substantive-predictors" class="nav-link" data-scroll-target="#polytomous-substantive-predictors"><span class="header-section-number">11.4.4</span> Polytomous substantive predictors</a></li>
  </ul></li>
  <li><a href="#displaying-fitted-hazard-and-survivor-functions" id="toc-displaying-fitted-hazard-and-survivor-functions" class="nav-link" data-scroll-target="#displaying-fitted-hazard-and-survivor-functions"><span class="header-section-number">11.5</span> Displaying fitted hazard and survivor functions</a>
  <ul>
  <li><a href="#a-strategy-for-a-single-categorical-substantive-predictor" id="toc-a-strategy-for-a-single-categorical-substantive-predictor" class="nav-link" data-scroll-target="#a-strategy-for-a-single-categorical-substantive-predictor"><span class="header-section-number">11.5.1</span> A strategy for a single categorical substantive predictor</a></li>
  <li><a href="#extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous" id="toc-extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous" class="nav-link" data-scroll-target="#extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous"><span class="header-section-number">11.5.2</span> Extending this strategy to multiple predictors (some of which are continuous)</a></li>
  <li><a href="#two-cautions-when-interpreting-fitted-hazard-and-survivor-functions" id="toc-two-cautions-when-interpreting-fitted-hazard-and-survivor-functions" class="nav-link" data-scroll-target="#two-cautions-when-interpreting-fitted-hazard-and-survivor-functions"><span class="header-section-number">11.5.3</span> Two cautions when interpreting fitted hazard and survivor functions</a></li>
  </ul></li>
  <li><a href="#comparing-models-using-deviance-statistics-and-information-criteria" id="toc-comparing-models-using-deviance-statistics-and-information-criteria" class="nav-link" data-scroll-target="#comparing-models-using-deviance-statistics-and-information-criteria"><span class="header-section-number">11.6</span> Comparing models using <del>deviance statistics and</del> information criteria</a>
  <ul>
  <li><a href="#the-deviance-statistic" id="toc-the-deviance-statistic" class="nav-link" data-scroll-target="#the-deviance-statistic"><span class="header-section-number">11.6.1</span> The deviance statistic</a></li>
  <li><a href="#deviance-based-hypothesis-tests-for-individual-predictors" id="toc-deviance-based-hypothesis-tests-for-individual-predictors" class="nav-link" data-scroll-target="#deviance-based-hypothesis-tests-for-individual-predictors"><span class="header-section-number">11.6.2</span> Deviance-based hypothesis tests for individual predictors</a></li>
  <li><a href="#deviance-based-hypothesis-tests-for-groups-of-predictors" id="toc-deviance-based-hypothesis-tests-for-groups-of-predictors" class="nav-link" data-scroll-target="#deviance-based-hypothesis-tests-for-groups-of-predictors"><span class="header-section-number">11.6.3</span> Deviance-based hypothesis tests for groups of predictors</a></li>
  <li><a href="#comparing-nonnested-models-using-waic-and-loo" id="toc-comparing-nonnested-models-using-waic-and-loo" class="nav-link" data-scroll-target="#comparing-nonnested-models-using-waic-and-loo"><span class="header-section-number">11.6.4</span> Comparing nonnested models using [WAIC and LOO]</a></li>
  </ul></li>
  <li><a href="#statistical-inference-using-uncertainty-in-the-bayesian-posterior" id="toc-statistical-inference-using-uncertainty-in-the-bayesian-posterior" class="nav-link" data-scroll-target="#statistical-inference-using-uncertainty-in-the-bayesian-posterior"><span class="header-section-number">11.7</span> Statistical inference using [uncertainty in the Bayesian posterior]</a>
  <ul>
  <li><a href="#the-wald-chi-square-statistic" id="toc-the-wald-chi-square-statistic" class="nav-link" data-scroll-target="#the-wald-chi-square-statistic"><span class="header-section-number">11.7.1</span> The <del>Wald chi-square statistic</del></a></li>
  <li><a href="#asymmetric-credible-intervals-for-parameters-and-odds-ratios" id="toc-asymmetric-credible-intervals-for-parameters-and-odds-ratios" class="nav-link" data-scroll-target="#asymmetric-credible-intervals-for-parameters-and-odds-ratios"><span class="header-section-number">11.7.2</span> [Asymmetric credible intervals] for parameters and odds ratios</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments">Comments</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fitting Basic Discrete-Time Hazard Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>In this chapter and the next, we present statistical models of hazard for data collected in discrete time. The relative simplicity of these models makes them an ideal entrée into the world of survival analysis. In subsequent chapters, we extend these basic ideas to situations in which event occurrence is recorded in continuous time.</p>
<p>Good data analysis involves more than using a computer package to fit a statistical model to data. To conduce a credible discrete-time survival analysis, you must: (1) specify a suitable model for hazard and understand its assumptions; (2) use sample data to estimate the model parameters; (3) interpret results in terms of your research questions; (4) evaluate model fit and [express the uncertainty in the] model parameters; and (5) communicate your findings. <span class="citation" data-cites="singerAppliedLongitudinalData2003">(<a href="references.html#ref-singerAppliedLongitudinalData2003" role="doc-biblioref">Singer &amp; Willett, 2003, pp. 357–358</a>)</span></p>
</blockquote>
<section id="toward-a-statistical-model-for-discrete-time-hazard" class="level2 page-columns page-full" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="toward-a-statistical-model-for-discrete-time-hazard"><span class="header-section-number">11.1</span> Toward a statistical model for discrete-time hazard</h2>
<p>Time to load Capaldi, Crosby, and Stoolmiller’s <span class="citation" data-cites="capaldiPredictingTimingFirst1996">(<a href="references.html#ref-capaldiPredictingTimingFirst1996" role="doc-biblioref">1996</a>)</span> <code>firstsex.csv</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/firstsex.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 180
Columns: 5
$ id     &lt;dbl&gt; 1, 2, 3, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 28, 29, 30, 31, 32, 33, …
$ time   &lt;dbl&gt; 9, 12, 12, 12, 11, 9, 12, 11, 12, 11, 12, 11, 9, 12, 10, 12, 7, 12, 10, 12, 11, 12, 11, 12, 11, 12, 11, 9, 12, 11…
$ censor &lt;dbl&gt; 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,…
$ pt     &lt;dbl&gt; 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1,…
$ pas    &lt;dbl&gt; 1.9788670, -0.5454916, -1.4049800, 0.9741806, -0.6356313, -0.2428857, -0.8685001, 0.4535947, 0.8017636, -0.745946…</code></pre>
</div>
</div>
<p>Here are the cases broken down by <code>time</code> and <code>censor</code> status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sex <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(time, censor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
   time censor     n
  &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1     7      0    15
2     8      0     7
3     9      0    24
4    10      0    29
5    11      0    25
6    12      0    26
7    12      1    54</code></pre>
</div>
</div>
<p>Since these data show no censoring before the final <code>time</code> point, it is straightforward to follow along with the text (p.&nbsp;358) and compute the percent who had already had sex by the 12<sup>th</sup> grade.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sex <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(censor) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  censor     n percent
   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1      0   126      70
2      1    54      30</code></pre>
</div>
</div>
<p>Here we break the data down by our central predictor, <code>pt</code>, which is coded “0 for boys who lived with both biological parents” and “1 for boys who experienced one or more parenting transitions” before the 7<sup>th</sup> grade.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sex <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pt) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
     pt     n percent
  &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1     0    72      40
2     1   108      60</code></pre>
</div>
</div>
<section id="plots-of-within-group-hazard-functions-and-survivor-functions" class="level3" data-number="11.1.1">
<h3 data-number="11.1.1" class="anchored" data-anchor-id="plots-of-within-group-hazard-functions-and-survivor-functions"><span class="header-section-number">11.1.1</span> Plots of within-group hazard functions and survivor functions</h3>
<blockquote class="blockquote">
<p>Plots of sample hazard functions and survivor functions estimates separately for groups distinguished by their predictor values are invaluable exploratory tools. If a predictor is categorical, like <em>PT</em>, construction of these displays is straightforward. If a predictor is continuous, you should just temporarily categorize its values for plotting purposes. (pp.&nbsp;358–359, <em>emphasis</em> in the original)</p>
</blockquote>
<p>To make our version of the descriptive plots in Figure 11.1, we’ll need to first load the <strong>survival</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>fit11.1</code> will be of the cases for which <code>pt ==  0</code> and <code>fit11.2</code> will be of the cases for which <code>pt ==  1</code>. With <code>fit11.3</code>, we use all cases regardless of <code>pt</code> status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pt <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(time, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pt <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(time, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(time, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we plot the results, it might be handy to arrange the fit results in life tables. We can streamline that code with the custom <code>make_lt()</code> function from last chapter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>make_lt <span class="ot">&lt;-</span> <span class="cf">function</span>(fit) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange the lt data for all rows but the first</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  most_rows <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">time =</span> fit<span class="sc">$</span>time) <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_int =</span> <span class="fu">str_c</span>(<span class="st">"["</span>, time, <span class="st">", "</span>, time <span class="sc">+</span> <span class="dv">1</span>, <span class="st">")"</span>), </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_risk   =</span> fit<span class="sc">$</span>n.risk, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_event  =</span> fit<span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n_censored   =</span> n_risk <span class="sc">-</span> n_event <span class="sc">-</span> <span class="fu">lead</span>(n_risk, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">hazard_fun   =</span> n_event <span class="sc">/</span> n_risk,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">survivor_fun =</span> fit<span class="sc">$</span>surv)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the values for t = 2 and t = 1</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  time_1 <span class="ot">&lt;-</span> fit<span class="sc">$</span>time[<span class="dv">1</span>]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  time_0 <span class="ot">&lt;-</span> time_1 <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the values for the row for which t = 1</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  row_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">time         =</span> time_0, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_int     =</span> <span class="fu">str_c</span>(<span class="st">"["</span>, time_0, <span class="st">", "</span>, time_1, <span class="st">")"</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_risk       =</span> fit<span class="sc">$</span>n.risk[<span class="dv">1</span>],</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_event      =</span> <span class="cn">NA</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_censored   =</span> <span class="cn">NA</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">hazard_fun   =</span> <span class="cn">NA</span>, </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">survivor_fun =</span> <span class="dv">1</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make the full life table</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(row_1, most_rows)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use <code>make_lt()</code> separately for each fit, stack the results from the first on top of those from the second, and add a <code>pt</code> column to index the rows. This will be our version of Table 11.1 (p.&nbsp;360).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">make_lt</span>(fit11<span class="fl">.1</span>), <span class="fu">make_lt</span>(fit11<span class="fl">.2</span>), <span class="fu">make_lt</span>(fit11<span class="fl">.3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"pt = 0"</span>, <span class="st">"pt = 1"</span>, <span class="st">"overall"</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pt, <span class="fu">everything</span>())</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>lt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 8
   pt      time time_int n_risk n_event n_censored hazard_fun survivor_fun
   &lt;fct&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
 1 pt = 0     6 [6, 7)       72      NA         NA    NA             1    
 2 pt = 0     7 [7, 8)       72       2          0     0.0278        0.972
 3 pt = 0     8 [8, 9)       70       2          0     0.0286        0.944
 4 pt = 0     9 [9, 10)      68       8          0     0.118         0.833
 5 pt = 0    10 [10, 11)     60       8          0     0.133         0.722
 6 pt = 0    11 [11, 12)     52      10          0     0.192         0.583
 7 pt = 0    12 [12, 13)     42       8         34     0.190         0.472
 8 pt = 1     6 [6, 7)      108      NA         NA    NA             1    
 9 pt = 1     7 [7, 8)      108      13          0     0.120         0.880
10 pt = 1     8 [8, 9)       95       5          0     0.0526        0.833
# ℹ 11 more rows</code></pre>
</div>
</div>
<p>Here is the code for the top panel of Figure 11.1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard_fun, <span class="at">color =</span> pt, <span class="at">group =</span> pt)) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"grade"</span>, <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"estimated hazard probability"</span>, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now make the plot for the bottom panel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survivor_fun, <span class="at">color =</span> pt, <span class="at">group =</span> pt)) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"grade"</span>, <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"estimated survival probability"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine the two <strong>ggplot2</strong> objects with <strong>patchwork</strong> syntax to make our version of Figure 11.1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>On page 361, Singer and Willett compared the hazard probabilities at grades 8 and 11 for boys in the two <code>pt</code> groups. We can make that comparison with <code>filter()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>lt <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">11</span>) <span class="sc">&amp;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pt<span class="sc">:</span>time, hazard_fun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  pt      time hazard_fun
  &lt;fct&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 pt = 0     8     0.0286
2 pt = 0    11     0.192 
3 pt = 1     8     0.0526
4 pt = 1    11     0.283 </code></pre>
</div>
</div>
<p>Compare the two groups on the hazard probabilities at grade 9.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lt <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>           pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pt<span class="sc">:</span>time, hazard_fun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  pt      time hazard_fun
  &lt;fct&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 pt = 0     9      0.118
2 pt = 1     9      0.178</code></pre>
</div>
</div>
<p>Now compare them on their hazard probabilities in grade 12.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lt <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>           pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pt<span class="sc">:</span>time, hazard_fun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  pt      time hazard_fun
  &lt;fct&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 pt = 0    12      0.190
2 pt = 1    12      0.474</code></pre>
</div>
</div>
<p>At the top of page 362, Singer and Willett compared the percentages of boys who were virgins at grades 9 and 12, by <code>pt</code> status. Those percentages are straight algebraic transformations of the corresponding survival function values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>lt <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">12</span>) <span class="sc">&amp;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>           pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pt<span class="sc">:</span>time, survivor_fun) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent_virgins =</span> (<span class="dv">100</span> <span class="sc">*</span> survivor_fun) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  pt      time survivor_fun percent_virgins
  &lt;fct&gt;  &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;
1 pt = 0     9        0.833            83.3
2 pt = 0    12        0.472            47.2
3 pt = 1     9        0.685            68.5
4 pt = 1    12        0.185            18.5</code></pre>
</div>
</div>
<p>Now let’s finish off by computing the interpolated median lifetime values for each with our custom <code>make_iml()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>make_iml <span class="ot">&lt;-</span> <span class="cf">function</span>(lt) {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lt is a generic name for a life table of the </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># kind we made with our `make_lt()` function</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># determine the mth row</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  lt_m <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(survivor_fun <span class="sc">&gt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="fu">n</span>())</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># determine the row for m + 1</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  lt_m1 <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(survivor_fun <span class="sc">&lt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull the value for m</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  m  <span class="ot">&lt;-</span> <span class="fu">pull</span>(lt_m, time)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull the two survival function values</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  stm  <span class="ot">&lt;-</span> <span class="fu">pull</span>(lt_m, survivor_fun)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  stm1 <span class="ot">&lt;-</span> <span class="fu">pull</span>(lt_m1, survivor_fun)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plug the values into Equation 10.6 (page 338)</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  m <span class="sc">+</span> ((stm <span class="sc">-</span> .<span class="dv">5</span>) <span class="sc">/</span> (stm <span class="sc">-</span> stm1)) <span class="sc">*</span> ((m <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">-</span> m)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Put <code>make_iml()</code> to work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make_iml</span>(lt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pt <span class="sc">==</span> <span class="st">"pt = 0"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.75</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make_iml</span>(lt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pt <span class="sc">==</span> <span class="st">"pt = 1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.952381</code></pre>
</div>
</div>
</section>
<section id="what-kind-of-statistical-model-do-these-graphs-suggest" class="level3 page-columns page-full" data-number="11.1.2">
<h3 data-number="11.1.2" class="anchored" data-anchor-id="what-kind-of-statistical-model-do-these-graphs-suggest"><span class="header-section-number">11.1.2</span> What kind of statistical model do these graphs suggest?</h3>
<blockquote class="blockquote">
<p>To postulate a statistical model to represent the relationship between the population discrete-time hazard function and predictors, we must deal with two complications apparent in these displays. One is that any hypothesized model must describe the shape of the <em>entire discrete-time hazard function</em> over time, not just its value in any one period, in much the same way that a multilevel model for change characterizes the shape of entire individual growth trajectories over time. A second complication is that, as a conditional probability, the value of discrete-time hazard must lie between 0 and 1. Any reasonable statistical model for hazard must recognize this constraint, precluding the occurrence of theoretically impossible values. (p.&nbsp;362, <em>emphasis</em> in the original)</p>
</blockquote>
<section id="the-bounded-nature-of-hazard" class="level4 page-columns page-full" data-number="11.1.2.1">
<h4 data-number="11.1.2.1" class="anchored" data-anchor-id="the-bounded-nature-of-hazard"><span class="header-section-number">11.1.2.1</span> The bounded nature of hazard</h4>
<p>A conventional way to handle the bounded nature of probabilities is transform the scale of the data. <span class="citation" data-cites="cox1972regression">Cox (<a href="references.html#ref-cox1972regression" role="doc-biblioref">1972</a>)</span> recommended either the odds and log-odds (i.e., logit) transformations. Given a probability, <span class="math inline">\(p\)</span>, we compute the odds as</p>
<p><span class="math display">\[\text{odds} = \frac{p}{1 - p}.\]</span></p>
<p>Log-odds is a minor extension; you simply take the log of the odds, which we can formally express as</p>
<p><span class="math display">\[\text{log-odds} = \log \left (\frac{p}{1 - p} \right ).\]</span></p>
<p>To make the conversions easy, we’ll define<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> a couple convenience functions: <code>odds()</code> and <code>log_odds()</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<strong>R</strong> already has a built-in function to convert probabilities to the log-odds scale. Somewhat confusingly, it’s called <code>qlogis()</code>. You can learn more by executing <code>?qlogis</code> or by browsing through <a href="https://ro-che.info/articles/2018-08-11-logit-logistic-r">this great blog post</a> by Roman Cheplyaka. It’s generally a good idea to stick to the functions in base <strong>R</strong> rather than make your own, like we did earlier in this chapter (see <a href="https://twitter.com/tjmahr/status/1248228130256453632">this twitter thread</a>). Since the name of <code>qlogis()</code> isn’t the easiest to remember, you can always execute something like <code>log_odds &lt;- qlogis</code> or <code>logit &lt;- qlogis</code> at the beginning of your scripts and then use one of those as a thin wrapper for <code>qlogis()</code>.</p></div></div><div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  p <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>log_odds <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(p <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s how they work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">odds     =</span> <span class="fu">odds</span>(p),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_odds =</span> <span class="fu">log_odds</span>(p))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
       p    odds log_odds
   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1   0     0     -Inf    
 2   0.1   0.111   -2.20 
 3   0.2   0.25    -1.39 
 4   0.3   0.429   -0.847
 5   0.4   0.667   -0.405
 6   0.5   1        0    
 7   0.6   1.5      0.405
 8   0.7   2.33     0.847
 9   0.8   4        1.39 
10   0.9   9        2.20 
11   1   Inf      Inf    </code></pre>
</div>
</div>
<p>Before we make our version of Figure 11.2, it might be instructive to see how odds and log-odds compare to probabilities in a plot. Here we’ll compare them to probabilities ranging from .01 to .99.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.01</span>, <span class="at">to =</span> <span class="fl">0.99</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">odds        =</span> <span class="fu">odds</span>(p),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">log(odds)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">log_odds</span>(p)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>p) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"odds"</span>, <span class="st">"log(odds)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"probability"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"transformed scale"</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Odds are bounded to values of zero and above and have an inflection at 1. Log-odds are unbounded and have an inflection point at 0. Here we’ll save the odds and log-odds for our hazard functions within the <code>lt</code> life table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">odds     =</span> <span class="fu">odds</span>(hazard_fun),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_odds =</span> <span class="fu">log_odds</span>(hazard_fun)) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>lt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 10
   pt      time time_int n_risk n_event n_censored hazard_fun survivor_fun    odds log_odds
   &lt;fct&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 pt = 0     6 [6, 7)       72      NA         NA    NA             1     NA         NA   
 2 pt = 0     7 [7, 8)       72       2          0     0.0278        0.972  0.0286    -3.56
 3 pt = 0     8 [8, 9)       70       2          0     0.0286        0.944  0.0294    -3.53
 4 pt = 0     9 [9, 10)      68       8          0     0.118         0.833  0.133     -2.01
 5 pt = 0    10 [10, 11)     60       8          0     0.133         0.722  0.154     -1.87
 6 pt = 0    11 [11, 12)     52      10          0     0.192         0.583  0.238     -1.44
 7 pt = 0    12 [12, 13)     42       8         34     0.190         0.472  0.235     -1.45
 8 pt = 1     6 [6, 7)      108      NA         NA    NA             1     NA         NA   
 9 pt = 1     7 [7, 8)      108      13          0     0.120         0.880  0.137     -1.99
10 pt = 1     8 [8, 9)       95       5          0     0.0526        0.833  0.0556    -2.89
# ℹ 11 more rows</code></pre>
</div>
</div>
<p>We’re ready to make and combine the subplots for our version of Figure 11.2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard_fun, <span class="at">color =</span> pt, <span class="at">group =</span> pt)) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Estimated hazard"</span>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey92"</span>),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.825</span>))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># odds</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> odds, <span class="at">color =</span> pt, <span class="at">group =</span> pt)) <span class="sc">+</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Estimated odds"</span>) <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co"># log-odds</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pt <span class="sc">!=</span> <span class="st">"overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> log_odds, <span class="at">color =</span> pt, <span class="at">group =</span> pt)) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Estimated logit(hazard)"</span>) <span class="sc">+</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3 ) <span class="sc">&amp;</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.5</span>) <span class="sc">&amp;</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"grade"</span>, <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="sc">&amp;</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-statistical-model-could-have-generated-these-sample-data" class="level4" data-number="11.1.2.2">
<h4 data-number="11.1.2.2" class="anchored" data-anchor-id="what-statistical-model-could-have-generated-these-sample-data"><span class="header-section-number">11.1.2.2</span> What statistical model could have generated these sample data?</h4>
<p>With the survival models from the prior sections, we were lazy and just used the <strong>survival</strong> package. But recall from the end of the last chapter that we can fit the analogous models <strong>brms</strong> using the binomial likelihood. This subsection is a great place to practice those some more. The fitted lines Singer and Willett displayed in Figure 11.3 can all be reproduced with binomial regression. However, the <code>sex</code> data are not in a convenient form to fit those models. Just like we did in last chapter, we’ll want to take a two-step process whereby we first convert the data to the long (i.e., person-period) format and then summarize. Happily, we can accomplish that first step by uploading the data in the <code>firstsex_pp.csv</code> file, which are already in the long format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sex_pp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/firstsex_pp.csv"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sex_pp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 822
Columns: 11
$ id     &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 7, 7, 7, 9, 9, 9, 9, 9, 9, 10, 10, …
$ period &lt;dbl&gt; 7, 8, 9, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 7, 8, 9, 7, 8, 9, 10, 11…
$ event  &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ d7     &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0,…
$ d8     &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0,…
$ d9     &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1,…
$ d10    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ d11    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,…
$ d12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,…
$ pt     &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ pas    &lt;dbl&gt; 1.9788670, 1.9788670, 1.9788670, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -1.40498…</code></pre>
</div>
</div>
<p>Now we’ll compute the desired summary values and wrangle a bit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>sex_aggregated <span class="ot">&lt;-</span> sex_pp <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="fu">if_else</span>(event <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"event"</span>, <span class="st">"no_event"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(event, pt) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> event,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total         =</span> event <span class="sc">+</span> no_event,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">period_center =</span> period <span class="sc">-</span> <span class="fu">mean</span>(period),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">peroid_factor =</span> <span class="fu">factor</span>(period),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">pt            =</span> <span class="fu">factor</span>(pt))</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>sex_aggregated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 7
   period pt    event no_event total period_center peroid_factor
    &lt;dbl&gt; &lt;fct&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;fct&gt;        
 1      7 0         2       70    72          -2.5 7            
 2      7 1        13       95   108          -2.5 7            
 3      8 0         2       68    70          -1.5 8            
 4      8 1         5       90    95          -1.5 8            
 5      9 0         8       60    68          -0.5 9            
 6      9 1        16       74    90          -0.5 9            
 7     10 0         8       52    60           0.5 10           
 8     10 1        21       53    74           0.5 10           
 9     11 0        10       42    52           1.5 11           
10     11 1        15       38    53           1.5 11           
11     12 0         8       34    42           2.5 12           
12     12 1        18       20    38           2.5 12           </code></pre>
</div>
</div>
<p>Note how we saved the grade values in three columns:</p>
<ul>
<li><code>period</code> has them as continuous values, which will be hand for plotting;</li>
<li><code>period_center</code> has them as mean-centered continuous values, which will make fitting the linear model in the middle panel easier; and</li>
<li><code>period_factor</code> has them saved as a factor, which will help us fit the model in the bottom panel.</li>
</ul>
<p>Fire up <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we fit the models, it might be good to acknowledge we’re jumping ahead of the authors, a bit. Singer and Willett didn’t discuss fitting discrete time hazard models until section 11.3.2. Sure, their focus was on the frequentist approach using maximum likelihood. But the point still stands. If these model fitting details feel a bit rushed, they are.</p>
<p>Any anxious feelings aside, now fit the three binomial models. We continue to use weakly-regularizing priors for each.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># top panel</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_aggregated,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(total) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> pt,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.04"</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># middle panel</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_aggregated,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(total) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> pt <span class="sc">+</span> period_center,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.05"</span>)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co"># bottom panel</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_aggregated,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(total) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> pt <span class="sc">+</span> peroid_factor,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.06"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the model summaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(total) ~ 0 + pt 
   Data: sex_aggregated (Number of observations: 12) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
pt0    -2.15      0.17    -2.51    -1.82 1.00     2933     2316
pt1    -1.44      0.12    -1.67    -1.21 1.00     3416     2883

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(total) ~ 0 + pt + period_center 
   Data: sex_aggregated (Number of observations: 12) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
pt0              -2.23      0.18    -2.60    -1.90 1.00     3173     3053
pt1              -1.35      0.13    -1.60    -1.10 1.00     3518     2753
period_center     0.43      0.07     0.30     0.56 1.00     3692     3246

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(total) ~ 0 + pt + peroid_factor 
   Data: sex_aggregated (Number of observations: 12) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
pt0                -3.00      0.31    -3.63    -2.42 1.00     1228     1889
pt1                -2.11      0.27    -2.66    -1.61 1.00     1063     1382
peroid_factor8     -0.77      0.47    -1.73     0.10 1.00     1736     1819
peroid_factor9      0.68      0.34     0.04     1.36 1.00     1306     1972
peroid_factor10     1.15      0.34     0.51     1.84 1.00     1339     1608
peroid_factor11     1.31      0.35     0.65     2.01 1.00     1441     2110
peroid_factor12     1.79      0.36     1.10     2.50 1.00     1318     2129

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>We can extract the fitted values and their summaries for each row in the data with <code>fitted()</code>. To get them in the log-odds metric, we need to set <code>scale = "linear"</code>. Here’s a quick example with <code>fit11.4</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit11<span class="fl">.4</span>, <span class="at">scale =</span> <span class="st">"linear"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate Est.Error      Q2.5     Q97.5
 [1,] -2.154803 0.1727112 -2.512909 -1.824280
 [2,] -1.438563 0.1180980 -1.667146 -1.208921
 [3,] -2.154803 0.1727112 -2.512909 -1.824280
 [4,] -1.438563 0.1180980 -1.667146 -1.208921
 [5,] -2.154803 0.1727112 -2.512909 -1.824280
 [6,] -1.438563 0.1180980 -1.667146 -1.208921
 [7,] -2.154803 0.1727112 -2.512909 -1.824280
 [8,] -1.438563 0.1180980 -1.667146 -1.208921
 [9,] -2.154803 0.1727112 -2.512909 -1.824280
[10,] -1.438563 0.1180980 -1.667146 -1.208921
[11,] -2.154803 0.1727112 -2.512909 -1.824280
[12,] -1.438563 0.1180980 -1.667146 -1.208921</code></pre>
</div>
</div>
<p>If we convert that output to a data frame, tack on the original data values, and wrangle a bit, we’ll be in good shape to make the top panel of Figure 11.3. Below we’ll do that for each of the three panels, saving them as <code>p1</code>, <code>p2</code>, and <code>p3</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(hazard) is horizontal with time</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit11<span class="fl">.4</span>, <span class="at">scale =</span> <span class="st">"linear"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(sex_aggregated) <span class="sc">%&gt;%</span> </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt =</span> <span class="fu">str_c</span>(<span class="st">"pt = "</span>, pt)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">log_odds</span>(event <span class="sc">/</span> total))) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"logit(hazard) is horizontal with time"</span>) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey92"</span>),</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.825</span>))</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(hazard) is linear with time</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit11<span class="fl">.5</span>, <span class="at">scale =</span> <span class="st">"linear"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(sex_aggregated) <span class="sc">%&gt;%</span> </span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate),</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">log_odds</span>(event <span class="sc">/</span> total))) <span class="sc">+</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"logit(hazard) is linear with time"</span>,</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"logit(hazard)"</span>) <span class="sc">+</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(hazard) is completely general with time</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit11<span class="fl">.6</span>, <span class="at">scale =</span> <span class="st">"linear"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(sex_aggregated) <span class="sc">%&gt;%</span> </span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate),</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">log_odds</span>(event <span class="sc">/</span> total))) <span class="sc">+</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"logit(hazard) is completely general with time"</span>,</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now combine the plots with <strong>patchwork</strong> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3) <span class="sc">&amp;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">&amp;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">&amp;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Grade"</span>, <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="sc">&amp;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>In addition to the posterior means (i.e., our analogues to the fitted values in the text), we added the 95% Bayesian intervals to give a better sense of the uncertainty in each model. Singer and Willett mused the unconstrained model (<code>fit6</code>) was a better fit to the data than the other two. We can quantify that with a LOO comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit11<span class="fl">.4</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit11<span class="fl">.5</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit11<span class="fl">.6</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit11<span class="fl">.4</span>, fit11<span class="fl">.5</span>, fit11<span class="fl">.6</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
fit11.6   0.0       0.0   -31.2      1.7         4.7   0.6     62.5   3.3   
fit11.5  -1.2       3.4   -32.4      3.3         3.7   1.3     64.8   6.7   
fit11.4 -28.1      10.5   -59.4     10.4         9.3   2.6    118.7  20.7   </code></pre>
</div>
</div>
<p>Here are the LOO weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit11<span class="fl">.4</span>, fit11<span class="fl">.5</span>, fit11<span class="fl">.6</span>, <span class="at">weights =</span> <span class="st">"loo"</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fit11.4 fit11.5 fit11.6 
  0.000   0.238   0.762 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="formal-representation-of-the-population-discrete-time-hazard-model" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="formal-representation-of-the-population-discrete-time-hazard-model"><span class="header-section-number">11.2</span> Formal representation of the population discrete-time hazard model</h2>
<p>Earlier equations for the hazard function omitted substantive predictors. Now consider the case where <span class="math inline">\(X_{1ij}, X_{2ij}, \dots , X_{Pij}\)</span> stand for the <span class="math inline">\(P\)</span> predictors which may or may not vary across individuals <span class="math inline">\(i\)</span> and time periods <span class="math inline">\(j\)</span>. Thus <span class="math inline">\(x_{pij}\)</span> is the value for the <span class="math inline">\(i^\text{th}\)</span> individual on the <span class="math inline">\(p^\text{th}\)</span> variable during the <span class="math inline">\(j^\text{th}\)</span> period. We can use this to define the conditional hazard function as</p>
<p><span class="math display">\[h(t_{ij}) = \Pr [T_i = j \mid T \geq j \text{ and } X_{1ij} = x_{1ij}, X_{2ij} = x_{2ij}, \dots , X_{Pij} = x_{pij}].\]</span></p>
<p>Building further and keeping the baseline shape of the discrete hazard function flexible, we want a method that allows each of the <span class="math inline">\(j\)</span> time periods to have its own value. Imagine a set of <span class="math inline">\(J\)</span> dummy variables, <span class="math inline">\(D_1, D_2, \dots, D_J\)</span>, marking off each of the time periods. For example, say <span class="math inline">\(J = 6\)</span>, we could depict this in a tibble like so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">period =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d1 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">d2 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d5 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d6 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  period    d1    d2    d3    d4    d5    d6
   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      1     1     0     0     0     0     0
2      2     0     1     0     0     0     0
3      3     0     0     1     0     0     0
4      4     0     0     0     1     0     0
5      5     0     0     0     0     1     0
6      6     0     0     0     0     0     1</code></pre>
</div>
</div>
<p>If we were to use a set of dummies of this kind in a model, we would omit the conventional regression intercept, replacing it with the <span class="math inline">\(J\)</span> dummies. Now presume we’re fitting a hazard model using the logit link, <span class="math inline">\(\operatorname{logit} h(t_{ij})\)</span>. We can express the discrete conditional hazard model with a general functional form with respect to time as</p>
<p><span class="math display">\[\operatorname{logit} h(t_{ij}) = [\alpha_1 D_{1ij} + \alpha_2 D_{2ij} + \cdots + \alpha_J D_{Jij}] + [\beta_1 X_{1ij} + \beta_2 X_{2ij} + \cdots + \beta_P X_{Pij}],\]</span></p>
<p>where the <span class="math inline">\(\alpha\)</span> parameters are the <span class="math inline">\(J\)</span> time-period dummies and the <span class="math inline">\(\beta\)</span> parameters are for other time-varying or time-invariant predictors. This is just the type of model we used to fit <code>fit116</code>. For that model, the basic equation was</p>
<p><span class="math display">\[\operatorname{logit} h(t_{ij}) = [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_1 \text{PT}_i ],\]</span></p>
<p>where the only substantive predictor was the time-invariant <code>pt</code>. However, that formula could be a little misleading. Recall the formula:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.6</span><span class="sc">$</span>formula</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>event | trials(total) ~ 0 + pt + peroid_factor </code></pre>
</div>
</div>
<p>We suppressed the default regression intercept with the <code>~ 0 +</code> syntax and the only two predictors were <code>pt</code> and <code>peroid_factor</code>. Both were saved as factor variables. Functionally, that’s why <code>period_factor</code> worked as <span class="math inline">\(\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}\)</span>, a series of 5 dummy variables with no reference category. The same basic thing goes for <code>pt</code>. Because <code>pt</code> was a factor used in a model <code>formula</code> with no conventional intercept, it acted as if it was a series of 2 dummy variables with no reference category. Thus, we might rewrite the model equation for <code>fit6</code> as</p>
<p><span class="math display">\[\operatorname{logit} h(t_{ij}) = [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_0 \text{PT}_{0i} + \beta_1 \text{PT}_{1i} ].\]</span></p>
<p>And since we’re practicing fitting these models as Bayesians, the <code>fit6</code> equation with a fuller expression of the likelihood and the priors looks like</p>
<p><span class="math display">\[
\begin{align}
\text{event}_{ij} &amp; = \operatorname{Binomial}(n = \text{trials}_{ij}, p_{ij}) \\
\operatorname{logit} (p_{ij}) &amp; =  [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_0 \text{PT}_{0i} + \beta_1 \text{PT}_{1i} ] \\
\alpha_7, \alpha_8, \dots, \alpha_{12} &amp; \sim \operatorname{Normal}(0, 4) \\
\beta_0 \text{ and } \beta_1 &amp; \sim \operatorname{Normal}(0, 4),
\end{align}
\]</span></p>
<p>where we’re describing the model in terms of the criterion, <code>event</code>, rather than in terms of <span class="math inline">\(h(t_{ij})\)</span>. And what is the criterion, <code>event</code>? It’s a vector of counts. The binomial likelihood allows us to model vectors of counts in terms of the number of trials, as indexed by our <code>trials</code> vector, and the (conditional) probability of a “1” in a given trial. In this context, <span class="math inline">\(h(t_{ij}) = p_{ij}\)</span>.</p>
<section id="what-do-the-parameters-represent" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="what-do-the-parameters-represent"><span class="header-section-number">11.2.1</span> What do the parameters represent?</h3>
<p>Given our factor coding of <code>pt</code>, our two submodels for the equations in the last section are</p>
<p><span class="math display">\[
\begin{align}
\text{when PT = 0: } \operatorname{logit} h(t_j) &amp; = [\alpha_7 D_7 + \alpha_8 D_8 + \cdots + \alpha_{12} D_{12}] + \beta_0 \\
\text{when PT = 1: } \operatorname{logit} h(t_j) &amp; = [\alpha_7 D_7 + \alpha_8 D_8 + \cdots + \alpha_{12} D_{12}] + \beta_1,
\end{align}
\]</span></p>
<p>where we used Singer and Willett’s simplified notation and dropped all the <span class="math inline">\(i\)</span> subscripts and most of the <span class="math inline">\(j\)</span> subscripts.</p>
</section>
<section id="an-alternative-representation-of-the-model" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="an-alternative-representation-of-the-model"><span class="header-section-number">11.2.2</span> An alternative representation of the model</h3>
<p>In the previous sections, we expressed the model in terms of the logit of the criterion or the <span class="math inline">\(p\)</span> parameter of the likelihood. Another strategy is the express the criterion (or <span class="math inline">\(p\)</span>) in its natural metric and put the nonlinear portion on the right side of the equation. If we consider the generic discrete conditional hazard function, that would follow the form</p>
<p><span class="math display">\[
h(t_{ij}) = \frac{1}{1 + e^{-([\alpha_1 D_{1ij} + \alpha_2 D_{2ij} + \cdots + \alpha_J D_{Jij}] + [\beta_1 X_{1ij} + \beta_2 X_{2ij} + \cdots + \beta_P X_{Pij}])}}.
\]</span></p>
<p>This is just a particular kind of logistic regression model. It also clarifies that “by specifying a linear relationship between predictors and logit hazard we imply a <em>nonlinear</em> relationship between predictors and <em>raw hazard</em>” (p.&nbsp;377, <em>emphasis</em> in the original). We can explore what that might look like with our version of Figure 11.4. Here we continue to use <code>fit6</code>, but this time we’ll save the output from <code>fitted()</code> before plotting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit11<span class="fl">.6</span>, <span class="at">scale =</span> <span class="st">"linear"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(sex_aggregated)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate Est.Error       Q2.5      Q97.5 period pt event no_event total period_center peroid_factor
1  -2.9961977 0.3118918 -3.6299955 -2.4188144      7  0     2       70    72          -2.5             7
2  -2.1106221 0.2696068 -2.6604562 -1.6051558      7  1    13       95   108          -2.5             7
3  -3.7686230 0.4335907 -4.6929008 -2.9779488      8  0     2       68    70          -1.5             8
4  -2.8830474 0.3974622 -3.7203998 -2.1929817      8  1     5       90    95          -1.5             8
5  -2.3134865 0.2740091 -2.8577350 -1.7856641      9  0     8       60    68          -0.5             9
6  -1.4279109 0.2251447 -1.8869407 -0.9980089      9  1    16       74    90          -0.5             9
7  -1.8495091 0.2655533 -2.3770859 -1.3344318     10  0     8       52    60           0.5            10
8  -0.9639334 0.2247747 -1.4134571 -0.5362926     10  1    21       53    74           0.5            10
9  -1.6840227 0.2738422 -2.2347843 -1.1460772     11  0    10       42    52           1.5            11
10 -0.7984471 0.2498367 -1.3011791 -0.3130270     11  1    15       38    53           1.5            11
11 -1.2032530 0.2792854 -1.7707307 -0.6776080     12  0     8       34    42           2.5            12
12 -0.3176774 0.2589108 -0.8189017  0.1767758     12  1    18       20    38           2.5            12</code></pre>
</div>
</div>
<p>Make the subplots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(hazard)</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt =</span> <span class="fu">str_c</span>(<span class="st">"pt = "</span>, pt)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"logit(hazard)"</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey92"</span>),</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.825</span>))</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co"># odds</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>), <span class="at">.funs =</span> exp) <span class="sc">%&gt;%</span> </span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"odds"</span>,</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>), <span class="at">.funs =</span> plogis) <span class="sc">%&gt;%</span> </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"hazard (i.e., probability)"</span>,</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine the subplots with <strong>patchwork</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3) <span class="sc">&amp;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">&amp;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">&amp;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Grade"</span>, <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="sc">&amp;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The <code>mutate_at()</code> conversions we made for <code>p2</code> and <code>p3</code> were based on the guidelines in Table 11.2. Those were:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">original scale</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"logit"</span>, <span class="st">"odds"</span>, <span class="st">"logit"</span>),</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">desired scale</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"odds"</span>, <span class="st">"probability"</span>, <span class="st">"probability"</span>),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">transformation   =</span> <span class="fu">c</span>(<span class="st">"exp(logit)"</span>, <span class="st">"odds / (1 + odds)"</span>, <span class="st">"1 / (1 + exp(-1 * logit))"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">width</span>(<span class="at">width =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-944f5dba{}.cl-944c0534{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-944d6276{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-944d6fbe{width:1.5in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-944d6fc8{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-944d6fc9{width:1.5in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-944d6fca{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-944d6fd2{width:1.5in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-944d6fd3{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-944f5dba"><thead><tr style="overflow-wrap:break-word;"><th class="cl-944d6fbe"><p class="cl-944d6276"><span class="cl-944c0534">original scale</span></p></th><th class="cl-944d6fbe"><p class="cl-944d6276"><span class="cl-944c0534">desired scale</span></p></th><th class="cl-944d6fc8"><p class="cl-944d6276"><span class="cl-944c0534">transformation</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-944d6fc9"><p class="cl-944d6276"><span class="cl-944c0534">logit</span></p></td><td class="cl-944d6fc9"><p class="cl-944d6276"><span class="cl-944c0534">odds</span></p></td><td class="cl-944d6fca"><p class="cl-944d6276"><span class="cl-944c0534">exp(logit)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-944d6fc9"><p class="cl-944d6276"><span class="cl-944c0534">odds</span></p></td><td class="cl-944d6fc9"><p class="cl-944d6276"><span class="cl-944c0534">probability</span></p></td><td class="cl-944d6fca"><p class="cl-944d6276"><span class="cl-944c0534">odds / (1 + odds)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-944d6fd2"><p class="cl-944d6276"><span class="cl-944c0534">logit</span></p></td><td class="cl-944d6fd2"><p class="cl-944d6276"><span class="cl-944c0534">probability</span></p></td><td class="cl-944d6fd3"><p class="cl-944d6276"><span class="cl-944c0534">1 / (1 + exp(-1 * logit))</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>We accomplished the transformation in the bottom row with the <code>plogis()</code> function.</p>
</section>
</section>
<section id="fitting-a-discrete-time-hazard-model-to-data" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="fitting-a-discrete-time-hazard-model-to-data"><span class="header-section-number">11.3</span> Fitting a discrete-time hazard model to data</h2>
<p>As Singer and Willett wrote, “with data collected on a random sample of individuals from a target population, you can easily fit a discrete-time hazard model, estimate its parameters using maximum likelihood methods, and evaluate goodness-of-fit” (pp.&nbsp;378–379. As we’ve already demonstrated, you can fit them with Bayesian software, too. Though we’ll be focusing on <strong>brms</strong>, you might also want to check out the <strong>rstanarm</strong> package, about which you can learn more from Brilleman, Elci, Novik, and Wolfe’s <span class="citation" data-cites="brilleman2020BayesianSurvivalAnalysis">(<a href="references.html#ref-brilleman2020BayesianSurvivalAnalysis" role="doc-biblioref">2020</a>)</span> preprint, <a href="https://arxiv.org/abs/2002.09633"><em>Bayesian survival analysis Using the rstanarm R package</em></a>, Brilleman’s <span class="citation" data-cites="Brilleman2019EstimatingSurvival">(<a href="references.html#ref-Brilleman2019EstimatingSurvival" role="doc-biblioref">2019</a>)</span> vignette, <a href="https://github.com/stan-dev/rstanarm/blob/feature/frailty-models/vignettes/surv.Rmd"><em>Estimating survival (time-to-event) models with rstanarm</em></a>, and the <a href="https://discourse.mc-stan.org/t/survival-models-in-rstanarm/3998">Survival models in rstanarm thread</a> in the Stan forums.</p>
<section id="adding-predictors-to-the-person-period-data-set" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="adding-predictors-to-the-person-period-data-set"><span class="header-section-number">11.3.1</span> Adding predictors to the person-period data set</h3>
<p>At the beginning of section 11.1.2.2, we already loaded a version of the person-period data including the discrete-time dummies. It has our substantive predictors <code>pt</code> and <code>pas</code>, too. We saved it as <code>sex_pp</code>. Here’s a <code>glimpse()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>sex_pp <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 822
Columns: 11
$ id     &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 7, 7, 7, 9, 9, 9, 9, 9, 9, 10, 10, …
$ period &lt;dbl&gt; 7, 8, 9, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 7, 8, 9, 7, 8, 9, 10, 11…
$ event  &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ d7     &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0,…
$ d8     &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0,…
$ d9     &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1,…
$ d10    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ d11    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,…
$ d12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,…
$ pt     &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ pas    &lt;dbl&gt; 1.9788670, 1.9788670, 1.9788670, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -1.40498…</code></pre>
</div>
</div>
</section>
<section id="maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model" class="level3" data-number="11.3.2">
<h3 data-number="11.3.2" class="anchored" data-anchor-id="maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model"><span class="header-section-number">11.3.2</span> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model</h3>
<p>We’re not going to walk through all the foundational equations for the likelihood and log-likelihood functions (Equations 11.11 through 11.13). For our purposes, just note that “it turns out that the standard logistic regression routines widely available in all major statistical packages, <em>when applied appropriately in the person-period data set</em>, actually provide estimates of the parameters of the discrete-time hazard model” (p.&nbsp;383, <em>emphasis</em> in the original). Happily, this is what we’ve been doing. Bayesian logistic regression via the binomial likelihood has been our approach. And since we’re Bayesians, the same caveat applies to survival models as applied to the other longitudinal models we fit in earlier chapters. We’re not just maximizing likelihoods, here. Bayes’s formula requires us to multiply the likelihood by the prior.</p>
<p><span class="math display">\[
\underbrace{p(\theta \mid d)}_\text{posterior} \propto \underbrace{p(d \mid \theta)}_\text{likelihood} \; \underbrace{p(\theta)}_\text{prior}
\]</span></p>
</section>
<section id="fitting-the-discrete-time-hazard-model-to-data" class="level3" data-number="11.3.3">
<h3 data-number="11.3.3" class="anchored" data-anchor-id="fitting-the-discrete-time-hazard-model-to-data"><span class="header-section-number">11.3.3</span> Fitting the discrete-time hazard model to data</h3>
<p>In one sense, fitting discrete-hazard models with Bayesian logistic regression is old hat, for us. We’ve been doing that since the end of last chapter. But one thing I haven’t clarified is, up to this point, we have been using the aggregated binomial format. To show what I mean, we might look at the data we used for our last model, <code>fit11.6</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sex_aggregated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 7
   period pt    event no_event total period_center peroid_factor
    &lt;dbl&gt; &lt;fct&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;fct&gt;        
 1      7 0         2       70    72          -2.5 7            
 2      7 1        13       95   108          -2.5 7            
 3      8 0         2       68    70          -1.5 8            
 4      8 1         5       90    95          -1.5 8            
 5      9 0         8       60    68          -0.5 9            
 6      9 1        16       74    90          -0.5 9            
 7     10 0         8       52    60           0.5 10           
 8     10 1        21       53    74           0.5 10           
 9     11 0        10       42    52           1.5 11           
10     11 1        15       38    53           1.5 11           
11     12 0         8       34    42           2.5 12           
12     12 1        18       20    38           2.5 12           </code></pre>
</div>
</div>
<p>Now recall the formula for the binomial likelihood from the end of last chapter:</p>
<p><span class="math display">\[\Pr (z \mid n, p) = \frac{n!}{z!(n - z)!} p^z (1 - p)^{n - z},\]</span></p>
<p>where <span class="math inline">\(z\)</span> is the number of cases for which the value is 1, <span class="math inline">\(n\)</span> is the total number of cases, and <span class="math inline">\(p\)</span> is the constant chance of a 1 across cases. We refer to binomial data as aggregated with <span class="math inline">\(n &gt; 1\)</span>. Our <span class="math inline">\(n\)</span> vector in the <code>sex_aggregated</code>, <code>total</code>, ranged from 38 to 108. Accordingly, our <span class="math inline">\(z\)</span> vector, <code>event</code>, was always some value equal or lower to that in the same row for <code>total</code>.</p>
<p>The person-period data, <code>sex_pp</code>, contain the same information but in a different format. Instead, each <code>event</code> cell only takes on a value of 0 or 1 (i.e., <span class="math inline">\(n = 1\)</span>). If you were to sum up all the values in the <code>total</code> column of the <code>sex_aggregated</code> data, you’d return 822.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>sex_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">sum</span>(total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
    sum
  &lt;int&gt;
1   822</code></pre>
</div>
</div>
<p>This is also the total number of rows in the <code>sex_pp</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sex_pp <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1   822</code></pre>
</div>
</div>
<p>It’s also the case that when <span class="math inline">\(n = 1\)</span>, the right side of the equation for the binomial function reduces to</p>
<p><span class="math display">\[p^z (1 - p)^{1 - z}.\]</span></p>
<p>Whether you are working with aggregated or un-aggregated data, both are suited to fit logistic regression models with the binomial likelihood. Just specify the necessary information in the model syntax. For <strong>brms</strong>, the primary difference is how you use the <code>trials()</code> function. When we fit our logistic regression models using the aggregated data, we specified <code>trials(total)</code>, which informed the <code>brm()</code> function what the <span class="math inline">\(n\)</span> values were. In the case of unaggregated binomial data, we can just state <code>trials(1)</code>. Each cell is the outcome <span class="math inline">\(z\)</span> for a single trial.</p>
<p>Before we fit the models, we might talk a bit about priors. When we fit the first model of this kind at the end of Chapter 10, we just used <code>prior(normal(0, 4), class = b)</code> without comment. Recall we’re modeling probabilities in the log-odds space. In Section 11.1.2.1 we used a plot to compare probability values to their log-odds counterparts. Let’s take a more focused look.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">log_odds =</span> <span class="sc">-</span><span class="dv">8</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">plogis</span>(log_odds)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_odds, <span class="at">y =</span> p)) <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="sc">-</span><span class="dv">8</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>When <span class="math inline">\(\operatorname{log-odds} p = 0\)</span>, <span class="math inline">\(p = .5\)</span>. Once <span class="math inline">\(\operatorname{log-odds} p\)</span> approaches the <span class="math inline">\(\mp 4\)</span> neighborhood, the corresponding values for <span class="math inline">\(p\)</span> asymptote at the boundaries <span class="math inline">\([0, 1]\)</span>. By using a <span class="math inline">\(\operatorname{Normal} (0, 4)\)</span> prior for <span class="math inline">\(\operatorname{log-odds} p\)</span>, we’re putting bulk of the prior mass in the <span class="math inline">\(\operatorname{log-odds} p\)</span> space between, say, -8 and 8. In the absence of other information, this might be a good place to start. A little further down, we’ll reexamine this set-up. For now, here’s how to use <code>brm()</code> to fit Models A through D from page 385.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># model a</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_pp,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> d7 <span class="sc">+</span> d8 <span class="sc">+</span> d9 <span class="sc">+</span> d10 <span class="sc">+</span> d11 <span class="sc">+</span> d12,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.07"</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co"># model b</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_pp,</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> d7 <span class="sc">+</span> d8 <span class="sc">+</span> d9 <span class="sc">+</span> d10 <span class="sc">+</span> d11 <span class="sc">+</span> d12 <span class="sc">+</span> pt,</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.08"</span>)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="co"># model c</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_pp,</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> d7 <span class="sc">+</span> d8 <span class="sc">+</span> d9 <span class="sc">+</span> d10 <span class="sc">+</span> d11 <span class="sc">+</span> d12 <span class="sc">+</span> pas,</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.09"</span>)</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a><span class="co"># model d</span></span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_pp,</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> d7 <span class="sc">+</span> d8 <span class="sc">+</span> d9 <span class="sc">+</span> d10 <span class="sc">+</span> d11 <span class="sc">+</span> d12 <span class="sc">+</span> pt <span class="sc">+</span> pas,</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="interpreting-parameter-estimates" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="interpreting-parameter-estimates"><span class="header-section-number">11.4</span> Interpreting parameter estimates</h2>
<p>Here are the model summaries in bulk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 
   Data: sex_pp (Number of observations: 822) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
d7     -2.42      0.27    -2.99    -1.90 1.00     5474     2708
d8     -3.16      0.39    -3.99    -2.45 1.00     5084     2689
d9     -1.73      0.22    -2.18    -1.32 1.00     5905     2946
d10    -1.30      0.21    -1.72    -0.90 1.00     6003     2873
d11    -1.18      0.24    -1.67    -0.73 1.00     5527     2820
d12    -0.74      0.24    -1.21    -0.27 1.00     5473     2634

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt 
   Data: sex_pp (Number of observations: 822) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
d7     -3.00      0.32    -3.67    -2.41 1.00     3002     2651
d8     -3.72      0.43    -4.60    -2.94 1.00     3904     2855
d9     -2.28      0.27    -2.83    -1.76 1.00     2858     2526
d10    -1.82      0.26    -2.33    -1.32 1.00     2847     2679
d11    -1.66      0.27    -2.19    -1.15 1.00     3142     2901
d12    -1.17      0.27    -1.71    -0.64 1.00     3426     2801
pt      0.86      0.21     0.44     1.27 1.00     1836     2479

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pas 
   Data: sex_pp (Number of observations: 822) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
d7     -2.48      0.27    -3.04    -1.95 1.00     6119     2828
d8     -3.20      0.39    -4.04    -2.50 1.00     5649     2934
d9     -1.75      0.23    -2.21    -1.31 1.00     5914     2947
d10    -1.30      0.21    -1.72    -0.88 1.00     6462     3165
d11    -1.15      0.24    -1.62    -0.68 1.00     6668     2811
d12    -0.65      0.24    -1.15    -0.19 1.00     6184     3042
pas     0.44      0.11     0.22     0.67 1.00     6467     2951

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt + pas 
   Data: sex_pp (Number of observations: 822) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
d7     -2.92      0.32    -3.57    -2.32 1.00     3002     2698
d8     -3.62      0.42    -4.49    -2.85 1.00     3622     2913
d9     -2.16      0.28    -2.73    -1.64 1.00     2697     3005
d10    -1.70      0.26    -2.21    -1.20 1.00     2686     2709
d11    -1.52      0.28    -2.09    -1.01 1.00     2838     2869
d12    -1.01      0.28    -1.58    -0.48 1.00     2461     2688
pt      0.65      0.23     0.19     1.12 1.00     1579     2498
pas     0.30      0.13     0.05     0.55 1.00     3899     2889

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Although the text distinguishes between <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters (i.e., intercept and slope parameters, respectively), our <strong>brms</strong> output makes no such distinction. These are all of <code>class = b</code>, population-level <span class="math inline">\(\beta\)</span> parameters.</p>
<p>When viewed in bulk, all those <code>print()</code> calls yield a lot of output. We can arrange the parameter summaries similar to those in Table 11.3 with a little tricky wrangling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">str_c</span>(<span class="st">"model "</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]),</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">fit   =</span> <span class="fu">str_c</span>(<span class="st">"fit11."</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f =</span> <span class="fu">map</span>(fit, <span class="sc">~</span> <span class="fu">get</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fixef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rownames_to_column</span>(<span class="st">"parameter"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(f) <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_sd  =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(Estimate, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">" ("</span>, <span class="fu">round</span>(Est.Error, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">")"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, parameter, e_sd) <span class="sc">%&gt;%</span> </span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> model, <span class="at">values_from =</span> e_sd) <span class="sc">%&gt;%</span> </span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">width</span>(<span class="at">width =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-965a8ad0{}.cl-9657cc64{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9658ed92{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9658f97c{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9658f986{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9658f987{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-965a8ad0"><thead><tr style="overflow-wrap:break-word;"><th class="cl-9658f97c"><p class="cl-9658ed92"><span class="cl-9657cc64">parameter</span></p></th><th class="cl-9658f97c"><p class="cl-9658ed92"><span class="cl-9657cc64">model a</span></p></th><th class="cl-9658f97c"><p class="cl-9658ed92"><span class="cl-9657cc64">model b</span></p></th><th class="cl-9658f97c"><p class="cl-9658ed92"><span class="cl-9657cc64">model c</span></p></th><th class="cl-9658f97c"><p class="cl-9658ed92"><span class="cl-9657cc64">model d</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">d7</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-2.42 (0.27)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-3 (0.32)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-2.48 (0.27)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-2.92 (0.32)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">d8</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-3.16 (0.39)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-3.72 (0.43)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-3.2 (0.39)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-3.62 (0.42)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">d9</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.73 (0.22)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-2.28 (0.27)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.75 (0.23)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-2.16 (0.28)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">d10</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.3 (0.21)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.82 (0.26)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.3 (0.21)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.7 (0.26)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">d11</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.18 (0.24)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.66 (0.27)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.15 (0.24)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.52 (0.28)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">d12</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-0.74 (0.24)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.17 (0.27)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-0.65 (0.24)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">-1.01 (0.28)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">pt</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64"></span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">0.86 (0.21)</span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64"></span></p></td><td class="cl-9658f986"><p class="cl-9658ed92"><span class="cl-9657cc64">0.65 (0.23)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9658f987"><p class="cl-9658ed92"><span class="cl-9657cc64">pas</span></p></td><td class="cl-9658f987"><p class="cl-9658ed92"><span class="cl-9657cc64"></span></p></td><td class="cl-9658f987"><p class="cl-9658ed92"><span class="cl-9657cc64"></span></p></td><td class="cl-9658f987"><p class="cl-9658ed92"><span class="cl-9657cc64">0.44 (0.11)</span></p></td><td class="cl-9658f987"><p class="cl-9658ed92"><span class="cl-9657cc64">0.3 (0.13)</span></p></td></tr></tbody></table></div>
</div>
</div>
<section id="the-time-indicators" class="level3" data-number="11.4.1">
<h3 data-number="11.4.1" class="anchored" data-anchor-id="the-time-indicators"><span class="header-section-number">11.4.1</span> The time indicators</h3>
<blockquote class="blockquote">
<p>As a group, the <span class="math inline">\(\hat \alpha\)</span>s are [Bayesian] estimates for the baseline logit hazard function. The amount and direction of variation in their values describe the shape of this function and tell us whether risk increases, decreases, or remains steady over time. (p.&nbsp;387)</p>
</blockquote>
<p>A coefficient plot might help us get a sense of that across the four models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">str_c</span>(<span class="st">"model "</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]),</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">fit   =</span> <span class="fu">str_c</span>(<span class="st">"fit11."</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f =</span> <span class="fu">map</span>(fit, <span class="sc">~</span> <span class="fu">get</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fixef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rownames_to_column</span>(<span class="st">"parameter"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(f) <span class="sc">%&gt;%</span> </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(parameter, <span class="st">"d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parameter =</span> <span class="fu">factor</span>(<span class="fu">str_remove</span>(parameter, <span class="st">"b_"</span>), </span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">"d"</span>, <span class="dv">12</span><span class="sc">:</span><span class="dv">7</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> parameter)) <span class="sc">+</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"posterior (log-odds scale)"</span>,</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> model, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>“The fairly steady increase over time in the magnitude of the <span class="math inline">\(\hat \alpha\)</span>s in each model [in the coefficient plot] shows that, in this sample of boys, the risk of first intercourse increases over time” (p.&nbsp;387). When comparing the <span class="math inline">\(\hat \alpha\)</span>s across models, it’s important to recall that the presence/absence of substantive covariates means each model has a different baseline group.</p>
<p>Because they were in the log-odds scale, the model output and our coefficient plot can be difficult to interpret. With the <code>plogis()</code>, we can convert the <span class="math inline">\(\hat \alpha\)</span>s to the hazard (i.e., probability) metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">str_c</span>(<span class="st">"model "</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]),</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">fit   =</span> <span class="fu">str_c</span>(<span class="st">"fit11."</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f =</span> <span class="fu">map</span>(fit, <span class="sc">~</span> <span class="fu">get</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fixef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rownames_to_column</span>(<span class="st">"parameter"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(f) <span class="sc">%&gt;%</span> </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(parameter, <span class="st">"d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parameter =</span> <span class="fu">factor</span>(<span class="fu">str_remove</span>(parameter, <span class="st">"b_"</span>), </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">"d"</span>, <span class="dv">12</span><span class="sc">:</span><span class="dv">7</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(Estimate<span class="sc">:</span>Q97<span class="fl">.5</span>), <span class="at">.funs =</span> plogis) <span class="sc">%&gt;%</span> </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> parameter)) <span class="sc">+</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"posterior (hazard scale)"</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> model, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Building further, here’s our version of Table 11.4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11<span class="fl">.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"predictor"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">time period</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_remove</span>(predictor, <span class="st">"d"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">time period</span><span class="st">`</span>, predictor, Estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">fitted odds</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">exp</span>(Estimate),</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">fitted hazard</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">plogis</span>(Estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">width</span>(<span class="at">width =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-96a4e710{}.cl-96a1f91a{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-96a32fa6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-96a32fb0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-96a33c4e{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-96a33c4f{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-96a33c58{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-96a33c59{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-96a33c62{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-96a33c63{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-96a4e710"><thead><tr style="overflow-wrap:break-word;"><th class="cl-96a33c4e"><p class="cl-96a32fa6"><span class="cl-96a1f91a">time period</span></p></th><th class="cl-96a33c4f"><p class="cl-96a32fb0"><span class="cl-96a1f91a">predictor</span></p></th><th class="cl-96a33c4e"><p class="cl-96a32fa6"><span class="cl-96a1f91a">Estimate</span></p></th><th class="cl-96a33c4e"><p class="cl-96a32fa6"><span class="cl-96a1f91a">fitted odds</span></p></th><th class="cl-96a33c4e"><p class="cl-96a32fa6"><span class="cl-96a1f91a">fitted hazard</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">7</span></p></td><td class="cl-96a33c59"><p class="cl-96a32fb0"><span class="cl-96a1f91a">d7</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">-2.4215</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.0888</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.0816</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">8</span></p></td><td class="cl-96a33c59"><p class="cl-96a32fb0"><span class="cl-96a1f91a">d8</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">-3.1555</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.0426</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.0409</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">9</span></p></td><td class="cl-96a33c59"><p class="cl-96a32fb0"><span class="cl-96a1f91a">d9</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">-1.7344</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.1765</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.1500</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">10</span></p></td><td class="cl-96a33c59"><p class="cl-96a32fb0"><span class="cl-96a1f91a">d10</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">-1.2975</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.2732</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.2146</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">11</span></p></td><td class="cl-96a33c59"><p class="cl-96a32fb0"><span class="cl-96a1f91a">d11</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">-1.1753</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.3087</span></p></td><td class="cl-96a33c58"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.2359</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-96a33c62"><p class="cl-96a32fa6"><span class="cl-96a1f91a">12</span></p></td><td class="cl-96a33c63"><p class="cl-96a32fb0"><span class="cl-96a1f91a">d12</span></p></td><td class="cl-96a33c62"><p class="cl-96a32fa6"><span class="cl-96a1f91a">-0.7402</span></p></td><td class="cl-96a33c62"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.4770</span></p></td><td class="cl-96a33c62"><p class="cl-96a32fa6"><span class="cl-96a1f91a">0.3230</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
<section id="dichotomous-substantive-predictors" class="level3" data-number="11.4.2">
<h3 data-number="11.4.2" class="anchored" data-anchor-id="dichotomous-substantive-predictors"><span class="header-section-number">11.4.2</span> Dichotomous substantive predictors</h3>
<p>Here’s the summary for <code>pt</code> from <code>fit11.8</code> (i.e., Model B).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11<span class="fl">.8</span>)[<span class="st">"pt"</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Estimate Est.Error      Q2.5     Q97.5 
0.8579369 0.2140275 0.4417184 1.2704125 </code></pre>
</div>
</div>
<p>If we take the anti-log (i.e., exponentiate) of that coefficient, we’ll return an odds ratio. Here’s the conversion with just the posterior mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11<span class="fl">.8</span>)[<span class="st">"pt"</span>, <span class="dv">1</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.35829</code></pre>
</div>
</div>
<p>To get a better sense of the conversion, here it is in a plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(fit11<span class="fl">.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">log-odds</span><span class="st">`</span>     <span class="ot">=</span> b_pt,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_pt)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"log-odds"</span>, <span class="st">"hazard ratio"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.95</span>), <span class="at">normalize =</span> <span class="st">"panels"</span>) <span class="sc">+</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"marginal posterior for pt"</span>) <span class="sc">+</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>This tells us that, in every grade, the estimated odds of first intercourse are nearly two and one half times higher for boys who experienced a parenting transition in comparison to boys raised with both biological parents. In substantive terms, an odds ratio of this magnitude represents a substantial, and potentially important, effect. (p.&nbsp;398)</p>
</blockquote>
<p>To reframe the odds ratio in terms of the other group (i.e., <code>pt == 0</code>), take the reciprocal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(fit11<span class="fl">.8</span>)[<span class="dv">7</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.424036</code></pre>
</div>
</div>
<p>“This tells us that the estimated odds of first intercourse for boys who did not experience a parenting transition are approximately 40% of the odds for boys who did. These complimentary ways of reporting effect sizes are equivalent” (p.&nbsp;389)</p>
</section>
<section id="continuous-substantive-predictors" class="level3" data-number="11.4.3">
<h3 data-number="11.4.3" class="anchored" data-anchor-id="continuous-substantive-predictors"><span class="header-section-number">11.4.3</span> Continuous substantive predictors</h3>
<p>Here’s the conditional effect of <code>pas</code> from <code>fit11.9</code> (i.e., Model C).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11<span class="fl">.9</span>)[<span class="st">"pas"</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Estimate Est.Error      Q2.5     Q97.5 
0.4448054 0.1147100 0.2195005 0.6668125 </code></pre>
</div>
</div>
<p>To understand <code>pas</code>, our measure of parental antisocial behavior, it will help to look at its range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(sex_pp<span class="sc">$</span>pas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.716180  2.781413</code></pre>
</div>
</div>
<p>Exponentiating (i.e., taking the anti-log) the posterior of a continuous predictor is a legitimate way to convert it to a hazard ratio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit11<span class="fl">.9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">log-odds</span><span class="st">`</span>     <span class="ot">=</span> b_pas,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_pas)) <span class="sc">%&gt;%</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"log-odds"</span>, <span class="st">"hazard ratio"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.95</span>), <span class="at">normalize =</span> <span class="st">"panels"</span>) <span class="sc">+</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"marginal posterior for pas"</span>) <span class="sc">+</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Here’s how to compute the hazard ratio for a 2-unit difference in <code>pas</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">fixef</span>(fit11<span class="fl">.9</span>)[<span class="dv">7</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.434182</code></pre>
</div>
</div>
<p>Here’s what that looks like in a plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit11<span class="fl">.9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">log-odds</span><span class="st">`</span>                   <span class="ot">=</span> b_pas,</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>               <span class="ot">=</span> <span class="fu">exp</span>(b_pas),</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">hr for a 2-unit difference</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_pas <span class="sc">*</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"log-odds"</span>, <span class="st">"hazard ratio"</span>, <span class="st">"hr for a 2-unit difference"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.95</span>), <span class="at">normalize =</span> <span class="st">"panels"</span>) <span class="sc">+</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"marginal posterior for pas"</span>) <span class="sc">+</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="polytomous-substantive-predictors" class="level3" data-number="11.4.4">
<h3 data-number="11.4.4" class="anchored" data-anchor-id="polytomous-substantive-predictors"><span class="header-section-number">11.4.4</span> Polytomous substantive predictors</h3>
<p>Unfortunately, neither the <code>sex</code> nor the <code>sex_pp</code> data sets contain the polytomous version of <code>pt</code> as Singer described in this section. However, we can simulate a similar set of dummy variables which will allow us to trace the basic steps in Singer and Willett’s workflow.</p>
<p>Since we’ve been working with the <code>sex_pp</code> data for the past few models, we’ll continue using it here. However, this creates a minor challenge. What we want to do is use the <code>sample()</code> function to randomly assign cases with values of 1, 2, or 3 conditional on whether <code>pt == 0</code>. The catch is, we need to make sure that random value is constant for each case. Our solution will be to first nest the data such that each case only has one row. Here’s what that looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>sex_pp <span class="ot">&lt;-</span> sex_pp <span class="sc">%&gt;%</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(period, event, d7, d8, d9, d10, d11, d12, pas)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">random =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="fu">n</span>(), <span class="at">replace =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt_cat =</span> <span class="fu">ifelse</span>(pt <span class="sc">==</span> <span class="dv">0</span>, pt, random)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt1 =</span> <span class="fu">ifelse</span>(pt_cat <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">pt2 =</span> <span class="fu">ifelse</span>(pt_cat <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">pt3 =</span> <span class="fu">ifelse</span>(pt_cat <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, pt, random, pt_cat<span class="sc">:</span>pt3, data)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>sex_pp <span class="sc">%&gt;%</span> </span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
     id    pt random pt_cat   pt1   pt2   pt3 data            
  &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;          
1     1     0      2      0     0     0     0 &lt;tibble [3 × 9]&gt;
2     2     1      2      2     0     1     0 &lt;tibble [6 × 9]&gt;
3     3     0      1      0     0     0     0 &lt;tibble [6 × 9]&gt;
4     5     1      1      1     1     0     0 &lt;tibble [6 × 9]&gt;
5     6     0      1      0     0     0     0 &lt;tibble [5 × 9]&gt;
6     7     1      2      2     0     1     0 &lt;tibble [3 × 9]&gt;</code></pre>
</div>
</div>
<p>Here are the number of cases for each of the four levels of our pseudovariable <code>pt_cat</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>sex_pp <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pt_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  pt_cat     n
   &lt;dbl&gt; &lt;int&gt;
1      0    72
2      1    41
3      2    30
4      3    37</code></pre>
</div>
</div>
<p>Our breakdown isn’t exactly the same as the one in the text (p.&nbsp;391), but we’re in the ballpark. Before we’re ready to fit our next model, we’ll need to <code>unnest()</code> the data, which will transform <code>sex_pp</code> back into the familiar long format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>sex_pp <span class="ot">&lt;-</span> sex_pp <span class="sc">%&gt;%</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we fit the model with the <code>pt*</code> dummies, let’s backup and talk about priors, again. When we fit the last four models, our discussion about priors for <span class="math inline">\(p\)</span> focused on the posterior implications for those parameters in the log-odds space. Things get odd when we consider the implications in the probability space. To demonstrate, let’s simulate from <span class="math inline">\(\operatorname{Normal}(0, 4)\)</span> and see what it looks like when we transform the draws back into the probability metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">log_odds =</span> <span class="fu">rnorm</span>(<span class="fl">1e6</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">plogis</span>(log_odds)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Perhaps unexpectedly, our log-odds <span class="math inline">\(\operatorname{Normal}(0, 4)\)</span> prior ended up bunching up the prior mass at the boundaries. Depending on what we want, this may or may not make sense. If we want to regularize the coefficients toward zero in the probability space, something closer to <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span> would be a better idea. Here’s a look at what happens when we compare three simulations in that range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">1.5</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_odds =</span> <span class="fu">map</span>(sd, <span class="sc">~</span><span class="fu">rnorm</span>(<span class="fl">1e6</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .))) <span class="sc">%&gt;%</span> </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(log_odds) <span class="sc">%&gt;%</span> </span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sd =</span> <span class="fu">str_c</span>(<span class="st">"sd = "</span>, sd),</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">p  =</span> <span class="fu">plogis</span>(log_odds)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>It looks like the log-odds <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span> gently regularizes <span class="math inline">\(p\)</span> toward .5, but still allows for stronger values. This might be a good prior to use for our substantive covariates, what Singer and Willett referred to as the <span class="math inline">\(\beta\)</span> parameters. But I don’t know that this makes sense for our <span class="math inline">\(\alpha\)</span> parameters. If you’ve been following along with the model output, the life tables, and so on, you’ll have noticed those tend to drift toward the lower end of the probability range. Regularizing toward <span class="math inline">\(p = .5\)</span> might not be a good idea. In the absence of good substantive or statistical theory, perhaps it’s best to use a flat prior. The log-odds <span class="math inline">\(\operatorname{Normal} (0, 1.5)\)</span> prior is nearly flat on the probability space, but it does still push the mass away from the boundaries.</p>
<p>Maybe we can come up with something better. What if we simulated a large number of draws from the <span class="math inline">\(\operatorname{Uniform}(0, 1)\)</span> distribution, converted those draws to the log-odds metric, and fit a simple Student’s <span class="math inline">\(t\)</span> model? If we wanted to stay within the Student-<span class="math inline">\(t\)</span> family of priors, of which the normal is a special case, that would give us a sense of the what prior values would approximate a uniform distribution on the probability scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">runif</span>(<span class="fl">1e5</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">g =</span> <span class="fu">log_odds</span>(p)) </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> student,</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  g <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: student 
  Links: mu = identity 
Formula: g ~ 1 
   Data: dat (Number of observations: 100000) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.00      0.01    -0.01     0.02 1.00     2702     2539

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     1.57      0.01     1.55     1.58 1.00     2573     2810
nu        7.61      0.18     7.29     7.95 1.00     2147     2359

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Now we can reverse the process. Here’s what it would look like if we simulated from the Student <span class="math inline">\(t\)</span>-distribution based on those posterior means and then converted the results into the probability metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">g =</span> <span class="fu">rt</span>(<span class="fl">1e6</span>, <span class="at">df =</span> <span class="fl">7.61</span>) <span class="sc">*</span> <span class="fl">1.57</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">plogis</span>(g)) <span class="sc">%&gt;%</span> </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Now here’s what it might look like if fit the next model with the <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span> prior for the <span class="math inline">\(\beta\)</span> parameters and <span class="math inline">\(\text{Student-} t (7.61, 0, 1.57)\)</span> prior for the <span class="math inline">\(\alpha\)</span> parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex_pp,</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> d7 <span class="sc">+</span> d8 <span class="sc">+</span> d9 <span class="sc">+</span> d10 <span class="sc">+</span> d11 <span class="sc">+</span> d12 <span class="sc">+</span> pt1 <span class="sc">+</span> pt2 <span class="sc">+</span> pt3,</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="fl">7.61</span>, <span class="dv">0</span>, <span class="fl">1.57</span>), <span class="at">class =</span> b), </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> pt1), </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> pt2), </span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> pt3)),</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">11</span>,</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit11.12"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is the model summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt1 + pt2 + pt3 
   Data: sex_pp (Number of observations: 822) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
d7     -2.83      0.30    -3.43    -2.26 1.00     3834     3297
d8     -3.50      0.40    -4.34    -2.78 1.00     5135     2881
d9     -2.13      0.26    -2.65    -1.64 1.00     3509     2972
d10    -1.67      0.24    -2.15    -1.20 1.00     3704     3301
d11    -1.50      0.26    -2.03    -1.01 1.00     4463     3192
d12    -1.03      0.26    -1.57    -0.53 1.00     4586     2975
pt1     0.47      0.25    -0.02     0.95 1.00     3001     3249
pt2     0.51      0.27    -0.02     1.05 1.00     3283     3075
pt3     1.01      0.26     0.50     1.52 1.00     3252     2975

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>We can use the <code>tidy()</code> function and a few lines of wrangling code to make a version of the table in the middle of page 391.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11<span class="fl">.12</span>)[<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"predictor"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">odds ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(Estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(predictor, Estimate, <span class="st">`</span><span class="at">odds ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  predictor Estimate odds ratio
1       pt1    0.470      1.599
2       pt2    0.514      1.672
3       pt3    1.013      2.753</code></pre>
</div>
</div>
<p>Because our data did not include the original values for <code>pt1</code> through <code>pt3</code>, the results in our table will not match those in the text. We did get pretty close, though, eh? Hopefully this gives a sense of the workflow.</p>
</section>
</section>
<section id="displaying-fitted-hazard-and-survivor-functions" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="displaying-fitted-hazard-and-survivor-functions"><span class="header-section-number">11.5</span> Displaying fitted hazard and survivor functions</h2>
<p>This will be an extension of what we’ve already been doing.</p>
<section id="a-strategy-for-a-single-categorical-substantive-predictor" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1" class="anchored" data-anchor-id="a-strategy-for-a-single-categorical-substantive-predictor"><span class="header-section-number">11.5.1</span> A strategy for a single categorical substantive predictor</h3>
<p>We can make our version of Table 11.5 like so. To reduce clutter, we will use abbreviated column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">time  =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fu">fixef</span>(fit11<span class="fl">.8</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span>],</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta  =</span> <span class="fu">fixef</span>(fit11<span class="fl">.8</span>)[<span class="dv">7</span>, <span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lh0 =</span> alpha,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lh1 =</span> alpha <span class="sc">+</span> beta) <span class="sc">%&gt;%</span> </span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h0 =</span> <span class="fu">plogis</span>(lh0),</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">h1 =</span> <span class="fu">plogis</span>(lh1)) <span class="sc">%&gt;%</span> </span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s0 =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> h0),</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">s1 =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> h1)) <span class="sc">%&gt;%</span> </span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this just simplifies the output</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   time alpha  beta   lh0    lh1     h0     h1    s0    s1
  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     7 -3.00 0.858 -3.00 -2.15  0.0472 0.105  0.953 0.895
2     8 -3.72 0.858 -3.72 -2.87  0.0236 0.0538 0.930 0.847
3     9 -2.28 0.858 -2.28 -1.42  0.0926 0.194  0.844 0.683
4    10 -1.82 0.858 -1.82 -0.964 0.139  0.276  0.727 0.494
5    11 -1.66 0.858 -1.66 -0.801 0.160  0.310  0.610 0.341
6    12 -1.17 0.858 -1.17 -0.317 0.236  0.421  0.466 0.197</code></pre>
</div>
</div>
<p>For the <code>alpha</code> and <code>beta</code> columns, we just subset the values from <code>fixef()</code>. The two logit-hazard columns, <code>lh0</code> and <code>lh1</code>, were simple algebraic transformations of <code>alpha</code> and <code>beta</code>, respectively. To make the two hazard columns, <code>h0</code> and <code>h1</code>, we applied the <code>plogis()</code> function to <code>lh0</code> and <code>lh1</code>, respectively. To make the two survival columns, <code>s0</code> and <code>s1</code>, we applied the <code>cumprod()</code> function to one minus the two hazard columns. Note how all this is based off of the posterior means. There’s enough going on with Table 11.5 that it makes sense to ignore uncertainty But when we’re ready to go beyond table glancing and actually make a plot, we will go beyond posterior means and reintroduce the uncertainty in the model.</p>
<p>Two of these plots are quite similar to two of the subplots from Figure 11.4, back in Section 11.2.1. But recall that though those plots were based on <code>fit11.6</code>, which was based on the aggregated data, the plots we are about to make will be based on <code>fit11.8</code>, the analogous model based on the disaggregated person-period data. Regardless of whether the logistic regression model is based on aggregated data, the post-processing approach will involve the <code>fitted()</code> function. However, the specifics of how we use <code>fitted()</code> will differ. For the disaggregated data used to fit <code>fit11.8</code>, here is how we might define the <code>newdata</code>, pump it through the model via <code>fitted()</code>, and wrangle.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">pt     =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">period =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d7  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">d8  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">d9  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d10 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d11 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d12 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit11<span class="fl">.8</span>,</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">newdata =</span> nd,</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">scale =</span> <span class="st">"linear"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt =</span> <span class="fu">str_c</span>(<span class="st">"pt = "</span>, pt))</span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate Est.Error       Q2.5      Q97.5     pt period d7 d8 d9 d10 d11 d12
1  -3.0045085 0.3201316 -3.6661894 -2.4085317 pt = 0      7  1  0  0   0   0   0
2  -3.7244765 0.4282015 -4.5958307 -2.9358676 pt = 0      8  0  1  0   0   0   0
3  -2.2817925 0.2727385 -2.8325954 -1.7567166 pt = 0      9  0  0  1   0   0   0
4  -1.8217178 0.2570652 -2.3291953 -1.3223914 pt = 0     10  0  0  0   1   0   0
5  -1.6593222 0.2666743 -2.1899975 -1.1501632 pt = 0     11  0  0  0   0   1   0
6  -1.1747822 0.2724716 -1.7132102 -0.6392948 pt = 0     12  0  0  0   0   0   1
7  -2.1465716 0.2799461 -2.7126277 -1.6286540 pt = 1      7  1  0  0   0   0   0
8  -2.8665396 0.3968174 -3.6929531 -2.1443914 pt = 1      8  0  1  0   0   0   0
9  -1.4238557 0.2384241 -1.9046141 -0.9652484 pt = 1      9  0  0  1   0   0   0
10 -0.9637809 0.2227195 -1.4271826 -0.5471339 pt = 1     10  0  0  0   1   0   0
11 -0.8013854 0.2477223 -1.2949851 -0.3102280 pt = 1     11  0  0  0   0   1   0
12 -0.3168453 0.2650743 -0.8483419  0.1979386 pt = 1     12  0  0  0   0   0   1</code></pre>
</div>
</div>
<p>Here we make and save the upper two panels of Figure 11.6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(hazard)</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"fitted logit(hazard)"</span>,</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey92"</span>),</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.825</span>))</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard</span></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>), <span class="at">.funs =</span> plogis) <span class="sc">%&gt;%</span> </span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"fitted hazard"</span>,</span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we’re ready to make the last panel, we’ll redo our <code>fitted()</code> work, this time including predicted values for grade 6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">pt     =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">period =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d6  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">d7  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">d8  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d9  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d10 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d11 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">d12 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit11<span class="fl">.8</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt =</span> <span class="fu">str_c</span>(<span class="st">"pt = "</span>, pt))</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate  Est.Error        Q2.5      Q97.5     pt period d6 d7 d8 d9 d10 d11 d12
1  0.50000000 0.00000000 0.500000000 0.50000000 pt = 0      6  1  0  0  0   0   0   0
2  0.04929972 0.01480780 0.024936027 0.08252443 pt = 0      7  0  1  0  0   0   0   0
3  0.02554916 0.01034991 0.009992967 0.05040871 pt = 0      8  0  0  1  0   0   0   0
4  0.09517391 0.02337014 0.055587998 0.14720204 pt = 0      9  0  0  0  1   0   0   0
5  0.14205156 0.03097250 0.088733711 0.21042071 pt = 0     10  0  0  0  0   1   0   0
6  0.16306147 0.03612953 0.100652317 0.24045928 pt = 0     11  0  0  0  0   0   1   0
7  0.23945289 0.04902283 0.152747807 0.34540597 pt = 0     12  0  0  0  0   0   0   1
8  0.70032482 0.04456270 0.608668421 0.78081336 pt = 1      6  1  0  0  0   0   0   0
9  0.10751164 0.02628804 0.062232325 0.16401483 pt = 1      7  0  1  0  0   0   0   0
10 0.05734801 0.02073893 0.024293529 0.10485649 pt = 1      8  0  0  1  0   0   0   0
11 0.19674112 0.03728895 0.129587139 0.27582862 pt = 1      9  0  0  0  1   0   0   0
12 0.27831049 0.04415757 0.193538052 0.36652961 pt = 1     10  0  0  0  0   1   0   0
13 0.31217660 0.05245849 0.215010245 0.42305909 pt = 1     11  0  0  0  0   0   1   0
14 0.42275310 0.06353559 0.299780810 0.54932372 pt = 1     12  0  0  0  0   0   0   1</code></pre>
</div>
</div>
<p>The values for grade 6 (i.e., those for when <code>d6 == 1</code>) are nonsensical. The main reason we included <code>d6</code> in the fitted results and in the <code>nd</code> data is so we’d have the slots in our <code>f</code> object. In the code block below, we’ll fill those slots with the appropriate values (<code>0</code>) and then convert the hazard summaries to the survival (i.e., cumulative probability) metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Estimate =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">0</span>, Estimate),</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q2.5     =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">0</span>, Q2<span class="fl">.5</span>),</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q97.5    =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">0</span>, Q97<span class="fl">.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pt) <span class="sc">%&gt;%</span> </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s       =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> Estimate),</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">s_lower =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> Q2<span class="fl">.5</span>),</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">s_upper =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> Q97<span class="fl">.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pt<span class="sc">:</span>d12, s<span class="sc">:</span>s_upper)</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 12
Groups: pt [2]
$ pt      &lt;chr&gt; "pt = 0", "pt = 0", "pt = 0", "pt = 0", "pt = 0", "pt = 0", "pt = 0", "pt = 1", "pt = 1", "pt = 1", "pt = 1", "p…
$ period  &lt;int&gt; 6, 7, 8, 9, 10, 11, 12, 6, 7, 8, 9, 10, 11, 12
$ d6      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0
$ d7      &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0
$ d8      &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0
$ d9      &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0
$ d10     &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0
$ d11     &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0
$ d12     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1
$ s       &lt;dbl&gt; 1.0000000, 0.9507003, 0.9264107, 0.8382406, 0.7191672, 0.6018987, 0.4577723, 1.0000000, 0.8924884, 0.8413059, 0.…
$ s_lower &lt;dbl&gt; 1.0000000, 0.9750640, 0.9653202, 0.9116600, 0.8307650, 0.7471466, 0.6330216, 1.0000000, 0.9377677, 0.9149860, 0.…
$ s_upper &lt;dbl&gt; 1.0000000, 0.9174756, 0.8712268, 0.7429804, 0.5866420, 0.4455785, 0.2916730, 1.0000000, 0.8359852, 0.7483267, 0.…</code></pre>
</div>
</div>
<p>Make and save the final panel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the interpolated median lifetime values</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>imls <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">make_iml</span>(lt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pt <span class="sc">==</span> <span class="st">"pt = 0"</span>)), <span class="fu">make_iml</span>(lt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pt <span class="sc">==</span> <span class="st">"pt = 1"</span>)))</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pt,</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pt, <span class="at">color =</span> pt)) <span class="sc">+</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> imls[<span class="dv">1</span>], <span class="at">xend =</span> imls[<span class="dv">1</span>],</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="fl">0.5</span>,</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> imls[<span class="dv">2</span>], <span class="at">xend =</span> imls[<span class="dv">2</span>],</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="fl">0.5</span>,</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> s_lower, <span class="at">ymax =</span> s_upper),</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> s)) <span class="sc">+</span> </span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"fitted survival probability"</span>) <span class="sc">+</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine the subplots to finish off our version of Figure 11.6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3) <span class="sc">&amp;</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">&amp;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">&amp;</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Grade"</span>, <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="sc">&amp;</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Here is the breakdown of what percentage of boys will still be virgins at grades 9 and 12, based on <code>pt</code> status, as indicated by <code>fit11.8</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">12</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, <span class="sc">~</span> (. <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">percent virgins</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_c</span>(s, <span class="st">" ["</span>, s_lower, <span class="st">", "</span>, s_upper, <span class="st">"]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(period, pt, <span class="st">`</span><span class="at">percent virgins</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   pt [2]
  period pt     `percent virgins`
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;            
1      9 pt = 0 84 [91, 74]      
2      9 pt = 1 68 [80, 54]      
3     12 pt = 0 46 [63, 29]      
4     12 pt = 1 19 [35, 9]       </code></pre>
</div>
</div>
</section>
<section id="extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2" class="anchored" data-anchor-id="extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous"><span class="header-section-number">11.5.2</span> Extending this strategy to multiple predictors (some of which are continuous)</h3>
<blockquote class="blockquote">
<p>It is easy to display fitted hazard and survivor functions for model involving multiple predictor by extending these ideas in a straightforward manner. Instead of plotting one fitted function for <em>each</em> predictor value, select several <em>prototypical</em> predictor values (using strategies presented in section 4.5.3 and plot fitted functions for combinations of these values. (p.&nbsp;394, <em>emphasis</em> in the original)</p>
</blockquote>
<p>We’ll be focusing on <code>fit11.10</code>, which includes both <code>pt</code> and <code>sas</code> as substantive predictors. <code>pt</code> only takes two values, 0 and 1. For pas, we’ll use the conventional -1, 0, and 1. Here’s the <code>fitted()</code>-related code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">pt  =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">pas =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(pt, pas),</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">period =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d6  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d7  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d8  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d9  =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">d10 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">d11 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">d12 =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit11<span class="fl">.10</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Estimate   Est.Error        Q2.5      Q97.5 pt pas period d6 d7 d8 d9 d10 d11 d12
1 0.42551332 0.030772069 0.366453944 0.48718611  0  -1      6  1  0  0  0   0   0   0
2 0.04040092 0.012828155 0.020460045 0.07007207  0  -1      7  0  1  0  0   0   0   0
3 0.02123362 0.008811553 0.008034598 0.04190023  0  -1      8  0  0  1  0   0   0   0
4 0.08137512 0.021006064 0.045742638 0.12755480  0  -1      9  0  0  0  1   0   0   0
5 0.12186778 0.028481788 0.073149687 0.18529576  0  -1     10  0  0  0  0   1   0   0
6 0.14237510 0.034274264 0.083828430 0.21582173  0  -1     11  0  0  0  0   0   1   0</code></pre>
</div>
</div>
<p>Make the two subplots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(hazard)</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt  =</span> <span class="fu">str_c</span>(<span class="st">"pt = "</span>, pt),</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pas =</span> <span class="fu">str_c</span>(<span class="st">"pas = "</span>, pas)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pas =</span> <span class="fu">factor</span>(pas,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">"pas = "</span>, <span class="dv">1</span><span class="sc">:-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">&gt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pas,</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pas, <span class="at">color =</span> pas)) <span class="sc">+</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"fitted logit(hazard)"</span>,</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> pt)</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> f <span class="sc">%&gt;%</span> </span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Estimate =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">0</span>, Estimate),</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q2.5     =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">0</span>, Q2<span class="fl">.5</span>),</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q97.5    =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="dv">6</span>, <span class="dv">0</span>, Q97<span class="fl">.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt  =</span> <span class="fu">str_c</span>(<span class="st">"pt = "</span>, pt),</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">pas =</span> <span class="fu">str_c</span>(<span class="st">"pas = "</span>, pas)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pas =</span> <span class="fu">factor</span>(pas,</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">"pas = "</span>, <span class="dv">1</span><span class="sc">:-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pt, pas) <span class="sc">%&gt;%</span> </span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s       =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> Estimate),</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">s_lower =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> Q2<span class="fl">.5</span>),</span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">s_upper =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">-</span> Q97<span class="fl">.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">group =</span> pas,</span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> pas, <span class="at">color =</span> pas)) <span class="sc">+</span></span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> s_lower, <span class="at">ymax =</span> s_upper),</span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> s)) <span class="sc">+</span></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"fitted survival probability"</span>) <span class="sc">+</span></span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> pt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine the subplots to make our version of Figure 11.7.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>((p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"D"</span>, <span class="at">end =</span> <span class="fl">0.8</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"D"</span>, <span class="at">end =</span> <span class="fl">0.8</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Grade"</span>, <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="sc">&amp;</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())) <span class="sc">+</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Here we departed from the text a bit by separating the subplots by <code>pt</code> status. They’re already cluttered enough as is.</p>
</section>
<section id="two-cautions-when-interpreting-fitted-hazard-and-survivor-functions" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3" class="anchored" data-anchor-id="two-cautions-when-interpreting-fitted-hazard-and-survivor-functions"><span class="header-section-number">11.5.3</span> Two cautions when interpreting fitted hazard and survivor functions</h3>
<p>Beware of inferring statistical interaction of a substantive predictor and time when examining plots if fitted hazard and survivor functions. The root of this difficulty is in our use of a link function.</p>
<blockquote class="blockquote">
<p>Because the model expresses the linear effect of the predictor on logit hazard, you cannot draw a conclusion about the stability of an effect using graphs plotted on a raw hazard scale. In fact, the logic works in the <em>opposite</em> direction. If the size of the gap between fitted hazard functions is constant over time, [the] effect of the predictor must <em>vary</em> over time! (pp.&nbsp;396-397, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Also, please don’t confuse plots of fitted values with descriptive sample-based plots. Hopefully our inclusion of 95% intervals helps prevent this.</p>
</section>
</section>
<section id="comparing-models-using-deviance-statistics-and-information-criteria" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="comparing-models-using-deviance-statistics-and-information-criteria"><span class="header-section-number">11.6</span> Comparing models using <del>deviance statistics and</del> information criteria</h2>
<blockquote class="blockquote">
<p>We now introduce two important questions that we usually address before interpreting parameters and displaying results: Which of the alternative models fits better: Might a predictor’s observed effect be the result of nothing more than sampling variation? (p.&nbsp;397)</p>
</blockquote>
<p>Much of the material in this section will be a refresher from the material we covered in Section 4.6.</p>
<section id="the-deviance-statistic" class="level3" data-number="11.6.1">
<h3 data-number="11.6.1" class="anchored" data-anchor-id="the-deviance-statistic"><span class="header-section-number">11.6.1</span> The deviance statistic</h3>
<p>The log-likelihood, LL, is</p>
<blockquote class="blockquote">
<p>a summary statistic routinely output (in some form) by any program that provides ML estimates. As discussed in section 4.6, its relative magnitude across a series of models fit to the same set of data can be informative (although its absolute magnitude is not). The larger the LL statistic, the better the fit. (pp.&nbsp;397–398)</p>
</blockquote>
<p>Note that <em>in some form</em> part. Frequentist software typically returns the LL for a given model as a single value. As we learned way back in Section 4.6, we can use the <code>log_lik()</code> function to get the LL information from our <strong>brms</strong> fits. However, form the <a href="https://CRAN.R-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> we discover <code>log_lik()</code> returns an “S x N matrix containing the pointwise log-likelihood samples, where S is the number of samples and N is the number of observations in the data” (p.&nbsp;112). Using <code>fit11.7</code> as a test case, here’s what that looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_lik</span>(fit11<span class="fl">.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000, 1:822] -0.1086 -0.0709 -0.1042 -0.0756 -0.0781 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : NULL</code></pre>
</div>
</div>
<p>To compute the LL for each HMC iteration, you sum across the rows. Deviance is that sum multiplied by -2. Here’s that in a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> fit11<span class="fl">.7</span> <span class="sc">%&gt;%</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>() <span class="sc">%&gt;%</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="sc">~</span> <span class="fu">str_c</span>(<span class="st">"c"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">822</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ll =</span> <span class="fu">rowSums</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deviance =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> ll) <span class="sc">%&gt;%</span> </span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ll, deviance, <span class="fu">everything</span>())</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>ll</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,000 × 824
      ll deviance      c1      c2    c3      c4      c5     c6     c7     c8     c9     c10     c11    c12    c13    c14    c15
   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -329.     658. -0.109  -0.0455 -1.98 -0.109  -0.0455 -0.149 -0.253 -0.219 -0.255 -0.109  -0.0455 -0.149 -0.253 -0.219 -0.255
 2 -330.     661. -0.0709 -0.0295 -2.11 -0.0709 -0.0295 -0.130 -0.284 -0.182 -0.297 -0.0709 -0.0295 -0.130 -0.284 -0.182 -0.297
 3 -331.     662. -0.104  -0.0605 -1.68 -0.104  -0.0605 -0.206 -0.176 -0.395 -0.455 -0.104  -0.0605 -0.206 -0.176 -0.395 -0.455
 4 -329.     658. -0.0756 -0.0328 -1.97 -0.0756 -0.0328 -0.151 -0.333 -0.199 -0.366 -0.0756 -0.0328 -0.151 -0.333 -0.199 -0.366
 5 -327.     655. -0.0781 -0.0504 -1.95 -0.0781 -0.0504 -0.154 -0.307 -0.249 -0.346 -0.0781 -0.0504 -0.154 -0.307 -0.249 -0.346
 6 -328.     657. -0.0611 -0.0425 -1.89 -0.0611 -0.0425 -0.163 -0.299 -0.229 -0.310 -0.0611 -0.0425 -0.163 -0.299 -0.229 -0.310
 7 -331.     662. -0.0841 -0.0342 -1.92 -0.0841 -0.0342 -0.159 -0.385 -0.235 -0.298 -0.0841 -0.0342 -0.159 -0.385 -0.235 -0.298
 8 -329.     657. -0.114  -0.0306 -1.69 -0.114  -0.0306 -0.204 -0.209 -0.244 -0.313 -0.114  -0.0306 -0.204 -0.209 -0.244 -0.313
 9 -328.     655. -0.0679 -0.0407 -2.05 -0.0679 -0.0407 -0.138 -0.259 -0.336 -0.434 -0.0679 -0.0407 -0.138 -0.259 -0.336 -0.434
10 -329.     658. -0.0616 -0.0749 -2.10 -0.0616 -0.0749 -0.131 -0.284 -0.279 -0.396 -0.0616 -0.0749 -0.131 -0.284 -0.279 -0.396
# ℹ 3,990 more rows
# ℹ 807 more variables: c16 &lt;dbl&gt;, c17 &lt;dbl&gt;, c18 &lt;dbl&gt;, c19 &lt;dbl&gt;, c20 &lt;dbl&gt;, c21 &lt;dbl&gt;, c22 &lt;dbl&gt;, c23 &lt;dbl&gt;, c24 &lt;dbl&gt;,
#   c25 &lt;dbl&gt;, c26 &lt;dbl&gt;, c27 &lt;dbl&gt;, c28 &lt;dbl&gt;, c29 &lt;dbl&gt;, c30 &lt;dbl&gt;, c31 &lt;dbl&gt;, c32 &lt;dbl&gt;, c33 &lt;dbl&gt;, c34 &lt;dbl&gt;, c35 &lt;dbl&gt;,
#   c36 &lt;dbl&gt;, c37 &lt;dbl&gt;, c38 &lt;dbl&gt;, c39 &lt;dbl&gt;, c40 &lt;dbl&gt;, c41 &lt;dbl&gt;, c42 &lt;dbl&gt;, c43 &lt;dbl&gt;, c44 &lt;dbl&gt;, c45 &lt;dbl&gt;, c46 &lt;dbl&gt;,
#   c47 &lt;dbl&gt;, c48 &lt;dbl&gt;, c49 &lt;dbl&gt;, c50 &lt;dbl&gt;, c51 &lt;dbl&gt;, c52 &lt;dbl&gt;, c53 &lt;dbl&gt;, c54 &lt;dbl&gt;, c55 &lt;dbl&gt;, c56 &lt;dbl&gt;, c57 &lt;dbl&gt;,
#   c58 &lt;dbl&gt;, c59 &lt;dbl&gt;, c60 &lt;dbl&gt;, c61 &lt;dbl&gt;, c62 &lt;dbl&gt;, c63 &lt;dbl&gt;, c64 &lt;dbl&gt;, c65 &lt;dbl&gt;, c66 &lt;dbl&gt;, c67 &lt;dbl&gt;, c68 &lt;dbl&gt;,
#   c69 &lt;dbl&gt;, c70 &lt;dbl&gt;, c71 &lt;dbl&gt;, c72 &lt;dbl&gt;, c73 &lt;dbl&gt;, c74 &lt;dbl&gt;, c75 &lt;dbl&gt;, c76 &lt;dbl&gt;, c77 &lt;dbl&gt;, c78 &lt;dbl&gt;, c79 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Since we have distributions for the LL and deviance, we may as well visualize them in a plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>ll <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(ll<span class="sc">:</span>deviance) <span class="sc">%&gt;%</span> </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ll"</span>, <span class="st">"deviance"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">normalize =</span> <span class="st">"panels"</span>) <span class="sc">+</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Here’s how to compute the LL and deviance distributions for each of our four models, <code>fit11.7</code> through <code>fit11.10</code>, in bulk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">str_c</span>(<span class="st">"model "</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]),</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">name  =</span> <span class="fu">str_c</span>(<span class="st">"fit11."</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">map</span>(name, get)) <span class="sc">%&gt;%</span> </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ll =</span> <span class="fu">map</span>(fit, <span class="sc">~</span><span class="fu">log_lik</span>(.) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(<span class="at">ll =</span> <span class="fu">rowSums</span>(.)))) <span class="sc">%&gt;%</span> </span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fit) <span class="sc">%&gt;%</span> </span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(ll) <span class="sc">%&gt;%</span> </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deviance =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> ll)</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>ll <span class="sc">%&gt;%</span> </span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16,000
Columns: 4
$ model    &lt;chr&gt; "model a", "model a", "model a", "model a", "model a", "model a", "model a", "model a", "model a", "model a", "…
$ name     &lt;chr&gt; "fit11.7", "fit11.7", "fit11.7", "fit11.7", "fit11.7", "fit11.7", "fit11.7", "fit11.7", "fit11.7", "fit11.7", "…
$ ll       &lt;dbl&gt; -329.1751, -330.4153, -330.9811, -329.1648, -327.3291, -328.4891, -330.8290, -328.6211, -327.5347, -328.9812, -…
$ deviance &lt;dbl&gt; 658.3502, 660.8305, 661.9622, 658.3296, 654.6582, 656.9782, 661.6579, 657.2422, 655.0694, 657.9625, 658.3806, 6…</code></pre>
</div>
</div>
<p>Now plot the LL and deviance distributions for each.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>ll <span class="sc">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(ll<span class="sc">:</span>deviance,</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"statistic"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">statistic =</span> <span class="fu">factor</span>(statistic, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ll"</span>, <span class="st">"deviance"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> model)) <span class="sc">+</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">normalize =</span> <span class="st">"panels"</span>) <span class="sc">+</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> statistic, <span class="at">scales =</span> <span class="st">"free_x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="deviance-based-hypothesis-tests-for-individual-predictors" class="level3" data-number="11.6.2">
<h3 data-number="11.6.2" class="anchored" data-anchor-id="deviance-based-hypothesis-tests-for-individual-predictors"><span class="header-section-number">11.6.2</span> Deviance-based hypothesis tests for individual predictors</h3>
<p>Singer and Willett wrote: “Comparing deviance statistics for pairs of nested models that differ only by a single substantive predictor permits evaluation of the ‘statistical significance’ of that predictor” (p.&nbsp;399). I’m just not going to appeal to null-hypothesis significance testing in this project and, as an extension, I am not going to appeal to tests using the <span class="math inline">\(\chi^2\)</span> distribution. But sure, you could take our deviance distributions and compare them with difference distributions. Singer and Willett made four deviance comparisons in this section. Here’s what that might look like using our deviance distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>ll <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, deviance) <span class="sc">%&gt;%</span> </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>, <span class="at">times =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> model,</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> deviance) <span class="sc">%&gt;%</span> </span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">a - b</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">model a</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">model b</span><span class="st">`</span>,</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">a - c</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">model a</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">model c</span><span class="st">`</span>,</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">c - d</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">model c</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">model d</span><span class="st">`</span>,</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">b - d</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">model b</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">model d</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">"-"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">normalize =</span> <span class="st">"panels"</span>) <span class="sc">+</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"deviance difference distribution"</span>,</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>But really, like no one does this with Bayesian models. If you think you have a good theoretical reason to use this approach, do not cite this project as a justification. I do not endorse it.</p>
</section>
<section id="deviance-based-hypothesis-tests-for-groups-of-predictors" class="level3" data-number="11.6.3">
<h3 data-number="11.6.3" class="anchored" data-anchor-id="deviance-based-hypothesis-tests-for-groups-of-predictors"><span class="header-section-number">11.6.3</span> Deviance-based hypothesis tests for groups of predictors</h3>
<p>We won’t be doing this.</p>
</section>
<section id="comparing-nonnested-models-using-waic-and-loo" class="level3" data-number="11.6.4">
<h3 data-number="11.6.4" class="anchored" data-anchor-id="comparing-nonnested-models-using-waic-and-loo"><span class="header-section-number">11.6.4</span> Comparing nonnested models using [WAIC and LOO]</h3>
<p>Now we return to our preferred methods for model comparison. Use the <code>add_criterion()</code> function to compute the WAIC and LOO and add their output to the model fits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.7</span>  <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit11<span class="fl">.7</span>, <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.8</span>  <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit11<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.9</span>  <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit11<span class="fl">.9</span>, <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>fit11<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit11<span class="fl">.10</span>, <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First compare Models B and C (i.e., <code>fit11.8</code> and <code>fit11.9</code>, respectively).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
fit11.8    0.0       0.0  -324.5     17.6         7.1    0.6    649.0   35.2  
fit11.9   -1.3       4.6  -325.7     17.6         7.2    0.6    651.5   35.1  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
fit11.8    0.0       0.0  -324.5      17.6          7.1    0.6     648.9   35.2 
fit11.9   -1.3       4.6  -325.7      17.6          7.1    0.6     651.5   35.1 </code></pre>
</div>
</div>
<p>In a head-to-head comparison, Model B is a little better than Model C. However, the standard error for their difference score is about three times as large as the difference itself. This is not a difference I would write home about. Now compare Models A through D.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
fit11.10    0.0       0.0  -322.7     17.6         8.2    0.6    645.5   35.2  
fit11.8    -1.7       2.5  -324.5     17.6         7.1    0.6    649.0   35.2  
fit11.9    -3.0       2.8  -325.7     17.6         7.2    0.6    651.5   35.1  
fit11.7    -9.4       4.8  -332.2     17.6         6.2    0.5    664.4   35.3  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
fit11.10    0.0       0.0  -322.7      17.6          8.2    0.6     645.5   35.2 
fit11.8    -1.7       2.5  -324.5      17.6          7.1    0.6     648.9   35.2 
fit11.9    -3.0       2.8  -325.7      17.6          7.1    0.6     651.5   35.1 
fit11.7    -9.5       4.8  -332.2      17.6          6.2    0.5     664.4   35.3 </code></pre>
</div>
</div>
<p>Model D (i.e., <code>fit11.10</code>, the full model) has the best (i.e., lowest) WAIC and LOO estimates. However, the standard errors for its difference scores with the other models is on the large side, particularly for Models B and C. So sure, adding either <code>pt</code> or <code>sas</code> to the model helps a bit and adding them both helps a little more, but neither predictor is a huge winner when you take that model complexity penalty into account.</p>
<p>As discussed earlier, we can also compare the models using weights. Here we’ll use the WAIC, LOO, and stacking weights to compare all four models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="at">weights =</span> <span class="st">"loo"</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> fit11.7  fit11.8  fit11.9 fit11.10 
   0.000    0.143    0.041    0.816 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="at">weights =</span> <span class="st">"waic"</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> fit11.7  fit11.8  fit11.9 fit11.10 
   0.000    0.143    0.041    0.816 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="at">weights =</span> <span class="st">"stacking"</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> fit11.7  fit11.8  fit11.9 fit11.10 
   0.000    0.352    0.259    0.389 </code></pre>
</div>
</div>
<p>Model D has the best showing across the three weighting schemes.</p>
</section>
</section>
<section id="statistical-inference-using-uncertainty-in-the-bayesian-posterior" class="level2" data-number="11.7">
<h2 data-number="11.7" class="anchored" data-anchor-id="statistical-inference-using-uncertainty-in-the-bayesian-posterior"><span class="header-section-number">11.7</span> Statistical inference using [uncertainty in the Bayesian posterior]</h2>
<p>I generally take a model-based approach to Bayesian statistics and I prefer to scrutinize marginal posteriors, consider effect sizes, and use graphical depictions of my models (e.g., posterior predictive checks) over hypothesis testing. Further extending that approach, here, puts us at further odds with the content in the test. In addition, the authors spent some time discussing the asymptotic properties of ML standard errors. Our Bayesian approach is not based on asymptotic theory and we just don’t need to concern ourselves with whether our marginal posteriors are Gaussian. They often are, which is nice. But we summarize our posteriors with percentile-based 95% intervals, we are not presuming they are symmetric or Gaussian.</p>
<section id="the-wald-chi-square-statistic" class="level3" data-number="11.7.1">
<h3 data-number="11.7.1" class="anchored" data-anchor-id="the-wald-chi-square-statistic"><span class="header-section-number">11.7.1</span> The <del>Wald chi-square statistic</del></h3>
<p>This will not be our approach. On page 404, Singer and Willett wrote: “The logistic regression analysis routines in all major statistical packages routinely output asymptotic standard errors.” This comment presumes we’re focusing on frequentist packages. Our rough analogue to frequentist standard errors is our Bayesian posterior standard deviations. The authors focused on the two substantive predictors from Model D (i.e., <code>fit11.10</code>). Here’s another look at the <strong>brms</strong> summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit11<span class="fl">.10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt + pas 
   Data: sex_pp (Number of observations: 822) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
d7     -2.92      0.32    -3.57    -2.32 1.00     3002     2698
d8     -3.62      0.42    -4.49    -2.85 1.00     3622     2913
d9     -2.16      0.28    -2.73    -1.64 1.00     2697     3005
d10    -1.70      0.26    -2.21    -1.20 1.00     2686     2709
d11    -1.52      0.28    -2.09    -1.01 1.00     2838     2869
d12    -1.01      0.28    -1.58    -0.48 1.00     2461     2688
pt      0.65      0.23     0.19     1.12 1.00     1579     2498
pas     0.30      0.13     0.05     0.55 1.00     3899     2889

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Recall that the second column for our ‘Population-Level Effects’, ‘Est.Error’, contains the standard deviation for each dimension of the posteriors listed (i.e., for each parameter ranging from <code>d7</code> to <code>pas</code>). This is similar, but distinct from, the frequentist standard error. Instead of focusing on <span class="math inline">\(p\)</span>-values connected to standard errors, why not look at the marginal posteriors directly?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit11<span class="fl">.10</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_pt<span class="sc">:</span>b_pas) <span class="sc">%&gt;%</span> </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> <span class="fu">stat</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>() <span class="sc">+</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue3"</span>, <span class="st">"red3"</span>)) <span class="sc">+</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"marginal posterior"</span>,</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>If we’d like to keep with the NHST perspective, zero is not a particularly credible value for either parameter. But neither are negative values in generals. In terms of uncertainty, look how much wider the posterior for <code>pt</code> is when compared with <code>pas</code>. And don’t forget that these are on the log-odds scale.</p>
<p>Looking at those densities might lead one to ask, <em>Exactly what proportion of the posterior draws for each is zero or below</em>? You can compute that like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_pt<span class="sc">:</span>b_pas) <span class="sc">%&gt;%</span> </span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">percent zero or below</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(value <span class="sc">&lt;=</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  name  `percent zero or below`
  &lt;chr&gt;                   &lt;dbl&gt;
1 b_pas                    0.85
2 b_pt                     0.3 </code></pre>
</div>
</div>
<p>Less that 1% of the draws were zero or below for each.</p>
</section>
<section id="asymmetric-credible-intervals-for-parameters-and-odds-ratios" class="level3" data-number="11.7.2">
<h3 data-number="11.7.2" class="anchored" data-anchor-id="asymmetric-credible-intervals-for-parameters-and-odds-ratios"><span class="header-section-number">11.7.2</span> [Asymmetric credible intervals] for parameters and odds ratios</h3>
<p>Whether we use percentile-based credible intervals, as we typically do, or use highest posterior density intervals, neither depends on asymptotic theory nor do they depend on the posterior standard deviation. That is, our Bayesian intervals do not presume the marginal posteriors are Gaussian. Let’s look back at the summary output for <code>fit11.10</code>, this time using the <code>fixef()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11<span class="fl">.10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Estimate Est.Error       Q2.5      Q97.5
d7  -2.9158998 0.3175476 -3.5694292 -2.3224360
d8  -3.6152021 0.4244056 -4.4859984 -2.8510084
d9  -2.1558972 0.2775011 -2.7335041 -1.6361895
d10 -1.7001798 0.2592930 -2.2134526 -1.1950339
d11 -1.5227911 0.2753575 -2.0883454 -1.0105407
d12 -1.0114062 0.2824609 -1.5767367 -0.4808470
pt   0.6463053 0.2340488  0.1931138  1.1227183
pas  0.3013619 0.1263270  0.0512668  0.5474599</code></pre>
</div>
</div>
<p>We find the lower- and upper-limits for our percentile-based Bayesian credible intervals in the last two columns. If you’d like HDIs instead, use the convenience functions from <strong>tidybayes</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_pt<span class="sc">:</span>b_pas) <span class="sc">%&gt;%</span> </span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  name  value .lower .upper .width .point .interval
  &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 b_pas 0.301 0.0414  0.534   0.95 mean   hdi      
2 b_pt  0.646 0.147   1.07    0.95 mean   hdi      </code></pre>
</div>
</div>
<p>We can exponentiate our measures of central tendency (e.g., posterior means) and posterior intervals to transform them out of the log-odds metric an into the odds-ratio metric. Here are the results working directly with <code>fixef()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit11<span class="fl">.10</span>)[<span class="fu">c</span>(<span class="st">"pt"</span>, <span class="st">"pas"</span>), <span class="sc">-</span><span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Estimate     Q2.5    Q97.5
pt  1.908477 1.213021 3.073197
pas 1.351698 1.052604 1.728856</code></pre>
</div>
</div>
<p>Keep in mind that fixating on just the 95% intervals is a little NHST-centric. Since we have entire posterior distributions to summarize, we might consider other intervals. Here we use another graphical approach by using <code>tidybayes_statintervalh()</code> to mark off the 10, 30, 50, 70, and 90% intervals for both substantive predictors. Both are in the odds-ratio metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_pt<span class="sc">:</span>b_pas) <span class="sc">%&gt;%</span> </span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">odds ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">odds ratio</span><span class="st">`</span>, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_interval</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">.width =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>(<span class="st">"CI level:"</span>, <span class="at">start =</span> <span class="fl">0.8</span>, <span class="at">end =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The frequentist 95% confidence intervals are asymmetric when expressed in the odds-ratio metric and so are our various Bayesian intervals. However, the asymmetry in our Bayesian intervals is less noteworthy because there was no explicit assumption of symmetry when they were in the log-odds metric.</p>
</section>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">Session info</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Ventura 13.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] tidybayes_3.0.7 brms_2.23.0     Rcpp_1.1.0      patchwork_1.3.2 survival_3.8-3  lubridate_1.9.4 forcats_1.0.1  
 [8] stringr_1.6.0   dplyr_1.1.4     purrr_1.2.1     readr_2.1.5     tidyr_1.3.2     tibble_3.3.1    ggplot2_4.0.1  
[15] tidyverse_2.0.0

loaded via a namespace (and not attached):
 [1] gridExtra_2.3           inline_0.3.21           sandwich_3.1-1          rlang_1.1.7             magrittr_2.0.4         
 [6] multcomp_1.4-29         matrixStats_1.5.0       compiler_4.5.1          loo_2.9.0.9000          systemfonts_1.3.1      
[11] vctrs_0.7.0             reshape2_1.4.5          arrayhelpers_1.1-0      pkgconfig_2.0.3         crayon_1.5.3           
[16] fastmap_1.2.0           backports_1.5.0         labeling_0.4.3          utf8_1.2.6              rmarkdown_2.30         
[21] tzdb_0.5.0              ragg_1.5.0              bit_4.6.0               xfun_0.55               jsonlite_2.0.0         
[26] uuid_1.2-1              parallel_4.5.1          R6_2.6.1                stringi_1.8.7           RColorBrewer_1.1-3     
[31] StanHeaders_2.36.0.9000 estimability_1.5.1      rstan_2.36.0.9000       knitr_1.51              zoo_1.8-14             
[36] bayesplot_1.15.0.9000   Matrix_1.7-3            splines_4.5.1           timechange_0.3.0        tidyselect_1.2.1       
[41] rstudioapi_0.17.1       abind_1.4-8             codetools_0.2-20        curl_7.0.0              pkgbuild_1.4.8         
[46] lattice_0.22-7          plyr_1.8.9              withr_3.0.2             bridgesampling_1.2-1    S7_0.2.1               
[51] flextable_0.9.10        askpass_1.2.1           posterior_1.6.1.9000    coda_0.19-4.1           evaluate_1.0.5         
[56] RcppParallel_5.1.11-1   ggdist_3.3.3            zip_2.3.3               xml2_1.4.0              pillar_1.11.1          
[61] tensorA_0.36.2.1        checkmate_2.3.3         stats4_4.5.1            distributional_0.5.0    generics_0.1.4         
[66] vroom_1.6.6             hms_1.1.4               rstantools_2.5.0.9000   scales_1.4.0            xtable_1.8-4           
[71] glue_1.8.0              gdtools_0.4.4           emmeans_1.11.2-8        tools_4.5.1             data.table_1.17.8      
[76] mvtnorm_1.3-3           grid_4.5.1              QuickJSR_1.8.1          nlme_3.1-168            cli_3.6.5              
[81] textshaping_1.0.4       officer_0.7.2           svUnit_1.0.8            fontBitstreamVera_0.1.1 viridisLite_0.4.2      
[86] Brobdingnag_1.2-9       V8_8.0.1                gtable_0.3.6            digest_0.6.39           fontquiver_0.2.1       
[91] TH.data_1.1-4           htmlwidgets_1.6.4       farver_2.1.2            htmltools_0.5.9         lifecycle_1.0.5        
[96] fontLiberation_0.1.0    openssl_2.3.4           bit64_4.6.0-1           MASS_7.3-65            </code></pre>
</div>
</div>
</section>
<section id="comments" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="comments">Comments</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Brilleman2019EstimatingSurvival" class="csl-entry" role="listitem">
Brilleman, S. (2019). <em>Estimating survival (time-to-event) models with rstanarm</em>. <a href="https://github.com/stan-dev/rstanarm/blob/feature/frailty-models/vignettes/surv.Rmd">https://github.com/stan-dev/rstanarm/blob/feature/frailty-models/vignettes/surv.Rmd</a>
</div>
<div id="ref-brilleman2020BayesianSurvivalAnalysis" class="csl-entry" role="listitem">
Brilleman, S. L., Elci, E. M., Novik, J. B., &amp; Wolfe, R. (2020). <em>Bayesian survival analysis using the <span class="nocase">rstanarm R</span> package</em>. <a href="https://arxiv.org/abs/2002.09633">https://arxiv.org/abs/2002.09633</a>
</div>
<div id="ref-capaldiPredictingTimingFirst1996" class="csl-entry" role="listitem">
Capaldi, D. M., Crosby, L., &amp; Stoolmiller, M. (1996). Predicting the timing of first sexual intercourse for at-risk adolescent males. <em>Child Development</em>, <em>67</em>(2), 344–359. <a href="https://doi.org/10.2307/1131818">https://doi.org/10.2307/1131818</a>
</div>
<div id="ref-cox1972regression" class="csl-entry" role="listitem">
Cox, D. R. (1972). Regression models and life-tables. <em>Journal of the Royal Statistical Society: Series B (Methodological)</em>, <em>34</em>(2), 187–202. <a href="https://doi.org/10.1111/j.2517-6161.1972.tb00899.x">https://doi.org/10.1111/j.2517-6161.1972.tb00899.x</a>
</div>
<div id="ref-singerAppliedLongitudinalData2003" class="csl-entry" role="listitem">
Singer, J. D., &amp; Willett, J. B. (2003). <em>Applied longitudinal data analysis: <span>Modeling</span> change and event occurrence</em>. Oxford University Press, USA. <a href="https://oxford.universitypressscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968">https://oxford.universitypressscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968</a>
</div>
</div>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/solomon\.quarto\.pub\/alda\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkxODg5MTU1MTM=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOC0KfOc4C1eQu";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10.html" class="pagination-link" aria-label="Describing Discrete-Time Event Occurrence Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Describing Discrete-Time Event Occurrence Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12.html" class="pagination-link" aria-label="Extending the Discrete-Time Hazard Model">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Extending the Discrete-Time Hazard Model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>