<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Fitting Basic Discrete-Time Hazard Models | Applied Longitudinal Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Fitting Basic Discrete-Time Hazard Models | Applied Longitudinal Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="github-repo" content="ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Fitting Basic Discrete-Time Hazard Models | Applied Longitudinal Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="describing-discrete-time-event-occurrence-data.html"/>
<link rel="next" href="extending-the-discrete-time-hazard-model.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html"><i class="fa fa-check"></i><b>1</b> A Framework for Investigating Change over Time</a><ul>
<li class="chapter" data-level="1.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#when-might-you-study-change-over-time"><i class="fa fa-check"></i><b>1.1</b> When might you study change over time?</a></li>
<li class="chapter" data-level="1.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#distinguishing-between-two-types-of-questions-about-change"><i class="fa fa-check"></i><b>1.2</b> Distinguishing between two types of questions about change</a></li>
<li class="chapter" data-level="1.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#three-important-features-of-a-study-of-change"><i class="fa fa-check"></i><b>1.3</b> Three important features of a study of change</a><ul>
<li class="chapter" data-level="1.3.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#multiple-waves-of-data."><i class="fa fa-check"></i><b>1.3.1</b> Multiple waves of data.</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-sensible-metric-for-time."><i class="fa fa-check"></i><b>1.3.2</b> A sensible metric for time.</a></li>
<li class="chapter" data-level="1.3.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-continuous-outcome-that-changes-systematically-over-time."><i class="fa fa-check"></i><b>1.3.3</b> A continuous outcome that changes systematically over time.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html"><i class="fa fa-check"></i><b>2</b> Exploring Longitudinal Data on Change</a><ul>
<li class="chapter" data-level="2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#creating-a-longitudinal-data-set"><i class="fa fa-check"></i><b>2.1</b> Creating a longitudinal data set</a><ul>
<li class="chapter" data-level="2.1.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-level-data-set."><i class="fa fa-check"></i><b>2.1.1</b> The person-level data set.</a></li>
<li class="chapter" data-level="2.1.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-period-data-set."><i class="fa fa-check"></i><b>2.1.2</b> The person-period data set.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#descriptive-analysis-of-individual-change-over-time"><i class="fa fa-check"></i><b>2.2</b> Descriptive analysis of individual change over time</a><ul>
<li class="chapter" data-level="2.2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#empirical-growth-plots."><i class="fa fa-check"></i><b>2.2.1</b> Empirical growth plots.</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-a-trajectory-to-summarize-each-persons-empirical-growth-record."><i class="fa fa-check"></i><b>2.2.2</b> Using a trajectory to summarize each person’s empirical growth record.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-differences-in-change-across-people"><i class="fa fa-check"></i><b>2.3</b> Exploring differences in change across people</a><ul>
<li class="chapter" data-level="2.3.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#examining-the-entire-set-of-smooth-trajectories."><i class="fa fa-check"></i><b>2.3.1</b> Examining the entire set of smooth trajectories.</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-the-results-of-model-fitting-to-frame-questions-about-change."><i class="fa fa-check"></i><b>2.3.2</b> Using the results of model fitting to frame questions about change.</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-the-relationship-between-change-and-time-invariant-predictors."><i class="fa fa-check"></i><b>2.3.3</b> Exploring the relationship between change and time-invariant predictors.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#improving-the-precision-and-reliability-of-ols-single-level-bayesian-estimated-rates-of-change-lessons-for-research-design"><i class="fa fa-check"></i><b>2.4</b> Improving the precision and reliability of <del>OLS</del> single-level-Bayesian-estimated rates of change: Lessons for research design</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>3</b> Introducing the Multilevel Model for Change</a><ul>
<li class="chapter" data-level="3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#what-is-the-purpose-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>3.1</b> What is the purpose of the multilevel model for change?</a></li>
<li class="chapter" data-level="3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-1-submodel-for-individual-change"><i class="fa fa-check"></i><b>3.2</b> The level-1 submodel for individual change</a><ul>
<li class="chapter" data-level="3.2.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-structural-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.1</b> The structural part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-stochastic-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.2</b> The stochastic part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#relating-the-level-1-submodel-to-the-ols-exploratory-methods-of-chapter-2."><i class="fa fa-check"></i><b>3.2.3</b> Relating the level-1 submodel to the OLS exploratory methods of chapter 2.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-2-submodel-for-systematic-interindividual-differences-in-change"><i class="fa fa-check"></i><b>3.3</b> The level-2 submodel for systematic interindividual differences in change</a><ul>
<li class="chapter" data-level="3.3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#structural-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.1</b> Structural components of the level-2 submodel.</a></li>
<li class="chapter" data-level="3.3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#stochastic-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.2</b> Stochastic components of the level-2 submodel.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#fitting-the-multilevel-model-for-change-to-data"><i class="fa fa-check"></i><b>3.4</b> Fitting the multilevel model for change to data</a><ul>
<li class="chapter" data-level="3.4.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-advantages-of-maximum-likelihood-bayesian-estimation."><i class="fa fa-check"></i><b>3.4.1</b> The advantages of <del>maximum likelihood</del> Bayesian estimation.</a></li>
<li class="chapter" data-level="3.4.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#using-maximum-likelihood-modern-bayesian-methods-to-fit-a-multilevel-model."><i class="fa fa-check"></i><b>3.4.2</b> Using <del>maximum likelihood</del> modern Bayesian methods to fit a multilevel model.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-fixed-effects"><i class="fa fa-check"></i><b>3.5</b> Examining estimated fixed effects</a><ul>
<li class="chapter" data-level="3.5.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-estimated-fixed-effects."><i class="fa fa-check"></i><b>3.5.1</b> Interpreting estimated fixed effects.</a></li>
<li class="chapter" data-level="3.5.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-fixed-effects."><i class="fa fa-check"></i><b>3.5.2</b> Single parameter tests for the fixed effects.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-variance-components"><i class="fa fa-check"></i><b>3.6</b> Examining estimated variance components</a><ul>
<li class="chapter" data-level="3.6.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-the-estimated-variance-components."><i class="fa fa-check"></i><b>3.6.1</b> Interpreting the estimated variance components.</a></li>
<li class="chapter" data-level="3.6.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-variance-components."><i class="fa fa-check"></i><b>3.6.2</b> Single parameter tests for the variance components.</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#bonus-how-did-you-simulate-that-data"><i class="fa fa-check"></i><b>3.7</b> Bonus: How did you simulate that data?</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>4</b> Doing Data Analysis with the Multilevel Model for Change</a><ul>
<li class="chapter" data-level="4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#example-changes-in-adolescent-alcohol-use"><i class="fa fa-check"></i><b>4.1</b> Example: Changes in adolescent alcohol use</a></li>
<li class="chapter" data-level="4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-composite-specification-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>4.2</b> The composite specification of the multilevel model for change</a><ul>
<li class="chapter" data-level="4.2.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-structural-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.1</b> The structural component of the composite model.</a></li>
<li class="chapter" data-level="4.2.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-stochastic-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.2</b> The stochastic component of the composite model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#methods-of-estimation-revisited"><i class="fa fa-check"></i><b>4.3</b> Methods of estimation, revisited</a></li>
<li class="chapter" data-level="4.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#first-steps-fitting-two-unconditional-multilevel-models-for-change"><i class="fa fa-check"></i><b>4.4</b> First steps: Fitting two unconditional multilevel models for change</a><ul>
<li class="chapter" data-level="4.4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-means-model."><i class="fa fa-check"></i><b>4.4.1</b> The unconditional means model.</a></li>
<li class="chapter" data-level="4.4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-growth-model."><i class="fa fa-check"></i><b>4.4.2</b> The unconditional growth model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#quantifying-the-proportion-of-outcome-variation-explained."><i class="fa fa-check"></i><b>4.4.3</b> Quantifying the proportion of outcome variation “explained.”</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#practical-data-analytic-strategies-for-model-building"><i class="fa fa-check"></i><b>4.5</b> Practical data analytic strategies for model building</a><ul>
<li class="chapter" data-level="4.5.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#a-taxonomy-of-statistical-models."><i class="fa fa-check"></i><b>4.5.1</b> A taxonomy of statistical models.</a></li>
<li class="chapter" data-level="4.5.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#interpreting-fitted-models."><i class="fa fa-check"></i><b>4.5.2</b> Interpreting fitted models.</a></li>
<li class="chapter" data-level="4.5.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#displaying-prototypical-change-trajectories."><i class="fa fa-check"></i><b>4.5.3</b> Displaying prototypical change trajectories.</a></li>
<li class="chapter" data-level="4.5.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#recentering-predictors-to-improve-interpretation."><i class="fa fa-check"></i><b>4.5.4</b> Recentering predictors to improve interpretation.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#comparing-models-using-deviance-statistics"><i class="fa fa-check"></i><b>4.6</b> Comparing models using deviance statistics</a><ul>
<li class="chapter" data-level="4.6.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-deviance-statistic."><i class="fa fa-check"></i><b>4.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="4.6.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#when-and-how-can-you-compare-deviance-statistics"><i class="fa fa-check"></i><b>4.6.2</b> When and how can you compare deviance statistics?</a></li>
<li class="chapter" data-level="4.6.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#implementing-deviance-based-hypothesis-tests."><i class="fa fa-check"></i><b>4.6.3</b> Implementing deviance-based hypothesis tests.</a></li>
<li class="chapter" data-level="4.6.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#aic-and-bic-waic-and-loo-statistics-comparing-nonnested-models-using-information-criteria-and-cross-validation."><i class="fa fa-check"></i><b>4.6.4</b> <del>AIC and BIC</del> WAIC and LOO statistics: Comparing nonnested models using information criteria [and cross validation].</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#using-wald-statistics-to-test-composite-hypotheses-about-fixed-effects"><i class="fa fa-check"></i><b>4.7</b> Using Wald statistics to test composite hypotheses about fixed effects</a></li>
<li class="chapter" data-level="4.8" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#evaluating-the-tenability-of-a-models-assumptions"><i class="fa fa-check"></i><b>4.8</b> Evaluating the tenability of a model’s assumptions</a><ul>
<li class="chapter" data-level="4.8.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-functional-form."><i class="fa fa-check"></i><b>4.8.1</b> Checking functional form.</a></li>
<li class="chapter" data-level="4.8.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-normality."><i class="fa fa-check"></i><b>4.8.2</b> Checking normality.</a></li>
<li class="chapter" data-level="4.8.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-homoscedasticity."><i class="fa fa-check"></i><b>4.8.3</b> Checking homoscedasticity.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#model-based-empirical-bayes-estimates-of-the-individual-growth-parameters"><i class="fa fa-check"></i><b>4.9</b> Model-based (Empirical Bayes) estimates of the individual growth parameters</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html"><i class="fa fa-check"></i><b>5</b> Treating Time More Flexibly</a><ul>
<li class="chapter" data-level="5.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#variably-spaced-measurement-occasions"><i class="fa fa-check"></i><b>5.1</b> Variably spaced measurement occasions</a><ul>
<li class="chapter" data-level="5.1.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#the-structure-of-variably-spaced-data-sets."><i class="fa fa-check"></i><b>5.1.1</b> The structure of variably spaced data sets.</a></li>
<li class="chapter" data-level="5.1.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#postulating-and-fitting-multilevel-models-with-variably-spaced-waves-of-data."><i class="fa fa-check"></i><b>5.1.2</b> Postulating and fitting multilevel models with variably spaced waves of data.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#varying-numbers-of-measurement-occasions"><i class="fa fa-check"></i><b>5.2</b> Varying numbers of measurement occasions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#analyzing-data-sets-in-which-the-number-of-waves-per-person-varies."><i class="fa fa-check"></i><b>5.2.1</b> Analyzing data sets in which the number of waves per person varies.</a></li>
<li class="chapter" data-level="5.2.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#practical-problems-that-may-arise-when-analyzing-unbalanced-data-sets."><i class="fa fa-check"></i><b>5.2.2</b> Practical problems that may arise when analyzing unbalanced data sets.</a></li>
<li class="chapter" data-level="5.2.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#distinguishing-among-different-types-of-missingness."><i class="fa fa-check"></i><b>5.2.3</b> Distinguishing among different types of missingness.</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#time-varying-predictors"><i class="fa fa-check"></i><b>5.3</b> Time-varying predictors</a><ul>
<li class="chapter" data-level="5.3.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#including-the-main-effect-of-a-time-varying-predictor."><i class="fa fa-check"></i><b>5.3.1</b> Including the main effect of a time-varying predictor.</a></li>
<li class="chapter" data-level="5.3.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#allowing-the-effect-of-a-time-varying-predictor-to-vary-over-time."><i class="fa fa-check"></i><b>5.3.2</b> Allowing the effect of a time-varying predictor to vary over time.</a></li>
<li class="chapter" data-level="5.3.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-time-varying-predictors."><i class="fa fa-check"></i><b>5.3.3</b> Recentering time-varying predictors.</a></li>
<li class="chapter" data-level="5.3.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#an-important-caveat-the-problem-of-reciprocal-causation."><i class="fa fa-check"></i><b>5.3.4</b> An important caveat: The problem of reciprocal causation.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-the-effect-of-time"><i class="fa fa-check"></i><b>5.4</b> Recentering the effect of <em>TIME</em></a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html"><i class="fa fa-check"></i><b>6</b> Modeling Discontinuous and Nonlinear Change</a><ul>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html"><i class="fa fa-check"></i><b>7</b> Examining the Multilevel Model’s Error Covariance Structure</a><ul>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html"><i class="fa fa-check"></i><b>8</b> Modeling Change Using Covariance Structure Analysis</a><ul>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html"><i class="fa fa-check"></i><b>9</b> A Framework for Investigating Event Occurrence</a><ul>
<li class="chapter" data-level="9.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#should-you-conduct-a-survival-analysis-the-whether-and-when-test"><i class="fa fa-check"></i><b>9.1</b> Should you conduct a survival analysis? The “whether” and “when” test</a><ul>
<li class="chapter" data-level="9.1.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#time-to-relapse-among-recently-treated-alcoholics."><i class="fa fa-check"></i><b>9.1.1</b> Time to relapse among recently treated alcoholics.</a></li>
<li class="chapter" data-level="9.1.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#length-of-stay-in-teaching."><i class="fa fa-check"></i><b>9.1.2</b> Length of stay in teaching.</a></li>
<li class="chapter" data-level="9.1.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#age-at-first-suicide-ideation."><i class="fa fa-check"></i><b>9.1.3</b> Age at first suicide ideation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#framing-a-research-question-about-event-occurrence"><i class="fa fa-check"></i><b>9.2</b> Framing a research question about event occurrence</a><ul>
<li class="chapter" data-level="9.2.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#defining-event-occurrence."><i class="fa fa-check"></i><b>9.2.1</b> Defining event occurrence.</a></li>
<li class="chapter" data-level="9.2.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#identifying-the-beginning-of-time."><i class="fa fa-check"></i><b>9.2.2</b> Identifying the “beginning of time.”</a></li>
<li class="chapter" data-level="9.2.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#specifying-a-metric-for-time."><i class="fa fa-check"></i><b>9.2.3</b> Specifying a metric for time.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#censoring-how-complete-are-the-data-on-event-occurrence"><i class="fa fa-check"></i><b>9.3</b> Censoring: How complete are the data on event occurrence?</a><ul>
<li class="chapter" data-level="9.3.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-and-why-does-censoring-arise"><i class="fa fa-check"></i><b>9.3.1</b> How and why does censoring arise?</a></li>
<li class="chapter" data-level="9.3.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#different-types-of-censoring."><i class="fa fa-check"></i><b>9.3.2</b> Different types of censoring.</a></li>
<li class="chapter" data-level="9.3.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-does-censoring-affect-statistical-analysis"><i class="fa fa-check"></i><b>9.3.3</b> How does censoring affect statistical analysis?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html"><i class="fa fa-check"></i><b>10</b> Describing Discrete-Time Event Occurrence Data</a><ul>
<li class="chapter" data-level="10.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-life-table"><i class="fa fa-check"></i><b>10.1</b> The life table</a></li>
<li class="chapter" data-level="10.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data"><i class="fa fa-check"></i><b>10.2</b> A framework for characterizing the distribution of discrete-time event occurrence data</a><ul>
<li class="chapter" data-level="10.2.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-function."><i class="fa fa-check"></i><b>10.2.1</b> Survivor function.</a></li>
<li class="chapter" data-level="10.2.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#median-lifetime."><i class="fa fa-check"></i><b>10.2.2</b> Median lifetime.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes"><i class="fa fa-check"></i><b>10.3</b> Developing intuition about hazard functions, survivor functions, and median lifetimes</a><ul>
<li class="chapter" data-level="10.3.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#identifying-periods-of-high-and-low-risk-using-hazard-functions."><i class="fa fa-check"></i><b>10.3.1</b> Identifying periods of high and low risk using hazard functions.</a></li>
<li class="chapter" data-level="10.3.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard."><i class="fa fa-check"></i><b>10.3.2</b> Survivor functions as a context for evaluating the magnitude of hazard.</a></li>
<li class="chapter" data-level="10.3.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#strengths-and-limitations-of-estimated-median-lifetimes."><i class="fa fa-check"></i><b>10.3.3</b> Strengths and limitations of estimated median lifetimes.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#quantifying-the-effects-of-sampling-variation"><i class="fa fa-check"></i><b>10.4</b> Quantifying the effects of sampling variation</a><ul>
<li class="chapter" data-level="10.4.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-standard-error-of-the-estimated-hazard-probabilities."><i class="fa fa-check"></i><b>10.4.1</b> The standard error of the estimated hazard probabilities.</a></li>
<li class="chapter" data-level="10.4.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#standard-error-of-the-estimated-survival-probabilities."><i class="fa fa-check"></i><b>10.4.2</b> Standard error of the estimated survival probabilities.</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-simple-and-useful-strategy-for-constructing-the-life-table"><i class="fa fa-check"></i><b>10.5</b> A simple and useful strategy for constructing the life table</a><ul>
<li class="chapter" data-level="10.5.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-person-period-data-set.-1"><i class="fa fa-check"></i><b>10.5.1</b> The person-period data set.</a></li>
<li class="chapter" data-level="10.5.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#using-the-person-period-data-set-to-construct-the-life-table."><i class="fa fa-check"></i><b>10.5.2</b> Using the person-period data set to construct the life table.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#bonus-fit-the-discrete-time-hazard-models-with-brms"><i class="fa fa-check"></i><b>10.6</b> Bonus: Fit the discrete-time hazard models with brms</a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html"><i class="fa fa-check"></i><b>11</b> Fitting Basic Discrete-Time Hazard Models</a><ul>
<li class="chapter" data-level="11.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#toward-a-statistical-model-for-discrete-time-hazard"><i class="fa fa-check"></i><b>11.1</b> Toward a statistical model for discrete-time hazard</a><ul>
<li class="chapter" data-level="11.1.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#plots-of-within-group-hazard-functions-and-survivor-functions."><i class="fa fa-check"></i><b>11.1.1</b> Plots of within-group hazard functions and survivor functions.</a></li>
<li class="chapter" data-level="11.1.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-kind-of-statistical-model-do-these-graphs-suggest"><i class="fa fa-check"></i><b>11.1.2</b> What kind of statistical model do these graphs suggest?</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#formal-representation-of-the-population-discrete-time-hazard-model"><i class="fa fa-check"></i><b>11.2</b> formal representation of the population discrete-time hazard model</a><ul>
<li class="chapter" data-level="11.2.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-do-the-parameters-represent"><i class="fa fa-check"></i><b>11.2.1</b> What do the parameters represent?</a></li>
<li class="chapter" data-level="11.2.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#an-alternative-representation-of-the-model."><i class="fa fa-check"></i><b>11.2.2</b> An alternative representation of the model.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-a-discrete-time-hazard-model-to-data"><i class="fa fa-check"></i><b>11.3</b> Fitting a discrete-time hazard model to data</a><ul>
<li class="chapter" data-level="11.3.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#adding-predictors-to-the-person-period-data-set."><i class="fa fa-check"></i><b>11.3.1</b> Adding predictors to the person-period data set.</a></li>
<li class="chapter" data-level="11.3.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model."><i class="fa fa-check"></i><b>11.3.2</b> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model.</a></li>
<li class="chapter" data-level="11.3.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-the-discrete-time-hazard-model-to-data."><i class="fa fa-check"></i><b>11.3.3</b> Fitting the discrete-time hazard model to data.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#interpreting-parameter-estimates"><i class="fa fa-check"></i><b>11.4</b> Interpreting parameter estimates</a><ul>
<li class="chapter" data-level="11.4.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-time-indicators."><i class="fa fa-check"></i><b>11.4.1</b> The time indicators.</a></li>
<li class="chapter" data-level="11.4.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#dichotomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.2</b> Dichotomous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#continuous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.3</b> Continuous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#polytomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.4</b> Polytomous substantive predictors.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#displaying-fitted-hazard-and-survivor-functions"><i class="fa fa-check"></i><b>11.5</b> Displaying fitted hazard and survivor functions</a><ul>
<li class="chapter" data-level="11.5.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#a-strategy-for-a-single-categorical-substantive-predictor."><i class="fa fa-check"></i><b>11.5.1</b> A strategy for a single categorical substantive predictor.</a></li>
<li class="chapter" data-level="11.5.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous."><i class="fa fa-check"></i><b>11.5.2</b> Extending this strategy to multiple predictors (some of which are continuous).</a></li>
<li class="chapter" data-level="11.5.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#two-cautions-when-interpreting-fitted-hazard-and-survivor-functions."><i class="fa fa-check"></i><b>11.5.3</b> Two cautions when interpreting fitted hazard and survivor functions.</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-models-using-deviance-statistics-and-information-criteria"><i class="fa fa-check"></i><b>11.6</b> Comparing models using <del>deviance statistics and</del> information criteria</a><ul>
<li class="chapter" data-level="11.6.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-deviance-statistic.-1"><i class="fa fa-check"></i><b>11.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="11.6.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-individual-predictors."><i class="fa fa-check"></i><b>11.6.2</b> Deviance-based hypothesis tests for individual predictors.</a></li>
<li class="chapter" data-level="11.6.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-groups-of-predictors."><i class="fa fa-check"></i><b>11.6.3</b> Deviance-based hypothesis tests for groups of predictors.</a></li>
<li class="chapter" data-level="11.6.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-nonnested-models-using-waic-and-loo."><i class="fa fa-check"></i><b>11.6.4</b> Comparing nonnested models using [WAIC and LOO].</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#statistical-inference-using-uncertainty-in-the-bayesian-posterior"><i class="fa fa-check"></i><b>11.7</b> Statistical inference using [uncertainty in the Bayesian posterior]</a><ul>
<li class="chapter" data-level="11.7.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-wald-chi-square-statistic."><i class="fa fa-check"></i><b>11.7.1</b> The <del>Wald chi-square statistic</del>.</a></li>
<li class="chapter" data-level="11.7.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#asymmetric-credible-intervals-for-parameters-and-odds-ratios."><i class="fa fa-check"></i><b>11.7.2</b> [Asymmetric credible intervals] for parameters and odds ratios.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html"><i class="fa fa-check"></i><b>12</b> Extending the Discrete-Time Hazard Model</a><ul>
<li class="chapter" data-level="12.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#alternative-specification-for-the-main-effect-of-time"><i class="fa fa-check"></i><b>12.1</b> Alternative specification for the “main effect” of <em>TIME</em></a><ul>
<li class="chapter" data-level="12.1.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#an-ordered-series-of-polynomial-specifications-for-time."><i class="fa fa-check"></i><b>12.1.1</b> An ordered series of polynomial specifications for <em>TIME</em>.</a></li>
<li class="chapter" data-level="12.1.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#criteria-for-comparing-alternative-specification."><i class="fa fa-check"></i><b>12.1.2</b> Criteria for comparing alternative specification.</a></li>
<li class="chapter" data-level="12.1.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-parameters-from-linear-quadratic-and-cubic-specifications."><i class="fa fa-check"></i><b>12.1.3</b> Interpreting parameters from linear, quadratic, and cubic specifications.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model"><i class="fa fa-check"></i><b>12.2</b> Using the complementary log-log link to specify a discrete-time hazard model</a><ul>
<li class="chapter" data-level="12.2.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-clog-log-transformation-when-and-why-it-is-useful."><i class="fa fa-check"></i><b>12.2.1</b> The clog-log transformation: When and why it is useful.</a></li>
<li class="chapter" data-level="12.2.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#a-discrete-time-hazard-model-using-the-complementary-log-log-link."><i class="fa fa-check"></i><b>12.2.2</b> A discrete-time hazard model using the complementary log-log link.</a></li>
<li class="chapter" data-level="12.2.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#choosing-between-logit-and-clog-log-links-for-discrete-time-hazard-models."><i class="fa fa-check"></i><b>12.2.3</b> Choosing between logit and clog-log links for discrete-time hazard models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#time-varying-predictors-1"><i class="fa fa-check"></i><b>12.3</b> Time-varying predictors</a><ul>
<li class="chapter" data-level="12.3.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#assumptions-underlying-a-model-with-time-varying-predictors."><i class="fa fa-check"></i><b>12.3.1</b> Assumptions underlying a model with time-varying predictors.</a></li>
<li class="chapter" data-level="12.3.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-and-displaying-time-varying-predictors-effects."><i class="fa fa-check"></i><b>12.3.2</b> Interpreting and displaying time-varying predictors’ effects.</a></li>
<li class="chapter" data-level="12.3.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#two-caveats-the-problems-of-state-and-rate-dependence."><i class="fa fa-check"></i><b>12.3.3</b> Two caveats: The problems of state and rate dependence.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-linear-additivity-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.4</b> The linear additivity assumption: Uncovering violations and simple solutions</a><ul>
<li class="chapter" data-level="12.4.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interactions-between-substantive-predictors."><i class="fa fa-check"></i><b>12.4.1</b> Interactions between substantive predictors.</a></li>
<li class="chapter" data-level="12.4.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#nonlinear-effects."><i class="fa fa-check"></i><b>12.4.2</b> Nonlinear effects.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-proportionality-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.5</b> The proportionality assumption: Uncovering violations and simple solutions</a><ul>
<li class="chapter" data-level="12.5.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#discrete-time-hazard-models-that-do-not-invoke-a-proportionality-assumption."><i class="fa fa-check"></i><b>12.5.1</b> Discrete-time hazard models that do not invoke a proportionality assumption.</a></li>
<li class="chapter" data-level="12.5.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#investigating-the-proportionality-assumption-in-practice."><i class="fa fa-check"></i><b>12.5.2</b> Investigating the proportionality assumption in practice.</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-no-unobserved-heterogeneity-assumption-no-simple-solution"><i class="fa fa-check"></i><b>12.6</b> The no unobserved heterogeneity assumption: No simple solution</a></li>
<li class="chapter" data-level="12.7" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#residual-analysis"><i class="fa fa-check"></i><b>12.7</b> Residual analysis</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#footnote-1"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Applied Longitudinal Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fitting-basic-discrete-time-hazard-models" class="section level1">
<h1><span class="header-section-number">11</span> Fitting Basic Discrete-Time Hazard Models</h1>
<blockquote>
<p>In this chapter and the next, we present statistical models of hazard for data collected in discrete time. The relative simplicity of these models makes them an ideal entrée into the world of survival analysis. In subsequent chapters, we extend these basic ideas to situations in which event occurrence is recorded in continuous time.</p>
<p>Good data analysis involves more than using a computer package to fit a statistical model to data. To conduce a credible discrete-time survival analysis, you must: (1) specify a suitable model for hazard and understand its assumptions; (2) use sample data to estimate the model parameters; (3) interpret results in terms of your research questions; (4) evaluate model fit and [express the uncertainty in the] model parameters; and (5) communicate your findings. (pp. 357–358)</p>
</blockquote>
<div id="toward-a-statistical-model-for-discrete-time-hazard" class="section level2">
<h2><span class="header-section-number">11.1</span> Toward a statistical model for discrete-time hazard</h2>
<p>Time to load <a href="https://www.ncbi.nlm.nih.gov/pubmed/8625717">Capaldi, Crosby, and Stoolmiller’s (1996)</a> <code>firstsex.csv</code> data.</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb833-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb833-2" data-line-number="2"></a>
<a class="sourceLine" id="cb833-3" data-line-number="3">sex &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/firstsex.csv&quot;</span>)</a>
<a class="sourceLine" id="cb833-4" data-line-number="4"></a>
<a class="sourceLine" id="cb833-5" data-line-number="5"><span class="kw">glimpse</span>(sex)</a></code></pre></div>
<pre><code>## Rows: 180
## Columns: 5
## $ id     &lt;dbl&gt; 1, 2, 3, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 28,…
## $ time   &lt;dbl&gt; 9, 12, 12, 12, 11, 9, 12, 11, 12, 11, 12, 11, 9, 12, 10, 12, 7, 12, 10, 12, 11, 12, 11, 12, …
## $ censor &lt;dbl&gt; 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0,…
## $ pt     &lt;dbl&gt; 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0,…
## $ pas    &lt;dbl&gt; 1.9788670, -0.5454916, -1.4049800, 0.9741806, -0.6356313, -0.2428857, -0.8685001, 0.4535947,…</code></pre>
<p>Here are the cases broken down by <code>time</code> and <code>censor</code> status.</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb835-1" data-line-number="1">sex <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb835-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(time, censor)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##    time censor     n
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
## 1     7      0    15
## 2     8      0     7
## 3     9      0    24
## 4    10      0    29
## 5    11      0    25
## 6    12      0    26
## 7    12      1    54</code></pre>
<p>Since these data show no censoring before the final <code>time</code> point, it is straightforward to follow along with the text (p. 358) and compute the percent who had already had sex by the 12<sup>th</sup> grade.</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb837-1" data-line-number="1">sex <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb837-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(censor) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb837-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   censor     n percent
##    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1      0   126      70
## 2      1    54      30</code></pre>
<p>Here we break the data down by our central predictor, <code>pt</code>, which is coded “0 for boys who lived with both biological parents” and “1 for boys who experienced one or more parenting transitions” before the 7<sup>th</sup> grade.</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb839-1" data-line-number="1">sex <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb839-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(pt) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb839-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##      pt     n percent
##   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1     0    72      40
## 2     1   108      60</code></pre>
<div id="plots-of-within-group-hazard-functions-and-survivor-functions." class="section level3">
<h3><span class="header-section-number">11.1.1</span> Plots of within-group hazard functions and survivor functions.</h3>
<blockquote>
<p>Plots of sample hazard functions and survivor functions estimates separately for groups distinguished by their predictor values are invaluable exploratory tools. If a predictor is categorical, like <em>PT</em>, construction of these displays is straightforward. If a predictor is continuous, you should just temporarily categorize its values for plotting purposes. (pp. 358–359, <em>emphasis</em> in the original)</p>
</blockquote>
<p>To make our version of the descriptive plots in Figure 11.1, we’ll need to first load the <strong>survival</strong> package.</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb841-1" data-line-number="1"><span class="kw">library</span>(survival)</a></code></pre></div>
<p><code>fit11.1</code> will be of the cases for which <code>pt ==  0</code> and <code>fit11.2</code> will be of the cases for which <code>pt ==  1</code>. With <code>fit11.3</code>, we use all cases regardless of <code>pt</code> status.</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb842-1" data-line-number="1">fit11<span class="fl">.1</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb842-2" data-line-number="2"><span class="st">  </span><span class="kw">survfit</span>(<span class="dt">data =</span> sex <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb842-3" data-line-number="3">          <span class="kw">Surv</span>(time, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>censor) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb842-4" data-line-number="4"></a>
<a class="sourceLine" id="cb842-5" data-line-number="5">fit11<span class="fl">.2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb842-6" data-line-number="6"><span class="st">  </span><span class="kw">survfit</span>(<span class="dt">data =</span> sex <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb842-7" data-line-number="7">          <span class="kw">Surv</span>(time, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>censor) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb842-8" data-line-number="8"></a>
<a class="sourceLine" id="cb842-9" data-line-number="9">fit11<span class="fl">.3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb842-10" data-line-number="10"><span class="st">  </span><span class="kw">survfit</span>(<span class="dt">data =</span> sex,</a>
<a class="sourceLine" id="cb842-11" data-line-number="11">          <span class="kw">Surv</span>(time, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>censor) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>Before we plot the results, it might be handy to arrange the fit results in life tables. We can streamline that code with the custom <code>make_lt()</code> function from last chapter.</p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb843-1" data-line-number="1">make_lt &lt;-<span class="st"> </span><span class="cf">function</span>(fit) {</a>
<a class="sourceLine" id="cb843-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb843-3" data-line-number="3">  <span class="co"># arrange the lt data for all rows but the first</span></a>
<a class="sourceLine" id="cb843-4" data-line-number="4">  most_rows &lt;-</a>
<a class="sourceLine" id="cb843-5" data-line-number="5"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">time =</span> fit<span class="op">$</span>time) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb843-6" data-line-number="6"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">time_int =</span> <span class="kw">str_c</span>(<span class="st">&quot;[&quot;</span>, time, <span class="st">&quot;, &quot;</span>, time <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>), </a>
<a class="sourceLine" id="cb843-7" data-line-number="7">           <span class="dt">n_risk   =</span> fit<span class="op">$</span>n.risk, </a>
<a class="sourceLine" id="cb843-8" data-line-number="8">           <span class="dt">n_event  =</span> fit<span class="op">$</span>n.event) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb843-9" data-line-number="9"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n_censored   =</span> n_risk <span class="op">-</span><span class="st"> </span>n_event <span class="op">-</span><span class="st"> </span><span class="kw">lead</span>(n_risk, <span class="dt">default =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb843-10" data-line-number="10">           <span class="dt">hazard_fun   =</span> n_event <span class="op">/</span><span class="st"> </span>n_risk,</a>
<a class="sourceLine" id="cb843-11" data-line-number="11">           <span class="dt">survivor_fun =</span> fit<span class="op">$</span>surv)</a>
<a class="sourceLine" id="cb843-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb843-13" data-line-number="13">  <span class="co"># define the values for t = 2 and t = 1</span></a>
<a class="sourceLine" id="cb843-14" data-line-number="14">  time_<span class="dv">1</span> &lt;-<span class="st"> </span>fit<span class="op">$</span>time[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb843-15" data-line-number="15">  time_<span class="dv">0</span> &lt;-<span class="st"> </span>time_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb843-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb843-17" data-line-number="17">  <span class="co"># define the values for the row for which t = 1</span></a>
<a class="sourceLine" id="cb843-18" data-line-number="18">  row_<span class="dv">1</span> &lt;-</a>
<a class="sourceLine" id="cb843-19" data-line-number="19"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">time         =</span> time_<span class="dv">0</span>, </a>
<a class="sourceLine" id="cb843-20" data-line-number="20">           <span class="dt">time_int     =</span> <span class="kw">str_c</span>(<span class="st">&quot;[&quot;</span>, time_<span class="dv">0</span>, <span class="st">&quot;, &quot;</span>, time_<span class="dv">1</span>, <span class="st">&quot;)&quot;</span>),</a>
<a class="sourceLine" id="cb843-21" data-line-number="21">           <span class="dt">n_risk       =</span> fit<span class="op">$</span>n.risk[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb843-22" data-line-number="22">           <span class="dt">n_event      =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb843-23" data-line-number="23">           <span class="dt">n_censored   =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb843-24" data-line-number="24">           <span class="dt">hazard_fun   =</span> <span class="ot">NA</span>, </a>
<a class="sourceLine" id="cb843-25" data-line-number="25">           <span class="dt">survivor_fun =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb843-26" data-line-number="26">  </a>
<a class="sourceLine" id="cb843-27" data-line-number="27">  <span class="co"># make the full life table</span></a>
<a class="sourceLine" id="cb843-28" data-line-number="28">  lt &lt;-</a>
<a class="sourceLine" id="cb843-29" data-line-number="29"><span class="st">    </span><span class="kw">bind_rows</span>(row_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb843-30" data-line-number="30">              most_rows)</a>
<a class="sourceLine" id="cb843-31" data-line-number="31">  </a>
<a class="sourceLine" id="cb843-32" data-line-number="32">  lt</a>
<a class="sourceLine" id="cb843-33" data-line-number="33">  </a>
<a class="sourceLine" id="cb843-34" data-line-number="34">}</a></code></pre></div>
<p>We’ll use <code>make_lt()</code> separately for each fit, stack the results from the first on top of those from the second, and add a <code>pt</code> column to index the rows. This will be our version of Table 11.1 (p. 360).</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb844-1" data-line-number="1">lt &lt;-</a>
<a class="sourceLine" id="cb844-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">make_lt</span>(fit11<span class="fl">.1</span>),</a>
<a class="sourceLine" id="cb844-3" data-line-number="3">            <span class="kw">make_lt</span>(fit11<span class="fl">.2</span>),</a>
<a class="sourceLine" id="cb844-4" data-line-number="4">            <span class="kw">make_lt</span>(fit11<span class="fl">.3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb844-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;pt = 0&quot;</span>, <span class="st">&quot;pt = 1&quot;</span>, <span class="st">&quot;overall&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">3</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb844-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(pt, <span class="kw">everything</span>())</a>
<a class="sourceLine" id="cb844-7" data-line-number="7"></a>
<a class="sourceLine" id="cb844-8" data-line-number="8">lt</a></code></pre></div>
<pre><code>## # A tibble: 21 x 8
##    pt      time time_int n_risk n_event n_censored hazard_fun survivor_fun
##    &lt;fct&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
##  1 pt = 0     6 [6, 7)       72      NA         NA    NA             1    
##  2 pt = 0     7 [7, 8)       72       2          0     0.0278        0.972
##  3 pt = 0     8 [8, 9)       70       2          0     0.0286        0.944
##  4 pt = 0     9 [9, 10)      68       8          0     0.118         0.833
##  5 pt = 0    10 [10, 11)     60       8          0     0.133         0.722
##  6 pt = 0    11 [11, 12)     52      10          0     0.192         0.583
##  7 pt = 0    12 [12, 13)     42       8         34     0.190         0.472
##  8 pt = 1     6 [6, 7)      108      NA         NA    NA             1    
##  9 pt = 1     7 [7, 8)      108      13          0     0.120         0.880
## 10 pt = 1     8 [8, 9)       95       5          0     0.0526        0.833
## # … with 11 more rows</code></pre>
<p>Here is the code for the top panel of Figure 11.1.</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb846-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb846-2" data-line-number="2"><span class="st">  </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb846-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb846-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb846-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> hazard_fun, <span class="dt">color =</span> pt, <span class="dt">group =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb846-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb846-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb846-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb846-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;estimated hazard probability&quot;</span>, </a>
<a class="sourceLine" id="cb846-10" data-line-number="10">                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb846-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p>Now make the plot for the bottom panel.</p>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb847-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb847-2" data-line-number="2"><span class="st">  </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb847-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb847-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb847-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> survivor_fun, <span class="dt">color =</span> pt, <span class="dt">group =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb847-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb847-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb847-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb847-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb847-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;estimated survival probability&quot;</span>,</a>
<a class="sourceLine" id="cb847-11" data-line-number="11">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb847-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p>Combine the two <strong>ggplot2</strong> objects with <strong>patchwork</strong> syntax to make our version of Figure 11.1.</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb848-1" data-line-number="1"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb848-2" data-line-number="2"></a>
<a class="sourceLine" id="cb848-3" data-line-number="3">(p1 <span class="op">/</span><span class="st"> </span>p2) <span class="op">+</span></a>
<a class="sourceLine" id="cb848-4" data-line-number="4"><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>On page 361, Singer and Willett compared the hazard probabilities at grades 8 and 11 for boys in the two <code>pt</code> groups. We can make that comparison with <code>filter()</code>.</p>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb849-1" data-line-number="1">lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb849-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(time <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">11</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb849-3" data-line-number="3"><span class="st">           </span>pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb849-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(pt<span class="op">:</span>time, hazard_fun)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   pt      time hazard_fun
##   &lt;fct&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 pt = 0     8     0.0286
## 2 pt = 0    11     0.192 
## 3 pt = 1     8     0.0526
## 4 pt = 1    11     0.283</code></pre>
<p>Compare the two groups on the hazard probabilities at grade 9.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb851-1" data-line-number="1">lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb851-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(time <span class="op">==</span><span class="st"> </span><span class="dv">9</span> <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb851-3" data-line-number="3"><span class="st">           </span>pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb851-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(pt<span class="op">:</span>time, hazard_fun)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   pt      time hazard_fun
##   &lt;fct&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 pt = 0     9      0.118
## 2 pt = 1     9      0.178</code></pre>
<p>Now compare them on their hazard probabilities in grade 12.</p>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb853-1" data-line-number="1">lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb853-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(time <span class="op">==</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb853-3" data-line-number="3"><span class="st">           </span>pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb853-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(pt<span class="op">:</span>time, hazard_fun)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   pt      time hazard_fun
##   &lt;fct&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 pt = 0    12      0.190
## 2 pt = 1    12      0.474</code></pre>
<p>At the top of page 362, Singer and Willett compared the percentages of boys who were virgins at grades 9 and 12, by <code>pt</code> status. Those percentages are straight algebraic transformations of the corresponding survival function values.</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb855-1" data-line-number="1">lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb855-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(time <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">12</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb855-3" data-line-number="3"><span class="st">           </span>pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb855-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(pt<span class="op">:</span>time, survivor_fun) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb855-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent_virgins =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>survivor_fun) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">1</span>))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   pt      time survivor_fun percent_virgins
##   &lt;fct&gt;  &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;
## 1 pt = 0     9        0.833            83.3
## 2 pt = 0    12        0.472            47.2
## 3 pt = 1     9        0.685            68.5
## 4 pt = 1    12        0.185            18.5</code></pre>
<p>Now let’s finish off by computing the interpolated median lifetime values for each with our custom <code>make_iml()</code> function.</p>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb857-1" data-line-number="1">make_iml &lt;-<span class="st"> </span><span class="cf">function</span>(lt) {</a>
<a class="sourceLine" id="cb857-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb857-3" data-line-number="3">  <span class="co"># lt is a generic name for a life table of the </span></a>
<a class="sourceLine" id="cb857-4" data-line-number="4">  <span class="co"># kind we made with our `make_lt()` function</span></a>
<a class="sourceLine" id="cb857-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb857-6" data-line-number="6">  <span class="co"># determine the mth row</span></a>
<a class="sourceLine" id="cb857-7" data-line-number="7">  lt_m &lt;-</a>
<a class="sourceLine" id="cb857-8" data-line-number="8"><span class="st">    </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb857-9" data-line-number="9"><span class="st">    </span><span class="kw">filter</span>(survivor_fun <span class="op">&gt;</span><span class="st"> </span><span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb857-10" data-line-number="10"><span class="st">    </span><span class="kw">slice</span>(<span class="kw">n</span>())</a>
<a class="sourceLine" id="cb857-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb857-12" data-line-number="12">  <span class="co"># determine the row for m + 1</span></a>
<a class="sourceLine" id="cb857-13" data-line-number="13">  lt_m1 &lt;-</a>
<a class="sourceLine" id="cb857-14" data-line-number="14"><span class="st">    </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb857-15" data-line-number="15"><span class="st">    </span><span class="kw">filter</span>(survivor_fun <span class="op">&lt;</span><span class="st"> </span><span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb857-16" data-line-number="16"><span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb857-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb857-18" data-line-number="18">  <span class="co"># pull the value for m</span></a>
<a class="sourceLine" id="cb857-19" data-line-number="19">  m  &lt;-<span class="st"> </span><span class="kw">pull</span>(lt_m, time)</a>
<a class="sourceLine" id="cb857-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb857-21" data-line-number="21">  <span class="co"># pull the two survival function values</span></a>
<a class="sourceLine" id="cb857-22" data-line-number="22">  stm  &lt;-<span class="st"> </span><span class="kw">pull</span>(lt_m, survivor_fun)</a>
<a class="sourceLine" id="cb857-23" data-line-number="23">  stm1 &lt;-<span class="st"> </span><span class="kw">pull</span>(lt_m1, survivor_fun)</a>
<a class="sourceLine" id="cb857-24" data-line-number="24">  </a>
<a class="sourceLine" id="cb857-25" data-line-number="25">  <span class="co"># plug the values into Equation 10.6 (page 338)</span></a>
<a class="sourceLine" id="cb857-26" data-line-number="26">  iml &lt;-<span class="st"> </span>m <span class="op">+</span><span class="st"> </span>((stm <span class="op">-</span><span class="st"> </span><span class="fl">.5</span>) <span class="op">/</span><span class="st"> </span>(stm <span class="op">-</span><span class="st"> </span>stm1)) <span class="op">*</span><span class="st"> </span>((m <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">-</span><span class="st"> </span>m)</a>
<a class="sourceLine" id="cb857-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb857-28" data-line-number="28">  iml</a>
<a class="sourceLine" id="cb857-29" data-line-number="29">  </a>
<a class="sourceLine" id="cb857-30" data-line-number="30">}</a></code></pre></div>
<p>Put <code>make_iml()</code> to work.</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb858-1" data-line-number="1"><span class="kw">make_iml</span>(lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> &quot;pt = 0&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 11.75</code></pre>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb860-1" data-line-number="1"><span class="kw">make_iml</span>(lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> &quot;pt = 1&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 9.952381</code></pre>
</div>
<div id="what-kind-of-statistical-model-do-these-graphs-suggest" class="section level3">
<h3><span class="header-section-number">11.1.2</span> What kind of statistical model do these graphs suggest?</h3>
<blockquote>
<p>To postulate a statistical model to represent the relationship between the population discrete-time hazard function and predictors, we must deal with two complications apparent in these displays. One is that any hypothesized model must describe the shape of the <em>entire discrete-time hazard function</em> over time, not just its value in any one period, in much the same way that a multilevel model for change characterizes the shape of entire individual growth trajectories over time. A second complication is that, as a conditional probability, the value of discrete-time hazard must lie between 0 and 1. Any reasonable statistical model for hazard must recognize this constraint, precluding the occurrence of theoretically impossible values. (p. 362, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="the-bounded-nature-of-hazard." class="section level4">
<h4><span class="header-section-number">11.1.2.1</span> The bounded nature of hazard.</h4>
<p>A conventional way to handle the bounded nature of probabilities is transform the scale of the data. <a href="https://eclass.uoa.gr/modules/document/file.php/MATH394/Papers/%5BCox(1972)%5D%20Regression%20Models%20and%20Life%20Tables.pdf">Cox (1972)</a> recommended either the odds and log-odds (i.e., logit) transformations. Given a probability, <span class="math inline">\(p\)</span>, we compute the odds as</p>
<p><span class="math display">\[\text{odds} = \frac{p}{1 - p}.\]</span></p>
<p>Log-odds is a minor extension; you simply take the log of the odds, which we can formally express as</p>
<p><span class="math display">\[\text{log-odds} = \log \Bigg (\frac{p}{1 - p} \Bigg ).\]</span></p>
<p>To make the conversions easy, we’ll define<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> a couple convenience functions: <code>odds()</code> and <code>log_odds()</code>.</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb862-1" data-line-number="1">odds &lt;-<span class="st"> </span><span class="cf">function</span>(p) {</a>
<a class="sourceLine" id="cb862-2" data-line-number="2">  p <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)</a>
<a class="sourceLine" id="cb862-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb862-4" data-line-number="4"></a>
<a class="sourceLine" id="cb862-5" data-line-number="5">log_odds &lt;-<span class="st"> </span><span class="cf">function</span>(p) {</a>
<a class="sourceLine" id="cb862-6" data-line-number="6">  <span class="kw">log</span>(p <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p))</a>
<a class="sourceLine" id="cb862-7" data-line-number="7">}</a></code></pre></div>
<p>Here’s how they work.</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb863-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">p =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb863-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">odds     =</span> <span class="kw">odds</span>(p),</a>
<a class="sourceLine" id="cb863-3" data-line-number="3">         <span class="dt">log_odds =</span> <span class="kw">log_odds</span>(p))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 3
##        p    odds log_odds
##    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1   0     0     -Inf    
##  2   0.1   0.111   -2.20 
##  3   0.2   0.25    -1.39 
##  4   0.3   0.429   -0.847
##  5   0.4   0.667   -0.405
##  6   0.5   1        0    
##  7   0.6   1.5      0.405
##  8   0.7   2.33     0.847
##  9   0.8   4.       1.39 
## 10   0.9   9.       2.20 
## 11   1   Inf      Inf</code></pre>
<p>Before we make our version of Figure 11.2, it might be instructive to see how odds and log-odds compare to probabilities in a plot. Here we’ll compare them to probabilities ranging from .01 to .99.</p>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb865-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">p =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.01</span>, <span class="dt">to =</span> <span class="fl">.99</span>, <span class="dt">by =</span> <span class="fl">.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb865-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">odds        =</span> <span class="kw">odds</span>(p),</a>
<a class="sourceLine" id="cb865-3" data-line-number="3">         <span class="st">`</span><span class="dt">log(odds)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">log_odds</span>(p)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb865-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>p) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb865-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name,</a>
<a class="sourceLine" id="cb865-6" data-line-number="6">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;odds&quot;</span>, <span class="st">&quot;log(odds)&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb865-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb865-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> p, <span class="dt">y =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb865-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb865-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;probability&quot;</span>,</a>
<a class="sourceLine" id="cb865-11" data-line-number="11">       <span class="dt">y =</span> <span class="st">&quot;transformed scale&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb865-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb865-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Odds are bounded to values of zero and above and have an inflection at 1. Log-odds are unbounded and have an inflection point at 0. Here we’ll save the odds and log-odds for our hazard functions within the <code>lt</code> life table.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb866-1" data-line-number="1">lt &lt;-</a>
<a class="sourceLine" id="cb866-2" data-line-number="2"><span class="st">  </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb866-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">odds     =</span> <span class="kw">odds</span>(hazard_fun),</a>
<a class="sourceLine" id="cb866-4" data-line-number="4">         <span class="dt">log_odds =</span> <span class="kw">log_odds</span>(hazard_fun)) </a>
<a class="sourceLine" id="cb866-5" data-line-number="5"></a>
<a class="sourceLine" id="cb866-6" data-line-number="6">lt</a></code></pre></div>
<pre><code>## # A tibble: 21 x 10
##    pt      time time_int n_risk n_event n_censored hazard_fun survivor_fun    odds log_odds
##    &lt;fct&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 pt = 0     6 [6, 7)       72      NA         NA    NA             1     NA         NA   
##  2 pt = 0     7 [7, 8)       72       2          0     0.0278        0.972  0.0286    -3.56
##  3 pt = 0     8 [8, 9)       70       2          0     0.0286        0.944  0.0294    -3.53
##  4 pt = 0     9 [9, 10)      68       8          0     0.118         0.833  0.133     -2.01
##  5 pt = 0    10 [10, 11)     60       8          0     0.133         0.722  0.154     -1.87
##  6 pt = 0    11 [11, 12)     52      10          0     0.192         0.583  0.238     -1.44
##  7 pt = 0    12 [12, 13)     42       8         34     0.190         0.472  0.235     -1.45
##  8 pt = 1     6 [6, 7)      108      NA         NA    NA             1     NA         NA   
##  9 pt = 1     7 [7, 8)      108      13          0     0.120         0.880  0.137     -1.99
## 10 pt = 1     8 [8, 9)       95       5          0     0.0526        0.833  0.0556    -2.89
## # … with 11 more rows</code></pre>
<p>We’re ready to make and combine the subplots for our version of Figure 11.2.</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb868-1" data-line-number="1"><span class="co"># hazard</span></a>
<a class="sourceLine" id="cb868-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb868-3" data-line-number="3"><span class="st">  </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb868-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb868-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb868-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> hazard_fun, <span class="dt">color =</span> pt, <span class="dt">group =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb868-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Estimated hazard&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb868-11" data-line-number="11">        <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb868-12" data-line-number="12">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.825</span>))</a>
<a class="sourceLine" id="cb868-13" data-line-number="13"></a>
<a class="sourceLine" id="cb868-14" data-line-number="14"><span class="co"># odds</span></a>
<a class="sourceLine" id="cb868-15" data-line-number="15">p2 &lt;-</a>
<a class="sourceLine" id="cb868-16" data-line-number="16"><span class="st">  </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb868-17" data-line-number="17"><span class="st">  </span><span class="kw">filter</span>(pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb868-18" data-line-number="18"><span class="st">  </span></a>
<a class="sourceLine" id="cb868-19" data-line-number="19"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> odds, <span class="dt">color =</span> pt, <span class="dt">group =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb868-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-22" data-line-number="22"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Estimated odds&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb868-24" data-line-number="24"></a>
<a class="sourceLine" id="cb868-25" data-line-number="25"><span class="co"># log-odds</span></a>
<a class="sourceLine" id="cb868-26" data-line-number="26">p3 &lt;-</a>
<a class="sourceLine" id="cb868-27" data-line-number="27"><span class="st">  </span>lt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb868-28" data-line-number="28"><span class="st">  </span><span class="kw">filter</span>(pt <span class="op">!=</span><span class="st"> &quot;overall&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb868-29" data-line-number="29"><span class="st">  </span></a>
<a class="sourceLine" id="cb868-30" data-line-number="30"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> log_odds, <span class="dt">color =</span> pt, <span class="dt">group =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-31" data-line-number="31"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb868-32" data-line-number="32"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-33" data-line-number="33"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Estimated logit(hazard)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb868-34" data-line-number="34"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb868-35" data-line-number="35"></a>
<a class="sourceLine" id="cb868-36" data-line-number="36">(p1 <span class="op">/</span><span class="st"> </span>p2 <span class="op">/</span><span class="st"> </span>p3 ) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb868-37" data-line-number="37"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.5</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb868-38" data-line-number="38"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb868-39" data-line-number="39"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="what-statistical-model-could-have-generated-these-sample-data" class="section level4">
<h4><span class="header-section-number">11.1.2.2</span> What statistical model could have generated these sample data?</h4>
<p>With the survival models from the prior sections, we were lazy and just used the <strong>survival</strong> package. But recall from the end of the last chapter that we can fit the analogous models <strong>brms</strong> using the binomial likelihood. This subsection is a great place to practice those some more. The fitted lines Singer and Willett displayed in Figure 11.3 can all be reproduced with binomial regression. However, the <code>sex</code> data are not in a convenient form to fit those models. Just like we did in last chapter, we’ll want to take a two-step process whereby we first convert the data to the long (i.e., person-period) format and then summarize. Happily, we can accomplish that first step by uploading the data in the <code>firstsex_pp.csv</code> file, which are already in the long format.</p>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb869-1" data-line-number="1">sex_pp &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/firstsex_pp.csv&quot;</span>)</a>
<a class="sourceLine" id="cb869-2" data-line-number="2"></a>
<a class="sourceLine" id="cb869-3" data-line-number="3"><span class="kw">glimpse</span>(sex_pp)</a></code></pre></div>
<pre><code>## Rows: 822
## Columns: 11
## $ id     &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 7, 7, 7, 9, 9,…
## $ period &lt;dbl&gt; 7, 8, 9, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 7, …
## $ event  &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0,…
## $ d7     &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0,…
## $ d8     &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1,…
## $ d9     &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,…
## $ d10    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ d11    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ d12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pt     &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0,…
## $ pas    &lt;dbl&gt; 1.9788670, 1.9788670, 1.9788670, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916,…</code></pre>
<p>Now we’ll compute the desired summary values and wrangle a bit.</p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb871-1" data-line-number="1">sex_aggregated &lt;-</a>
<a class="sourceLine" id="cb871-2" data-line-number="2"><span class="st">  </span>sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb871-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">event =</span> <span class="kw">if_else</span>(event <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;event&quot;</span>, <span class="st">&quot;no_event&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb871-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(period) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb871-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(event, pt) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb871-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb871-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> event,</a>
<a class="sourceLine" id="cb871-8" data-line-number="8">              <span class="dt">values_from =</span> n) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb871-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total         =</span> event <span class="op">+</span><span class="st"> </span>no_event,</a>
<a class="sourceLine" id="cb871-10" data-line-number="10">         <span class="dt">period_center =</span> period <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(period),</a>
<a class="sourceLine" id="cb871-11" data-line-number="11">         <span class="dt">peroid_factor =</span> <span class="kw">factor</span>(period),</a>
<a class="sourceLine" id="cb871-12" data-line-number="12">         <span class="dt">pt            =</span> <span class="kw">factor</span>(pt))</a>
<a class="sourceLine" id="cb871-13" data-line-number="13"></a>
<a class="sourceLine" id="cb871-14" data-line-number="14">sex_aggregated</a></code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    period pt    event no_event total period_center peroid_factor
##     &lt;dbl&gt; &lt;fct&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;fct&gt;        
##  1      7 0         2       70    72          -2.5 7            
##  2      7 1        13       95   108          -2.5 7            
##  3      8 0         2       68    70          -1.5 8            
##  4      8 1         5       90    95          -1.5 8            
##  5      9 0         8       60    68          -0.5 9            
##  6      9 1        16       74    90          -0.5 9            
##  7     10 0         8       52    60           0.5 10           
##  8     10 1        21       53    74           0.5 10           
##  9     11 0        10       42    52           1.5 11           
## 10     11 1        15       38    53           1.5 11           
## 11     12 0         8       34    42           2.5 12           
## 12     12 1        18       20    38           2.5 12</code></pre>
<p>Note how we saved the grade values in three columns:</p>
<ul>
<li><code>period</code> has them as continuous values, which will be hand for plotting;</li>
<li><code>period_center</code> has them as mean-centered continuous values, which will make fitting the linear model in the middle panel easier; and</li>
<li><code>period_factor</code> has them saved as a factor, which will help us fit the model in the bottom panel.</li>
</ul>
<p>Fire up <strong>brms</strong>.</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb873-1" data-line-number="1"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>Before we fit the models, it might be good to acknowledge we’re jumping ahead of the authors, a bit. Singer and Willett didn’t discuss fitting discrete time hazard models until section 11.3.2. Sure, their focus was on the frequentist approach using maximum likelihood. But the point still stands. If these model fitting details feel a bit rushed, they are.</p>
<p>Any anxious feelings aside, now fit the three binomial models. We continue to use weakly-regularizing priors for each.</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb874-1" data-line-number="1"><span class="co"># top panel</span></a>
<a class="sourceLine" id="cb874-2" data-line-number="2">fit11<span class="fl">.4</span> &lt;-</a>
<a class="sourceLine" id="cb874-3" data-line-number="3"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_aggregated,</a>
<a class="sourceLine" id="cb874-4" data-line-number="4">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb874-5" data-line-number="5">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(total) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>pt,</a>
<a class="sourceLine" id="cb874-6" data-line-number="6">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb874-7" data-line-number="7">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb874-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb874-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.04&quot;</span>)</a>
<a class="sourceLine" id="cb874-10" data-line-number="10"></a>
<a class="sourceLine" id="cb874-11" data-line-number="11"><span class="co"># middle panel</span></a>
<a class="sourceLine" id="cb874-12" data-line-number="12">fit11<span class="fl">.5</span> &lt;-</a>
<a class="sourceLine" id="cb874-13" data-line-number="13"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_aggregated,</a>
<a class="sourceLine" id="cb874-14" data-line-number="14">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb874-15" data-line-number="15">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(total) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>pt <span class="op">+</span><span class="st"> </span>period_center,</a>
<a class="sourceLine" id="cb874-16" data-line-number="16">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb874-17" data-line-number="17">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb874-18" data-line-number="18">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb874-19" data-line-number="19">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.05&quot;</span>)</a>
<a class="sourceLine" id="cb874-20" data-line-number="20"></a>
<a class="sourceLine" id="cb874-21" data-line-number="21"><span class="co"># bottom panel</span></a>
<a class="sourceLine" id="cb874-22" data-line-number="22">fit11<span class="fl">.6</span> &lt;-</a>
<a class="sourceLine" id="cb874-23" data-line-number="23"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_aggregated,</a>
<a class="sourceLine" id="cb874-24" data-line-number="24">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb874-25" data-line-number="25">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(total) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>pt <span class="op">+</span><span class="st"> </span>peroid_factor,</a>
<a class="sourceLine" id="cb874-26" data-line-number="26">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb874-27" data-line-number="27">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb874-28" data-line-number="28">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb874-29" data-line-number="29">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.06&quot;</span>)</a></code></pre></div>
<p>Check the model summaries.</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb875-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.4</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(total) ~ 0 + pt 
##    Data: sex_aggregated (Number of observations: 12) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## pt0    -2.16      0.17    -2.50    -1.83 1.00     3006     2359
## pt1    -1.44      0.12    -1.67    -1.20 1.00     3569     2236
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb877-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.5</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(total) ~ 0 + pt + period_center 
##    Data: sex_aggregated (Number of observations: 12) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## pt0              -2.23      0.18    -2.60    -1.88 1.00     3375     3009
## pt1              -1.35      0.12    -1.60    -1.11 1.00     3695     3007
## period_center     0.43      0.07     0.31     0.56 1.00     3267     2960
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb879-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.6</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(total) ~ 0 + pt + peroid_factor 
##    Data: sex_aggregated (Number of observations: 12) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## pt0                -2.98      0.30    -3.61    -2.40 1.01     1115     1570
## pt1                -2.10      0.26    -2.64    -1.62 1.01      967     1416
## peroid_factor8     -0.80      0.47    -1.78     0.13 1.01     1579     2551
## peroid_factor9      0.68      0.34     0.01     1.36 1.01     1245     2005
## peroid_factor10     1.13      0.33     0.46     1.80 1.01     1199     1433
## peroid_factor11     1.30      0.35     0.61     1.99 1.01     1239     1640
## peroid_factor12     1.78      0.36     1.10     2.48 1.01     1177     1631
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We can extract the fitted values and their summaries for each row in the data with <code>fitted()</code>. To get them in the log-odds metric, we need to set <code>scale = &quot;linear&quot;</code>. Here’s a quick example with <code>fit11.4</code>.</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb881-1" data-line-number="1"><span class="kw">fitted</span>(fit11<span class="fl">.4</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>)</a></code></pre></div>
<pre><code>##        Estimate Est.Error      Q2.5     Q97.5
##  [1,] -2.155601 0.1690484 -2.498164 -1.833945
##  [2,] -1.436847 0.1176147 -1.673421 -1.204534
##  [3,] -2.155601 0.1690484 -2.498164 -1.833945
##  [4,] -1.436847 0.1176147 -1.673421 -1.204534
##  [5,] -2.155601 0.1690484 -2.498164 -1.833945
##  [6,] -1.436847 0.1176147 -1.673421 -1.204534
##  [7,] -2.155601 0.1690484 -2.498164 -1.833945
##  [8,] -1.436847 0.1176147 -1.673421 -1.204534
##  [9,] -2.155601 0.1690484 -2.498164 -1.833945
## [10,] -1.436847 0.1176147 -1.673421 -1.204534
## [11,] -2.155601 0.1690484 -2.498164 -1.833945
## [12,] -1.436847 0.1176147 -1.673421 -1.204534</code></pre>
<p>If we convert that output to a data frame, tack on the original data values, and wrangle a bit, we’ll be in good shape to make the top panel of Figure 11.3. Below we’ll do that for each of the three panels, saving them as <code>p1</code>, <code>p2</code>, and <code>p3</code>.</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb883-1" data-line-number="1"><span class="co"># logit(hazard) is horizontal with time</span></a>
<a class="sourceLine" id="cb883-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb883-3" data-line-number="3"><span class="st">  </span><span class="kw">fitted</span>(fit11<span class="fl">.4</span>,</a>
<a class="sourceLine" id="cb883-4" data-line-number="4">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-5" data-line-number="5"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(sex_aggregated) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt =</span> <span class="kw">str_c</span>(<span class="st">&quot;pt = &quot;</span>, pt)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb883-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb883-10" data-line-number="10">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb883-12" data-line-number="12">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate),</a>
<a class="sourceLine" id="cb883-14" data-line-number="14">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">log_odds</span>(event <span class="op">/</span><span class="st"> </span>total))) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-17" data-line-number="17"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;logit(hazard) is horizontal with time&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb883-19" data-line-number="19">        <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb883-20" data-line-number="20">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.825</span>))</a>
<a class="sourceLine" id="cb883-21" data-line-number="21"></a>
<a class="sourceLine" id="cb883-22" data-line-number="22"><span class="co"># logit(hazard) is linear with time</span></a>
<a class="sourceLine" id="cb883-23" data-line-number="23">p2 &lt;-</a>
<a class="sourceLine" id="cb883-24" data-line-number="24"><span class="st">  </span><span class="kw">fitted</span>(fit11<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb883-25" data-line-number="25">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-26" data-line-number="26"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-27" data-line-number="27"><span class="st">  </span><span class="kw">bind_cols</span>(sex_aggregated) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-28" data-line-number="28"><span class="st">  </span></a>
<a class="sourceLine" id="cb883-29" data-line-number="29"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb883-30" data-line-number="30">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-31" data-line-number="31"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb883-32" data-line-number="32">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-33" data-line-number="33"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate),</a>
<a class="sourceLine" id="cb883-34" data-line-number="34">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-35" data-line-number="35"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">log_odds</span>(event <span class="op">/</span><span class="st"> </span>total))) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-36" data-line-number="36"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;logit(hazard) is linear with time&quot;</span>,</a>
<a class="sourceLine" id="cb883-37" data-line-number="37">       <span class="dt">y =</span> <span class="st">&quot;logit(hazard)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-38" data-line-number="38"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-39" data-line-number="39"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb883-40" data-line-number="40"></a>
<a class="sourceLine" id="cb883-41" data-line-number="41"><span class="co"># logit(hazard) is completely general with time</span></a>
<a class="sourceLine" id="cb883-42" data-line-number="42">p3 &lt;-</a>
<a class="sourceLine" id="cb883-43" data-line-number="43"><span class="st">  </span><span class="kw">fitted</span>(fit11<span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb883-44" data-line-number="44">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-45" data-line-number="45"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-46" data-line-number="46"><span class="st">  </span><span class="kw">bind_cols</span>(sex_aggregated) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-47" data-line-number="47"><span class="st">  </span></a>
<a class="sourceLine" id="cb883-48" data-line-number="48"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb883-49" data-line-number="49">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-50" data-line-number="50"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb883-51" data-line-number="51">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-52" data-line-number="52"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate),</a>
<a class="sourceLine" id="cb883-53" data-line-number="53">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-54" data-line-number="54"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">log_odds</span>(event <span class="op">/</span><span class="st"> </span>total))) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-55" data-line-number="55"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;logit(hazard) is completely general with time&quot;</span>,</a>
<a class="sourceLine" id="cb883-56" data-line-number="56">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-57" data-line-number="57"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb883-58" data-line-number="58"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p>Now combine the plots with <strong>patchwork</strong> syntax.</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb884-1" data-line-number="1">(p1 <span class="op">/</span><span class="st"> </span>p2 <span class="op">/</span><span class="st"> </span>p3) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb884-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb884-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb884-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb884-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-30-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>In addition to the posterior means (i.e., our analogues to the fitted values in the text), we added the 95% Bayesian intervals to give a better sense of the uncertainty in each model. Singer and Willet mused the unconstrained model (<code>fit6</code>) was a better fit to the data than the other two. We can quantify that with a LOO comparison.</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb885-1" data-line-number="1">fit11<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit11<span class="fl">.4</span>, <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb885-2" data-line-number="2">fit11<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit11<span class="fl">.5</span>, <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb885-3" data-line-number="3">fit11<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit11<span class="fl">.6</span>, <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb885-4" data-line-number="4"></a>
<a class="sourceLine" id="cb885-5" data-line-number="5"><span class="kw">loo_compare</span>(fit11<span class="fl">.4</span>, fit11<span class="fl">.5</span>, fit11<span class="fl">.6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## fit11.6   0.0       0.0   -31.6      1.8         5.1   0.7     63.2   3.5   
## fit11.5  -0.6       3.3   -32.3      3.2         3.5   1.2     64.5   6.4   
## fit11.4 -27.5      10.3   -59.2     10.3         9.1   2.5    118.3  20.7</code></pre>
<p>Here are the LOO weights.</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb887-1" data-line-number="1"><span class="kw">model_weights</span>(fit11<span class="fl">.4</span>, fit11<span class="fl">.5</span>, fit11<span class="fl">.6</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit11.4 fit11.5 fit11.6 
##   0.000   0.344   0.656</code></pre>
</div>
</div>
</div>
<div id="formal-representation-of-the-population-discrete-time-hazard-model" class="section level2">
<h2><span class="header-section-number">11.2</span> formal representation of the population discrete-time hazard model</h2>
<p>Earlier equations for the hazard function omitted substantive predictors. Now consider the case where <span class="math inline">\(X_{1ij}, X_{2ij}, . . ., X_{Pij}\)</span> stand for the <span class="math inline">\(P\)</span> predictors which may or may not vary across individuals <span class="math inline">\(i\)</span> and time periods <span class="math inline">\(j\)</span>. Thus <span class="math inline">\(x_{pij}\)</span> is the value for the <span class="math inline">\(i^\text{th}\)</span> individual on the <span class="math inline">\(p^\text{th}\)</span> variable during the <span class="math inline">\(j^\text{th}\)</span> period. We can use this to define the conditional hazard function as</p>
<p><span class="math display">\[h(t_{ij}) = \text{Pr} [T_i = j | T \geq j \text{ and } X_{1ij} = x_{1ij}, X_{2ij} = x_{2ij}, ..., X_{Pij} = x_{pij}].\]</span></p>
<p>Building further and keeping the baseline shape of the discrete hazard function flexible, we want a method that allows each of the <span class="math inline">\(j\)</span> time periods to have its own value. Imagine a set of <span class="math inline">\(J\)</span> dummy variables, <span class="math inline">\(D_1, D_2, ..., D_J\)</span>, marking off each of the time periods. For example, say <span class="math inline">\(J = 6\)</span>, we could depict this in a tibble like so.</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb889-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb889-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d1 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb889-3" data-line-number="3">         <span class="dt">d2 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb889-4" data-line-number="4">         <span class="dt">d3 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb889-5" data-line-number="5">         <span class="dt">d4 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb889-6" data-line-number="6">         <span class="dt">d5 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb889-7" data-line-number="7">         <span class="dt">d6 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   period    d1    d2    d3    d4    d5    d6
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1      1     1     0     0     0     0     0
## 2      2     0     1     0     0     0     0
## 3      3     0     0     1     0     0     0
## 4      4     0     0     0     1     0     0
## 5      5     0     0     0     0     1     0
## 6      6     0     0     0     0     0     1</code></pre>
<p>If we were to use a set of dummies of this kind in a model, we would omit the conventional regression intercept, replacing it with the <span class="math inline">\(J\)</span> dummies. Now presume we’re fitting a hazard model using the logit link, <span class="math inline">\(\operatorname{logit} h(t_{ij})\)</span>. We can express the discrete conditional hazard model with a general functional form with respect to time as</p>
<p><span class="math display">\[\operatorname{logit} h(t_{ij}) = [\alpha_1 D_{1ij} + \alpha_2 D_{2ij} + \cdots + \alpha_J D_{Jij}] + [\beta_1 X_{1ij} + \beta_2 X_{2ij} + \cdots + \beta_P X_{Pij}],\]</span></p>
<p>where the <span class="math inline">\(\alpha\)</span> parameters are the <span class="math inline">\(J\)</span> time-period dummies and the <span class="math inline">\(\beta\)</span> parameters are for other time-varying or time-invariant predictors. This is just the type of model we used to fit <code>fit116</code>. For that model, the basic equation was</p>
<p><span class="math display">\[\operatorname{logit} h(t_{ij}) = [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_1 \text{PT}_i ],\]</span></p>
<p>where the only substantive predictor was the time-invariant <code>pt</code>. However, that formula could be a little misleading. Recall the formula:</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb891-1" data-line-number="1">fit11<span class="fl">.6</span><span class="op">$</span>formula</a></code></pre></div>
<pre><code>## event | trials(total) ~ 0 + pt + peroid_factor</code></pre>
<p>We suppressed the default regression intercept with the <code>~ 0 +</code> syntax and the only two predictors were <code>pt</code> and <code>peroid_factor</code>. Both were saved as factor variables. Functionally, that’s why <code>period_factor</code> worked as <span class="math inline">\(\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}\)</span>, a series of 5 dummy variables with no reference category. The same basic thing goes for <code>pt</code>. Because <code>pt</code> was a factor used in a model <code>formula</code> with no conventional intercept, it acted as if it was a series of 2 dummy variables with no reference category. Thus, we might rewrite the model equation for <code>fit6</code> as</p>
<p><span class="math display">\[\operatorname{logit} h(t_{ij})  =  [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_0 \text{PT}_{0i} + \beta_1 \text{PT}_{1i} ].\]</span></p>
<p>And since we’re practicing fitting these models as Bayesians, the <code>fit6</code> equation with a fuller expression of the likelihood and the priors looks like</p>
<p><span class="math display">\[\begin{align*}
\text{event}_{ij} &amp; = \operatorname{Binomial}(n = \text{trials}_{ij}, p_{ij}) \\ 
\operatorname{logit} (p_{ij}) &amp; =  [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_0 \text{PT}_{0i} + \beta_1 \text{PT}_{1i} ] \\
\alpha_7, \alpha_8, ..., \alpha_{12} &amp; \sim \operatorname{Normal}(0, 4) \\
\beta_0 \text{ and } \beta_1 &amp; \sim \operatorname{Normal}(0, 4),
\end{align*}\]</span></p>
<p>where we’re describing the model in terms of the criterion, <code>event</code>, rather than in terms of <span class="math inline">\(h(t_{ij})\)</span>. And what is the criterion, <code>event</code>? It’s a vector of counts. The binomial likelihood allows us to model vectors of counts in terms of the number of trials, as indexed by our <code>trials</code> vector, and the (conditional) probability of a “1” in a given trial. In this context, <span class="math inline">\(h(t_{ij}) = p_{ij}\)</span>.</p>
<div id="what-do-the-parameters-represent" class="section level3">
<h3><span class="header-section-number">11.2.1</span> What do the parameters represent?</h3>
<p>Given our factor coding of <code>pt</code>, our two submodels for the equations in the last section are</p>
<p><span class="math display">\[\begin{align*}
\text{when PT = 0: } \operatorname{logit} h(t_j) &amp; = [\alpha_7 D_7 + \alpha_8 D_8 + \cdots + \alpha_{12} D_{12}] + \beta_0 \\
\text{when PT = 1: } \operatorname{logit} h(t_j) &amp; = [\alpha_7 D_7 + \alpha_8 D_8 + \cdots + \alpha_{12} D_{12}] + \beta_1,
\end{align*}\]</span></p>
<p>where we used Singer and Willett’s simplified notation and dropped all the <span class="math inline">\(i\)</span> subscripts and most of the <span class="math inline">\(j\)</span> subscripts.</p>
</div>
<div id="an-alternative-representation-of-the-model." class="section level3">
<h3><span class="header-section-number">11.2.2</span> An alternative representation of the model.</h3>
<p>In the previous sections, we expressed the model in terms of the logit of the criterion or the <span class="math inline">\(p\)</span> parameter of the likelihood. Another strategy is the express the criterion (or <span class="math inline">\(p\)</span>) in its natural metric and put the nonlinear portion on the right side of the equation. If we consider the generic discrete conditional hazard function, that would follow the form</p>
<p><span class="math display">\[h(t_{ij})  = \frac{1}{1 + e^{-([\alpha_1 D_{1ij} + \alpha_2 D_{2ij} + \cdots + \alpha_J D_{Jij}] + [\beta_1 X_{1ij} + \beta_2 X_{2ij} + \cdots + \beta_P X_{Pij}])}}.\]</span></p>
<p>This is just a particular kind of logistic regression model. It also clarifies that “by specifying a linear relationship between predictors and logit hazard we imply a <em>nonlinear</em> relationship between predictors and <em>raw hazard</em>” (p. 377, <em>emphasis</em> in the original). We can explore what that might look like with our version of Figure 11.4. Here we continue to use <code>fit6</code>, but this time we’ll save the output from <code>fitted()</code> before plotting.</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb893-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb893-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(fit11<span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb893-3" data-line-number="3">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb893-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb893-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(sex_aggregated)</a>
<a class="sourceLine" id="cb893-6" data-line-number="6"></a>
<a class="sourceLine" id="cb893-7" data-line-number="7">f</a></code></pre></div>
<pre><code>##      Estimate Est.Error       Q2.5      Q97.5 period pt event no_event total period_center peroid_factor
## 1  -2.9823801 0.3027754 -3.6052434 -2.4029398      7  0     2       70    72          -2.5             7
## 2  -2.1040306 0.2627053 -2.6400659 -1.6186357      7  1    13       95   108          -2.5             7
## 3  -3.7780523 0.4274048 -4.6832736 -2.9802509      8  0     2       68    70          -1.5             8
## 4  -2.8997028 0.3986271 -3.7552060 -2.1762555      8  1     5       90    95          -1.5             8
## 5  -2.3039891 0.2752605 -2.8577347 -1.7842792      9  0     8       60    68          -0.5             9
## 6  -1.4256396 0.2336338 -1.8961418 -0.9931028      9  1    16       74    90          -0.5             9
## 7  -1.8484071 0.2612627 -2.3727600 -1.3615568     10  0     8       52    60           0.5            10
## 8  -0.9700576 0.2258581 -1.4365800 -0.5480139     10  1    21       53    74           0.5            10
## 9  -1.6845420 0.2727390 -2.2317108 -1.1589977     11  0    10       42    52           1.5            11
## 10 -0.8061924 0.2488261 -1.3015364 -0.3373509     11  1    15       38    53           1.5            11
## 11 -1.1987436 0.2818114 -1.7638193 -0.6609502     12  0     8       34    42           2.5            12
## 12 -0.3203941 0.2668366 -0.8597507  0.1816277     12  1    18       20    38           2.5            12</code></pre>
<p>Make the subplots.</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb895-1" data-line-number="1"><span class="co"># logit(hazard)</span></a>
<a class="sourceLine" id="cb895-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb895-3" data-line-number="3"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb895-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt =</span> <span class="kw">str_c</span>(<span class="st">&quot;pt = &quot;</span>, pt)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb895-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb895-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb895-7" data-line-number="7">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb895-9" data-line-number="9">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;logit(hazard)&quot;</span>,</a>
<a class="sourceLine" id="cb895-12" data-line-number="12">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-13" data-line-number="13"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb895-15" data-line-number="15">        <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb895-16" data-line-number="16">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.825</span>))</a>
<a class="sourceLine" id="cb895-17" data-line-number="17"></a>
<a class="sourceLine" id="cb895-18" data-line-number="18"><span class="co"># odds</span></a>
<a class="sourceLine" id="cb895-19" data-line-number="19">p2 &lt;-</a>
<a class="sourceLine" id="cb895-20" data-line-number="20"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb895-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>), <span class="dt">.funs =</span> exp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb895-22" data-line-number="22"><span class="st">  </span></a>
<a class="sourceLine" id="cb895-23" data-line-number="23"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb895-24" data-line-number="24">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-25" data-line-number="25"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb895-26" data-line-number="26">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-27" data-line-number="27"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-28" data-line-number="28"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;odds&quot;</span>,</a>
<a class="sourceLine" id="cb895-29" data-line-number="29">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-30" data-line-number="30"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.8</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-31" data-line-number="31"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb895-32" data-line-number="32"></a>
<a class="sourceLine" id="cb895-33" data-line-number="33"><span class="co"># hazard</span></a>
<a class="sourceLine" id="cb895-34" data-line-number="34">p3 &lt;-</a>
<a class="sourceLine" id="cb895-35" data-line-number="35"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb895-36" data-line-number="36"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>), <span class="dt">.funs =</span> inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb895-37" data-line-number="37"><span class="st">  </span></a>
<a class="sourceLine" id="cb895-38" data-line-number="38"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb895-39" data-line-number="39">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-40" data-line-number="40"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb895-41" data-line-number="41">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-42" data-line-number="42"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-43" data-line-number="43"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;hazard (i.e., probability)&quot;</span>,</a>
<a class="sourceLine" id="cb895-44" data-line-number="44">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-45" data-line-number="45"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb895-46" data-line-number="46"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p>Combine the subplots with <strong>patchwork</strong>.</p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb896-1" data-line-number="1">(p1 <span class="op">/</span><span class="st"> </span>p2 <span class="op">/</span><span class="st"> </span>p3) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb896-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb896-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb896-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb896-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-37-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The <code>mutate_at()</code> conversions we made for <code>p2</code> and <code>p3</code> were based on the guidelines in Table 11.2. Those were:</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb897-1" data-line-number="1"><span class="kw">tibble</span>(<span class="st">`</span><span class="dt">original scale</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;odds&quot;</span>, <span class="st">&quot;logit&quot;</span>),</a>
<a class="sourceLine" id="cb897-2" data-line-number="2">       <span class="st">`</span><span class="dt">desired scale</span><span class="st">`</span>  =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;odds&quot;</span>, <span class="st">&quot;probability&quot;</span>, <span class="st">&quot;probability&quot;</span>),</a>
<a class="sourceLine" id="cb897-3" data-line-number="3">       <span class="dt">transformation   =</span> <span class="kw">c</span>(<span class="st">&quot;exp(logit)&quot;</span>, <span class="st">&quot;odds / (1 + odds)&quot;</span>, <span class="st">&quot;1 / (1 + exp(-1 * logit))&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb897-4" data-line-number="4"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">original scale</th>
<th align="left">desired scale</th>
<th align="left">transformation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">logit</td>
<td align="left">odds</td>
<td align="left">exp(logit)</td>
</tr>
<tr class="even">
<td align="left">odds</td>
<td align="left">probability</td>
<td align="left">odds / (1 + odds)</td>
</tr>
<tr class="odd">
<td align="left">logit</td>
<td align="left">probability</td>
<td align="left">1 / (1 + exp(-1 * logit))</td>
</tr>
</tbody>
</table>
<p>We accomplished the transformation in the bottom row with the <code>brms::inv_logit_scaled()</code> function.</p>
</div>
</div>
<div id="fitting-a-discrete-time-hazard-model-to-data" class="section level2">
<h2><span class="header-section-number">11.3</span> Fitting a discrete-time hazard model to data</h2>
<p>As Singer and Willett wrote, “with data collected on a random sample of individuals from a target population, you can easily fit a discrete-time hazard model, estimate its parameters using maximum likelihood methods, and evaluate goodness-of-fit” (pp. 378–379. As we’ve already demonstrated, you can fit them with Bayesian software, too. Though we’ll be focusing on <strong>brms</strong>, you might also want to check out the <strong>rstanarm</strong> package, about which you can learn more from Brilleman, Elci, Novik, and Wolfe’s preprint, <a href="https://arxiv.org/abs/2002.09633"><em>Bayesian Survival Analysis Using the rstanarm R Package</em></a>, Brilleman’s <a href="https://github.com/stan-dev/rstanarm/blob/feature/frailty-models/vignettes/surv.Rmd"><em>Estimating Survival (Time-to-Event) Models with rstanarm</em> vignette</a>, and the <a href="https://discourse.mc-stan.org/t/survival-models-in-rstanarm/3998">Survival models in rstanarm thread</a> in the Stan forums.</p>
<div id="adding-predictors-to-the-person-period-data-set." class="section level3">
<h3><span class="header-section-number">11.3.1</span> Adding predictors to the person-period data set.</h3>
<p>At the beginning of section 11.1.2.2, we already loaded a version of the person-period data including the discrete-time dummies. It has our substantive predictors <code>pt</code> and <code>pas</code>, too. We saved it as <code>sex_pp</code>. Here’s a <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb898-1" data-line-number="1">sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb898-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 822
## Columns: 11
## $ id     &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 7, 7, 7, 9, 9,…
## $ period &lt;dbl&gt; 7, 8, 9, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 7, …
## $ event  &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0,…
## $ d7     &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0,…
## $ d8     &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1,…
## $ d9     &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,…
## $ d10    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ d11    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ d12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pt     &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0,…
## $ pas    &lt;dbl&gt; 1.9788670, 1.9788670, 1.9788670, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916,…</code></pre>
</div>
<div id="maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model." class="section level3">
<h3><span class="header-section-number">11.3.2</span> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model.</h3>
<p>We’re not going to walk through all the foundational equations for the likelihood and log-likelihood functions (Equations 11.11 through 11.13). For our purposes, just note that “it turns out that the standard logistic regression routines widely available in all major statistical packages, <em>when applied appropriately in the person-period data set</em>, actually provide estimates of the parameters of the discrete-time hazard model” (p. 383, <em>emphasis</em> in the original). Happily, this is what we’ve been doing. Bayesian logistic regression via the binomial likelihood has been our approach. And since we’re Bayesians, the same caveat applies to survival models as applied to the other longitudinal models we fit in earlier chapters. We’re not just maximizing likelihoods, here. Bayes’s formula requires us to multiply the likelihood by the prior.</p>
<p><span class="math display">\[\underbrace{p(\theta | d)}_\text{posterior} \propto \underbrace{p(d | \theta)}_\text{likelihood} \; \underbrace{p(\theta)}_\text{prior}\]</span></p>
</div>
<div id="fitting-the-discrete-time-hazard-model-to-data." class="section level3">
<h3><span class="header-section-number">11.3.3</span> Fitting the discrete-time hazard model to data.</h3>
<p>In one sense, fitting discrete-hazard models with Bayesian logistic regression is old hat, for us. We’ve been doing that since the end of last chapter. But one thing I haven’t clarified is, up to this point, we have been using the aggregated binomial format. To show what I mean, we might look at the data we used for our last model, <code>fit11.6</code>.</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb900-1" data-line-number="1">sex_aggregated</a></code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    period pt    event no_event total period_center peroid_factor
##     &lt;dbl&gt; &lt;fct&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;fct&gt;        
##  1      7 0         2       70    72          -2.5 7            
##  2      7 1        13       95   108          -2.5 7            
##  3      8 0         2       68    70          -1.5 8            
##  4      8 1         5       90    95          -1.5 8            
##  5      9 0         8       60    68          -0.5 9            
##  6      9 1        16       74    90          -0.5 9            
##  7     10 0         8       52    60           0.5 10           
##  8     10 1        21       53    74           0.5 10           
##  9     11 0        10       42    52           1.5 11           
## 10     11 1        15       38    53           1.5 11           
## 11     12 0         8       34    42           2.5 12           
## 12     12 1        18       20    38           2.5 12</code></pre>
<p>Now recall the formula for the binomial likelihood from the end of last chapter:</p>
<p><span class="math display">\[\text{Pr} (z | n, p) = \frac{n!}{z!(n - z)!} p^z (1 - p)^{n - z},\]</span></p>
<p>where <span class="math inline">\(z\)</span> is the number of cases for which the value is 1, <span class="math inline">\(n\)</span> is the total number of cases, and <span class="math inline">\(p\)</span> is the constant chance of a 1 across cases. We refer to binomial data as aggregated with <span class="math inline">\(n &gt; 1\)</span>. Our <span class="math inline">\(n\)</span> vector in the <code>sex_aggregated</code>, <code>total</code>, ranged from 38 to 108. Accordingly, our <span class="math inline">\(z\)</span> vector, <code>event</code>, was always some value equal or lower to that in the same row for <code>total</code>.</p>
<p>The person-period data, <code>sex_pp</code>, contain the same information but in a different format. Instead, each <code>event</code> cell only takes on a value of 0 or 1 (i.e., <span class="math inline">\(n = 1\)</span>). If you were to sum up all the values in the <code>total</code> column of the <code>sex_aggregated</code> data, you’d return 822.</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb902-1" data-line-number="1">sex_aggregated <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb902-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum =</span> <span class="kw">sum</span>(total))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##     sum
##   &lt;int&gt;
## 1   822</code></pre>
<p>This is also the total number of rows in the <code>sex_pp</code> data.</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb904-1" data-line-number="1">sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb904-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   822</code></pre>
<p>It’s also the case that when <span class="math inline">\(n = 1\)</span>, the right side of the equation for the binomial function reduces to</p>
<p><span class="math display">\[p^z (1 - p)^{1 - z}.\]</span></p>
<p>Whether you are working with aggregated or un-aggregated data, both are suited to fit logistic regression models with the binomial likelihood. Just specify the necessary information in the model syntax. For <strong>brms</strong>, the primary difference is how you use the <code>trials()</code> function. When we fit our logistic regression models using the aggregated data, we specified <code>trials(total)</code>, which informed the <code>brm()</code> function what the <span class="math inline">\(n\)</span> values were. In the case of unaggregated binomial data, we can just state <code>trials(1)</code>. Each sell is the outcome <span class="math inline">\(z\)</span> for a single trial. Here’s how to use that with Models A through D on page 385.</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb906-1" data-line-number="1"><span class="co"># model a</span></a>
<a class="sourceLine" id="cb906-2" data-line-number="2">fit11<span class="fl">.7</span> &lt;-</a>
<a class="sourceLine" id="cb906-3" data-line-number="3"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb906-4" data-line-number="4">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb906-5" data-line-number="5">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12,</a>
<a class="sourceLine" id="cb906-6" data-line-number="6">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb906-7" data-line-number="7">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb906-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb906-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.07&quot;</span>)</a>
<a class="sourceLine" id="cb906-10" data-line-number="10"></a>
<a class="sourceLine" id="cb906-11" data-line-number="11"><span class="co"># model b</span></a>
<a class="sourceLine" id="cb906-12" data-line-number="12">fit11<span class="fl">.8</span> &lt;-</a>
<a class="sourceLine" id="cb906-13" data-line-number="13"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb906-14" data-line-number="14">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb906-15" data-line-number="15">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12 <span class="op">+</span><span class="st"> </span>pt,</a>
<a class="sourceLine" id="cb906-16" data-line-number="16">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb906-17" data-line-number="17">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb906-18" data-line-number="18">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb906-19" data-line-number="19">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.08&quot;</span>)</a>
<a class="sourceLine" id="cb906-20" data-line-number="20"></a>
<a class="sourceLine" id="cb906-21" data-line-number="21"><span class="co"># model c</span></a>
<a class="sourceLine" id="cb906-22" data-line-number="22">fit11<span class="fl">.9</span> &lt;-</a>
<a class="sourceLine" id="cb906-23" data-line-number="23"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb906-24" data-line-number="24">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb906-25" data-line-number="25">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12 <span class="op">+</span><span class="st"> </span>pas,</a>
<a class="sourceLine" id="cb906-26" data-line-number="26">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb906-27" data-line-number="27">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb906-28" data-line-number="28">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb906-29" data-line-number="29">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.09&quot;</span>)</a>
<a class="sourceLine" id="cb906-30" data-line-number="30"></a>
<a class="sourceLine" id="cb906-31" data-line-number="31"><span class="co"># model d</span></a>
<a class="sourceLine" id="cb906-32" data-line-number="32">fit11<span class="fl">.10</span> &lt;-</a>
<a class="sourceLine" id="cb906-33" data-line-number="33"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb906-34" data-line-number="34">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb906-35" data-line-number="35">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12 <span class="op">+</span><span class="st"> </span>pt <span class="op">+</span><span class="st"> </span>pas,</a>
<a class="sourceLine" id="cb906-36" data-line-number="36">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb906-37" data-line-number="37">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb906-38" data-line-number="38">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb906-39" data-line-number="39">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.10&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="interpreting-parameter-estimates" class="section level2">
<h2><span class="header-section-number">11.4</span> Interpreting parameter estimates</h2>
<p>Here are the model summaries in bulk.</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb907-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.7</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 
##    Data: sex_pp (Number of observations: 822) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## d7     -2.42      0.27    -2.98    -1.91 1.00     5256     2256
## d8     -3.16      0.41    -4.05    -2.45 1.00     3795     1956
## d9     -1.73      0.22    -2.19    -1.32 1.00     4750     2432
## d10    -1.30      0.21    -1.71    -0.88 1.00     5076     2613
## d11    -1.18      0.23    -1.64    -0.74 1.00     5062     2689
## d12    -0.74      0.24    -1.23    -0.27 1.00     5070     2662
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb909-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.8</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt 
##    Data: sex_pp (Number of observations: 822) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## d7     -3.00      0.31    -3.62    -2.43 1.00     3358     2965
## d8     -3.73      0.42    -4.60    -2.96 1.00     3911     2413
## d9     -2.28      0.27    -2.82    -1.77 1.00     2981     3153
## d10    -1.82      0.25    -2.33    -1.34 1.00     2803     3189
## d11    -1.65      0.27    -2.18    -1.13 1.00     3017     2707
## d12    -1.18      0.27    -1.71    -0.64 1.00     3388     2817
## pt      0.86      0.21     0.44     1.27 1.00     1752     2304
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb911-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.9</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pas 
##    Data: sex_pp (Number of observations: 822) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## d7     -2.49      0.28    -3.06    -1.97 1.00     5613     3027
## d8     -3.20      0.41    -4.08    -2.47 1.00     5041     2792
## d9     -1.74      0.22    -2.18    -1.33 1.00     6378     2773
## d10    -1.30      0.22    -1.75    -0.88 1.00     5745     2686
## d11    -1.14      0.24    -1.61    -0.70 1.00     5150     3215
## d12    -0.65      0.24    -1.15    -0.19 1.00     5412     3082
## pas     0.44      0.11     0.22     0.67 1.00     6587     3449
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb913-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.10</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt + pas 
##    Data: sex_pp (Number of observations: 822) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## d7     -2.90      0.31    -3.56    -2.30 1.00     2644     2387
## d8     -3.61      0.43    -4.51    -2.83 1.00     3094     2761
## d9     -2.15      0.28    -2.72    -1.63 1.00     2306     2394
## d10    -1.69      0.26    -2.24    -1.18 1.00     2136     2649
## d11    -1.51      0.27    -2.05    -0.99 1.00     2542     2813
## d12    -1.00      0.28    -1.57    -0.46 1.00     2621     2732
## pt      0.64      0.24     0.19     1.11 1.00     1433     1850
## pas     0.30      0.12     0.06     0.54 1.00     3444     3031
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Although the text distinguishes between <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters (i.e., intercept and slope parameters, respectively), our <strong>brms</strong> output makes no such distinction. These are all of <code>class = b</code>, population-level <span class="math inline">\(\beta\)</span> parameters.</p>
<p>When viewed in bulk, all those <code>print()</code> calls yield a lot of output. We can arrange the parameter summaries similar to those in Table 11.3 with help from <code>broom::tidy()</code>.</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb915-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb915-2" data-line-number="2"></a>
<a class="sourceLine" id="cb915-3" data-line-number="3"><span class="kw">bind_rows</span>(<span class="kw">tidy</span>(fit11<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;a&quot;</span>),</a>
<a class="sourceLine" id="cb915-4" data-line-number="4">          <span class="kw">tidy</span>(fit11<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb915-5" data-line-number="5">          <span class="kw">tidy</span>(fit11<span class="fl">.9</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb915-6" data-line-number="6">          <span class="kw">tidy</span>(fit11<span class="fl">.10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;d&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb915-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;lp__&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb915-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term  =</span> <span class="kw">str_remove</span>(term, <span class="st">&quot;b_&quot;</span>),</a>
<a class="sourceLine" id="cb915-9" data-line-number="9">         <span class="dt">model =</span> <span class="kw">str_c</span>(<span class="st">&quot;model &quot;</span>, model),</a>
<a class="sourceLine" id="cb915-10" data-line-number="10">         <span class="dt">e_sd  =</span> <span class="kw">str_c</span>(<span class="kw">round</span>(estimate, <span class="dt">digits =</span> <span class="dv">2</span>), <span class="st">&quot; (&quot;</span>, <span class="kw">round</span>(std.error, <span class="dt">digits =</span> <span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb915-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(model, term, e_sd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb915-12" data-line-number="12"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> model, </a>
<a class="sourceLine" id="cb915-13" data-line-number="13">              <span class="dt">values_from =</span> e_sd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb915-14" data-line-number="14"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="left">model a</th>
<th align="left">model b</th>
<th align="left">model c</th>
<th align="left">model d</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">d7</td>
<td align="left">-2.42 (0.27)</td>
<td align="left">-3 (0.31)</td>
<td align="left">-2.49 (0.28)</td>
<td align="left">-2.9 (0.31)</td>
</tr>
<tr class="even">
<td align="left">d8</td>
<td align="left">-3.16 (0.41)</td>
<td align="left">-3.73 (0.42)</td>
<td align="left">-3.2 (0.41)</td>
<td align="left">-3.61 (0.43)</td>
</tr>
<tr class="odd">
<td align="left">d9</td>
<td align="left">-1.73 (0.22)</td>
<td align="left">-2.28 (0.27)</td>
<td align="left">-1.74 (0.22)</td>
<td align="left">-2.15 (0.28)</td>
</tr>
<tr class="even">
<td align="left">d10</td>
<td align="left">-1.3 (0.21)</td>
<td align="left">-1.82 (0.25)</td>
<td align="left">-1.3 (0.22)</td>
<td align="left">-1.69 (0.26)</td>
</tr>
<tr class="odd">
<td align="left">d11</td>
<td align="left">-1.18 (0.23)</td>
<td align="left">-1.65 (0.27)</td>
<td align="left">-1.14 (0.24)</td>
<td align="left">-1.51 (0.27)</td>
</tr>
<tr class="even">
<td align="left">d12</td>
<td align="left">-0.74 (0.24)</td>
<td align="left">-1.18 (0.27)</td>
<td align="left">-0.65 (0.24)</td>
<td align="left">-1 (0.28)</td>
</tr>
<tr class="odd">
<td align="left">pt</td>
<td align="left">NA</td>
<td align="left">0.86 (0.21)</td>
<td align="left">NA</td>
<td align="left">0.64 (0.24)</td>
</tr>
<tr class="even">
<td align="left">pas</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">0.44 (0.11)</td>
<td align="left">0.3 (0.12)</td>
</tr>
</tbody>
</table>
<div id="the-time-indicators." class="section level3">
<h3><span class="header-section-number">11.4.1</span> The time indicators.</h3>
<blockquote>
<p>As a group, the <span class="math inline">\(\hat \alpha\)</span>s are [Bayesian] estimates for the baseline logit hazard function. The amount and direction of variation in their values describe the shape of this function and tell us whether risk increases, decreases, or remains steady over time. (p. 387)</p>
</blockquote>
<p>A coefficient plot might help us get a sense of that across the four models.</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" data-line-number="1"><span class="kw">bind_rows</span>(<span class="kw">tidy</span>(fit11<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;a&quot;</span>),</a>
<a class="sourceLine" id="cb916-2" data-line-number="2">          <span class="kw">tidy</span>(fit11<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb916-3" data-line-number="3">          <span class="kw">tidy</span>(fit11<span class="fl">.9</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb916-4" data-line-number="4">          <span class="kw">tidy</span>(fit11<span class="fl">.10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;d&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb916-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(term, <span class="st">&quot;d&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb916-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">str_c</span>(<span class="st">&quot;model &quot;</span>, model),</a>
<a class="sourceLine" id="cb916-7" data-line-number="7">         <span class="dt">term  =</span> <span class="kw">factor</span>(<span class="kw">str_remove</span>(term, <span class="st">&quot;b_&quot;</span>),</a>
<a class="sourceLine" id="cb916-8" data-line-number="8">                       <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;d&quot;</span>, <span class="dv">12</span><span class="op">:</span><span class="dv">7</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb916-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb916-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> term, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper)) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">fatten =</span> <span class="fl">2.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb916-13" data-line-number="13">       <span class="dt">y =</span> <span class="st">&quot;posterior (log-odds scale)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb916-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb916-16" data-line-number="16">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb916-17" data-line-number="17">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-18" data-line-number="18"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>model, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-45-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>“The fairly steady increase over time in the magnitude of the <span class="math inline">\(\hat \alpha\)</span>s in each model [in the coefficient plot] shows that, in this sample of boys, the risk of first intercourse increases over time” (p. 387). When comparing the <span class="math inline">\(\hat \alpha\)</span>s across models, it’s important to recall that the presence/absence of substantive covariates means each model has a different baseline group.</p>
<p>Because they were in the log-odds scale, the model output and our coefficient plot can be difficult to interpret. With the <code>brms::inv_logit_scaled()</code>, we can convert the <span class="math inline">\(\hat \alpha\)</span>s to the hazard (i.e., probability) metric.</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb917-1" data-line-number="1"><span class="kw">bind_rows</span>(<span class="kw">tidy</span>(fit11<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;a&quot;</span>),</a>
<a class="sourceLine" id="cb917-2" data-line-number="2">          <span class="kw">tidy</span>(fit11<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb917-3" data-line-number="3">          <span class="kw">tidy</span>(fit11<span class="fl">.9</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb917-4" data-line-number="4">          <span class="kw">tidy</span>(fit11<span class="fl">.10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;d&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(term, <span class="st">&quot;d&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">str_c</span>(<span class="st">&quot;model &quot;</span>, model),</a>
<a class="sourceLine" id="cb917-7" data-line-number="7">         <span class="dt">term  =</span> <span class="kw">factor</span>(<span class="kw">str_remove</span>(term, <span class="st">&quot;b_&quot;</span>),</a>
<a class="sourceLine" id="cb917-8" data-line-number="8">                       <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;d&quot;</span>, <span class="dv">12</span><span class="op">:</span><span class="dv">7</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb917-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(estimate<span class="op">:</span>upper), <span class="dt">.funs =</span> inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb917-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> term, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper)) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">fatten =</span> <span class="fl">2.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb917-14" data-line-number="14">       <span class="dt">y =</span> <span class="st">&quot;posterior (hazard scale)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-15" data-line-number="15"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb917-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb917-17" data-line-number="17">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb917-18" data-line-number="18">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-19" data-line-number="19"><span class="kw">facet_wrap</span>(<span class="op">~</span>model, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-46-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Building further, here’s our version of Table 11.4.</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" data-line-number="1"><span class="kw">tidy</span>(fit11<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;lp__&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">time period</span><span class="st">`</span> =<span class="st"> </span><span class="kw">str_remove</span>(term, <span class="st">&quot;b_d&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),</a>
<a class="sourceLine" id="cb918-4" data-line-number="4">         <span class="dt">predictor     =</span> <span class="kw">str_remove</span>(term, <span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">time period</span><span class="st">`</span>, predictor, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">fitted odds</span><span class="st">`</span>   =<span class="st"> </span><span class="kw">exp</span>(estimate),</a>
<a class="sourceLine" id="cb918-7" data-line-number="7">         <span class="st">`</span><span class="dt">fitted hazard</span><span class="st">`</span> =<span class="st"> </span><span class="kw">inv_logit_scaled</span>(estimate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-9" data-line-number="9"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">time period</th>
<th align="left">predictor</th>
<th align="right">estimate</th>
<th align="right">fitted odds</th>
<th align="right">fitted hazard</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">7</td>
<td align="left">d7</td>
<td align="right">-2.4168</td>
<td align="right">0.0892</td>
<td align="right">0.0819</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">d8</td>
<td align="right">-3.1564</td>
<td align="right">0.0426</td>
<td align="right">0.0408</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">d9</td>
<td align="right">-1.7306</td>
<td align="right">0.1772</td>
<td align="right">0.1505</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">d10</td>
<td align="right">-1.2959</td>
<td align="right">0.2736</td>
<td align="right">0.2148</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">d11</td>
<td align="right">-1.1753</td>
<td align="right">0.3087</td>
<td align="right">0.2359</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="left">d12</td>
<td align="right">-0.7416</td>
<td align="right">0.4764</td>
<td align="right">0.3227</td>
</tr>
</tbody>
</table>
</div>
<div id="dichotomous-substantive-predictors." class="section level3">
<h3><span class="header-section-number">11.4.2</span> Dichotomous substantive predictors.</h3>
<p>Here’s the summary for <code>pt</code> from <code>fit11.8</code> (i.e., Model B).</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb919-1" data-line-number="1"><span class="kw">fixef</span>(fit11<span class="fl">.8</span>)[<span class="st">&quot;pt&quot;</span>, ]</a></code></pre></div>
<pre><code>##  Estimate Est.Error      Q2.5     Q97.5 
## 0.8572376 0.2126537 0.4366487 1.2708265</code></pre>
<p>If we take the anti-log (i.e., exponentiate) of that coefficient, we’ll return an odds ratio. Here’s the conversion with just the posterior mean.</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb921-1" data-line-number="1"><span class="kw">fixef</span>(fit11<span class="fl">.8</span>)[<span class="st">&quot;pt&quot;</span>, <span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>()</a></code></pre></div>
<pre><code>## [1] 2.356642</code></pre>
<p>To get a better sense of the conversion, here it is in a plot.</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb923-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb923-2" data-line-number="2"></a>
<a class="sourceLine" id="cb923-3" data-line-number="3"><span class="kw">posterior_samples</span>(fit11<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb923-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">log-odds</span><span class="st">`</span>     =<span class="st"> </span>b_pt,</a>
<a class="sourceLine" id="cb923-5" data-line-number="5">            <span class="st">`</span><span class="dt">hazard ratio</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(b_pt)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb923-6" data-line-number="6"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb923-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name,</a>
<a class="sourceLine" id="cb923-8" data-line-number="8">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;log-odds&quot;</span>, <span class="st">&quot;hazard ratio&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb923-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb923-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb923-11" data-line-number="11"><span class="st">  </span><span class="kw">stat_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>),</a>
<a class="sourceLine" id="cb923-12" data-line-number="12">                <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb923-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb923-14" data-line-number="14"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;marginal posterior for pt&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb923-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb923-16" data-line-number="16"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-50-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>This tells us that, in every grade, the estimated odds of first intercourse are nearly two and one half times higher for boys who experienced a parenting transition in comparison to boys raised with both biological parents. In substantive terms, an odds ratio of this magnitude represents a substantial, and potentially important, effect. (p. 398)</p>
</blockquote>
<p>To reframe the odds ratio in terms of the other group (i.e., <code>pt == 0</code>), take the reciprocal.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb924-1" data-line-number="1"><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">fixef</span>(fit11<span class="fl">.8</span>)[<span class="dv">7</span>, <span class="dv">1</span>])</a></code></pre></div>
<pre><code>## [1] 0.4243326</code></pre>
<p>“This tells us that the estimated odds of first intercourse for boys who did not experience a parenting transition are approximately 40% of the odds for boys who did. These complimentary ways of reporting effect sizes are equivalent” (p. 389)</p>
</div>
<div id="continuous-substantive-predictors." class="section level3">
<h3><span class="header-section-number">11.4.3</span> Continuous substantive predictors.</h3>
<p>Here’s the conditional effect of <code>pas</code> from <code>fit11.9</code> (i.e., Model C).</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb926-1" data-line-number="1"><span class="kw">fixef</span>(fit11<span class="fl">.9</span>)[<span class="st">&quot;pas&quot;</span>, ]</a></code></pre></div>
<pre><code>##  Estimate Est.Error      Q2.5     Q97.5 
## 0.4445845 0.1135034 0.2176975 0.6663583</code></pre>
<p>To understand <code>pas</code>, our measure of parental antisocial behavior, it will help to look at its range.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb928-1" data-line-number="1"><span class="kw">range</span>(sex_pp<span class="op">$</span>pas)</a></code></pre></div>
<pre><code>## [1] -1.716180  2.781413</code></pre>
<p>Exponentiating (i.e., taking the anti-log) the posterior of a continuous predictor is a legitimate way to convert it to a hazard ratio.</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb930-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit11<span class="fl">.9</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb930-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">log-odds</span><span class="st">`</span>     =<span class="st"> </span>b_pas,</a>
<a class="sourceLine" id="cb930-3" data-line-number="3">            <span class="st">`</span><span class="dt">hazard ratio</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(b_pas)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb930-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb930-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name,</a>
<a class="sourceLine" id="cb930-6" data-line-number="6">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;log-odds&quot;</span>, <span class="st">&quot;hazard ratio&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb930-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb930-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb930-9" data-line-number="9"><span class="st">  </span><span class="kw">stat_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>),</a>
<a class="sourceLine" id="cb930-10" data-line-number="10">                <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb930-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb930-12" data-line-number="12"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;marginal posterior for pas&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb930-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb930-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-54-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here’s how to compute the hazard ratio for a 2-unit difference in <code>pas</code>.</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb931-1" data-line-number="1"><span class="kw">exp</span>(<span class="kw">fixef</span>(fit11<span class="fl">.9</span>)[<span class="dv">7</span>, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 2.433107</code></pre>
<p>Here’s what that looks like in a plot.</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb933-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit11<span class="fl">.9</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb933-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">log-odds</span><span class="st">`</span>                   =<span class="st"> </span>b_pas,</a>
<a class="sourceLine" id="cb933-3" data-line-number="3">            <span class="st">`</span><span class="dt">hazard ratio</span><span class="st">`</span>               =<span class="st"> </span><span class="kw">exp</span>(b_pas),</a>
<a class="sourceLine" id="cb933-4" data-line-number="4">            <span class="st">`</span><span class="dt">hr for a 2-unit difference</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(b_pas <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb933-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb933-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name,</a>
<a class="sourceLine" id="cb933-7" data-line-number="7">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;log-odds&quot;</span>, <span class="st">&quot;hazard ratio&quot;</span>, <span class="st">&quot;hr for a 2-unit difference&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb933-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb933-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb933-10" data-line-number="10"><span class="st">  </span><span class="kw">stat_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>),</a>
<a class="sourceLine" id="cb933-11" data-line-number="11">                <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb933-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb933-13" data-line-number="13"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;marginal posterior for pas&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb933-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb933-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-56-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="polytomous-substantive-predictors." class="section level3">
<h3><span class="header-section-number">11.4.4</span> Polytomous substantive predictors.</h3>
<p>Unfortunately, neither the <code>sex</code> nor the <code>sex_pp</code> data sets contain the polytomous version of <code>pt</code> as Singer described in this section. However, we can simulate a similar set of dummy variables which will allow us to trace the basic steps in Singer and Willett’s workflow.</p>
<p>Since we’ve been working with the <code>sex_pp</code> data for the past few models, we’ll continue using it here. However, this creates a minor challenge. What we want to do is use the <code>sample()</code> function to randomly assign cases with values of 1, 2, or 3 conditional on whether <code>pt == 0</code>. The catch is, we need to make sure that random value is constant for each case. Our solution will be to first nest the data such that each case only has one row. Here’s what that looks like.</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb934-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb934-2" data-line-number="2"></a>
<a class="sourceLine" id="cb934-3" data-line-number="3">sex_pp &lt;-</a>
<a class="sourceLine" id="cb934-4" data-line-number="4"><span class="st">  </span>sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb934-5" data-line-number="5"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">data =</span> <span class="kw">c</span>(period, event, d7, d8, d9, d10, d11, d12, pas)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb934-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">random =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">size =</span> <span class="kw">n</span>(), <span class="dt">replace =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb934-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt_cat =</span> <span class="kw">ifelse</span>(pt <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, pt, random)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb934-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt1    =</span> <span class="kw">ifelse</span>(pt_cat <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb934-9" data-line-number="9">         <span class="dt">pt2    =</span> <span class="kw">ifelse</span>(pt_cat <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb934-10" data-line-number="10">         <span class="dt">pt3    =</span> <span class="kw">ifelse</span>(pt_cat <span class="op">==</span><span class="st"> </span><span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb934-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(id, pt, random, pt_cat<span class="op">:</span>pt3, data)</a>
<a class="sourceLine" id="cb934-12" data-line-number="12"></a>
<a class="sourceLine" id="cb934-13" data-line-number="13">sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb934-14" data-line-number="14"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##      id    pt random pt_cat   pt1   pt2   pt3 data            
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;          
## 1     1     0      2      0     0     0     0 &lt;tibble [3 × 9]&gt;
## 2     2     1      2      2     0     1     0 &lt;tibble [6 × 9]&gt;
## 3     3     0      1      0     0     0     0 &lt;tibble [6 × 9]&gt;
## 4     5     1      1      1     1     0     0 &lt;tibble [6 × 9]&gt;
## 5     6     0      1      0     0     0     0 &lt;tibble [5 × 9]&gt;
## 6     7     1      2      2     0     1     0 &lt;tibble [3 × 9]&gt;</code></pre>
<p>Here are the number of cases for each of the four levels of our pseudovariable <code>pt_cat</code>.</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb936-1" data-line-number="1">sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb936-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(pt_cat)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   pt_cat     n
##    &lt;dbl&gt; &lt;int&gt;
## 1      0    72
## 2      1    41
## 3      2    30
## 4      3    37</code></pre>
<p>Our breakdown isn’t exactly the same as the one in the text (p. 391), but we’re in the ballpark. Before we’re ready to fit our next model, we’ll need to <code>unnest()</code> the data, which will transform <code>sex_pp</code> back into the familiar long format.</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb938-1" data-line-number="1">sex_pp &lt;-</a>
<a class="sourceLine" id="cb938-2" data-line-number="2"><span class="st">  </span>sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb938-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>(data)</a></code></pre></div>
<p>Fit the model with the dummies <code>pt1</code>, <code>pt2</code>, and <code>pt3</code>.</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb939-1" data-line-number="1">fit11<span class="fl">.11</span> &lt;-</a>
<a class="sourceLine" id="cb939-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb939-3" data-line-number="3">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb939-4" data-line-number="4">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12 <span class="op">+</span><span class="st"> </span>pt1 <span class="op">+</span><span class="st"> </span>pt2 <span class="op">+</span><span class="st"> </span>pt3,</a>
<a class="sourceLine" id="cb939-5" data-line-number="5">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb939-6" data-line-number="6">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb939-7" data-line-number="7">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb939-8" data-line-number="8">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.11&quot;</span>)</a></code></pre></div>
<p>Here is the model summary.</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb940-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.11</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt1 + pt2 + pt3 
##    Data: sex_pp (Number of observations: 822) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## d7     -3.03      0.32    -3.67    -2.44 1.00     3268     3011
## d8     -3.75      0.41    -4.61    -3.02 1.00     3833     2963
## d9     -2.29      0.27    -2.84    -1.78 1.00     3248     3154
## d10    -1.81      0.26    -2.32    -1.31 1.00     3480     2880
## d11    -1.64      0.27    -2.18    -1.13 1.00     3545     2633
## d12    -1.15      0.27    -1.69    -0.64 1.00     4116     3278
## pt1     0.65      0.27     0.12     1.17 1.00     2828     2876
## pt2     0.70      0.29     0.14     1.28 1.00     2873     2861
## pt3     1.22      0.28     0.68     1.75 1.00     2533     3055
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We can use the <code>tidy()</code> function and a few lines of wrangling code to make a version of the table in the middle of page 391.</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb942-1" data-line-number="1"><span class="kw">tidy</span>(fit11<span class="fl">.11</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb942-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(term, <span class="st">&quot;b_pt&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb942-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predictor    =</span> <span class="kw">str_remove</span>(term, <span class="st">&quot;b_&quot;</span>),</a>
<a class="sourceLine" id="cb942-4" data-line-number="4">         <span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(estimate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb942-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(predictor, estimate, <span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb942-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   predictor estimate odds ratio
## 1       pt1    0.650      1.916
## 2       pt2    0.703      2.020
## 3       pt3    1.222      3.394</code></pre>
<p>Because our data did not include the original values for <code>pt1</code> through <code>pt3</code>, the results in our table will not match those in the text. We did get pretty close, though, eh? Hopefully this gives a sense of the workflow.</p>
</div>
</div>
<div id="displaying-fitted-hazard-and-survivor-functions" class="section level2">
<h2><span class="header-section-number">11.5</span> Displaying fitted hazard and survivor functions</h2>
<p>This will be an extension of what we’ve already been doing.</p>
<div id="a-strategy-for-a-single-categorical-substantive-predictor." class="section level3">
<h3><span class="header-section-number">11.5.1</span> A strategy for a single categorical substantive predictor.</h3>
<p>We can make our version of Table 11.5 like so. To reduce clutter, we will use abbreviated column names.</p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb944-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">time  =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>,</a>
<a class="sourceLine" id="cb944-2" data-line-number="2">       <span class="dt">alpha =</span> <span class="kw">fixef</span>(fit11<span class="fl">.8</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb944-3" data-line-number="3">       <span class="dt">beta  =</span> <span class="kw">fixef</span>(fit11<span class="fl">.8</span>)[<span class="dv">7</span>, <span class="dv">1</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb944-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lh0 =</span> alpha,</a>
<a class="sourceLine" id="cb944-5" data-line-number="5">         <span class="dt">lh1 =</span> alpha <span class="op">+</span><span class="st"> </span>beta) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb944-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">h0 =</span> <span class="kw">inv_logit_scaled</span>(lh0),</a>
<a class="sourceLine" id="cb944-7" data-line-number="7">         <span class="dt">h1 =</span> <span class="kw">inv_logit_scaled</span>(lh1)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb944-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">s0 =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>h0),</a>
<a class="sourceLine" id="cb944-9" data-line-number="9">         <span class="dt">s1 =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>h1)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb944-10" data-line-number="10"><span class="st">  </span><span class="co"># this just simplifies the output</span></a>
<a class="sourceLine" id="cb944-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##    time alpha  beta   lh0    lh1     h0     h1    s0    s1
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     7 -3.00 0.857 -3.00 -2.15  0.0473 0.105  0.953 0.895
## 2     8 -3.73 0.857 -3.73 -2.87  0.0235 0.0537 0.930 0.847
## 3     9 -2.28 0.857 -2.28 -1.42  0.0927 0.194  0.844 0.683
## 4    10 -1.82 0.857 -1.82 -0.965 0.139  0.276  0.727 0.494
## 5    11 -1.65 0.857 -1.65 -0.794 0.161  0.311  0.610 0.340
## 6    12 -1.18 0.857 -1.18 -0.320 0.236  0.421  0.466 0.197</code></pre>
<p>For the <code>alpha</code> and <code>beta</code> columns, we just subset the values from <code>fixef()</code>. The two logit-hazard columns, <code>lh0</code> and <code>lh1</code>, were simple algebraic transformations of <code>alpha</code> and <code>beta</code>, respectively. To make the two hazard columns, <code>h0</code> and <code>h1</code>, we applied the <code>inv_logit_scaled()</code> function to <code>lh0</code> and <code>lh1</code>, respectively. To make the two survival columns, <code>s0</code> and <code>s1</code>, we applied the <code>cumprod()</code> function to one minus the two hazard columns. Note how all this is based off of the posterior means. There’s enough going on with Table 11.5 that it makes sense to ignore uncertainty But when we’re ready to go beyond table glancing and actually make a plot, we will go beyond posterior means and reintroduce the uncertainty in the model.</p>
<p>Two of these plots are quite similar to two of the subplots from Figure 11.4, back in Section 11.2.1. But recall that though those plots were based on <code>fit11.6</code>, which was based on the aggregated data, the plots we are about to make will be based on <code>fit11.8</code>, the analogous model based on the disaggregated person-period data. Regardless of whether the logistic regression model is based on aggregated data, the post-processing approach will involve the <code>fitted()</code> function. However, the specifics of how we use <code>fitted()</code> will differ. For the disaggregated data used to fit <code>fit11.8</code>, here is how we might define the <code>newdata</code>, pump it through the model via <code>fitted()</code>, and wrangle.</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb946-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb946-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">pt     =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb946-3" data-line-number="3">           <span class="dt">period =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb946-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d7  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb946-5" data-line-number="5">         <span class="dt">d8  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb946-6" data-line-number="6">         <span class="dt">d9  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb946-7" data-line-number="7">         <span class="dt">d10 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb946-8" data-line-number="8">         <span class="dt">d11 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb946-9" data-line-number="9">         <span class="dt">d12 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb946-10" data-line-number="10"></a>
<a class="sourceLine" id="cb946-11" data-line-number="11">f &lt;-</a>
<a class="sourceLine" id="cb946-12" data-line-number="12"><span class="st">  </span><span class="kw">fitted</span>(fit11<span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb946-13" data-line-number="13">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb946-14" data-line-number="14">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb946-15" data-line-number="15"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb946-16" data-line-number="16"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb946-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt =</span> <span class="kw">str_c</span>(<span class="st">&quot;pt = &quot;</span>, pt))</a>
<a class="sourceLine" id="cb946-18" data-line-number="18"></a>
<a class="sourceLine" id="cb946-19" data-line-number="19">f</a></code></pre></div>
<pre><code>##      Estimate Est.Error      Q2.5      Q97.5     pt period d7 d8 d9 d10 d11 d12
## 1  -3.0028021 0.3071880 -3.619907 -2.4291047 pt = 0      7  1  0  0   0   0   0
## 2  -3.7263185 0.4234433 -4.604059 -2.9568205 pt = 0      8  0  1  0   0   0   0
## 3  -2.2806265 0.2698021 -2.821580 -1.7680331 pt = 0      9  0  0  1   0   0   0
## 4  -1.8225996 0.2538985 -2.331516 -1.3371696 pt = 0     10  0  0  0   1   0   0
## 5  -1.6512001 0.2679558 -2.184255 -1.1296853 pt = 0     11  0  0  0   0   1   0
## 6  -1.1776296 0.2692006 -1.706033 -0.6423001 pt = 0     12  0  0  0   0   0   1
## 7  -2.1455645 0.2786570 -2.733983 -1.6350970 pt = 1      7  1  0  0   0   0   0
## 8  -2.8690809 0.4020457 -3.736634 -2.1654320 pt = 1      8  0  1  0   0   0   0
## 9  -1.4233889 0.2360307 -1.907156 -0.9714672 pt = 1      9  0  0  1   0   0   0
## 10 -0.9653619 0.2252534 -1.401366 -0.5339492 pt = 1     10  0  0  0   1   0   0
## 11 -0.7939625 0.2459580 -1.273436 -0.3284309 pt = 1     11  0  0  0   0   1   0
## 12 -0.3203919 0.2590562 -0.820268  0.1769375 pt = 1     12  0  0  0   0   0   1</code></pre>
<p>Here we make and save the upper two panels of Figure 11.6.</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb948-1" data-line-number="1"><span class="co"># logit(hazard)</span></a>
<a class="sourceLine" id="cb948-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb948-3" data-line-number="3"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb948-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb948-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb948-6" data-line-number="6">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb948-8" data-line-number="8">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;fitted logit(hazard)&quot;</span>,</a>
<a class="sourceLine" id="cb948-11" data-line-number="11">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb948-14" data-line-number="14">        <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb948-15" data-line-number="15">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.825</span>))</a>
<a class="sourceLine" id="cb948-16" data-line-number="16"></a>
<a class="sourceLine" id="cb948-17" data-line-number="17"><span class="co"># hazard</span></a>
<a class="sourceLine" id="cb948-18" data-line-number="18">p2 &lt;-</a>
<a class="sourceLine" id="cb948-19" data-line-number="19"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb948-20" data-line-number="20"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>), <span class="dt">.funs =</span> inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb948-21" data-line-number="21"><span class="st">  </span></a>
<a class="sourceLine" id="cb948-22" data-line-number="22"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb948-23" data-line-number="23">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb948-25" data-line-number="25">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-27" data-line-number="27"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;fitted hazard&quot;</span>,</a>
<a class="sourceLine" id="cb948-28" data-line-number="28">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-29" data-line-number="29"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-30" data-line-number="30"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p>Before we’re ready to make the last panel, we’ll redo our <code>fitted()</code> work, this time including predicted values for grade 6.</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb949-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb949-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">pt     =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb949-3" data-line-number="3">           <span class="dt">period =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb949-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d6  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb949-5" data-line-number="5">         <span class="dt">d7  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb949-6" data-line-number="6">         <span class="dt">d8  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb949-7" data-line-number="7">         <span class="dt">d9  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb949-8" data-line-number="8">         <span class="dt">d10 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb949-9" data-line-number="9">         <span class="dt">d11 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb949-10" data-line-number="10">         <span class="dt">d12 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb949-11" data-line-number="11"></a>
<a class="sourceLine" id="cb949-12" data-line-number="12">f &lt;-</a>
<a class="sourceLine" id="cb949-13" data-line-number="13"><span class="st">  </span><span class="kw">fitted</span>(fit11<span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb949-14" data-line-number="14">         <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb949-15" data-line-number="15"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb949-16" data-line-number="16"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb949-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt =</span> <span class="kw">str_c</span>(<span class="st">&quot;pt = &quot;</span>, pt))</a>
<a class="sourceLine" id="cb949-18" data-line-number="18"></a>
<a class="sourceLine" id="cb949-19" data-line-number="19">f</a></code></pre></div>
<pre><code>##      Estimate  Est.Error       Q2.5      Q97.5     pt period d6 d7 d8 d9 d10 d11 d12
## 1  0.50000000 0.00000000 0.50000000 0.50000000 pt = 0      6  1  0  0  0   0   0   0
## 2  0.04922053 0.01429394 0.02608644 0.08098007 pt = 0      7  0  1  0  0   0   0   0
## 3  0.02546482 0.01024019 0.00991189 0.04941514 pt = 0      8  0  0  1  0   0   0   0
## 4  0.09521774 0.02309532 0.05616910 0.14578711 pt = 0      9  0  0  0  1   0   0   0
## 5  0.14187768 0.03057243 0.08854622 0.20797593 pt = 0     10  0  0  0  0   1   0   0
## 6  0.16419164 0.03653532 0.10117336 0.24421919 pt = 0     11  0  0  0  0   0   1   0
## 7  0.23885945 0.04842691 0.15367900 0.34472680 pt = 0     12  0  0  0  0   0   0   1
## 8  0.70020505 0.04432433 0.60746019 0.78088420 pt = 1      6  1  0  0  0   0   0   0
## 9  0.10757917 0.02618851 0.06099762 0.16313332 pt = 1      7  0  1  0  0   0   0   0
## 10 0.05728498 0.02082329 0.02327936 0.10289794 pt = 1      8  0  0  1  0   0   0   0
## 11 0.19676002 0.03676760 0.12930068 0.27458817 pt = 1      9  0  0  0  1   0   0   0
## 12 0.27804687 0.04460934 0.19759942 0.36959628 pt = 1     10  0  0  0  0   1   0   0
## 13 0.31371815 0.05225591 0.21866970 0.41862246 pt = 1     11  0  0  0  0   0   1   0
## 14 0.42185661 0.06217035 0.30570677 0.54411934 pt = 1     12  0  0  0  0   0   0   1</code></pre>
<p>The values for grade 6 (i.e., those for when <code>d6 == 1</code>) are nonsensical. The main reason we included <code>d6</code> in the fitted results and in the <code>nd</code> data is so we’d have the slots in our <code>f</code> object. In the code block below, we’ll fill those slots with the appropriate values (<code>0</code>) and then convert the hazard summaries to the survival (i.e., cumulative probability) metric.</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb951-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb951-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb951-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Estimate =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">0</span>, Estimate),</a>
<a class="sourceLine" id="cb951-4" data-line-number="4">         <span class="dt">Q2.5     =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">0</span>, Q2<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb951-5" data-line-number="5">         <span class="dt">Q97.5    =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">0</span>, Q97<span class="fl">.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb951-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(pt) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb951-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">s       =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Estimate),</a>
<a class="sourceLine" id="cb951-8" data-line-number="8">         <span class="dt">s_lower =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Q2<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb951-9" data-line-number="9">         <span class="dt">s_upper =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Q97<span class="fl">.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb951-10" data-line-number="10"><span class="st">  </span><span class="kw">select</span>(pt<span class="op">:</span>d12, s<span class="op">:</span>s_upper)</a>
<a class="sourceLine" id="cb951-11" data-line-number="11"></a>
<a class="sourceLine" id="cb951-12" data-line-number="12">f <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 14
## Columns: 12
## Groups: pt [2]
## $ pt      &lt;chr&gt; &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 1&quot;, &quot;pt = 1&quot;, &quot;…
## $ period  &lt;int&gt; 6, 7, 8, 9, 10, 11, 12, 6, 7, 8, 9, 10, 11, 12
## $ d6      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0
## $ d7      &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0
## $ d8      &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0
## $ d9      &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0
## $ d10     &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0
## $ d11     &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0
## $ d12     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1
## $ s       &lt;dbl&gt; 1.0000000, 0.9507795, 0.9265680, 0.8383423, 0.7194003, 0.6012808, 0.4576592, 1.0000000, 0.8…
## $ s_lower &lt;dbl&gt; 1.0000000, 0.9739136, 0.9642602, 0.9100986, 0.8295128, 0.7455882, 0.6310070, 1.0000000, 0.9…
## $ s_upper &lt;dbl&gt; 1.00000000, 0.91901993, 0.87360643, 0.74624588, 0.59104470, 0.44670024, 0.29271070, 1.00000…</code></pre>
<p>Make and save the final panel.</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb953-1" data-line-number="1"><span class="co"># save the interpolated median lifetime values</span></a>
<a class="sourceLine" id="cb953-2" data-line-number="2">imls &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">make_iml</span>(lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> &quot;pt = 0&quot;</span>)), <span class="kw">make_iml</span>(lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> &quot;pt = 1&quot;</span>)))</a>
<a class="sourceLine" id="cb953-3" data-line-number="3"></a>
<a class="sourceLine" id="cb953-4" data-line-number="4"><span class="co"># hazard</span></a>
<a class="sourceLine" id="cb953-5" data-line-number="5">p3 &lt;-</a>
<a class="sourceLine" id="cb953-6" data-line-number="6"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb953-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb953-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pt,</a>
<a class="sourceLine" id="cb953-9" data-line-number="9">             <span class="dt">fill =</span> pt, <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">x =</span> imls[<span class="dv">1</span>], <span class="dt">xend =</span> imls[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb953-12" data-line-number="12">               <span class="dt">y =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">yend =</span> <span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb953-13" data-line-number="13">               <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">x =</span> imls[<span class="dv">2</span>], <span class="dt">xend =</span> imls[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb953-15" data-line-number="15">               <span class="dt">y =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">yend =</span> <span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb953-16" data-line-number="16">               <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> s_lower, <span class="dt">ymax =</span> s_upper),</a>
<a class="sourceLine" id="cb953-18" data-line-number="18">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-21" data-line-number="21"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;fitted survival probability&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-22" data-line-number="22"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb953-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p>Combine the subplots to finish off our version of Figure 11.6.</p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb954-1" data-line-number="1">(p1 <span class="op">/</span><span class="st"> </span>p2 <span class="op">/</span><span class="st"> </span>p3) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb954-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb954-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb954-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb954-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-68-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Here is the breakdown of what percentage of boys will still be virgins at grades 9 and 12, based on <code>pt</code> status, as indicated by <code>fit11.8</code>.</p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb955-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb955-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(period <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">12</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb955-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, <span class="op">~</span><span class="st"> </span>(. <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb955-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">percent virgins</span><span class="st">`</span> =<span class="st"> </span><span class="kw">str_c</span>(s, <span class="st">&quot; [&quot;</span>, s_lower, <span class="st">&quot;, &quot;</span>, s_upper, <span class="st">&quot;]&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb955-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(period, pt, <span class="st">`</span><span class="dt">percent virgins</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb955-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(period)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
## # Groups:   pt [2]
##   period pt     `percent virgins`
##    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;            
## 1      9 pt = 0 84 [91, 75]      
## 2      9 pt = 1 68 [80, 54]      
## 3     12 pt = 0 46 [63, 29]      
## 4     12 pt = 1 19 [35, 9]</code></pre>
</div>
<div id="extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous." class="section level3">
<h3><span class="header-section-number">11.5.2</span> Extending this strategy to multiple predictors (some of which are continuous).</h3>
<blockquote>
<p>It is easy to display fitted hazard and survivor functions for model involving multiple predictor by extending these ideas in a straightforward manner. Instead of plotting one fitted function for <em>each</em> predictor value, select several <em>prototypical</em> predictor values (using strategies presented in section 4.5.3 and plot fitted functions for combinations of these values. (p. 394, <em>emphasis</em> in the original)</p>
</blockquote>
<p>We’ll be focusing on <code>fit11.10</code>, which includes both <code>pt</code> and <code>sas</code> as substantive predictors. <code>pt</code> only takes two values, 0 and 1. For pas, we’ll use the conventional -1, 0, and 1. Here’s the <code>fitted()</code>-related code.</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb957-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb957-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">pt  =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb957-3" data-line-number="3">           <span class="dt">pas =</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb957-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(pt, pas),</a>
<a class="sourceLine" id="cb957-5" data-line-number="5">         <span class="dt">period =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb957-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d6  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb957-7" data-line-number="7">         <span class="dt">d7  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb957-8" data-line-number="8">         <span class="dt">d8  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb957-9" data-line-number="9">         <span class="dt">d9  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb957-10" data-line-number="10">         <span class="dt">d10 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb957-11" data-line-number="11">         <span class="dt">d11 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb957-12" data-line-number="12">         <span class="dt">d12 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb957-13" data-line-number="13"></a>
<a class="sourceLine" id="cb957-14" data-line-number="14">f &lt;-</a>
<a class="sourceLine" id="cb957-15" data-line-number="15"><span class="st">  </span><span class="kw">fitted</span>(fit11<span class="fl">.10</span>,</a>
<a class="sourceLine" id="cb957-16" data-line-number="16">         <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb957-17" data-line-number="17"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb957-18" data-line-number="18"><span class="st">  </span><span class="kw">bind_cols</span>(nd)</a>
<a class="sourceLine" id="cb957-19" data-line-number="19"></a>
<a class="sourceLine" id="cb957-20" data-line-number="20"><span class="kw">head</span>(f)</a></code></pre></div>
<pre><code>##     Estimate   Est.Error        Q2.5      Q97.5 pt pas period d6 d7 d8 d9 d10 d11 d12
## 1 0.42485980 0.029968357 0.368464812 0.48403874  0  -1      6  1  0  0  0   0   0   0
## 2 0.04085235 0.012738516 0.019953216 0.07001607  0  -1      7  0  1  0  0   0   0   0
## 3 0.02134740 0.008830432 0.008064858 0.04289951  0  -1      8  0  0  1  0   0   0   0
## 4 0.08160469 0.021075901 0.046419952 0.12849732  0  -1      9  0  0  0  1   0   0   0
## 5 0.12223623 0.028381639 0.073395909 0.18434817  0  -1     10  0  0  0  0   1   0   0
## 6 0.14284857 0.033352645 0.086573345 0.21547653  0  -1     11  0  0  0  0   0   1   0</code></pre>
<p>Make the two subplots.</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb959-1" data-line-number="1"><span class="co"># logit(hazard)</span></a>
<a class="sourceLine" id="cb959-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb959-3" data-line-number="3"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt  =</span> <span class="kw">str_c</span>(<span class="st">&quot;pt = &quot;</span>, pt),</a>
<a class="sourceLine" id="cb959-5" data-line-number="5">         <span class="dt">pas =</span> <span class="kw">str_c</span>(<span class="st">&quot;pas = &quot;</span>, pas)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pas =</span> <span class="kw">factor</span>(pas,</a>
<a class="sourceLine" id="cb959-7" data-line-number="7">                      <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;pas = &quot;</span>, <span class="dv">1</span><span class="op">:-</span><span class="dv">1</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(period <span class="op">&gt;</span><span class="st"> </span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb959-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pas,</a>
<a class="sourceLine" id="cb959-11" data-line-number="11">             <span class="dt">fill =</span> pas, <span class="dt">color =</span> pas)) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb959-13" data-line-number="13">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;fitted logit(hazard)&quot;</span>,</a>
<a class="sourceLine" id="cb959-16" data-line-number="16">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-17" data-line-number="17"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-18" data-line-number="18"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>pt)</a>
<a class="sourceLine" id="cb959-19" data-line-number="19"></a>
<a class="sourceLine" id="cb959-20" data-line-number="20"><span class="co"># hazard</span></a>
<a class="sourceLine" id="cb959-21" data-line-number="21">p2 &lt;-</a>
<a class="sourceLine" id="cb959-22" data-line-number="22"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-23" data-line-number="23"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Estimate =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">0</span>, Estimate),</a>
<a class="sourceLine" id="cb959-24" data-line-number="24">         <span class="dt">Q2.5     =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">0</span>, Q2<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb959-25" data-line-number="25">         <span class="dt">Q97.5    =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">0</span>, Q97<span class="fl">.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-26" data-line-number="26"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt  =</span> <span class="kw">str_c</span>(<span class="st">&quot;pt = &quot;</span>, pt),</a>
<a class="sourceLine" id="cb959-27" data-line-number="27">         <span class="dt">pas =</span> <span class="kw">str_c</span>(<span class="st">&quot;pas = &quot;</span>, pas)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-28" data-line-number="28"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pas =</span> <span class="kw">factor</span>(pas,</a>
<a class="sourceLine" id="cb959-29" data-line-number="29">                      <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;pas = &quot;</span>, <span class="dv">1</span><span class="op">:-</span><span class="dv">1</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-30" data-line-number="30"><span class="st">  </span><span class="kw">group_by</span>(pt, pas) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-31" data-line-number="31"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">s       =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Estimate),</a>
<a class="sourceLine" id="cb959-32" data-line-number="32">         <span class="dt">s_lower =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Q2<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb959-33" data-line-number="33">         <span class="dt">s_upper =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Q97<span class="fl">.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb959-34" data-line-number="34"><span class="st">  </span></a>
<a class="sourceLine" id="cb959-35" data-line-number="35"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> pas,</a>
<a class="sourceLine" id="cb959-36" data-line-number="36">             <span class="dt">fill =</span> pas, <span class="dt">color =</span> pas)) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-37" data-line-number="37"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-38" data-line-number="38"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> s_lower, <span class="dt">ymax =</span> s_upper),</a>
<a class="sourceLine" id="cb959-39" data-line-number="39">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-40" data-line-number="40"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-41" data-line-number="41"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-42" data-line-number="42"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;fitted survival probability&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-43" data-line-number="43"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-44" data-line-number="44"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb959-45" data-line-number="45"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>pt)</a></code></pre></div>
<p>Combine the subplots to make our version of Figure 11.7.</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb960-1" data-line-number="1">((p1 <span class="op">/</span><span class="st"> </span>p2) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb960-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;D&quot;</span>, <span class="dt">end =</span> <span class="fl">.8</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb960-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;D&quot;</span>, <span class="dt">end =</span> <span class="fl">.8</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb960-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb960-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())) <span class="op">+</span></a>
<a class="sourceLine" id="cb960-6" data-line-number="6"><span class="st">   </span><span class="kw">plot_layout</span>(<span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-72-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Here we departed from the text a bit by separating the subplots by <code>pt</code> status. They’re already cluttered enough as is.</p>
</div>
<div id="two-cautions-when-interpreting-fitted-hazard-and-survivor-functions." class="section level3">
<h3><span class="header-section-number">11.5.3</span> Two cautions when interpreting fitted hazard and survivor functions.</h3>
<p>Beware of inferring statistical interaction of a substantive predictor and time when examining plots if fitted hazard and survivor functions. The root of this difficulty is in our use of a link function.</p>
<blockquote>
<p>Because the model expresses the linear effect of the predictor on logit hazard, you cannot draw a conclusion about the stability of an effect using graphs plotted on a raw hazard scale. In fact, the logic works in the <em>opposite</em> direction. If the size of the gap between fitted hazard functions is constant over time, [the] effect of the predictor must <em>vary</em> over time! (pp. 396-397, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Also, please don’t confuse plots of fitted values with descriptive sample-based plots. Hopefully our inclusion of 95% intervals helps prevent this.</p>
</div>
</div>
<div id="comparing-models-using-deviance-statistics-and-information-criteria" class="section level2">
<h2><span class="header-section-number">11.6</span> Comparing models using <del>deviance statistics and</del> information criteria</h2>
<blockquote>
<p>We now introduce two important questions that we usually address before interpreting parameters and displaying results: Which of the alternative models fits better: Might a predictor’s observed effect be the result of nothing more than sampling variation? (p. 397)</p>
</blockquote>
<p>Much of the material in this section will be a refresher from the material we covered in Section 4.6.</p>
<div id="the-deviance-statistic.-1" class="section level3">
<h3><span class="header-section-number">11.6.1</span> The deviance statistic.</h3>
<p>The log-likelihood, LL, is</p>
<blockquote>
<p>a summary statistic routinely output (in some form) by any program that provides ML estimates. As discussed in section 4.6, its relative magnitude across a series of models fit to the same set of data can be informative (although its absolute magnitude is not). The larger the LL statistic, the better the fit. (pp. 397–398)</p>
</blockquote>
<p>Note that <em>in some form</em> part. Frequentist software typically returns the LL for a given model as a sigle value. As we learned way back in Section 4.6, we can use the <code>log_lik()</code> function to get the LL information from our <strong>brms</strong> fits. However, form the <strong>brms</strong> <a href="https://cran.r-project.org/web/packages/brms/brms.pdf">reference manual</a> we discover <code>log_lik()</code> returns an “S x N matrix containing the pointwise log-likelihood samples, where S is the number of samples and N is the number of observations in the data” (p. 112). Using <code>fit11.7</code> as a test case, here’s what that looks like.</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb961-1" data-line-number="1"><span class="kw">log_lik</span>(fit11<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb961-2" data-line-number="2"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:4000, 1:822] -0.1018 -0.0737 -0.0921 -0.0772 -0.066 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL</code></pre>
<p>To compute the LL for each HMC iteration, you sum across the rows. Deviance is that sum multiplied by -2. Here’s that in a tibble.</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb963-1" data-line-number="1">ll &lt;-</a>
<a class="sourceLine" id="cb963-2" data-line-number="2"><span class="st">  </span>fit11<span class="fl">.7</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb963-3" data-line-number="3"><span class="st">  </span><span class="kw">log_lik</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb963-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>(<span class="dt">.name_repair =</span> <span class="op">~</span><span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">822</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb963-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">rowSums</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb963-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">deviance =</span> <span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb963-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(ll, deviance, <span class="kw">everything</span>())</a></code></pre></div>
<pre><code>## New names:
## * `` -&gt; c1
## * `` -&gt; c2
## * `` -&gt; c3
## * `` -&gt; c4
## * `` -&gt; c5
## * ...</code></pre>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb965-1" data-line-number="1">ll</a></code></pre></div>
<pre><code>## # A tibble: 4,000 x 824
##       ll deviance      c1      c2    c3      c4      c5     c6     c7     c8     c9     c10     c11    c12
##    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 -330.     660. -0.102  -0.0219 -2.10 -0.102  -0.0219 -0.130 -0.191 -0.313 -0.311 -0.102  -0.0219 -0.130
##  2 -330.     660. -0.0737 -0.0740 -1.76 -0.0737 -0.0740 -0.190 -0.304 -0.192 -0.471 -0.0737 -0.0740 -0.190
##  3 -331.     663. -0.0921 -0.0257 -1.97 -0.0921 -0.0257 -0.150 -0.153 -0.389 -0.396 -0.0921 -0.0257 -0.150
##  4 -331.     662. -0.0772 -0.0677 -1.78 -0.0772 -0.0677 -0.184 -0.344 -0.173 -0.391 -0.0772 -0.0677 -0.184
##  5 -329.     658. -0.0660 -0.0456 -1.88 -0.0660 -0.0456 -0.166 -0.189 -0.193 -0.328 -0.0660 -0.0456 -0.166
##  6 -327.     654. -0.0826 -0.0529 -1.76 -0.0826 -0.0529 -0.190 -0.200 -0.285 -0.399 -0.0826 -0.0529 -0.190
##  7 -329.     659. -0.115  -0.0390 -1.78 -0.115  -0.0390 -0.186 -0.169 -0.209 -0.381 -0.115  -0.0390 -0.186
##  8 -330.     660. -0.0946 -0.0243 -2.20 -0.0946 -0.0243 -0.117 -0.303 -0.324 -0.321 -0.0946 -0.0243 -0.117
##  9 -330.     660. -0.0930 -0.0378 -2.12 -0.0930 -0.0378 -0.128 -0.242 -0.294 -0.231 -0.0930 -0.0378 -0.128
## 10 -328.     656. -0.105  -0.0540 -1.88 -0.105  -0.0540 -0.166 -0.258 -0.263 -0.544 -0.105  -0.0540 -0.166
## # … with 3,990 more rows, and 810 more variables: c13 &lt;dbl&gt;, c14 &lt;dbl&gt;, c15 &lt;dbl&gt;, c16 &lt;dbl&gt;, c17 &lt;dbl&gt;,
## #   c18 &lt;dbl&gt;, c19 &lt;dbl&gt;, c20 &lt;dbl&gt;, c21 &lt;dbl&gt;, c22 &lt;dbl&gt;, c23 &lt;dbl&gt;, c24 &lt;dbl&gt;, c25 &lt;dbl&gt;, c26 &lt;dbl&gt;,
## #   c27 &lt;dbl&gt;, c28 &lt;dbl&gt;, c29 &lt;dbl&gt;, c30 &lt;dbl&gt;, c31 &lt;dbl&gt;, c32 &lt;dbl&gt;, c33 &lt;dbl&gt;, c34 &lt;dbl&gt;, c35 &lt;dbl&gt;,
## #   c36 &lt;dbl&gt;, c37 &lt;dbl&gt;, c38 &lt;dbl&gt;, c39 &lt;dbl&gt;, c40 &lt;dbl&gt;, c41 &lt;dbl&gt;, c42 &lt;dbl&gt;, c43 &lt;dbl&gt;, c44 &lt;dbl&gt;,
## #   c45 &lt;dbl&gt;, c46 &lt;dbl&gt;, c47 &lt;dbl&gt;, c48 &lt;dbl&gt;, c49 &lt;dbl&gt;, c50 &lt;dbl&gt;, c51 &lt;dbl&gt;, c52 &lt;dbl&gt;, c53 &lt;dbl&gt;,
## #   c54 &lt;dbl&gt;, c55 &lt;dbl&gt;, c56 &lt;dbl&gt;, c57 &lt;dbl&gt;, c58 &lt;dbl&gt;, c59 &lt;dbl&gt;, c60 &lt;dbl&gt;, c61 &lt;dbl&gt;, c62 &lt;dbl&gt;,
## #   c63 &lt;dbl&gt;, c64 &lt;dbl&gt;, c65 &lt;dbl&gt;, c66 &lt;dbl&gt;, c67 &lt;dbl&gt;, c68 &lt;dbl&gt;, c69 &lt;dbl&gt;, c70 &lt;dbl&gt;, c71 &lt;dbl&gt;,
## #   c72 &lt;dbl&gt;, c73 &lt;dbl&gt;, c74 &lt;dbl&gt;, c75 &lt;dbl&gt;, c76 &lt;dbl&gt;, c77 &lt;dbl&gt;, c78 &lt;dbl&gt;, c79 &lt;dbl&gt;, c80 &lt;dbl&gt;,
## #   c81 &lt;dbl&gt;, c82 &lt;dbl&gt;, c83 &lt;dbl&gt;, c84 &lt;dbl&gt;, c85 &lt;dbl&gt;, c86 &lt;dbl&gt;, c87 &lt;dbl&gt;, c88 &lt;dbl&gt;, c89 &lt;dbl&gt;,
## #   c90 &lt;dbl&gt;, c91 &lt;dbl&gt;, c92 &lt;dbl&gt;, c93 &lt;dbl&gt;, c94 &lt;dbl&gt;, c95 &lt;dbl&gt;, c96 &lt;dbl&gt;, c97 &lt;dbl&gt;, c98 &lt;dbl&gt;,
## #   c99 &lt;dbl&gt;, c100 &lt;dbl&gt;, c101 &lt;dbl&gt;, c102 &lt;dbl&gt;, c103 &lt;dbl&gt;, c104 &lt;dbl&gt;, c105 &lt;dbl&gt;, c106 &lt;dbl&gt;,
## #   c107 &lt;dbl&gt;, c108 &lt;dbl&gt;, c109 &lt;dbl&gt;, c110 &lt;dbl&gt;, c111 &lt;dbl&gt;, c112 &lt;dbl&gt;, …</code></pre>
<p>Since we have distributions for the LL and deviance, we may as well visualize them in a plot.</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb967-1" data-line-number="1">ll <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb967-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(ll<span class="op">:</span>deviance) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb967-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;deviance&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb967-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb967-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb967-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb967-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb967-8" data-line-number="8"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb967-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb967-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-75-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here’s how to compute the LL and deviance distributions for each of our four models, <code>fit11.7</code> through <code>fit11.10</code>, in bulk.</p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb968-1" data-line-number="1">ll &lt;-</a>
<a class="sourceLine" id="cb968-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">model =</span> <span class="kw">str_c</span>(<span class="st">&quot;model &quot;</span>, letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]),</a>
<a class="sourceLine" id="cb968-3" data-line-number="3">         <span class="dt">name  =</span> <span class="kw">str_c</span>(<span class="st">&quot;fit11.&quot;</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb968-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit =</span> <span class="kw">map</span>(name, get)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb968-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">map</span>(fit, <span class="op">~</span><span class="kw">log_lik</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(<span class="dt">ll =</span> <span class="kw">rowSums</span>(.)))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb968-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>fit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb968-7" data-line-number="7"><span class="st">  </span><span class="kw">unnest</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb968-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">deviance =</span> <span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>ll)</a>
<a class="sourceLine" id="cb968-9" data-line-number="9"></a>
<a class="sourceLine" id="cb968-10" data-line-number="10">ll <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb968-11" data-line-number="11"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 16,000
## Columns: 4
## $ model    &lt;chr&gt; &quot;model a&quot;, &quot;model a&quot;, &quot;model a&quot;, &quot;model a&quot;, &quot;model a&quot;, &quot;model a&quot;, &quot;model a&quot;, &quot;model a&quot;, &quot;m…
## $ name     &lt;chr&gt; &quot;fit11.7&quot;, &quot;fit11.7&quot;, &quot;fit11.7&quot;, &quot;fit11.7&quot;, &quot;fit11.7&quot;, &quot;fit11.7&quot;, &quot;fit11.7&quot;, &quot;fit11.7&quot;, &quot;f…
## $ ll       &lt;dbl&gt; -329.7999, -330.1944, -331.3949, -331.1617, -329.0912, -326.9543, -329.3654, -329.8801, -3…
## $ deviance &lt;dbl&gt; 659.5997, 660.3887, 662.7898, 662.3234, 658.1824, 653.9087, 658.7309, 659.7603, 659.8338, …</code></pre>
<p>Now plot the LL and deviance distributions for each.</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb970-1" data-line-number="1">ll <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb970-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(ll<span class="op">:</span>deviance,</a>
<a class="sourceLine" id="cb970-3" data-line-number="3">               <span class="dt">names_to =</span> <span class="st">&quot;statistic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb970-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">statistic =</span> <span class="kw">factor</span>(statistic, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;deviance&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb970-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb970-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb970-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb970-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb970-9" data-line-number="9">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb970-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb970-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>statistic, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-77-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="deviance-based-hypothesis-tests-for-individual-predictors." class="section level3">
<h3><span class="header-section-number">11.6.2</span> Deviance-based hypothesis tests for individual predictors.</h3>
<p>Singer and Willett wrote: “Comparing deviance statistics for pairs of nested models that differ only by a single substantive predictor permits evaluation of the ‘statistical significance’ of that predictor” (p. 399). I’m just not going to appeal to null-hypothesis significance testing in this project and, as an extension, I am not going to appeal to tests using the <span class="math inline">\(\chi^2\)</span> distribution. But sure, you could take our deviance distributions and compare them with difference distributions. Singer and Willett made four deviance comparisons in this section. Here’s what that might look like using our deviance distributions.</p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb971-1" data-line-number="1">ll <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb971-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(model, deviance) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb971-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>, <span class="dt">times =</span> <span class="dv">4</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb971-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> model,</a>
<a class="sourceLine" id="cb971-5" data-line-number="5">              <span class="dt">values_from =</span> deviance) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb971-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">a - b</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">model a</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">model b</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb971-7" data-line-number="7">         <span class="st">`</span><span class="dt">a - c</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">model a</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">model c</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb971-8" data-line-number="8">         <span class="st">`</span><span class="dt">c - d</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">model c</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">model d</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb971-9" data-line-number="9">         <span class="st">`</span><span class="dt">b - d</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">model b</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">model d</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb971-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot;-&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb971-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb971-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb971-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb971-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;deviance difference distribution&quot;</span>,</a>
<a class="sourceLine" id="cb971-15" data-line-number="15">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb971-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-78-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>But really, like no one does this with Bayesian models. If you think you have a good theoretical reason to use this approach, do not cite this project as a justification. I do not endorse it.</p>
</div>
<div id="deviance-based-hypothesis-tests-for-groups-of-predictors." class="section level3">
<h3><span class="header-section-number">11.6.3</span> Deviance-based hypothesis tests for groups of predictors.</h3>
<p>We won’t be doing this.</p>
</div>
<div id="comparing-nonnested-models-using-waic-and-loo." class="section level3">
<h3><span class="header-section-number">11.6.4</span> Comparing nonnested models using [WAIC and LOO].</h3>
<p>Now we return to our preferred methods for model comparison. Use the <code>add_criterion()</code> function to compute the WAIC and LOO and add their output to the model fits.</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb972-1" data-line-number="1">fit11<span class="fl">.7</span>  &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit11<span class="fl">.7</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb972-2" data-line-number="2">fit11<span class="fl">.8</span>  &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit11<span class="fl">.8</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb972-3" data-line-number="3">fit11<span class="fl">.9</span>  &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit11<span class="fl">.9</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb972-4" data-line-number="4">fit11<span class="fl">.10</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit11<span class="fl">.10</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a></code></pre></div>
<p>First compare Models B and C (i.e., <code>fit11.8</code> and <code>fit11.9</code>, respectively).</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb973-1" data-line-number="1"><span class="kw">loo_compare</span>(fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit11.8    0.0       0.0  -324.4     17.6         7.1    0.6    648.8   35.2  
## fit11.9   -1.4       4.6  -325.8     17.6         7.2    0.6    651.6   35.1</code></pre>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb975-1" data-line-number="1"><span class="kw">loo_compare</span>(fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit11.8    0.0       0.0  -324.4      17.6          7.0    0.6     648.8   35.2 
## fit11.9   -1.4       4.6  -325.8      17.6          7.2    0.6     651.6   35.1</code></pre>
<p>In a head-to-head comparison, Model B is a little better than Model C. However, the standard error for their difference score is about three times as large as the difference itself. This is not a difference I would write home about. Now compare Models A through D.</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb977-1" data-line-number="1"><span class="kw">loo_compare</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit11.10    0.0       0.0  -322.6     17.6         8.0    0.6    645.1   35.1  
## fit11.8    -1.8       2.6  -324.4     17.6         7.1    0.6    648.8   35.2  
## fit11.9    -3.3       2.8  -325.8     17.6         7.2    0.6    651.6   35.1  
## fit11.7    -9.6       4.8  -332.1     17.6         6.2    0.5    664.3   35.3</code></pre>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb979-1" data-line-number="1"><span class="kw">loo_compare</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit11.10    0.0       0.0  -322.5      17.5          8.0    0.6     645.1   35.1 
## fit11.8    -1.9       2.6  -324.4      17.6          7.0    0.6     648.8   35.2 
## fit11.9    -3.3       2.8  -325.8      17.6          7.2    0.6     651.6   35.1 
## fit11.7    -9.6       4.8  -332.1      17.6          6.1    0.5     664.2   35.3</code></pre>
<p>Model D (i.e., <code>fit11.10</code>, the full model) has the best (i.e., lowest) WAIC and LOO estimates. However, the standard errors for its difference scores with the other models is on the large side, particularly for Models B and C. So sure, adding either <code>pt</code> or <code>sas</code> to the model helps a bit and adding them both helps a little more, but neither predictor is a huge winner when you take that model complexity penalty into account.</p>
<p>As discussed earlier, we can also compare the models using weights. Here we’ll use the WAIC, LOO, and stacking weights to compare all four models.</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb981-1" data-line-number="1"><span class="kw">model_weights</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  fit11.7  fit11.8  fit11.9 fit11.10 
##    0.000    0.132    0.032    0.836</code></pre>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb983-1" data-line-number="1"><span class="kw">model_weights</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  fit11.7  fit11.8  fit11.9 fit11.10 
##    0.000    0.131    0.032    0.836</code></pre>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb985-1" data-line-number="1"><span class="kw">model_weights</span>(fit11<span class="fl">.7</span>, fit11<span class="fl">.8</span>, fit11<span class="fl">.9</span>, fit11<span class="fl">.10</span>, <span class="dt">weights =</span> <span class="st">&quot;stacking&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  fit11.7  fit11.8  fit11.9 fit11.10 
##    0.000    0.313    0.209    0.478</code></pre>
<p>Model D has the best showing across the three weighting schemes.</p>
</div>
</div>
<div id="statistical-inference-using-uncertainty-in-the-bayesian-posterior" class="section level2">
<h2><span class="header-section-number">11.7</span> Statistical inference using [uncertainty in the Bayesian posterior]</h2>
<p>I generally take a model-based approach to Bayesian statistics and I prefer to scrutinize marginal posteriors, consider effect sizes, and use graphical depictions of my models (e.g., posterior predictive checks) over hypothesis testing. Further extending that approach, here, puts us at further odds with the content in the test. In addition, the authors spent some time discussing the asymptotic properties of ML standard errors. Our Bayesian approach is not based on asymptotic theory and we just don’t need to concern ourselves with whether our marginal posteriors are Gaussian. They often are, which is nice. But we summarize our posteriors with percentile-based 95% intervals, we are not presuming they are symmetric or Gaussian.</p>
<div id="the-wald-chi-square-statistic." class="section level3">
<h3><span class="header-section-number">11.7.1</span> The <del>Wald chi-square statistic</del>.</h3>
<p>This will not be our approach. On page 404, Singer and Willett wrote: “The logistic regression analysis routines in all major statistical packages routinely output asymptotic standard errors.” This comment presumes we’re focusing on frequentist packages. Our rough analogue to frequentist standard errors is our Bayesian posterior standard deviations. The authors focused on the two substantive predictors from Model D (i.e., <code>fit11.10</code>). Here’s another look at the <strong>brms</strong> summary.</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb987-1" data-line-number="1"><span class="kw">print</span>(fit11<span class="fl">.10</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + d7 + d8 + d9 + d10 + d11 + d12 + pt + pas 
##    Data: sex_pp (Number of observations: 822) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## d7     -2.90      0.31    -3.56    -2.30 1.00     2644     2387
## d8     -3.61      0.43    -4.51    -2.83 1.00     3094     2761
## d9     -2.15      0.28    -2.72    -1.63 1.00     2306     2394
## d10    -1.69      0.26    -2.24    -1.18 1.00     2136     2649
## d11    -1.51      0.27    -2.05    -0.99 1.00     2542     2813
## d12    -1.00      0.28    -1.57    -0.46 1.00     2621     2732
## pt      0.64      0.24     0.19     1.11 1.00     1433     1850
## pas     0.30      0.12     0.06     0.54 1.00     3444     3031
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Recall that the second column for our ‘Population-Level Effects’, ‘Est.Error’, contains the standard deviation for each dimension of the posteriors listed (i.e., for each parameter ranging from <code>d7</code> to <code>pas</code>). This is similar, but distinct from, the frequentist standard error. Instead of focusing on <span class="math inline">\(p\)</span>-values connected to standard errors, why not look at the marginal posteriors directly?</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb989-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit11<span class="fl">.10</span>)</a>
<a class="sourceLine" id="cb989-2" data-line-number="2"></a>
<a class="sourceLine" id="cb989-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb989-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_longer</span>(b_pt<span class="op">:</span>b_pas) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb989-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb989-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> name, <span class="dt">fill =</span> <span class="kw">stat</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-7" data-line-number="7"><span class="st">  </span><span class="kw">stat_slabh</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb989-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue3&quot;</span>, <span class="st">&quot;red3&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;marginal posterior&quot;</span>,</a>
<a class="sourceLine" id="cb989-10" data-line-number="10">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-83-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If we’d like to keep with the NHST perspective, zero is not a particularly credible value for either parameter. But neither are negative values in generals. In terms of uncertainty, look how much wider the posterior for <code>pt</code> is when compared with <code>pas</code>. And don’t forget that these are on the log-odds scale.</p>
<p>Looking at those densities might lead one to ask, <em>Exactly what proportion of the posterior draws for each is zero or below</em>? You can compute that like this.</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb990-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb990-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(b_pt<span class="op">:</span>b_pas) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb990-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb990-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="st">`</span><span class="dt">percent zero or below</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(value <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   name  `percent zero or below`
##   &lt;chr&gt;                   &lt;dbl&gt;
## 1 b_pas                   0.875
## 2 b_pt                    0.175</code></pre>
<p>Less that 1% of the draws were zero or below for each.</p>
</div>
<div id="asymmetric-credible-intervals-for-parameters-and-odds-ratios." class="section level3">
<h3><span class="header-section-number">11.7.2</span> [Asymmetric credible intervals] for parameters and odds ratios.</h3>
<p>Whether we use percentile-based credible intervals, as we typically do, or use highest posterior density intervals, neither depends on asymptotic theory nor do they depend on the posterior standard deviation. That is, our Bayesian intervals do not presume the marginal posteriors are Gaussian. Let’s look back at the summary output for <code>fit11.10</code>, this time using the <code>fixef()</code> function.</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb992-1" data-line-number="1"><span class="kw">fixef</span>(fit11<span class="fl">.10</span>)</a></code></pre></div>
<pre><code>##       Estimate Est.Error        Q2.5      Q97.5
## d7  -2.9005763 0.3137696 -3.55588990 -2.3026882
## d8  -3.6075406 0.4307296 -4.50648338 -2.8348577
## d9  -2.1499960 0.2776953 -2.72499466 -1.6279351
## d10 -1.6942049 0.2629563 -2.23593367 -1.1815440
## d11 -1.5143291 0.2680454 -2.05015155 -0.9908001
## d12 -1.0035752 0.2808239 -1.56552178 -0.4577481
## pt   0.6393620 0.2377291  0.18562424  1.1109096
## pas  0.3039824 0.1230509  0.06386673  0.5388084</code></pre>
<p>We find the lower- and upper-limits for our percentile-based Bayesian credible intervals in the last two columns. If you’d like HDIs instead, use the convenience functions from <strong>tidybayes</strong>.</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb994-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb994-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(b_pt<span class="op">:</span>b_pas) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb994-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb994-4" data-line-number="4"><span class="st">  </span><span class="kw">mean_hdi</span>(value)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   name  value .lower .upper .width .point .interval
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 b_pas 0.304 0.0628  0.536   0.95 mean   hdi      
## 2 b_pt  0.639 0.186   1.11    0.95 mean   hdi</code></pre>
<p>We can exponentiate our measures of central tendency (e.g., posterior means) and posterior intervals to transform them out of the log-odds metric an into the odds-ratio metric. Here are the results working directly with <code>fixef()</code>.</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb996-1" data-line-number="1"><span class="kw">fixef</span>(fit11<span class="fl">.10</span>)[<span class="kw">c</span>(<span class="st">&quot;pt&quot;</span>, <span class="st">&quot;pas&quot;</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>()</a></code></pre></div>
<pre><code>##     Estimate    Q2.5    Q97.5
## pt  1.895271 1.20397 3.037120
## pas 1.355245 1.06595 1.713963</code></pre>
<p>Keep in mind that fixating on just the 95% intervals is a little NHST-centric. Since we have entire posterior distributions to summarize, we might consider other intervals. Here we use another graphical approach by using <code>tidybayes_statintervalh()</code> to mark off the 10, 30, 50, 70, and 90% intervals for both substantive predictors. Both are in the odds-ratio metric.</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb998-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb998-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(b_pt<span class="op">:</span>b_pas) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb998-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb998-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb998-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span>, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_intervalh</span>(<span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">.width =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.1</span>, <span class="dt">to =</span> <span class="fl">.9</span>, <span class="dt">by =</span> <span class="fl">.2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_color_grey</span>(<span class="st">&quot;CI level:&quot;</span>, <span class="dt">start =</span> <span class="fl">.8</span>, <span class="dt">end =</span> <span class="fl">.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-9" data-line-number="9"><span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>,</a>
<a class="sourceLine" id="cb998-12" data-line-number="12">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-88-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The frequentist 95% confidence intervals are asymmetric when expressed in the odds-ratio metric and so are our various Bayesian intervals. However, the asymmetry in our Bayesian intervals is less noteworthy because there was no explicit assumption of symmetry when they were in the log-odds metric.</p>
</div>
</div>
<div id="reference-10" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://www.oxfordscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968">Singer, J. D., &amp; Willett, J. B. (2003). <em>Applied longitudinal data analysis: Modeling change and event occurrence</em>. New York, NY, US: Oxford University Press.</a></p>
</div>
<div id="session-info-10" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb999-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_2.0.3 broom_0.5.5     brms_2.12.0     Rcpp_1.0.4.6    patchwork_1.0.0 survival_3.1-12
##  [7] forcats_0.5.0   stringr_1.4.0   dplyr_0.8.5     purrr_0.3.3     readr_1.3.1     tidyr_1.0.2    
## [13] tibble_3.0.0    ggplot2_3.3.0   tidyverse_1.3.0
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1     ellipsis_0.3.0       ggridges_0.5.2       rsconnect_0.8.16     markdown_1.1        
##   [6] base64enc_0.1-3      fs_1.4.1             rstudioapi_0.11      farver_2.0.3         rstan_2.19.3        
##  [11] svUnit_0.7-12        DT_0.13              fansi_0.4.1          mvtnorm_1.1-0        lubridate_1.7.8     
##  [16] xml2_1.3.1           bridgesampling_1.0-0 splines_3.6.3        knitr_1.28           shinythemes_1.1.2   
##  [21] bayesplot_1.7.1      jsonlite_1.6.1       dbplyr_1.4.2         shiny_1.4.0.2        compiler_3.6.3      
##  [26] httr_1.4.1           backports_1.1.6      assertthat_0.2.1     Matrix_1.2-18        fastmap_1.0.1       
##  [31] cli_2.0.2            later_1.0.0          prettyunits_1.1.1    htmltools_0.4.0      tools_3.6.3         
##  [36] igraph_1.2.5         coda_0.19-3          gtable_0.3.0         glue_1.4.0           reshape2_1.4.4      
##  [41] cellranger_1.1.0     vctrs_0.2.4          nlme_3.1-144         crosstalk_1.1.0.1    xfun_0.13           
##  [46] ps_1.3.2             rvest_0.3.5          mime_0.9             miniUI_0.1.1.1       lifecycle_0.2.0     
##  [51] gtools_3.8.2         zoo_1.8-7            scales_1.1.0         colourpicker_1.0     hms_0.5.3           
##  [56] promises_1.1.0       Brobdingnag_1.2-6    parallel_3.6.3       inline_0.3.15        shinystan_2.5.0     
##  [61] yaml_2.2.1           gridExtra_2.3        StanHeaders_2.21.0-1 loo_2.2.0            stringi_1.4.6       
##  [66] highr_0.8            dygraphs_1.1.1.6     pkgbuild_1.0.6       rlang_0.4.5          pkgconfig_2.0.3     
##  [71] matrixStats_0.56.0   HDInterval_0.2.0     evaluate_0.14        lattice_0.20-38      rstantools_2.0.0    
##  [76] htmlwidgets_1.5.1    labeling_0.3         tidyselect_1.0.0     processx_3.4.2       plyr_1.8.6          
##  [81] magrittr_1.5         bookdown_0.18        R6_2.4.1             generics_0.0.2       DBI_1.1.0           
##  [86] pillar_1.4.3         haven_2.2.0          withr_2.1.2          xts_0.12-0           abind_1.4-5         
##  [91] modelr_0.1.6         crayon_1.3.4         arrayhelpers_1.1-0   utf8_1.1.4           rmarkdown_2.1       
##  [96] grid_3.6.3           readxl_1.3.1         callr_3.4.3          threejs_0.3.3        reprex_0.3.0        
## [101] digest_0.6.25        xtable_1.8-4         httpuv_1.5.2         stats4_3.6.3         munsell_0.5.0       
## [106] viridisLite_0.3.0    shinyjs_1.1</code></pre>
</div>
<div id="footnote" class="section level2 unnumbered">
<h2>Footnote</h2>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p><strong>R</strong> already has a built-in function to convert probabilities to the log-odds scale. Somewhat confusingly, it’s called <code>qlogis()</code>. You can learn more by executing <code>?qlogis</code> or by browsing through <a href="https://ro-che.info/articles/2018-08-11-logit-logistic-r">this great blog post</a> by Roman Cheplyaka. It’s generally a good idea to stick to the functions in base <strong>R</strong> rather than make your own, like we did earlier in this chapter (see t<a href="https://twitter.com/tjmahr/status/1248228130256453632">his twitter thread</a>). Since the name of <code>qlogis()</code> isn’t the easiest to remember, you can always execute something like <code>log_odds &lt;- qlogis</code> or <code>logit &lt;- qlogis</code> at the beginning of your scripts and then use that as a thin wrapper for <code>qlogis()</code>.<a href="fitting-basic-discrete-time-hazard-models.html#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="describing-discrete-time-event-occurrence-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="extending-the-discrete-time-hazard-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
