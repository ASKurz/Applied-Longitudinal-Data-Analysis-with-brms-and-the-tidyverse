<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Extending the Discrete-Time Hazard Model | Applied Longitudinal Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Extending the Discrete-Time Hazard Model | Applied Longitudinal Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="github-repo" content="ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Extending the Discrete-Time Hazard Model | Applied Longitudinal Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fitting-basic-discrete-time-hazard-models.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html"><i class="fa fa-check"></i><b>1</b> A Framework for Investigating Change over Time</a><ul>
<li class="chapter" data-level="1.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#when-might-you-study-change-over-time"><i class="fa fa-check"></i><b>1.1</b> When might you study change over time?</a></li>
<li class="chapter" data-level="1.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#distinguishing-between-two-types-of-questions-about-change"><i class="fa fa-check"></i><b>1.2</b> Distinguishing between two types of questions about change</a></li>
<li class="chapter" data-level="1.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#three-important-features-of-a-study-of-change"><i class="fa fa-check"></i><b>1.3</b> Three important features of a study of change</a><ul>
<li class="chapter" data-level="1.3.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#multiple-waves-of-data."><i class="fa fa-check"></i><b>1.3.1</b> Multiple waves of data.</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-sensible-metric-for-time."><i class="fa fa-check"></i><b>1.3.2</b> A sensible metric for time.</a></li>
<li class="chapter" data-level="1.3.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-continuous-outcome-that-changes-systematically-over-time."><i class="fa fa-check"></i><b>1.3.3</b> A continuous outcome that changes systematically over time.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html"><i class="fa fa-check"></i><b>2</b> Exploring Longitudinal Data on Change</a><ul>
<li class="chapter" data-level="2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#creating-a-longitudinal-data-set"><i class="fa fa-check"></i><b>2.1</b> Creating a longitudinal data set</a><ul>
<li class="chapter" data-level="2.1.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-level-data-set."><i class="fa fa-check"></i><b>2.1.1</b> The person-level data set.</a></li>
<li class="chapter" data-level="2.1.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-period-data-set."><i class="fa fa-check"></i><b>2.1.2</b> The person-period data set.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#descriptive-analysis-of-individual-change-over-time"><i class="fa fa-check"></i><b>2.2</b> Descriptive analysis of individual change over time</a><ul>
<li class="chapter" data-level="2.2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#empirical-growth-plots."><i class="fa fa-check"></i><b>2.2.1</b> Empirical growth plots.</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-a-trajectory-to-summarize-each-persons-empirical-growth-record."><i class="fa fa-check"></i><b>2.2.2</b> Using a trajectory to summarize each person’s empirical growth record.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-differences-in-change-across-people"><i class="fa fa-check"></i><b>2.3</b> Exploring differences in change across people</a><ul>
<li class="chapter" data-level="2.3.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#examining-the-entire-set-of-smooth-trajectories."><i class="fa fa-check"></i><b>2.3.1</b> Examining the entire set of smooth trajectories.</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-the-results-of-model-fitting-to-frame-questions-about-change."><i class="fa fa-check"></i><b>2.3.2</b> Using the results of model fitting to frame questions about change.</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-the-relationship-between-change-and-time-invariant-predictors."><i class="fa fa-check"></i><b>2.3.3</b> Exploring the relationship between change and time-invariant predictors.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#improving-the-precision-and-reliability-of-ols-single-level-bayesian-estimated-rates-of-change-lessons-for-research-design"><i class="fa fa-check"></i><b>2.4</b> Improving the precision and reliability of <del>OLS</del> single-level-Bayesian-estimated rates of change: Lessons for research design</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>3</b> Introducing the Multilevel Model for Change</a><ul>
<li class="chapter" data-level="3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#what-is-the-purpose-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>3.1</b> What is the purpose of the multilevel model for change?</a></li>
<li class="chapter" data-level="3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-1-submodel-for-individual-change"><i class="fa fa-check"></i><b>3.2</b> The level-1 submodel for individual change</a><ul>
<li class="chapter" data-level="3.2.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-structural-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.1</b> The structural part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-stochastic-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.2</b> The stochastic part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#relating-the-level-1-submodel-to-the-ols-exploratory-methods-of-chapter-2."><i class="fa fa-check"></i><b>3.2.3</b> Relating the level-1 submodel to the OLS exploratory methods of chapter 2.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-2-submodel-for-systematic-interindividual-differences-in-change"><i class="fa fa-check"></i><b>3.3</b> The level-2 submodel for systematic interindividual differences in change</a><ul>
<li class="chapter" data-level="3.3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#structural-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.1</b> Structural components of the level-2 submodel.</a></li>
<li class="chapter" data-level="3.3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#stochastic-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.2</b> Stochastic components of the level-2 submodel.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#fitting-the-multilevel-model-for-change-to-data"><i class="fa fa-check"></i><b>3.4</b> Fitting the multilevel model for change to data</a><ul>
<li class="chapter" data-level="3.4.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-advantages-of-maximum-likelihood-bayesian-estimation."><i class="fa fa-check"></i><b>3.4.1</b> The advantages of <del>maximum likelihood</del> Bayesian estimation.</a></li>
<li class="chapter" data-level="3.4.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#using-maximum-likelihood-modern-bayesian-methods-to-fit-a-multilevel-model."><i class="fa fa-check"></i><b>3.4.2</b> Using <del>maximum likelihood</del> modern Bayesian methods to fit a multilevel model.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-fixed-effects"><i class="fa fa-check"></i><b>3.5</b> Examining estimated fixed effects</a><ul>
<li class="chapter" data-level="3.5.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-estimated-fixed-effects."><i class="fa fa-check"></i><b>3.5.1</b> Interpreting estimated fixed effects.</a></li>
<li class="chapter" data-level="3.5.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-fixed-effects."><i class="fa fa-check"></i><b>3.5.2</b> Single parameter tests for the fixed effects.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-variance-components"><i class="fa fa-check"></i><b>3.6</b> Examining estimated variance components</a><ul>
<li class="chapter" data-level="3.6.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-the-estimated-variance-components."><i class="fa fa-check"></i><b>3.6.1</b> Interpreting the estimated variance components.</a></li>
<li class="chapter" data-level="3.6.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-variance-components."><i class="fa fa-check"></i><b>3.6.2</b> Single parameter tests for the variance components.</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#bonus-how-did-you-simulate-that-data"><i class="fa fa-check"></i><b>3.7</b> Bonus: How did you simulate that data?</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>4</b> Doing Data Analysis with the Multilevel Model for Change</a><ul>
<li class="chapter" data-level="4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#example-changes-in-adolescent-alcohol-use"><i class="fa fa-check"></i><b>4.1</b> Example: Changes in adolescent alcohol use</a></li>
<li class="chapter" data-level="4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-composite-specification-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>4.2</b> The composite specification of the multilevel model for change</a><ul>
<li class="chapter" data-level="4.2.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-structural-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.1</b> The structural component of the composite model.</a></li>
<li class="chapter" data-level="4.2.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-stochastic-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.2</b> The stochastic component of the composite model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#methods-of-estimation-revisited"><i class="fa fa-check"></i><b>4.3</b> Methods of estimation, revisited</a></li>
<li class="chapter" data-level="4.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#first-steps-fitting-two-unconditional-multilevel-models-for-change"><i class="fa fa-check"></i><b>4.4</b> First steps: Fitting two unconditional multilevel models for change</a><ul>
<li class="chapter" data-level="4.4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-means-model."><i class="fa fa-check"></i><b>4.4.1</b> The unconditional means model.</a></li>
<li class="chapter" data-level="4.4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-growth-model."><i class="fa fa-check"></i><b>4.4.2</b> The unconditional growth model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#quantifying-the-proportion-of-outcome-variation-explained."><i class="fa fa-check"></i><b>4.4.3</b> Quantifying the proportion of outcome variation “explained.”</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#practical-data-analytic-strategies-for-model-building"><i class="fa fa-check"></i><b>4.5</b> Practical data analytic strategies for model building</a><ul>
<li class="chapter" data-level="4.5.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#a-taxonomy-of-statistical-models."><i class="fa fa-check"></i><b>4.5.1</b> A taxonomy of statistical models.</a></li>
<li class="chapter" data-level="4.5.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#interpreting-fitted-models."><i class="fa fa-check"></i><b>4.5.2</b> Interpreting fitted models.</a></li>
<li class="chapter" data-level="4.5.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#displaying-prototypical-change-trajectories."><i class="fa fa-check"></i><b>4.5.3</b> Displaying prototypical change trajectories.</a></li>
<li class="chapter" data-level="4.5.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#recentering-predictors-to-improve-interpretation."><i class="fa fa-check"></i><b>4.5.4</b> Recentering predictors to improve interpretation.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#comparing-models-using-deviance-statistics"><i class="fa fa-check"></i><b>4.6</b> Comparing models using deviance statistics</a><ul>
<li class="chapter" data-level="4.6.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-deviance-statistic."><i class="fa fa-check"></i><b>4.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="4.6.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#when-and-how-can-you-compare-deviance-statistics"><i class="fa fa-check"></i><b>4.6.2</b> When and how can you compare deviance statistics?</a></li>
<li class="chapter" data-level="4.6.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#implementing-deviance-based-hypothesis-tests."><i class="fa fa-check"></i><b>4.6.3</b> Implementing deviance-based hypothesis tests.</a></li>
<li class="chapter" data-level="4.6.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#aic-and-bic-waic-and-loo-statistics-comparing-nonnested-models-using-information-criteria-and-cross-validation."><i class="fa fa-check"></i><b>4.6.4</b> <del>AIC and BIC</del> WAIC and LOO statistics: Comparing nonnested models using information criteria [and cross validation].</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#using-wald-statistics-to-test-composite-hypotheses-about-fixed-effects"><i class="fa fa-check"></i><b>4.7</b> Using Wald statistics to test composite hypotheses about fixed effects</a></li>
<li class="chapter" data-level="4.8" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#evaluating-the-tenability-of-a-models-assumptions"><i class="fa fa-check"></i><b>4.8</b> Evaluating the tenability of a model’s assumptions</a><ul>
<li class="chapter" data-level="4.8.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-functional-form."><i class="fa fa-check"></i><b>4.8.1</b> Checking functional form.</a></li>
<li class="chapter" data-level="4.8.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-normality."><i class="fa fa-check"></i><b>4.8.2</b> Checking normality.</a></li>
<li class="chapter" data-level="4.8.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-homoscedasticity."><i class="fa fa-check"></i><b>4.8.3</b> Checking homoscedasticity.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#model-based-empirical-bayes-estimates-of-the-individual-growth-parameters"><i class="fa fa-check"></i><b>4.9</b> Model-based (Empirical Bayes) estimates of the individual growth parameters</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html"><i class="fa fa-check"></i><b>5</b> Treating Time More Flexibly</a><ul>
<li class="chapter" data-level="5.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#variably-spaced-measurement-occasions"><i class="fa fa-check"></i><b>5.1</b> Variably spaced measurement occasions</a><ul>
<li class="chapter" data-level="5.1.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#the-structure-of-variably-spaced-data-sets."><i class="fa fa-check"></i><b>5.1.1</b> The structure of variably spaced data sets.</a></li>
<li class="chapter" data-level="5.1.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#postulating-and-fitting-multilevel-models-with-variably-spaced-waves-of-data."><i class="fa fa-check"></i><b>5.1.2</b> Postulating and fitting multilevel models with variably spaced waves of data.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#varying-numbers-of-measurement-occasions"><i class="fa fa-check"></i><b>5.2</b> Varying numbers of measurement occasions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#analyzing-data-sets-in-which-the-number-of-waves-per-person-varies."><i class="fa fa-check"></i><b>5.2.1</b> Analyzing data sets in which the number of waves per person varies.</a></li>
<li class="chapter" data-level="5.2.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#practical-problems-that-may-arise-when-analyzing-unbalanced-data-sets."><i class="fa fa-check"></i><b>5.2.2</b> Practical problems that may arise when analyzing unbalanced data sets.</a></li>
<li class="chapter" data-level="5.2.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#distinguishing-among-different-types-of-missingness."><i class="fa fa-check"></i><b>5.2.3</b> Distinguishing among different types of missingness.</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#time-varying-predictors"><i class="fa fa-check"></i><b>5.3</b> Time-varying predictors</a><ul>
<li class="chapter" data-level="5.3.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#including-the-main-effect-of-a-time-varying-predictor."><i class="fa fa-check"></i><b>5.3.1</b> Including the main effect of a time-varying predictor.</a></li>
<li class="chapter" data-level="5.3.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#allowing-the-effect-of-a-time-varying-predictor-to-vary-over-time."><i class="fa fa-check"></i><b>5.3.2</b> Allowing the effect of a time-varying predictor to vary over time.</a></li>
<li class="chapter" data-level="5.3.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-time-varying-predictors."><i class="fa fa-check"></i><b>5.3.3</b> Recentering time-varying predictors.</a></li>
<li class="chapter" data-level="5.3.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#an-important-caveat-the-problem-of-reciprocal-causation."><i class="fa fa-check"></i><b>5.3.4</b> An important caveat: The problem of reciprocal causation.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-the-effect-of-time"><i class="fa fa-check"></i><b>5.4</b> Recentering the effect of <em>TIME</em></a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html"><i class="fa fa-check"></i><b>6</b> Modeling Discontinuous and Nonlinear Change</a><ul>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html"><i class="fa fa-check"></i><b>7</b> Examining the Multilevel Model’s Error Covariance Structure</a><ul>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html"><i class="fa fa-check"></i><b>8</b> Modeling Change Using Covariance Structure Analysis</a><ul>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html"><i class="fa fa-check"></i><b>9</b> A Framework for Investigating Event Occurrence</a><ul>
<li class="chapter" data-level="9.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#should-you-conduct-a-survival-analysis-the-whether-and-when-test"><i class="fa fa-check"></i><b>9.1</b> Should you conduct a survival analysis? The “whether” and “when” test</a><ul>
<li class="chapter" data-level="9.1.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#time-to-relapse-among-recently-treated-alcoholics."><i class="fa fa-check"></i><b>9.1.1</b> Time to relapse among recently treated alcoholics.</a></li>
<li class="chapter" data-level="9.1.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#length-of-stay-in-teaching."><i class="fa fa-check"></i><b>9.1.2</b> Length of stay in teaching.</a></li>
<li class="chapter" data-level="9.1.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#age-at-first-suicide-ideation."><i class="fa fa-check"></i><b>9.1.3</b> Age at first suicide ideation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#framing-a-research-question-about-event-occurrence"><i class="fa fa-check"></i><b>9.2</b> Framing a research question about event occurrence</a><ul>
<li class="chapter" data-level="9.2.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#defining-event-occurrence."><i class="fa fa-check"></i><b>9.2.1</b> Defining event occurrence.</a></li>
<li class="chapter" data-level="9.2.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#identifying-the-beginning-of-time."><i class="fa fa-check"></i><b>9.2.2</b> Identifying the “beginning of time.”</a></li>
<li class="chapter" data-level="9.2.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#specifying-a-metric-for-time."><i class="fa fa-check"></i><b>9.2.3</b> Specifying a metric for time.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#censoring-how-complete-are-the-data-on-event-occurrence"><i class="fa fa-check"></i><b>9.3</b> Censoring: How complete are the data on event occurrence?</a><ul>
<li class="chapter" data-level="9.3.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-and-why-does-censoring-arise"><i class="fa fa-check"></i><b>9.3.1</b> How and why does censoring arise?</a></li>
<li class="chapter" data-level="9.3.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#different-types-of-censoring."><i class="fa fa-check"></i><b>9.3.2</b> Different types of censoring.</a></li>
<li class="chapter" data-level="9.3.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-does-censoring-affect-statistical-analysis"><i class="fa fa-check"></i><b>9.3.3</b> How does censoring affect statistical analysis?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html"><i class="fa fa-check"></i><b>10</b> Describing Discrete-Time Event Occurrence Data</a><ul>
<li class="chapter" data-level="10.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-life-table"><i class="fa fa-check"></i><b>10.1</b> The life table</a></li>
<li class="chapter" data-level="10.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data"><i class="fa fa-check"></i><b>10.2</b> A framework for characterizing the distribution of discrete-time event occurrence data</a><ul>
<li class="chapter" data-level="10.2.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-function."><i class="fa fa-check"></i><b>10.2.1</b> Survivor function.</a></li>
<li class="chapter" data-level="10.2.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#median-lifetime."><i class="fa fa-check"></i><b>10.2.2</b> Median lifetime.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes"><i class="fa fa-check"></i><b>10.3</b> Developing intuition about hazard functions, survivor functions, and median lifetimes</a><ul>
<li class="chapter" data-level="10.3.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#identifying-periods-of-high-and-low-risk-using-hazard-functions."><i class="fa fa-check"></i><b>10.3.1</b> Identifying periods of high and low risk using hazard functions.</a></li>
<li class="chapter" data-level="10.3.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard."><i class="fa fa-check"></i><b>10.3.2</b> Survivor functions as a context for evaluating the magnitude of hazard.</a></li>
<li class="chapter" data-level="10.3.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#strengths-and-limitations-of-estimated-median-lifetimes."><i class="fa fa-check"></i><b>10.3.3</b> Strengths and limitations of estimated median lifetimes.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#quantifying-the-effects-of-sampling-variation"><i class="fa fa-check"></i><b>10.4</b> Quantifying the effects of sampling variation</a><ul>
<li class="chapter" data-level="10.4.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-standard-error-of-the-estimated-hazard-probabilities."><i class="fa fa-check"></i><b>10.4.1</b> The standard error of the estimated hazard probabilities.</a></li>
<li class="chapter" data-level="10.4.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#standard-error-of-the-estimated-survival-probabilities."><i class="fa fa-check"></i><b>10.4.2</b> Standard error of the estimated survival probabilities.</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-simple-and-useful-strategy-for-constructing-the-life-table"><i class="fa fa-check"></i><b>10.5</b> A simple and useful strategy for constructing the life table</a><ul>
<li class="chapter" data-level="10.5.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-person-period-data-set.-1"><i class="fa fa-check"></i><b>10.5.1</b> The person-period data set.</a></li>
<li class="chapter" data-level="10.5.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#using-the-person-period-data-set-to-construct-the-life-table."><i class="fa fa-check"></i><b>10.5.2</b> Using the person-period data set to construct the life table.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#bonus-fit-the-discrete-time-hazard-models-with-brms"><i class="fa fa-check"></i><b>10.6</b> Bonus: Fit the discrete-time hazard models with brms</a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html"><i class="fa fa-check"></i><b>11</b> Fitting Basic Discrete-Time Hazard Models</a><ul>
<li class="chapter" data-level="11.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#toward-a-statistical-model-for-discrete-time-hazard"><i class="fa fa-check"></i><b>11.1</b> Toward a statistical model for discrete-time hazard</a><ul>
<li class="chapter" data-level="11.1.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#plots-of-within-group-hazard-functions-and-survivor-functions."><i class="fa fa-check"></i><b>11.1.1</b> Plots of within-group hazard functions and survivor functions.</a></li>
<li class="chapter" data-level="11.1.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-kind-of-statistical-model-do-these-graphs-suggest"><i class="fa fa-check"></i><b>11.1.2</b> What kind of statistical model do these graphs suggest?</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#formal-representation-of-the-population-discrete-time-hazard-model"><i class="fa fa-check"></i><b>11.2</b> formal representation of the population discrete-time hazard model</a><ul>
<li class="chapter" data-level="11.2.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-do-the-parameters-represent"><i class="fa fa-check"></i><b>11.2.1</b> What do the parameters represent?</a></li>
<li class="chapter" data-level="11.2.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#an-alternative-representation-of-the-model."><i class="fa fa-check"></i><b>11.2.2</b> An alternative representation of the model.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-a-discrete-time-hazard-model-to-data"><i class="fa fa-check"></i><b>11.3</b> Fitting a discrete-time hazard model to data</a><ul>
<li class="chapter" data-level="11.3.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#adding-predictors-to-the-person-period-data-set."><i class="fa fa-check"></i><b>11.3.1</b> Adding predictors to the person-period data set.</a></li>
<li class="chapter" data-level="11.3.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model."><i class="fa fa-check"></i><b>11.3.2</b> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model.</a></li>
<li class="chapter" data-level="11.3.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-the-discrete-time-hazard-model-to-data."><i class="fa fa-check"></i><b>11.3.3</b> Fitting the discrete-time hazard model to data.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#interpreting-parameter-estimates"><i class="fa fa-check"></i><b>11.4</b> Interpreting parameter estimates</a><ul>
<li class="chapter" data-level="11.4.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-time-indicators."><i class="fa fa-check"></i><b>11.4.1</b> The time indicators.</a></li>
<li class="chapter" data-level="11.4.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#dichotomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.2</b> Dichotomous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#continuous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.3</b> Continuous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#polytomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.4</b> Polytomous substantive predictors.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#displaying-fitted-hazard-and-survivor-functions"><i class="fa fa-check"></i><b>11.5</b> Displaying fitted hazard and survivor functions</a><ul>
<li class="chapter" data-level="11.5.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#a-strategy-for-a-single-categorical-substantive-predictor."><i class="fa fa-check"></i><b>11.5.1</b> A strategy for a single categorical substantive predictor.</a></li>
<li class="chapter" data-level="11.5.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous."><i class="fa fa-check"></i><b>11.5.2</b> Extending this strategy to multiple predictors (some of which are continuous).</a></li>
<li class="chapter" data-level="11.5.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#two-cautions-when-interpreting-fitted-hazard-and-survivor-functions."><i class="fa fa-check"></i><b>11.5.3</b> Two cautions when interpreting fitted hazard and survivor functions.</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-models-using-deviance-statistics-and-information-criteria"><i class="fa fa-check"></i><b>11.6</b> Comparing models using <del>deviance statistics and</del> information criteria</a><ul>
<li class="chapter" data-level="11.6.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-deviance-statistic.-1"><i class="fa fa-check"></i><b>11.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="11.6.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-individual-predictors."><i class="fa fa-check"></i><b>11.6.2</b> Deviance-based hypothesis tests for individual predictors.</a></li>
<li class="chapter" data-level="11.6.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-groups-of-predictors."><i class="fa fa-check"></i><b>11.6.3</b> Deviance-based hypothesis tests for groups of predictors.</a></li>
<li class="chapter" data-level="11.6.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-nonnested-models-using-waic-and-loo."><i class="fa fa-check"></i><b>11.6.4</b> Comparing nonnested models using [WAIC and LOO].</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#statistical-inference-using-uncertainty-in-the-bayesian-posterior"><i class="fa fa-check"></i><b>11.7</b> Statistical inference using [uncertainty in the Bayesian posterior]</a><ul>
<li class="chapter" data-level="11.7.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-wald-chi-square-statistic."><i class="fa fa-check"></i><b>11.7.1</b> The <del>Wald chi-square statistic</del>.</a></li>
<li class="chapter" data-level="11.7.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#asymmetric-credible-intervals-for-parameters-and-odds-ratios."><i class="fa fa-check"></i><b>11.7.2</b> [Asymmetric credible intervals] for parameters and odds ratios.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html"><i class="fa fa-check"></i><b>12</b> Extending the Discrete-Time Hazard Model</a><ul>
<li class="chapter" data-level="12.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#alternative-specification-for-the-main-effect-of-time"><i class="fa fa-check"></i><b>12.1</b> Alternative specification for the “main effect” of <em>TIME</em></a><ul>
<li class="chapter" data-level="12.1.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#an-ordered-series-of-polynomial-specifications-for-time."><i class="fa fa-check"></i><b>12.1.1</b> An ordered series of polynomial specifications for <em>TIME</em>.</a></li>
<li class="chapter" data-level="12.1.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#criteria-for-comparing-alternative-specification."><i class="fa fa-check"></i><b>12.1.2</b> Criteria for comparing alternative specification.</a></li>
<li class="chapter" data-level="12.1.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-parameters-from-linear-quadratic-and-cubic-specifications."><i class="fa fa-check"></i><b>12.1.3</b> Interpreting parameters from linear, quadratic, and cubic specifications.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model"><i class="fa fa-check"></i><b>12.2</b> Using the complementary log-log link to specify a discrete-time hazard model</a><ul>
<li class="chapter" data-level="12.2.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-clog-log-transformation-when-and-why-it-is-useful."><i class="fa fa-check"></i><b>12.2.1</b> The clog-log transformation: When and why it is useful.</a></li>
<li class="chapter" data-level="12.2.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#a-discrete-time-hazard-model-using-the-complementary-log-log-link."><i class="fa fa-check"></i><b>12.2.2</b> A discrete-time hazard model using the complementary log-log link.</a></li>
<li class="chapter" data-level="12.2.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#choosing-between-logit-and-clog-log-links-for-discrete-time-hazard-models."><i class="fa fa-check"></i><b>12.2.3</b> Choosing between logit and clog-log links for discrete-time hazard models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#time-varying-predictors-1"><i class="fa fa-check"></i><b>12.3</b> Time-varying predictors</a><ul>
<li class="chapter" data-level="12.3.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#assumptions-underlying-a-model-with-time-varying-predictors."><i class="fa fa-check"></i><b>12.3.1</b> Assumptions underlying a model with time-varying predictors.</a></li>
<li class="chapter" data-level="12.3.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-and-displaying-time-varying-predictors-effects."><i class="fa fa-check"></i><b>12.3.2</b> Interpreting and displaying time-varying predictors’ effects.</a></li>
<li class="chapter" data-level="12.3.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#two-caveats-the-problems-of-state-and-rate-dependence."><i class="fa fa-check"></i><b>12.3.3</b> Two caveats: The problems of state and rate dependence.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-linear-additivity-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.4</b> The linear additivity assumption: Uncovering violations and simple solutions</a><ul>
<li class="chapter" data-level="12.4.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interactions-between-substantive-predictors."><i class="fa fa-check"></i><b>12.4.1</b> Interactions between substantive predictors.</a></li>
<li class="chapter" data-level="12.4.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#nonlinear-effects."><i class="fa fa-check"></i><b>12.4.2</b> Nonlinear effects.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-proportionality-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.5</b> The proportionality assumption: Uncovering violations and simple solutions</a><ul>
<li class="chapter" data-level="12.5.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#discrete-time-hazard-models-that-do-not-invoke-a-proportionality-assumption."><i class="fa fa-check"></i><b>12.5.1</b> Discrete-time hazard models that do not invoke a proportionality assumption.</a></li>
<li class="chapter" data-level="12.5.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#investigating-the-proportionality-assumption-in-practice."><i class="fa fa-check"></i><b>12.5.2</b> Investigating the proportionality assumption in practice.</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-no-unobserved-heterogeneity-assumption-no-simple-solution"><i class="fa fa-check"></i><b>12.6</b> The no unobserved heterogeneity assumption: No simple solution</a></li>
<li class="chapter" data-level="12.7" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#residual-analysis"><i class="fa fa-check"></i><b>12.7</b> Residual analysis</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#footnote-1"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Applied Longitudinal Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="extending-the-discrete-time-hazard-model" class="section level1">
<h1><span class="header-section-number">12</span> Extending the Discrete-Time Hazard Model</h1>
<blockquote>
<p>Like all statistical models, the basic discrete-time hazard model invokes assumptions about the population that may, or may not, hold in practice. Because no model should be adopted without scrutiny, we devote this chapter to examining its assumptions, demonstrating how to evaluate their tenability and relax their constraints when appropriate. In doing so, we illustrate practical principles of data analysis and offer theoretical insights into the model’s behavior and interpretation. (p. 407)</p>
</blockquote>
<div id="alternative-specification-for-the-main-effect-of-time" class="section level2">
<h2><span class="header-section-number">12.1</span> Alternative specification for the “main effect” of <em>TIME</em></h2>
<blockquote>
<p>Use of a completely general specification for <em>TIME</em> [as explored in the last chapter] is an analytic decision, not an integral feature of the model. Nothing about the model or its estimation <em>requires</em> adoption of this, or any other, particular specification for <em>TIME</em> (p. 409, <em>emphasis</em> in the original)</p>
</blockquote>
<p>In the next page, Singer and Willett listed three circumstances under which we might consider alternatives to the completely general approach to time. They were</p>
<ul>
<li>in studies with many discrete time periods,</li>
<li>when hazard is expected to be near zero in some time periods, and</li>
<li>when some time periods have small risk sets.</li>
</ul>
<p>In the subsections to follow, we will explore each in turn.</p>
<div id="an-ordered-series-of-polynomial-specifications-for-time." class="section level3">
<h3><span class="header-section-number">12.1.1</span> An ordered series of polynomial specifications for <em>TIME</em>.</h3>
<p>Load the Gamse and Conger’s (1997) <code>tenure_pp.csv</code> data.</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1001-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1001-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1001-3" data-line-number="3">tenure_pp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1001-4" data-line-number="4"><span class="st">  </span><span class="kw">read_csv</span>(<span class="st">&quot;data/tenure_pp.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1001-5" data-line-number="5"><span class="st">  </span><span class="co"># convert the column names to lower case</span></a>
<a class="sourceLine" id="cb1001-6" data-line-number="6"><span class="st">  </span><span class="kw">rename_all</span>(tolower)</a>
<a class="sourceLine" id="cb1001-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1001-8" data-line-number="8"><span class="kw">glimpse</span>(tenure_pp)</a></code></pre></div>
<pre><code>## Rows: 1,474
## Columns: 12
## $ id     &lt;dbl&gt; 111, 111, 111, 111, 111, 211, 211, 211, 211, 211, 211, 311, 311, 311, 311, 311, 311, 311, 31…
## $ period &lt;dbl&gt; 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 7, 8, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1, 2, 3,…
## $ event  &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,…
## $ d1     &lt;dbl&gt; 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…
## $ d2     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0,…
## $ d3     &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1,…
## $ d4     &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ d5     &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,…
## $ d6     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ d7     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ d8     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,…
## $ d9     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,…</code></pre>
<p>Let’s confirm these data are composed of the records of <span class="math inline">\(n = 260\)</span> early-career academics.</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1003-1" data-line-number="1">tenure_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1003-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1003-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   260</code></pre>
<p>Here’s a way to count how many cases were censored.</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1005-1" data-line-number="1">tenure_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1005-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1005-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(period)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1005-4" data-line-number="4"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1005-5" data-line-number="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1005-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(event) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1005-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   event     n percent
##   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1     0    94    36.2
## 2     1   166    63.8</code></pre>
<p>Let’s fire up <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1007-1" data-line-number="1"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>As discussed in the prose and displayed in Tables 12.1 and 12.2, we will fit seven models, ranging from a constant (i.e., intercept only) model to a general (i.e., discrete factor) model. In the last chapter, we discussed how one can fit a general model with a series of <span class="math inline">\(J\)</span> dummies or equivalently with the time variable, <code>period</code> in these data, set as a factor. Here we’ll do both. In preparation, we’ll make a <code>period_f</code> version of <code>period</code>.</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1008-1" data-line-number="1">tenure_pp &lt;-</a>
<a class="sourceLine" id="cb1008-2" data-line-number="2"><span class="st">  </span>tenure_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1008-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period_f =</span> <span class="kw">factor</span>(period))</a></code></pre></div>
<p>Now fit the models.</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1009-1" data-line-number="1"><span class="co"># constant</span></a>
<a class="sourceLine" id="cb1009-2" data-line-number="2">fit12<span class="fl">.1</span> &lt;-</a>
<a class="sourceLine" id="cb1009-3" data-line-number="3"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-4" data-line-number="4">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-5" data-line-number="5">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1009-6" data-line-number="6">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1009-7" data-line-number="7">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1009-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.01&quot;</span>)</a>
<a class="sourceLine" id="cb1009-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1009-11" data-line-number="11"><span class="co"># linear</span></a>
<a class="sourceLine" id="cb1009-12" data-line-number="12">fit12<span class="fl">.2</span> &lt;-</a>
<a class="sourceLine" id="cb1009-13" data-line-number="13"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-14" data-line-number="14">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-15" data-line-number="15">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>period,</a>
<a class="sourceLine" id="cb1009-16" data-line-number="16">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1009-17" data-line-number="17">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1009-18" data-line-number="18">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-19" data-line-number="19">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.02&quot;</span>)</a>
<a class="sourceLine" id="cb1009-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1009-21" data-line-number="21"><span class="co"># quadratic</span></a>
<a class="sourceLine" id="cb1009-22" data-line-number="22">fit12<span class="fl">.3</span> &lt;-</a>
<a class="sourceLine" id="cb1009-23" data-line-number="23"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-24" data-line-number="24">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-25" data-line-number="25">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>period <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1009-26" data-line-number="26">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1009-27" data-line-number="27">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1009-28" data-line-number="28">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-29" data-line-number="29">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.03&quot;</span>)</a>
<a class="sourceLine" id="cb1009-30" data-line-number="30"></a>
<a class="sourceLine" id="cb1009-31" data-line-number="31"><span class="co"># cubic</span></a>
<a class="sourceLine" id="cb1009-32" data-line-number="32">fit12<span class="fl">.4</span> &lt;-</a>
<a class="sourceLine" id="cb1009-33" data-line-number="33"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-34" data-line-number="34">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-35" data-line-number="35">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>period <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1009-36" data-line-number="36">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1009-37" data-line-number="37">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1009-38" data-line-number="38">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-39" data-line-number="39">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.04&quot;</span>)</a>
<a class="sourceLine" id="cb1009-40" data-line-number="40"></a>
<a class="sourceLine" id="cb1009-41" data-line-number="41"><span class="co"># fourth order</span></a>
<a class="sourceLine" id="cb1009-42" data-line-number="42">fit12<span class="fl">.5</span> &lt;-</a>
<a class="sourceLine" id="cb1009-43" data-line-number="43"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-44" data-line-number="44">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-45" data-line-number="45">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>period <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">4</span>),</a>
<a class="sourceLine" id="cb1009-46" data-line-number="46">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1009-47" data-line-number="47">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1009-48" data-line-number="48">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">max_treedepth =</span> <span class="dv">12</span>),</a>
<a class="sourceLine" id="cb1009-49" data-line-number="49">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-50" data-line-number="50">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.05&quot;</span>)</a>
<a class="sourceLine" id="cb1009-51" data-line-number="51"></a>
<a class="sourceLine" id="cb1009-52" data-line-number="52"><span class="co"># fifth order</span></a>
<a class="sourceLine" id="cb1009-53" data-line-number="53">fit12<span class="fl">.6</span> &lt;-</a>
<a class="sourceLine" id="cb1009-54" data-line-number="54"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-55" data-line-number="55">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-56" data-line-number="56">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>period <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period<span class="op">^</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb1009-57" data-line-number="57">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1009-58" data-line-number="58">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb1009-59" data-line-number="59">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">max_treedepth =</span> <span class="dv">13</span>),</a>
<a class="sourceLine" id="cb1009-60" data-line-number="60">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-61" data-line-number="61">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.06&quot;</span>)</a>
<a class="sourceLine" id="cb1009-62" data-line-number="62"></a>
<a class="sourceLine" id="cb1009-63" data-line-number="63"><span class="co"># general</span></a>
<a class="sourceLine" id="cb1009-64" data-line-number="64">fit12<span class="fl">.7</span> &lt;-</a>
<a class="sourceLine" id="cb1009-65" data-line-number="65"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-66" data-line-number="66">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-67" data-line-number="67">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d1 <span class="op">+</span><span class="st"> </span>d2 <span class="op">+</span><span class="st"> </span>d3 <span class="op">+</span><span class="st"> </span>d4 <span class="op">+</span><span class="st"> </span>d5 <span class="op">+</span><span class="st"> </span>d6 <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9,</a>
<a class="sourceLine" id="cb1009-68" data-line-number="68">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1009-69" data-line-number="69">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1009-70" data-line-number="70">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-71" data-line-number="71">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.07&quot;</span>)</a>
<a class="sourceLine" id="cb1009-72" data-line-number="72"></a>
<a class="sourceLine" id="cb1009-73" data-line-number="73"><span class="co"># general with `factor(period)`</span></a>
<a class="sourceLine" id="cb1009-74" data-line-number="74">fit12<span class="fl">.8</span> &lt;-</a>
<a class="sourceLine" id="cb1009-75" data-line-number="75"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1009-76" data-line-number="76">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1009-77" data-line-number="77">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>period_f,</a>
<a class="sourceLine" id="cb1009-78" data-line-number="78">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1009-79" data-line-number="79">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1009-80" data-line-number="80">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1009-81" data-line-number="81">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.08&quot;</span>)</a></code></pre></div>
<p>Before we compare the models with information criteria, it might be handy to look at the hazard functions for each. A relatively quick way is with the <code>conditional_effects()</code> function.</p>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1010-1" data-line-number="1">p2 &lt;-<span class="st"> </span><span class="kw">plot</span>(<span class="kw">conditional_effects</span>(fit12<span class="fl">.2</span>), <span class="dt">plot =</span> F)[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;linear&quot;</span>)</a>
<a class="sourceLine" id="cb1010-2" data-line-number="2">p3 &lt;-<span class="st"> </span><span class="kw">plot</span>(<span class="kw">conditional_effects</span>(fit12<span class="fl">.3</span>), <span class="dt">plot =</span> F)[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;quadratic&quot;</span>)</a>
<a class="sourceLine" id="cb1010-3" data-line-number="3">p4 &lt;-<span class="st"> </span><span class="kw">plot</span>(<span class="kw">conditional_effects</span>(fit12<span class="fl">.4</span>), <span class="dt">plot =</span> F)[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;cubic&quot;</span>)</a>
<a class="sourceLine" id="cb1010-4" data-line-number="4">p5 &lt;-<span class="st"> </span><span class="kw">plot</span>(<span class="kw">conditional_effects</span>(fit12<span class="fl">.5</span>), <span class="dt">plot =</span> F)[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;fourth order&quot;</span>)</a>
<a class="sourceLine" id="cb1010-5" data-line-number="5">p6 &lt;-<span class="st"> </span><span class="kw">plot</span>(<span class="kw">conditional_effects</span>(fit12<span class="fl">.6</span>), <span class="dt">plot =</span> F)[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;fifth order&quot;</span>)</a>
<a class="sourceLine" id="cb1010-6" data-line-number="6">p7 &lt;-<span class="st"> </span><span class="kw">plot</span>(<span class="kw">conditional_effects</span>(fit12<span class="fl">.8</span>), </a>
<a class="sourceLine" id="cb1010-7" data-line-number="7">           <span class="dt">cat_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">2</span>), </a>
<a class="sourceLine" id="cb1010-8" data-line-number="8">           <span class="dt">plot =</span> F)[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;general&quot;</span>)</a></code></pre></div>
<p>Because it contains no predictors, we cannot use <code>conditional_effects()</code> to make a plot for the constant model (i.e., <code>fit12.1</code>). We’ll have to do that by hand.</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1011-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1011-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1011-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1011-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="kw">fixef</span>(fit12<span class="fl">.1</span>)[, <span class="dv">3</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>(),</a>
<a class="sourceLine" id="cb1011-5" data-line-number="5">                  <span class="dt">ymax =</span> <span class="kw">fixef</span>(fit12<span class="fl">.1</span>)[, <span class="dv">4</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>()),</a>
<a class="sourceLine" id="cb1011-6" data-line-number="6">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1011-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fixef</span>(fit12<span class="fl">.1</span>)[, <span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>()),</a>
<a class="sourceLine" id="cb1011-8" data-line-number="8">            <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;blue1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1011-9" data-line-number="9"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;constant&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1011-10" data-line-number="10"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;event | trials(1)&quot;</span>)</a></code></pre></div>
<p>Now combine and format the subplots with <strong>patchwork</strong>.</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1012-1" data-line-number="1"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb1012-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1012-3" data-line-number="3">(((p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span>p4 <span class="op">+</span><span class="st"> </span>p5 <span class="op">+</span><span class="st"> </span>p6) <span class="op">&amp;</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)) <span class="op">+</span><span class="st"> </span>p7) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1012-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1012-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>We are going to depart from Singer and Willett and no longer entertain using deviance for Bayesian model comparison. But we will compare then using the WAIC and the LOO.</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1013-1" data-line-number="1">fit12<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.1</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1013-2" data-line-number="2">fit12<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.2</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1013-3" data-line-number="3">fit12<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.3</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1013-4" data-line-number="4">fit12<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.4</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1013-5" data-line-number="5">fit12<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.5</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1013-6" data-line-number="6">fit12<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.6</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1013-7" data-line-number="7">fit12<span class="fl">.7</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.7</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1013-8" data-line-number="8">fit12<span class="fl">.8</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.8</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a></code></pre></div>
<p>Before comparing the models in bulk, as in Table 12.2, let’s confirm that whether we use the dummy variable method (<code>fit12.7</code>) or the factor variable method (<code>fit12.8</code>), the results for the general model are the same.</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1014-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.7</span>, fit12<span class="fl">.8</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit12.7    0.0       0.0  -425.0     22.4         9.3    1.0    849.9   44.9  
## fit12.8    0.0       0.0  -425.0     22.4         9.3    1.0    849.9   44.9</code></pre>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1016-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.7</span>, fit12<span class="fl">.8</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit12.7    0.0       0.0  -424.9      22.4          9.3    1.0     849.8   44.9 
## fit12.8    0.0       0.0  -424.9      22.4          9.3    1.0     849.8   44.9</code></pre>
<p>Yep, both WAIC and LOO confirm both methods are equivalent. One of the main reasons we used the factor method, here, was because it made it easier to plot the results with <code>conditional_effects()</code>. But with the following model comparisons, we’ll focus on <code>fit12.1</code> through <code>fit12.7</code>.</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1018-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.1</span>, fit12<span class="fl">.2</span>, fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, fit12<span class="fl">.5</span>, fit12<span class="fl">.6</span>, fit12<span class="fl">.7</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1018-2" data-line-number="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit12.4    0.0       0.0  -420.5     22.1         3.9    0.5    841.1   44.1  
## fit12.5   -0.6       0.9  -421.2     22.2         4.7    0.6    842.4   44.3  
## fit12.3   -0.8       2.1  -421.3     22.1         3.2    0.4    842.6   44.1  
## fit12.6   -1.3       0.8  -421.8     22.2         5.4    0.7    843.6   44.5  
## fit12.7   -4.4       1.5  -425.0     22.4         9.3    1.0    849.9   44.9  
## fit12.2  -15.2       5.9  -435.7     22.1         1.9    0.1    871.4   44.1  
## fit12.1  -99.2      13.1  -519.8     25.1         1.0    0.1   1039.5   50.2</code></pre>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1020-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.1</span>, fit12<span class="fl">.2</span>, fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, fit12<span class="fl">.5</span>, fit12<span class="fl">.6</span>, fit12<span class="fl">.7</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1020-2" data-line-number="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit12.4    0.0       0.0  -420.5      22.1          3.9    0.5     841.0   44.1 
## fit12.5   -0.6       0.9  -421.2      22.2          4.7    0.6     842.3   44.3 
## fit12.3   -0.8       2.1  -421.3      22.1          3.2    0.4     842.6   44.1 
## fit12.6   -1.3       0.8  -421.8      22.2          5.4    0.7     843.6   44.5 
## fit12.7   -4.4       1.5  -424.9      22.4          9.3    1.0     849.8   44.9 
## fit12.2  -15.2       5.9  -435.7      22.1          1.9    0.1     871.4   44.1 
## fit12.1  -99.2      13.1  -519.8      25.1          1.0    0.1    1039.5   50.2</code></pre>
<p>Our results are very similar to those in the AIC column in Table 12.2. Just for kicks and giggles, here are the model weights based on the LOO, WAIC, and stacking method.</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1022-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.1</span>, fit12<span class="fl">.2</span>, fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, fit12<span class="fl">.5</span>, fit12<span class="fl">.6</span>, fit12<span class="fl">.7</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1022-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.1 fit12.2 fit12.3 fit12.4 fit12.5 fit12.6 fit12.7 
##   0.000   0.000   0.206   0.439   0.230   0.120   0.005</code></pre>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1024-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.1</span>, fit12<span class="fl">.2</span>, fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, fit12<span class="fl">.5</span>, fit12<span class="fl">.6</span>, fit12<span class="fl">.7</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1024-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.1 fit12.2 fit12.3 fit12.4 fit12.5 fit12.6 fit12.7 
##   0.000   0.000   0.205   0.438   0.230   0.121   0.006</code></pre>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1026-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.1</span>, fit12<span class="fl">.2</span>, fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, fit12<span class="fl">.5</span>, fit12<span class="fl">.6</span>, fit12<span class="fl">.7</span>, <span class="dt">weights =</span> <span class="st">&quot;stacking&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1026-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.1 fit12.2 fit12.3 fit12.4 fit12.5 fit12.6 fit12.7 
##   0.017   0.000   0.405   0.578   0.000   0.000   0.000</code></pre>
<p>Across the comparison methods, the overall pattern is the cubic model (<code>fit12.4</code>) is marginally better than the rest, but that both the quadratic and fourth-order models were quite close. Unlike when you use model deviance, the parsimony corrections used in the information-criteria-based methods all suggest the general model is overfit.</p>
<blockquote>
<p>Before considering whether these differences in [information criteria] are sufficient to warrant use of an alternative specification for <em>TIME</em>, let us examine the corresponding fitted logit hazard functions. Doing so not only highlights the behavior of logit hazard, it also offers a graphical means of comparing the fit of competing specifications. (p. 413, <em>emphasis</em> in the original)</p>
</blockquote>
<p>In preparation for our Figure 12.1, we’ll make a custom function called <code>make_fitted()</code>, which will streamline some of the data wrangling code.</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1028-1" data-line-number="1">make_fitted &lt;-<span class="st"> </span><span class="cf">function</span>(fit, scale, ...) {</a>
<a class="sourceLine" id="cb1028-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1028-3" data-line-number="3">  <span class="kw">fitted</span>(fit,</a>
<a class="sourceLine" id="cb1028-4" data-line-number="4">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1028-5" data-line-number="5">         <span class="dt">scale =</span> scale,</a>
<a class="sourceLine" id="cb1028-6" data-line-number="6">         ...) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1028-7" data-line-number="7"><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1028-8" data-line-number="8"><span class="st">    </span><span class="kw">bind_cols</span>(nd)</a>
<a class="sourceLine" id="cb1028-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb1028-10" data-line-number="10">}</a></code></pre></div>
<p>In addition to taking different <strong>brms</strong> fit objects as input, <code>make_fitted()</code> will allow us to adjust the <code>scale</code> of the output. As you’ll see, we will need to work with to settings in the coming plots. For our first batch of code, we’ll use <code>scale = &quot;linear&quot;</code>. Because the <code>newdata</code> for our version of the general model (i.e., <code>fit12.8</code>) requires the predictor to be called <code>period_f</code> and the rest of the models require the predictor to be named <code>period</code>, we’ll make and save the results for the former first, redefine our <code>newdata</code>, apply <code>make_fitted()</code> to the rest of the models, and then combine them all. Here it is in one fell swoop.</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1029-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">period_f =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1029-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1029-3" data-line-number="3">f &lt;-<span class="st"> </span><span class="kw">make_fitted</span>(fit12<span class="fl">.8</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">period =</span> period_f)</a>
<a class="sourceLine" id="cb1029-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1029-5" data-line-number="5"><span class="co"># this will simplify the `mutate()` code below</span></a>
<a class="sourceLine" id="cb1029-6" data-line-number="6">models &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;constant&quot;</span>, <span class="st">&quot;linear&quot;</span>, <span class="st">&quot;quadratic&quot;</span>, <span class="st">&quot;cubic&quot;</span>, <span class="st">&quot;general&quot;</span>)</a>
<a class="sourceLine" id="cb1029-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1029-8" data-line-number="8">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1029-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1029-10" data-line-number="10">f &lt;-</a>
<a class="sourceLine" id="cb1029-11" data-line-number="11"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">make_fitted</span>(fit12<span class="fl">.1</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),  <span class="co"># constant</span></a>
<a class="sourceLine" id="cb1029-12" data-line-number="12">            <span class="kw">make_fitted</span>(fit12<span class="fl">.2</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),  <span class="co"># linear</span></a>
<a class="sourceLine" id="cb1029-13" data-line-number="13">            <span class="kw">make_fitted</span>(fit12<span class="fl">.3</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),  <span class="co"># quadratic</span></a>
<a class="sourceLine" id="cb1029-14" data-line-number="14">            <span class="kw">make_fitted</span>(fit12<span class="fl">.4</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),  <span class="co"># cubic</span></a>
<a class="sourceLine" id="cb1029-15" data-line-number="15">            f) <span class="op">%&gt;%</span><span class="st">                                   </span><span class="co"># general</span></a>
<a class="sourceLine" id="cb1029-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(models, <span class="dt">each =</span> <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb1029-17" data-line-number="17">                        <span class="dt">levels =</span> models))</a>
<a class="sourceLine" id="cb1029-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1029-19" data-line-number="19"><span class="co"># what have we done?</span></a>
<a class="sourceLine" id="cb1029-20" data-line-number="20"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 45
## Columns: 6
## $ Estimate  &lt;dbl&gt; -2.0628440, -2.0628440, -2.0628440, -2.0628440, -2.0628440, -2.0628440, -2.0628440, -2.06…
## $ Est.Error &lt;dbl&gt; 0.08140815, 0.08140815, 0.08140815, 0.08140815, 0.08140815, 0.08140815, 0.08140815, 0.081…
## $ Q2.5      &lt;dbl&gt; -2.22322400, -2.22322400, -2.22322400, -2.22322400, -2.22322400, -2.22322400, -2.22322400…
## $ Q97.5     &lt;dbl&gt; -1.90425837, -1.90425837, -1.90425837, -1.90425837, -1.90425837, -1.90425837, -1.90425837…
## $ period    &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1, 2, 3,…
## $ model     &lt;fct&gt; constant, constant, constant, constant, constant, constant, constant, constant, constant,…</code></pre>
<p>Now we’re in good shape to make and save our version of the top panel of Figure 12.1.</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1031-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1031-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1031-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> Estimate, <span class="dt">color =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1031-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1031-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1031-6" data-line-number="6"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Fitted logit(hazard)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1031-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="op">-</span><span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1031-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p>The bottom two panels require we redo our <code>make_fitted()</code> code from above, this time setting <code>scale = &quot;response&quot;</code>.</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1032-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">period_f =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1032-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1032-3" data-line-number="3">f &lt;-<span class="st"> </span><span class="kw">make_fitted</span>(fit12<span class="fl">.8</span>, <span class="dt">scale =</span> <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">period =</span> period_f)</a>
<a class="sourceLine" id="cb1032-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1032-5" data-line-number="5">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1032-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1032-7" data-line-number="7">f &lt;-</a>
<a class="sourceLine" id="cb1032-8" data-line-number="8"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">make_fitted</span>(fit12<span class="fl">.1</span>, <span class="dt">scale =</span> <span class="st">&quot;response&quot;</span>),  <span class="co"># constant</span></a>
<a class="sourceLine" id="cb1032-9" data-line-number="9">            <span class="kw">make_fitted</span>(fit12<span class="fl">.2</span>, <span class="dt">scale =</span> <span class="st">&quot;response&quot;</span>),  <span class="co"># linear</span></a>
<a class="sourceLine" id="cb1032-10" data-line-number="10">            <span class="kw">make_fitted</span>(fit12<span class="fl">.3</span>, <span class="dt">scale =</span> <span class="st">&quot;response&quot;</span>),  <span class="co"># quadratic</span></a>
<a class="sourceLine" id="cb1032-11" data-line-number="11">            <span class="kw">make_fitted</span>(fit12<span class="fl">.4</span>, <span class="dt">scale =</span> <span class="st">&quot;response&quot;</span>),  <span class="co"># cubic</span></a>
<a class="sourceLine" id="cb1032-12" data-line-number="12">            f) <span class="op">%&gt;%</span><span class="st">                                     </span><span class="co"># general</span></a>
<a class="sourceLine" id="cb1032-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(models, <span class="dt">each =</span> <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb1032-14" data-line-number="14">                        <span class="dt">levels =</span> models))</a></code></pre></div>
<p>Now make and save the bottom left panel for Figure 12.1.</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1033-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb1033-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1033-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(model <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;quadratic&quot;</span>, <span class="st">&quot;general&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1033-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb1033-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> Estimate, <span class="dt">color =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1033-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1033-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.5</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1033-8" data-line-number="8"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Fitted hazard&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1033-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1033-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1033-11" data-line-number="11">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p>Our <code>f</code> data will also work to make the final bottom right panel for the figure, but we’ll need to convert the <code>Estimate</code> values from the hazard metric to the survival-probability metric. In addition, we will need to add in values for when <code>period = 0</code>. Here we wrangle, plot, and save in one block.</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1034-1" data-line-number="1">new_rows &lt;-</a>
<a class="sourceLine" id="cb1034-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">Estimate =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1034-3" data-line-number="3">         <span class="dt">period   =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1034-4" data-line-number="4">         <span class="dt">model    =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;quadratic&quot;</span>, <span class="st">&quot;general&quot;</span>),</a>
<a class="sourceLine" id="cb1034-5" data-line-number="5">                           <span class="dt">levels =</span> models))</a>
<a class="sourceLine" id="cb1034-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1034-7" data-line-number="7">p3 &lt;-</a>
<a class="sourceLine" id="cb1034-8" data-line-number="8"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1034-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(model <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;quadratic&quot;</span>, <span class="st">&quot;general&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1034-10" data-line-number="10"><span class="st">  </span><span class="kw">select</span>(Estimate, period, model) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1034-11" data-line-number="11"><span class="st">  </span><span class="co"># add the `new_rows` data</span></a>
<a class="sourceLine" id="cb1034-12" data-line-number="12"><span class="st">  </span><span class="kw">bind_rows</span>(new_rows) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1034-13" data-line-number="13"><span class="st">  </span><span class="kw">arrange</span>(model, period) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1034-14" data-line-number="14"><span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1034-15" data-line-number="15"><span class="st">  </span><span class="co"># convert hazards to survival probabilities</span></a>
<a class="sourceLine" id="cb1034-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Estimate =</span> <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Estimate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1034-17" data-line-number="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb1034-18" data-line-number="18"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1034-19" data-line-number="19"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> Estimate, <span class="dt">color =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.5</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-23" data-line-number="23"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Fitted survival probability&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-24" data-line-number="24"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-25" data-line-number="25"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1034-26" data-line-number="26">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p>Now combine the subplots and format a little with <strong>patchwork</strong> to make our version of Figure 12.1.</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1035-1" data-line-number="1">p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1035-2" data-line-number="2"><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1035-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Years after hire&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">9</span>))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-19-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Instead of the two-row layout in the text, it seemed simpler to arrange the panels all in one row. This way we can let the full version of the line-color legend serve for all three panels.</p>
</div>
<div id="criteria-for-comparing-alternative-specification." class="section level3">
<h3><span class="header-section-number">12.1.2</span> Criteria for comparing alternative specification.</h3>
<blockquote>
<p>The decline in the deviance statistic across models indicates that fit improves with increasing complexity of the temporal specification. To evaluate the magnitude of this decline, we must also account for the increased number of parameters in the model. You should not adopt a more complex specification if it fits no better than a simpler one. But if an alternative specification is (nearly) as good as the most general one, it may be “good enough.” At the same time, we would not want an alternative that performs measurably worse than we know we can do. (p. 415)</p>
</blockquote>
<p>We won’t be comparing deviances with <span class="math inline">\(\chi^2\)</span> tests, here. As to information criteria, we got ahead of the authors a bit and presented those comparisons in the last section. Although our use of the WAIC and the LOO is similar to Singer and Willett’s use of the AIC and BIC in that they yield no formal hypothesis test in the form of a <span class="math inline">\(p\)</span>-value, their estimates and difference scores do come with standard errors.</p>
<p>In the middle of page 416, the authors focused on comparing the constant and linear models, the linear and quadratic models, and the quadratic and general models. The LOO and WAIC estimates for each were near identical. For the sake of simplicity, here are those three focused comparisons using the LOO.</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1036-1" data-line-number="1"><span class="co"># the constant and linear models</span></a>
<a class="sourceLine" id="cb1036-2" data-line-number="2">l1 &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(fit12<span class="fl">.1</span>, fit12<span class="fl">.2</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb1036-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1036-4" data-line-number="4"><span class="co"># the linear and quadratic models</span></a>
<a class="sourceLine" id="cb1036-5" data-line-number="5">l2 &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(fit12<span class="fl">.2</span>, fit12<span class="fl">.3</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb1036-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1036-7" data-line-number="7"><span class="co"># the quadratic and general models</span></a>
<a class="sourceLine" id="cb1036-8" data-line-number="8">l3 &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(fit12<span class="fl">.3</span>, fit12<span class="fl">.7</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb1036-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1036-10" data-line-number="10">l1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit12.2    0.0       0.0  -435.7     22.1         1.9    0.1    871.4   44.1  
## fit12.1  -84.0      11.6  -519.8     25.1         1.0    0.1   1039.5   50.2</code></pre>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1038-1" data-line-number="1">l2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit12.3    0.0       0.0  -421.3     22.1         3.2    0.4    842.6   44.1  
## fit12.2  -14.4       5.5  -435.7     22.1         1.9    0.1    871.4   44.1</code></pre>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1040-1" data-line-number="1">l3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit12.3    0.0       0.0  -421.3     22.1         3.2    0.4    842.6   44.1  
## fit12.7   -3.7       2.4  -425.0     22.4         9.3    1.0    849.9   44.9</code></pre>
<p>If we presume the LOO differences follow a normal distribution, we can use their point estimates and standard errors to plot those distributions using simulated data from good old <code>rnorm()</code>.</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1042-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb1042-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1042-3" data-line-number="3">n &lt;-<span class="st"> </span><span class="fl">1e6</span></a>
<a class="sourceLine" id="cb1042-4" data-line-number="4">models &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;linear - constant&quot;</span>, <span class="st">&quot;quadratic - linear&quot;</span>, <span class="st">&quot;quadratic - general&quot;</span>)</a>
<a class="sourceLine" id="cb1042-5" data-line-number="5"><span class="kw">set.seed</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb1042-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1042-7" data-line-number="7"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb1042-8" data-line-number="8"><span class="kw">tibble</span>(<span class="dt">loo_difference =</span> <span class="kw">c</span>(<span class="kw">rnorm</span>(n, <span class="dt">mean =</span> l1[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>, <span class="dt">sd =</span> l1[<span class="dv">2</span>, <span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1042-9" data-line-number="9">                          <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> l2[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>, <span class="dt">sd =</span> l2[<span class="dv">2</span>, <span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1042-10" data-line-number="10">                          <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> l3[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>, <span class="dt">sd =</span> l3[<span class="dv">2</span>, <span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1042-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">models =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(models, <span class="dt">each =</span> n),</a>
<a class="sourceLine" id="cb1042-12" data-line-number="12">                         <span class="dt">levels =</span> models)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1042-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb1042-14" data-line-number="14"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1042-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> loo_difference, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1042-16" data-line-number="16"><span class="st">  </span><span class="kw">stat_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>), <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1042-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1042-18" data-line-number="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;LOO-difference simulations based on 1,000,000 draws&quot;</span>,</a>
<a class="sourceLine" id="cb1042-19" data-line-number="19">       <span class="dt">x =</span> <span class="st">&quot;difference distribution&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1042-20" data-line-number="20"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1042-21" data-line-number="21"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>models, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The LOO difference for the linear and constant models is decisive. The difference for the quadratic and linear models is fairly large on the information-criteria scale, but the uncertainty in that distribution is fairly large relative to its location (i.e., its mean), which might temper overly-strong conclusions about how much better the quadratic was compared to the linear. The comparison between the quadratic and the general produced a simulation with a modest location and rather large uncertainty relative to the magnitude of that location. All in all, “all signs point to the superiority of the quadratic specification, which fits nearly as well as the general mode, but with fewer parameters” (p. 416).</p>
<p>In the next page, Singer and Willett briefly focused on comparing the cubic and quadratic models. Here are their LOO and WAIC caparisons.</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1043-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit12.4    0.0       0.0  -420.5     22.1         3.9    0.5    841.1   44.1  
## fit12.3   -0.8       2.1  -421.3     22.1         3.2    0.4    842.6   44.1</code></pre>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1045-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit12.4    0.0       0.0  -420.5      22.1          3.9    0.5     841.0   44.1 
## fit12.3   -0.8       2.1  -421.3      22.1          3.2    0.4     842.6   44.1</code></pre>
<p>In the text, the results for the AIC and BIC differed. Our LOO and WAIC results both agree with the AIC: the cubic model has a slightly lower LOO and WAIC estimate compared to the quadratic. However, the standard errors for the formal difference score are about twice the size of that difference and the absolute magnitude of the difference is rather small to begin with. Here’s what it looks like if we compare them using LOO weights, WAIC weights, and stacking weights.</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1047-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.3 fit12.4 
##   0.319   0.681</code></pre>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1049-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.3 fit12.4 
##   0.318   0.682</code></pre>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1051-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>, <span class="dt">weights =</span> <span class="st">&quot;stacking&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.3 fit12.4 
##   0.331   0.669</code></pre>
<p>Across all three weight comparisons, there was a modest edge for the quadratic model. But back to Singer and Willett:</p>
<blockquote>
<p>Although decision rules cannot substitute for judgment, intuition, and common sense, we nevertheless conclude by offering two guidelines for selecting among alternative specifications:</p>
<ul>
<li><em>If a smooth specification works nearly as well as the completely general one, appreciably better than all simpler ones, and no worse than all more complex ones, consider adopting it.</em></li>
<li><em>If no smooth specifications meet these criteria, retain the completely general specification.</em></li>
</ul>
<p>If this decision process leads you to a polynomial specification, then you can interpret the model’s parameters easily, as we [will discuss in a bit]. (p. 417, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Before moving on, we might point out that our Bayesian <strong>brms</strong>-based framework offers a different option: model averaging. We plot the hazard and survival curves based on weighted averages of multiple models. The weights can be based on various criteria. One approach would be to use the model weights from the LOO or the WAIC. As an example, here we use the LOO weights for the quadratic and cubic models.</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1053-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1053-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1053-3" data-line-number="3">pp &lt;-</a>
<a class="sourceLine" id="cb1053-4" data-line-number="4"><span class="st">  </span><span class="kw">pp_average</span>(fit12<span class="fl">.3</span>, fit12<span class="fl">.4</span>,</a>
<a class="sourceLine" id="cb1053-5" data-line-number="5">             <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>,</a>
<a class="sourceLine" id="cb1053-6" data-line-number="6">             <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1053-7" data-line-number="7">             <span class="dt">method =</span> <span class="st">&quot;pp_expect&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1053-8" data-line-number="8"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1053-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(nd)</a></code></pre></div>
<p>The <code>pp_average()</code> function works much like <code>fitted()</code> or <code>predict()</code>. If you input models and perhaps <code>newdata</code>, it will return estimates that are the weighted averages of the specified models. With the <code>weights = &quot;loo&quot;</code> argument, we indicated our desired weights were those from the LOO, just as we computed earlier with the <code>model_weights()</code> function. With the <code>method = &quot;pp_expect&quot;</code> argument, we indicated we wanted fitted values like we would get from <code>fitted()</code>.
Here we plot the results in terms of hazard and survival.</p>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1054-1" data-line-number="1"><span class="co"># hazard</span></a>
<a class="sourceLine" id="cb1054-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb1054-3" data-line-number="3"><span class="st">  </span>pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1054-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb1054-6" data-line-number="6">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Years after hire&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">9</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-9" data-line-number="9"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;hazard&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb1054-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1054-12" data-line-number="12"><span class="co"># survival</span></a>
<a class="sourceLine" id="cb1054-13" data-line-number="13">p2 &lt;-</a>
<a class="sourceLine" id="cb1054-14" data-line-number="14"><span class="st">  </span>pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1054-15" data-line-number="15"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Est.Error) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1054-16" data-line-number="16"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">tibble</span>(<span class="dt">Estimate =</span> <span class="dv">0</span>, <span class="dt">Q2.5 =</span> <span class="dv">0</span>, <span class="dt">Q97.5 =</span> <span class="dv">0</span>, <span class="dt">period =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1054-17" data-line-number="17"><span class="st">  </span><span class="kw">arrange</span>(period) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1054-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate<span class="op">:</span>Q97<span class="fl">.5</span>), <span class="dt">.funs =</span> <span class="op">~</span><span class="st"> </span><span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1054-19" data-line-number="19"><span class="st">  </span></a>
<a class="sourceLine" id="cb1054-20" data-line-number="20"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb1054-23" data-line-number="23">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-25" data-line-number="25"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Years after hire&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-26" data-line-number="26"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;survival&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1054-27" data-line-number="27"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb1054-28" data-line-number="28"></a>
<a class="sourceLine" id="cb1054-29" data-line-number="29"><span class="co"># combine</span></a>
<a class="sourceLine" id="cb1054-30" data-line-number="30">(p1 <span class="op">|</span><span class="st"> </span>p2) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1054-31" data-line-number="31"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;Behold the fitted hazard and survival curves based on a weighted</span><span class="ch">\n</span><span class="st">average of the quadratic and linear models!&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-24-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="interpreting-parameters-from-linear-quadratic-and-cubic-specifications." class="section level3">
<h3><span class="header-section-number">12.1.3</span> Interpreting parameters from linear, quadratic, and cubic specifications.</h3>
<p>“One advantage of a polynomial specification is that you can often interpret its parameters directly” (p. 417). For the polynomial models in this section, Singer and Willett used the <span class="math inline">\(TIME - c\)</span> specification for <code>period</code> where <span class="math inline">\(c\)</span> is a centering constant. They used <span class="math inline">\(c = 5\)</span>. Before we can refit our polynomial models with this parameterization, we’ll want to make a new <code>period</code> variable with this centering. We’ll call it <code>period_5</code>.</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1055-1" data-line-number="1">tenure_pp &lt;-</a>
<a class="sourceLine" id="cb1055-2" data-line-number="2"><span class="st">  </span>tenure_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1055-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period_5 =</span> period <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1055-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1055-5" data-line-number="5"><span class="co"># how do the two `period` variables compare?</span></a>
<a class="sourceLine" id="cb1055-6" data-line-number="6">tenure_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1055-7" data-line-number="7"><span class="st">  </span><span class="kw">distinct</span>(period, period_<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 2
##   period period_5
##    &lt;dbl&gt;    &lt;dbl&gt;
## 1      1       -4
## 2      2       -3
## 3      3       -2
## 4      4       -1
## 5      5        0
## 6      6        1
## 7      7        2
## 8      8        3
## 9      9        4</code></pre>
<p>Now refit the quadratic model using <code>period_5</code>.</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1057-1" data-line-number="1">fit12<span class="fl">.9</span> &lt;-</a>
<a class="sourceLine" id="cb1057-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(fit12<span class="fl">.3</span>,</a>
<a class="sourceLine" id="cb1057-3" data-line-number="3">         <span class="dt">newdata =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1057-4" data-line-number="4">         event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>period_<span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period_<span class="dv">5</span><span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1057-5" data-line-number="5">         <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1057-6" data-line-number="6">         <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1057-7" data-line-number="7">         <span class="dt">file =</span> <span class="st">&quot;fits/fit12.09&quot;</span>)</a></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1058-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.9</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ Intercept + period_5 + I(period_5^2) - 1 
##    Data: tenure_pp (Number of observations: 1474) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept      -1.41      0.11    -1.63    -1.21 1.00     2477     2167
## period_5        0.61      0.06     0.50     0.73 1.00     2656     2283
## Iperiod_5E2    -0.13      0.03    -0.18    -0.08 1.00     2221     2022
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Focusing just on the posterior means, this yields the following formula for the quadratic discrete-time hazard model: <span class="math inline">\(\operatorname{logit} \hat h (t_j) =\;\)</span> -1.4140 <span class="math inline">\(\text{one } +\)</span> 0.6147<span class="math inline">\((\text{time}_j - 5)\)</span> -0.1281<span class="math inline">\((\text{time}_j - 5)^2\)</span>.</p>
<p>Singer and Willett used the term “flipover point” for the point at which the quadratic function reaches its peak or trough. If we let <span class="math inline">\(c\)</span> be the centering constant for time variable, <span class="math inline">\(\alpha_1\)</span> be the linear coefficient for time, and <span class="math inline">\(\alpha_2\)</span> be the quadratic coefficient for time, we define the flipover point as</p>
<p><span class="math display">\[\text{flipover point} = [c - 1/2 (\alpha_1 / \alpha_2)].\]</span></p>
<p>Here’s what that looks like using the posterior samples.</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1060-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.9</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1060-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">c  =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb1060-3" data-line-number="3">            <span class="dt">a1 =</span> b_period_<span class="dv">5</span>,</a>
<a class="sourceLine" id="cb1060-4" data-line-number="4">            <span class="dt">a2 =</span> b_Iperiod_<span class="fl">5E2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1060-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">flipover point</span><span class="st">`</span> =<span class="st"> </span>c <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>(a1 <span class="op">/</span><span class="st"> </span>a2)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1060-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1060-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">flipover point</span><span class="st">`</span>, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1060-8" data-line-number="8"><span class="st">  </span><span class="kw">stat_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1060-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1060-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1060-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-27-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Just as each parameter has a posterior distribution, the flipover point, which is a function of two of the parameters, also has a posterior distribution. To understand what this flipover distribution means, it might be helpful to look at it in another way. For that, we’ll employ <code>fitted()</code>.</p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1061-1" data-line-number="1">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1061-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">12</span>, <span class="dt">by =</span> <span class="fl">.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1061-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period_5 =</span> period <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1061-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1061-5" data-line-number="5">f &lt;-</a>
<a class="sourceLine" id="cb1061-6" data-line-number="6"><span class="st">  </span><span class="kw">fitted</span>(fit12<span class="fl">.9</span>,</a>
<a class="sourceLine" id="cb1061-7" data-line-number="7">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1061-8" data-line-number="8">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb1061-9" data-line-number="9">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1061-10" data-line-number="10"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1061-11" data-line-number="11"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1061-12" data-line-number="12"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">expand</span>(nd,</a>
<a class="sourceLine" id="cb1061-13" data-line-number="13">                   <span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>,</a>
<a class="sourceLine" id="cb1061-14" data-line-number="14">                   <span class="kw">nesting</span>(period, period_<span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb1061-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1061-16" data-line-number="16">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1061-17" data-line-number="17"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 484,000
## Columns: 5
## $ name     &lt;chr&gt; &quot;X1&quot;, &quot;X2&quot;, &quot;X3&quot;, &quot;X4&quot;, &quot;X5&quot;, &quot;X6&quot;, &quot;X7&quot;, &quot;X8&quot;, &quot;X9&quot;, &quot;X10&quot;, &quot;X11&quot;, &quot;X12&quot;, &quot;X13&quot;, &quot;X14&quot;, &quot;…
## $ value    &lt;dbl&gt; -7.475609, -7.301111, -7.128899, -6.958974, -6.791335, -6.625982, -6.462916, -6.302136, -6…
## $ iter     &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ period   &lt;dbl&gt; 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, …
## $ period_5 &lt;dbl&gt; -5.0, -4.9, -4.8, -4.7, -4.6, -4.5, -4.4, -4.3, -4.2, -4.1, -4.0, -3.9, -3.8, -3.7, -3.6, …</code></pre>
<p>Now make a logit hazard spaghetti plot.</p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1063-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1063-2" data-line-number="2"><span class="st">  </span><span class="co"># how many lines would you like?</span></a>
<a class="sourceLine" id="cb1063-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(iter <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1063-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb1063-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> value, <span class="dt">group =</span> iter)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1063-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1063-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;logit hazard&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1063-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb1063-9" data-line-number="9">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1063-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-29-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>To keep the plot manageable, we filtered to just the first 30 posterior draws. Each was depicted with its own hazard line. Note how each of those hazard lines peaks at a different point along the <span class="math inline">\(x\)</span>-axis. Most peak somewhere around 7.4. Some take on notably higher values.</p>
<p>Now fit a cubic model using <code>period_5</code>, <span class="math inline">\((TIME_j - 5)\)</span>, as the measure of time.</p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1064-1" data-line-number="1">fit12<span class="fl">.10</span> &lt;-</a>
<a class="sourceLine" id="cb1064-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(fit12<span class="fl">.4</span>,</a>
<a class="sourceLine" id="cb1064-3" data-line-number="3">         <span class="dt">newdata =</span> tenure_pp,</a>
<a class="sourceLine" id="cb1064-4" data-line-number="4">         event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>period_<span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period_<span class="dv">5</span><span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(period_<span class="dv">5</span><span class="op">^</span><span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1064-5" data-line-number="5">         <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1064-6" data-line-number="6">         <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1064-7" data-line-number="7">         <span class="dt">file =</span> <span class="st">&quot;fits/fit12.10&quot;</span>)</a></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1065-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.10</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ Intercept + period_5 + I(period_5^2) + I(period_5^3) - 1 
##    Data: tenure_pp (Number of observations: 1474) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept      -1.45      0.11    -1.68    -1.23 1.00     2583     2293
## period_5        0.75      0.10     0.56     0.94 1.00     1647     1839
## Iperiod_5E2    -0.11      0.02    -0.17    -0.07 1.00     2362     2373
## Iperiod_5E3    -0.02      0.01    -0.04     0.00 1.00     1894     2195
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Focusing again on just the posterior means, this yields the following formula for the cubic discrete-time hazard model: <span class="math inline">\(\operatorname{logit} \hat h (t_j) =\;\)</span> -1.4510 <span class="math inline">\(\text{one } +\)</span> 0.7475<span class="math inline">\((\text{time}_j - 5)\)</span> -0.1149<span class="math inline">\((\text{time}_j - 5)^2\)</span> -0.0180<span class="math inline">\((\text{time}_j - 5)^3\)</span>. Now if we let <span class="math inline">\(c\)</span>, <span class="math inline">\(\alpha_1\)</span> and <span class="math inline">\(\alpha_2\)</span> retain their meanings from before and further let <span class="math inline">\(\alpha_3\)</span> stand for the cubic term for time, we can define the two flipover points in the cubic logit hazard model as</p>
<p><span class="math display">\[\text{flipover points} = c + \frac{-\alpha_2 \pm \sqrt{\alpha_2^2 - 3 \alpha_1 \alpha_3}}{3 \alpha_3}.\]</span></p>
<p>Do you see that <span class="math inline">\(\pm\)</span> sign in the numerator? That’s what gives us the two points. Now apply the formula to <code>fit12.10</code> and plot.</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1067-1" data-line-number="1"><span class="co"># extract the posterior draws</span></a>
<a class="sourceLine" id="cb1067-2" data-line-number="2">post &lt;-</a>
<a class="sourceLine" id="cb1067-3" data-line-number="3"><span class="st">  </span><span class="kw">posterior_samples</span>(fit12<span class="fl">.10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">c  =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb1067-5" data-line-number="5">            <span class="dt">a1 =</span> b_period_<span class="dv">5</span>,</a>
<a class="sourceLine" id="cb1067-6" data-line-number="6">            <span class="dt">a2 =</span> b_Iperiod_<span class="fl">5E2</span>,</a>
<a class="sourceLine" id="cb1067-7" data-line-number="7">            <span class="dt">a3 =</span> b_Iperiod_<span class="fl">5E3</span>)</a>
<a class="sourceLine" id="cb1067-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1067-9" data-line-number="9"><span class="co"># flipover point with &quot;+&quot; in the numerator</span></a>
<a class="sourceLine" id="cb1067-10" data-line-number="10">p1 &lt;-</a>
<a class="sourceLine" id="cb1067-11" data-line-number="11"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">flipover point 1</span><span class="st">`</span> =<span class="st"> </span>c <span class="op">+</span><span class="st"> </span>(<span class="op">-</span><span class="st"> </span>a2 <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>a3)) <span class="op">/</span><span class="st"> </span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>a3)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">flipover point 1</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-14" data-line-number="14"><span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">flipover point 1</span><span class="st">`</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">-50</span> <span class="op">&amp;</span><span class="st"> `</span><span class="dt">flipover point 1</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb1067-16" data-line-number="16"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">flipover point 1</span><span class="st">`</span>, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1067-17" data-line-number="17"><span class="st">  </span><span class="kw">stat_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>),) <span class="op">+</span></a>
<a class="sourceLine" id="cb1067-18" data-line-number="18"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb1067-19" data-line-number="19">           <span class="dt">x =</span> <span class="dv">-30</span>, <span class="dt">y =</span> <span class="fl">.85</span>,</a>
<a class="sourceLine" id="cb1067-20" data-line-number="20">           <span class="dt">label =</span> <span class="st">&quot;italic(c)+frac(-alpha[2]+sqrt(alpha[2]^2-3*alpha[1]*alpha[3]), 3*alpha[3])&quot;</span>,</a>
<a class="sourceLine" id="cb1067-21" data-line-number="21">           <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="dt">parse =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb1067-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1067-23" data-line-number="23"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">30</span>, <span class="dv">20</span>))</a>
<a class="sourceLine" id="cb1067-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1067-25" data-line-number="25"><span class="co"># flipover point with &quot;-&quot; in the numerator</span></a>
<a class="sourceLine" id="cb1067-26" data-line-number="26">p2 &lt;-</a>
<a class="sourceLine" id="cb1067-27" data-line-number="27"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-28" data-line-number="28"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">flipover point 2</span><span class="st">`</span> =<span class="st"> </span>c <span class="op">+</span><span class="st"> </span>(<span class="op">-</span><span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>a3)) <span class="op">/</span><span class="st"> </span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>a3)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-29" data-line-number="29"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">flipover point 2</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1067-30" data-line-number="30"><span class="st">  </span></a>
<a class="sourceLine" id="cb1067-31" data-line-number="31"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">flipover point 2</span><span class="st">`</span>, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1067-32" data-line-number="32"><span class="st">  </span><span class="kw">stat_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1067-33" data-line-number="33"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb1067-34" data-line-number="34">           <span class="dt">x =</span> <span class="fl">8.2</span>, <span class="dt">y =</span> <span class="fl">.85</span>,</a>
<a class="sourceLine" id="cb1067-35" data-line-number="35">           <span class="dt">label =</span> <span class="st">&quot;italic(c)+frac(-alpha[2]-sqrt(alpha[2]^2-3*alpha[1]*alpha[3]), 3*alpha[3])&quot;</span>,</a>
<a class="sourceLine" id="cb1067-36" data-line-number="36">           <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="dt">parse =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb1067-37" data-line-number="37"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1067-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1067-39" data-line-number="39"><span class="co"># combine!</span></a>
<a class="sourceLine" id="cb1067-40" data-line-number="40">(p1 <span class="op">|</span><span class="st"> </span>p2) <span class="op">&amp;</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-31-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The plot on the right looks similar to the flipover plot from <code>fit12.9</code>. But look at the massive uncertainty in the flipover point in the plot on the left. If you play around with the code, you’ll see the <span class="math inline">\(x\)</span>-axis extends far beyond the boundaries in the plot. Another spaghetti plot might help show what’s going on.</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1068-1" data-line-number="1"><span class="co"># redifine the `newdata`</span></a>
<a class="sourceLine" id="cb1068-2" data-line-number="2">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1068-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-8</span>, <span class="dt">to =</span> <span class="dv">11</span>, <span class="dt">by =</span> <span class="fl">.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1068-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period_5 =</span> period <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1068-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1068-6" data-line-number="6"><span class="co"># employ `fitted()` and wrangle</span></a>
<a class="sourceLine" id="cb1068-7" data-line-number="7">f &lt;-</a>
<a class="sourceLine" id="cb1068-8" data-line-number="8"><span class="st">  </span><span class="kw">fitted</span>(fit12<span class="fl">.10</span>,</a>
<a class="sourceLine" id="cb1068-9" data-line-number="9">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1068-10" data-line-number="10">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb1068-11" data-line-number="11">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1068-12" data-line-number="12"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1068-13" data-line-number="13"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1068-14" data-line-number="14"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">expand</span>(nd,</a>
<a class="sourceLine" id="cb1068-15" data-line-number="15">                   <span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>,</a>
<a class="sourceLine" id="cb1068-16" data-line-number="16">                   <span class="kw">nesting</span>(period, period_<span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb1068-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1068-18" data-line-number="18"><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1068-19" data-line-number="19">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1068-20" data-line-number="20"><span class="st">  </span><span class="kw">filter</span>(iter <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1068-21" data-line-number="21"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> value, <span class="dt">group =</span> iter)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1068-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1068-23" data-line-number="23"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;logit hazard&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1068-24" data-line-number="24"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1068-25" data-line-number="25">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">13</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1068-26" data-line-number="26"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-32-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>On the region to the right of 0 on the <span class="math inline">\(x\)</span>-axis, the plot looks a lot like the one for the quadratic model. But look at how wildly the lines fan out on the left side of 0. Since that’s the region where we find the second flipover point, all that uncertainty got baked into its marginal posterior. Just because I think it looks cool, here’s a version of that plot with lines corresponding to all 4,000 posterior draws.</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1069-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1069-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> value, <span class="dt">group =</span> iter)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1069-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1069-4" data-line-number="4"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;logit hazard&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1069-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1069-6" data-line-number="6">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">13</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1069-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-33-1.png" width="384" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model" class="section level2">
<h2><span class="header-section-number">12.2</span> Using the complementary log-log link to specify a discrete-time hazard model</h2>
<p>So far we’ve been using the</p>
<blockquote>
<p>logit transformation [which] represented a natural choice because it allowed us to: (1) specify the model using familiar terminology; (2) use widely available software for estimation; and (3) exploit interpretative strategies with which many empirical researchers are comfortable.</p>
<p>Just like the choice of a completely general specification for the main effect of <em>TIME</em>, use of a logit link is an analytic decision. Nothing about the way in which the model is postulated or fit requires the adoption of this, or any other, particular link function. (p. 419–420, <em>emphasis</em> in the original)</p>
</blockquote>
<p>The <em>complimentary log-log</em> transformation–<em>clog-log</em> for short–is a widely-used alternative. It follows the form</p>
<p><span class="math display">\[\operatorname{clog-log} = \log \big (- \log (1 - p) \big),\]</span></p>
<p>where <span class="math inline">\(p\)</span> is a probability value. In words, “while the logit transformation yields the logarithm of the <em>odds of event occurrence</em>, the clog-log transformation yields <em>the logarithm of the negated logarithm of the probability of event nonoccurrence</em>” (p. 420, <em>emphasis</em> in the original).</p>
<div id="the-clog-log-transformation-when-and-why-it-is-useful." class="section level3">
<h3><span class="header-section-number">12.2.1</span> The clog-log transformation: When and why it is useful.</h3>
<p>Here’s our version of Figure 12.2, where we compare the logit and clog-log transformations.</p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1070-1" data-line-number="1"><span class="co"># simulate the data</span></a>
<a class="sourceLine" id="cb1070-2" data-line-number="2"><span class="kw">tibble</span>(<span class="dt">p =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.00001</span>, <span class="dt">to =</span> <span class="fl">.99999</span>, <span class="dt">length.out =</span> <span class="fl">1e4</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1070-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">logit   =</span> <span class="kw">log</span>(p <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)),</a>
<a class="sourceLine" id="cb1070-4" data-line-number="4">         <span class="dt">cloglog =</span> <span class="kw">log</span>(<span class="op">-</span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1070-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>p) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1070-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name,</a>
<a class="sourceLine" id="cb1070-7" data-line-number="7">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;cloglog&quot;</span>),</a>
<a class="sourceLine" id="cb1070-8" data-line-number="8">                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Logit&quot;</span>, <span class="st">&quot;Complementary log-log&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1070-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1070-10" data-line-number="10"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1070-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> p, <span class="dt">y =</span> value, <span class="dt">color =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1070-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1070-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1070-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1070-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;transformed hazard probability&quot;</span>, </a>
<a class="sourceLine" id="cb1070-16" data-line-number="16">                     <span class="dt">breaks =</span> <span class="dv">-3</span><span class="op">:</span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">15</span>, <span class="dv">15</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1070-17" data-line-number="17"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;hazard probability&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1070-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb1070-19" data-line-number="19">        <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb1070-20" data-line-number="20">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.85</span>),</a>
<a class="sourceLine" id="cb1070-21" data-line-number="21">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-34-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Both transformations extend to the full <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span> parameter space. But whereas the logit is symmetric around zero and has a memorable point corresponding to <span class="math inline">\(p = .5\)</span> (i.e., 0), the clog-log is asymmetric and has a less-intuitive point corresponding to <span class="math inline">\(p = .5\)</span> (i.e., -0.3665129). Though somewhat odd, the advantage of the clog-log is</p>
<blockquote>
<p>it provides a discrete-time statistical model for hazard that has a built-in <em>proportional hazards</em> assumption, and not a <em>proportional odds</em> assumption (as in the case of the logit link). This would be completely unremarkable except for one thing: it provides a conceptual parallelism between the clog-log discrete-time hazard model and the models that we will ultimately describe for continuous-time survival analysis. (p. 421, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="a-discrete-time-hazard-model-using-the-complementary-log-log-link." class="section level3">
<h3><span class="header-section-number">12.2.2</span> A discrete-time hazard model using the complementary log-log link.</h3>
<p>Singer and Willett (p. 422):</p>
<blockquote>
<p>Any discrete-time hazard model postulated using a logit link can be rewritten using a clog-log link, simply by substituting transformations of the outcome. For example, we can write a general discrete-time hazard model for <span class="math inline">\(J\)</span> time periods and <span class="math inline">\(P\)</span> substantive predictors as:</p>
</blockquote>
<p><span class="math display">\[\begin{align*}
\operatorname{clog-log} h(t_j) &amp; = [\alpha_1 D_1 + \alpha_2 D_2 + \cdots + \alpha_J D_J] \\
&amp; \;\; + [\beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_P X_P].
\end{align*}\]</span></p>
<p>Now reload the <code>firstsex_pp.csv</code> data to test this baby out.</p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1071-1" data-line-number="1">sex_pp &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/firstsex_pp.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1071-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1071-3" data-line-number="3"><span class="kw">glimpse</span>(sex_pp)</a></code></pre></div>
<pre><code>## Rows: 822
## Columns: 11
## $ id     &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 7, 7, 7, 9, 9,…
## $ period &lt;dbl&gt; 7, 8, 9, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 7, …
## $ event  &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0,…
## $ d7     &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0,…
## $ d8     &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1,…
## $ d9     &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,…
## $ d10    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ d11    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ d12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pt     &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0,…
## $ pas    &lt;dbl&gt; 1.9788670, 1.9788670, 1.9788670, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916,…</code></pre>
<p>Our next task is to recreate Figure 12.3, which shows the “sample hazard functions for the grade of first intercourse data displayed on different scales,” namely the logit and clog-log (p. 423). The key word here is “sample,” meaning we’re not fitting full models. For our version of the corresponding figure from the last chapter (i.e., Figure 11.2 from page 363), we computed the sample logit hazard functions with life tables based on the output from the <code>survival::survfit()</code> function. I am not aware that you can get hazards in the clog-log scale from the <code>survfit()</code> function. The folks at IDRE solved the problem by fitting four maximum likelihood models using the <code>glm()</code> function (see <a href="https://stats.idre.ucla.edu/r/examples/alda/r-applied-longitudinal-data-analysis-ch-12/">here</a>). We’ll follow a similar approach, but with weakly-regularizing priors using the <code>brms::brm()</code> function.</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1073-1" data-line-number="1"><span class="co">## logit</span></a>
<a class="sourceLine" id="cb1073-2" data-line-number="2"><span class="co"># pt == 0</span></a>
<a class="sourceLine" id="cb1073-3" data-line-number="3">fit12<span class="fl">.11</span> &lt;-</a>
<a class="sourceLine" id="cb1073-4" data-line-number="4"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1073-5" data-line-number="5">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1073-6" data-line-number="6">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12,</a>
<a class="sourceLine" id="cb1073-7" data-line-number="7">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1073-8" data-line-number="8">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1073-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1073-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.11&quot;</span>)</a>
<a class="sourceLine" id="cb1073-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1073-12" data-line-number="12"><span class="co"># pt == 1</span></a>
<a class="sourceLine" id="cb1073-13" data-line-number="13">fit12<span class="fl">.12</span> &lt;-</a>
<a class="sourceLine" id="cb1073-14" data-line-number="14"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1073-15" data-line-number="15">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1073-16" data-line-number="16">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12,</a>
<a class="sourceLine" id="cb1073-17" data-line-number="17">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1073-18" data-line-number="18">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1073-19" data-line-number="19">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1073-20" data-line-number="20">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.12&quot;</span>)</a>
<a class="sourceLine" id="cb1073-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1073-22" data-line-number="22"><span class="co">## clog-log</span></a>
<a class="sourceLine" id="cb1073-23" data-line-number="23"><span class="co"># pt == 0</span></a>
<a class="sourceLine" id="cb1073-24" data-line-number="24">fit12<span class="fl">.13</span> &lt;-</a>
<a class="sourceLine" id="cb1073-25" data-line-number="25"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1073-26" data-line-number="26">      <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> cloglog),</a>
<a class="sourceLine" id="cb1073-27" data-line-number="27">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12,</a>
<a class="sourceLine" id="cb1073-28" data-line-number="28">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1073-29" data-line-number="29">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1073-30" data-line-number="30">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1073-31" data-line-number="31">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.13&quot;</span>)</a>
<a class="sourceLine" id="cb1073-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1073-33" data-line-number="33"><span class="co"># pt == 1</span></a>
<a class="sourceLine" id="cb1073-34" data-line-number="34">fit12<span class="fl">.14</span> &lt;-</a>
<a class="sourceLine" id="cb1073-35" data-line-number="35"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pt <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1073-36" data-line-number="36">      <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> cloglog),</a>
<a class="sourceLine" id="cb1073-37" data-line-number="37">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12,</a>
<a class="sourceLine" id="cb1073-38" data-line-number="38">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1073-39" data-line-number="39">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1073-40" data-line-number="40">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1073-41" data-line-number="41">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.14&quot;</span>)</a></code></pre></div>
<p>The primary line of code that distinguishes <code>fit12.11</code> and <code>fit12.12</code> from <code>fit12.13</code> and <code>fit12.14</code> is <code>family = binomial(link = cloglog)</code>. With the <code>family</code> argument, we switched out the default logit link for the clog-log link. Before we can make our version of Figure 12.5, we will redefine our <code>nd</code> data for <code>fitted()</code>, pump our four fit objects into our custom <code>make_fitted()</code> function from earlier, and wrangle a little.</p>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1074-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb1074-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">period =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1074-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d7  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1074-4" data-line-number="4">         <span class="dt">d8  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1074-5" data-line-number="5">         <span class="dt">d9  =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1074-6" data-line-number="6">         <span class="dt">d10 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1074-7" data-line-number="7">         <span class="dt">d11 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1074-8" data-line-number="8">         <span class="dt">d12 =</span> <span class="kw">if_else</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb1074-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1074-10" data-line-number="10">f &lt;-</a>
<a class="sourceLine" id="cb1074-11" data-line-number="11"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">make_fitted</span>(fit12<span class="fl">.11</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),</a>
<a class="sourceLine" id="cb1074-12" data-line-number="12">            <span class="kw">make_fitted</span>(fit12<span class="fl">.12</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),</a>
<a class="sourceLine" id="cb1074-13" data-line-number="13">            <span class="kw">make_fitted</span>(fit12<span class="fl">.13</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),</a>
<a class="sourceLine" id="cb1074-14" data-line-number="14">            <span class="kw">make_fitted</span>(fit12<span class="fl">.14</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1074-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pt   =</span> <span class="kw">rep</span>(<span class="kw">str_c</span>(<span class="st">&quot;pt = &quot;</span>, <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">4</span>),</a>
<a class="sourceLine" id="cb1074-16" data-line-number="16">         <span class="dt">link =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;clog-log&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1074-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1074-18" data-line-number="18">f <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 24
## Columns: 13
## $ Estimate  &lt;dbl&gt; -3.6759906, -3.6291011, -2.0585557, -1.9032077, -1.4559047, -1.4836458, -2.0077659, -2.94…
## $ Est.Error &lt;dbl&gt; 0.7452492, 0.7126282, 0.3684063, 0.3817483, 0.3533212, 0.4079584, 0.2966442, 0.4566804, 0…
## $ Q2.5      &lt;dbl&gt; -5.3798295, -5.2487341, -2.8453966, -2.7152387, -2.1943648, -2.3116730, -2.6237891, -3.92…
## $ Q97.5     &lt;dbl&gt; -2.43884354, -2.38763382, -1.39491123, -1.21280831, -0.79546524, -0.72122095, -1.45588706…
## $ period    &lt;int&gt; 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12
## $ d7        &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0
## $ d8        &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0
## $ d9        &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0
## $ d10       &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0
## $ d11       &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0
## $ d12       &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1
## $ pt        &lt;chr&gt; &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 0&quot;, &quot;pt = 1&quot;, &quot;pt = 1&quot;, &quot;pt = 1&quot;,…
## $ link      &lt;chr&gt; &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;, &quot;logit&quot;,…</code></pre>
<p>Make our version of Figure 12.3.</p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1076-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1076-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">group =</span> <span class="kw">interaction</span>(pt, link),</a>
<a class="sourceLine" id="cb1076-3" data-line-number="3">             <span class="dt">color =</span> pt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1076-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">linetype =</span> link)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1076-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1076-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;grade&quot;</span>, <span class="dt">breaks =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">12</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1076-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;transformed hazard probability&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1076-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1076-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-37-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Our next step is to fit proper models to the data. First, we will refit <code>fit11.8</code> from last chapter. Then we’ll fit the clog-log analogue to the same model. The two models, respectively, follow the form</p>
<p><span class="math display">\[\begin{align*}
\operatorname{logit} h(t_{ij}) &amp; = [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_1 \text{PT}_i ] \; \text{and} \\
\operatorname{clog-log} h(t_{ij}) &amp; = [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_1 \text{PT}_i ].
\end{align*}\]</span></p>
<p>Fit the models.</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1077-1" data-line-number="1"><span class="co"># logit</span></a>
<a class="sourceLine" id="cb1077-2" data-line-number="2">fit11<span class="fl">.8</span> &lt;-</a>
<a class="sourceLine" id="cb1077-3" data-line-number="3"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb1077-4" data-line-number="4">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1077-5" data-line-number="5">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12 <span class="op">+</span><span class="st"> </span>pt,</a>
<a class="sourceLine" id="cb1077-6" data-line-number="6">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1077-7" data-line-number="7">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1077-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1077-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.08&quot;</span>)</a>
<a class="sourceLine" id="cb1077-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1077-11" data-line-number="11"><span class="co"># clog-log</span></a>
<a class="sourceLine" id="cb1077-12" data-line-number="12">fit12<span class="fl">.15</span> &lt;-</a>
<a class="sourceLine" id="cb1077-13" data-line-number="13"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb1077-14" data-line-number="14">      <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> cloglog),</a>
<a class="sourceLine" id="cb1077-15" data-line-number="15">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12 <span class="op">+</span><span class="st"> </span>pt,</a>
<a class="sourceLine" id="cb1077-16" data-line-number="16">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1077-17" data-line-number="17">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1077-18" data-line-number="18">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1077-19" data-line-number="19">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.15&quot;</span>)</a></code></pre></div>
<p>Both models used the binomial likelihood. They only differed in which link function we used to transform the data. To further explicate, we can more fully write out our Bayesian clog-log model as</p>
<p><span class="math display">\[\begin{align*}
\text{event}_{ij} &amp; = \operatorname{Binomial}(n = 1, p_{ij}) \\ 
\operatorname{clog-log} (p_{ij}) &amp; =  [\alpha_7 D_{7ij} + \alpha_8 D_{8ij} + \cdots + \alpha_{12} D_{12ij}] + [\beta_1 \text{PT}_{1i} ] \\
\alpha_7, \alpha_8, ..., \alpha_{12} &amp; \sim \operatorname{Normal}(0, 4) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 4).
\end{align*}\]</span></p>
<p>Here are the posterior means for <code>fit11.8</code> and <code>fit12.15</code>, as depicted in the firs three columns of Table 12.3.</p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1078-1" data-line-number="1">pars &lt;-</a>
<a class="sourceLine" id="cb1078-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">fixef</span>(fit11<span class="fl">.8</span>)  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;par&quot;</span>),</a>
<a class="sourceLine" id="cb1078-3" data-line-number="3">            <span class="kw">fixef</span>(fit12<span class="fl">.15</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;par&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1078-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">link =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;clog-log&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1078-5" data-line-number="5">         <span class="dt">par  =</span> <span class="kw">factor</span>(par, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="kw">str_c</span>(<span class="st">&quot;d&quot;</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>), <span class="st">&quot;pt&quot;</span>)))</a>
<a class="sourceLine" id="cb1078-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1078-7" data-line-number="7">pars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1078-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(par, link, Estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1078-9" data-line-number="9"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> link,</a>
<a class="sourceLine" id="cb1078-10" data-line-number="10">              <span class="dt">values_from =</span> Estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1078-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(par, <span class="st">`</span><span class="dt">clog-log</span><span class="st">`</span>, logit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1078-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   par   `clog-log`  logit
##   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1 d7        -2.97  -3.00 
## 2 d8        -3.68  -3.73 
## 3 d9        -2.32  -2.28 
## 4 d10       -1.90  -1.82 
## 5 d11       -1.77  -1.65 
## 6 d12       -1.35  -1.18 
## 7 pt         0.760  0.857</code></pre>
<p>They might be easier to compare in a coefficient plot.</p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1080-1" data-line-number="1">pars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1080-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> link, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1080-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1080-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb1080-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;transformed hazard&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1080-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1080-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1080-8" data-line-number="8">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1080-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>par, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-39-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Instead of comparing them with deviances, we will compare the two models using Bayesian information criteria. For simplicity, we’ll focus on the LOO.</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1081-1" data-line-number="1">fit12<span class="fl">.15</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.15</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb1081-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1081-3" data-line-number="3"><span class="kw">loo_compare</span>(fit12<span class="fl">.15</span>, fit11<span class="fl">.8</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit12.15    0.0       0.0  -324.3     17.6         7.0    0.5    648.6   35.2  
## fit11.8    -0.1       0.2  -324.4     17.6         7.1    0.6    648.8   35.2</code></pre>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1083-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.15</span>, fit11<span class="fl">.8</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.15  fit11.8 
##     0.53     0.47</code></pre>
<p>From a LOO perspective, they’re basically the same. The parameter summaries are also quite similar between the two models. A coefficient plot might make it easy to see. “Numerical similarity is common when fitting identical models with alternate link functions (and net risks of event occurrence are low) and suggests that choice of a link function should depend on other considerations” (p. 423).</p>
<p>We already know from the last chapter that we can convert logits to probabilities with the function</p>
<p><span class="math display">\[p = \frac{1}{1 + e^{- \text{logit}}}.\]</span></p>
<p>The relevant inverse transformation for the clog-log link is</p>
<p><span class="math display">\[p = 1 - e^{\Big (- e^{( \text{clog-log})} \Big)}.\]</span></p>
<p>Now use those formulas to convert our <code>Estimate</code> values into the hazard metric, as shown in the last two columns of Table 12.3.</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1085-1" data-line-number="1">pars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1085-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(par <span class="op">!=</span><span class="st"> &quot;pt&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1085-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Estimate =</span> <span class="kw">if_else</span>(<span class="kw">str_detect</span>(link, <span class="st">&quot;logit&quot;</span>),</a>
<a class="sourceLine" id="cb1085-4" data-line-number="4">                            <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>Estimate)),</a>
<a class="sourceLine" id="cb1085-5" data-line-number="5">                            <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="kw">exp</span>(Estimate)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1085-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(par, link, Estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1085-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> link,</a>
<a class="sourceLine" id="cb1085-8" data-line-number="8">              <span class="dt">values_from =</span> Estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1085-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(par, <span class="st">`</span><span class="dt">clog-log</span><span class="st">`</span>, logit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1085-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">clog-log - logit</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">clog-log</span><span class="st">`</span> <span class="op">-</span><span class="st"> </span>logit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1085-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   par   `clog-log`  logit `clog-log - logit`
##   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;              &lt;dbl&gt;
## 1 d7        0.05   0.0473             0.0027
## 2 d8        0.0249 0.0235             0.0014
## 3 d9        0.0938 0.0927             0.001 
## 4 d10       0.139  0.139             -0.0001
## 5 d11       0.157  0.161             -0.0037
## 6 d12       0.229  0.236             -0.0064</code></pre>
<p>For kicks, we threw in a column of their differences. The <code>clog-log - logit</code> column highlights how</p>
<blockquote>
<p>in general, fitted hazard functions from models estimated with both link functions will be indistinguishable unless hazard is high, once again suggesting that the quality of the estimates does not provide a rationale for selecting one of these link functions over the other. (p. 424)</p>
</blockquote>
<p>Now focus on the <code>pt</code> parameter for both models.</p>
<blockquote>
<p>In both cases, we antilog [i.e., exponentiate] parameter estimates, but whereas an antilogged [i.e., exponentiated] coefficient from a model with a logit link is an odds ratio, an antilogged coefficient from a model with a clog-log link is a hazard ratio. (p. 424)</p>
</blockquote>
<p>Here’s that in a plot.</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1087-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1087-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit11<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1087-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_pt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>(), <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1087-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1087-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;fit11.8 (logit link)&quot;</span>,</a>
<a class="sourceLine" id="cb1087-6" data-line-number="6">       <span class="dt">subtitle =</span> <span class="st">&quot;Exponentiating this parameter yields an odds ratio.&quot;</span>)</a>
<a class="sourceLine" id="cb1087-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1087-8" data-line-number="8">p2 &lt;-</a>
<a class="sourceLine" id="cb1087-9" data-line-number="9"><span class="st">  </span><span class="kw">posterior_samples</span>(fit12<span class="fl">.15</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1087-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_pt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>(), <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1087-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1087-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;fit12.15 (clog-log link)&quot;</span>,</a>
<a class="sourceLine" id="cb1087-13" data-line-number="13">       <span class="dt">subtitle =</span> <span class="st">&quot;Exponentiating this parameter yields a hazard ratio.&quot;</span>)</a>
<a class="sourceLine" id="cb1087-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1087-15" data-line-number="15">(p1 <span class="op">|</span><span class="st"> </span>p2) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1087-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;b_pt (exponentiated)&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1087-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1087-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-42-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>For the clog-log model, then,</p>
<blockquote>
<p>in every grade from 7<sup>th</sup> to 12<sup>th</sup>, we estimate the hazard of first intercourse for boys who experienced a parenting transition to be [about] 2.2 times the hazard for their peers raised with both biological parents. This interpretation contrasts with that from the model with a logit link, which suggests that the odds of first intercourse are [about] 2.4 times the <em>odds</em> for boys who experienced a parenting transition. (pp. 424–425, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="choosing-between-logit-and-clog-log-links-for-discrete-time-hazard-models." class="section level3">
<h3><span class="header-section-number">12.2.3</span> Choosing between logit and clog-log links for discrete-time hazard models.</h3>
<blockquote>
<p>The primary advantage of the clog-log link is that in invoking a proportional hazards assumption it yields a direct analog to the continuous time hazard model…. If you believe that the underlying metric for time is truly continuous and that the only reason you observe discretized values is due to measurement difficulties, a model specified with a clog-log link has much to recommend it….</p>
<p>[Yet,] if data are collected in truly discrete time, the clog-log specification has no particular advantage. As <a href="https://www.oxfordscholarship.com/view/10.1093/0198292376.001.0001/acprof-9780198292371">Beck (1999)</a>; <a href="http://www-personal.umich.edu/~franzese/BeckKatzTucker.TakingTimeSeriously.AJPS1998.pdf">Beck, Katz, and Tucker (1998)</a>; and <a href="http://halweb.uc3m.es/esp/Personal/personas/mhveiga/eng/docencia_Master_archivos/2285055.pdf">Sueyoshi (1995)</a> argue, the proportional hazards assumption is no more sacred than the proportional odds assumption, and while consistency across models is noble, so, too, is simplicity (which decreases the chances of mistake). (p. 426)</p>
</blockquote>
</div>
</div>
<div id="time-varying-predictors-1" class="section level2">
<h2><span class="header-section-number">12.3</span> Time-varying predictors</h2>
<p>“Discrete-time survival analysis adopts naturally to the inclusion of time-varying predictors. Because models are fit using a person-period data set, a time-varying predictor simply takes on its appropriate value for each person in each period” (p. 427).</p>
<div id="assumptions-underlying-a-model-with-time-varying-predictors." class="section level3">
<h3><span class="header-section-number">12.3.1</span> Assumptions underlying a model with time-varying predictors.</h3>
<p>Load the depression data from <a href="https://www.cambridge.org/core/books/stress-and-adversity-over-the-life-course/8CD7EE190B912C5C7DD0B3831C95348F">Wheaton, Rozell, and Hall (1997)</a>.</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1088-1" data-line-number="1">depression_pp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1088-2" data-line-number="2"><span class="st">  </span><span class="kw">read_csv</span>(<span class="st">&quot;data/depression_pp.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1088-3" data-line-number="3"><span class="st">  </span><span class="co"># convert the column names to lower case</span></a>
<a class="sourceLine" id="cb1088-4" data-line-number="4"><span class="st">  </span><span class="kw">rename_all</span>(tolower)</a>
<a class="sourceLine" id="cb1088-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1088-6" data-line-number="6"><span class="kw">glimpse</span>(depression_pp)</a></code></pre></div>
<pre><code>## Rows: 36,997
## Columns: 22
## $ id        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ onset     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ age       &lt;dbl&gt; 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 3…
## $ censor    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ censage   &lt;dbl&gt; 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 3…
## $ aged      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ female    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ nsibs     &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,…
## $ sibs12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ sibs34    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ sibs56    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ sibs78    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ sibs9plus &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ bigfamily &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ period    &lt;dbl&gt; 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,…
## $ event     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pd        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pdnow     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ one       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ age_18    &lt;dbl&gt; -14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9…
## $ age_18sq  &lt;dbl&gt; 196, 169, 144, 121, 100, 81, 64, 49, 36, 25, 16, 9, 4, 1, 0, 1, 4, 9, 16, 25, 36, 49, 64,…
## $ age_18cub &lt;dbl&gt; -2744, -2197, -1728, -1331, -1000, -729, -512, -343, -216, -125, -64, -27, -8, -1, 0, 1, …</code></pre>
<p>Here is the participant <code>age</code> range.</p>
<div class="sourceCode" id="cb1090"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1090-1" data-line-number="1"><span class="kw">range</span>(depression_pp<span class="op">$</span>age)</a></code></pre></div>
<pre><code>## [1] 17 57</code></pre>
<p>We might count how many participants experienced a parantal divorce, <code>pd</code>, like this.</p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1092-1" data-line-number="1">depression_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1092-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1092-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pd =</span> <span class="kw">if_else</span>(<span class="kw">sum</span>(pd) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1092-4" data-line-number="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1092-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(pd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1092-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##      pd     n percent
##   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1     0  1248    89.6
## 2     1   145    10.4</code></pre>
<p>Here we fit the discrete hazard model based on a quadratic treatment of <span class="math inline">\(\text{age} - 18\)</span> with and the time-varying predictor <code>pd</code> and without/with the time-invariant predictor <code>female</code>.</p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1094-1" data-line-number="1">fit12<span class="fl">.16</span> &lt;-</a>
<a class="sourceLine" id="cb1094-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> depression_pp,</a>
<a class="sourceLine" id="cb1094-3" data-line-number="3">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1094-4" data-line-number="4">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>pd,</a>
<a class="sourceLine" id="cb1094-5" data-line-number="5">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1094-6" data-line-number="6">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1094-7" data-line-number="7">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1094-8" data-line-number="8">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.16&quot;</span>)</a>
<a class="sourceLine" id="cb1094-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1094-10" data-line-number="10">fit12<span class="fl">.17</span> &lt;-</a>
<a class="sourceLine" id="cb1094-11" data-line-number="11"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> depression_pp,</a>
<a class="sourceLine" id="cb1094-12" data-line-number="12">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1094-13" data-line-number="13">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>pd <span class="op">+</span><span class="st"> </span>female,</a>
<a class="sourceLine" id="cb1094-14" data-line-number="14">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1094-15" data-line-number="15">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1094-16" data-line-number="16">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1094-17" data-line-number="17">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.17&quot;</span>)</a></code></pre></div>
<p>Check the summaries.</p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1095-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.16</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + Intercept + age_18 + I(age_18^2) + I(age_18^3) + pd 
##    Data: depression_pp (Number of observations: 36997) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -4.25      0.08    -4.40    -4.10 1.00     1752     1516
## age_18        0.06      0.01     0.04     0.08 1.00     1467     1608
## Iage_18E2    -0.01      0.00    -0.01    -0.01 1.00     2573     2358
## Iage_18E3     0.00      0.00     0.00     0.00 1.00     2195     2469
## pd            0.42      0.16     0.09     0.73 1.00     1402     1354
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1097-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.17</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + Intercept + age_18 + I(age_18^2) + I(age_18^3) + pd + female 
##    Data: depression_pp (Number of observations: 36997) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -4.58      0.11    -4.79    -4.38 1.00     1762     2512
## age_18        0.06      0.01     0.04     0.08 1.00     2162     2085
## Iage_18E2    -0.01      0.00    -0.01    -0.01 1.00     3435     2851
## Iage_18E3     0.00      0.00     0.00     0.00 1.00     2695     2648
## pd            0.40      0.16     0.07     0.71 1.00     1319     1178
## female        0.54      0.11     0.33     0.76 1.00     1982     2294
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Before we make our version of Figure 12.4, we’ll need to make an aggregated version of the data, which will allow us to replicate the dots and plus signs. We’ll use the same basic wrangling steps from when we made <code>sex_aggregated</code> from back in Chapter 11.</p>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1099-1" data-line-number="1">depression_aggregated &lt;-</a>
<a class="sourceLine" id="cb1099-2" data-line-number="2"><span class="st">  </span>depression_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">event =</span> <span class="kw">if_else</span>(event <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;event&quot;</span>, <span class="st">&quot;no_event&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(age_<span class="dv">18</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(event, pd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-7" data-line-number="7"><span class="st">  </span><span class="kw">complete</span>(age_<span class="dv">18</span>, event, pd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-8" data-line-number="8"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> event,</a>
<a class="sourceLine" id="cb1099-9" data-line-number="9">              <span class="dt">values_from =</span> n) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pd    =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, pd),</a>
<a class="sourceLine" id="cb1099-11" data-line-number="11">                        <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>)),</a>
<a class="sourceLine" id="cb1099-12" data-line-number="12">         <span class="dt">age   =</span> age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="dv">18</span>,</a>
<a class="sourceLine" id="cb1099-13" data-line-number="13">         <span class="dt">total =</span> event <span class="op">+</span><span class="st"> </span>no_event) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">proportion =</span> event <span class="op">/</span><span class="st"> </span>total) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1099-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">logit =</span> <span class="kw">log</span>(proportion <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>proportion)))</a>
<a class="sourceLine" id="cb1099-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1099-17" data-line-number="17">depression_aggregated</a></code></pre></div>
<pre><code>## # A tibble: 72 x 8
##    age_18 pd     event no_event   age total proportion logit
##     &lt;dbl&gt; &lt;fct&gt;  &lt;int&gt;    &lt;int&gt; &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1    -14 pd = 0     1     1353     4  1354   0.000739 -7.21
##  2    -14 pd = 1    NA       39     4    NA  NA        NA   
##  3    -13 pd = 0    NA     1344     5    NA  NA        NA   
##  4    -13 pd = 1    NA       48     5    NA  NA        NA   
##  5    -12 pd = 0     4     1333     6  1337   0.00299  -5.81
##  6    -12 pd = 1     1       54     6    55   0.0182   -3.99
##  7    -11 pd = 0     5     1322     7  1327   0.00377  -5.58
##  8    -11 pd = 1    NA       60     7    NA  NA        NA   
##  9    -10 pd = 0     2     1313     8  1315   0.00152  -6.49
## 10    -10 pd = 1     1       66     8    67   0.0149   -4.19
## # … with 62 more rows</code></pre>
<p>Now make Figure 12.4.</p>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1101-1" data-line-number="1">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1101-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">age_18 =</span> <span class="dv">-14</span><span class="op">:</span><span class="dv">21</span>,</a>
<a class="sourceLine" id="cb1101-3" data-line-number="3">           <span class="dt">pd     =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="dv">18</span>)</a>
<a class="sourceLine" id="cb1101-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb1101-6" data-line-number="6"><span class="co"># hazard (top panel)</span></a>
<a class="sourceLine" id="cb1101-7" data-line-number="7">p1 &lt;-</a>
<a class="sourceLine" id="cb1101-8" data-line-number="8"><span class="st">  </span><span class="kw">fitted</span>(fit12<span class="fl">.16</span>,</a>
<a class="sourceLine" id="cb1101-9" data-line-number="9">         <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-10" data-line-number="10"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-11" data-line-number="11"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pd =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, pd),</a>
<a class="sourceLine" id="cb1101-13" data-line-number="13">                     <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-14" data-line-number="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb1101-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">group =</span> pd, <span class="dt">color =</span> pd)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> depression_aggregated,</a>
<a class="sourceLine" id="cb1101-18" data-line-number="18">             <span class="kw">aes</span>(<span class="dt">y =</span> proportion, <span class="dt">shape =</span> pd),</a>
<a class="sourceLine" id="cb1101-19" data-line-number="19">             <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">40</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;proportion experiencing event&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.06</span>))</a>
<a class="sourceLine" id="cb1101-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1101-23" data-line-number="23"><span class="co"># logit(hazard) (top panel)</span></a>
<a class="sourceLine" id="cb1101-24" data-line-number="24">p2 &lt;-</a>
<a class="sourceLine" id="cb1101-25" data-line-number="25"><span class="st">  </span><span class="kw">fitted</span>(fit12<span class="fl">.16</span>,</a>
<a class="sourceLine" id="cb1101-26" data-line-number="26">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1101-27" data-line-number="27">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-28" data-line-number="28"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-29" data-line-number="29"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-30" data-line-number="30"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pd =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, pd),</a>
<a class="sourceLine" id="cb1101-31" data-line-number="31">                     <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-32" data-line-number="32"><span class="st">  </span></a>
<a class="sourceLine" id="cb1101-33" data-line-number="33"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">group =</span> pd, <span class="dt">color =</span> pd)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-34" data-line-number="34"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-35" data-line-number="35"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> depression_aggregated,</a>
<a class="sourceLine" id="cb1101-36" data-line-number="36">             <span class="kw">aes</span>(<span class="dt">y =</span> logit, <span class="dt">shape =</span> pd),</a>
<a class="sourceLine" id="cb1101-37" data-line-number="37">             <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-38" data-line-number="38"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">40</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-39" data-line-number="39"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;logit(proportion experiencing event)&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">8</span>, <span class="dv">-2</span>))</a>
<a class="sourceLine" id="cb1101-40" data-line-number="40"></a>
<a class="sourceLine" id="cb1101-41" data-line-number="41"><span class="co"># combine</span></a>
<a class="sourceLine" id="cb1101-42" data-line-number="42">(</a>
<a class="sourceLine" id="cb1101-43" data-line-number="43">  (p1 <span class="op">/</span><span class="st"> </span>p2) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1101-44" data-line-number="44"><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">16</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1101-45" data-line-number="45"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1101-46" data-line-number="46"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb1101-47" data-line-number="47">) <span class="op">+</span></a>
<a class="sourceLine" id="cb1101-48" data-line-number="48"><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-48-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="interpreting-and-displaying-time-varying-predictors-effects." class="section level3">
<h3><span class="header-section-number">12.3.2</span> Interpreting and displaying time-varying predictors’ effects.</h3>
<p>We jumped the gun a little, but to repeat:</p>
<blockquote>
<p>you can fit a discrete-time hazard model with time-varying predictors using exactly the same strategies presented in chapter 11. In the person-period data set, use a logistic regression routine to regress the event indicator on variables representing the main effect of <em>TIME</em> and the desired predictors. (pp. 434–435, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For example, here is the statistical formula we used when we fit <code>fit12.17</code>:</p>
<p><span class="math display">\[\begin{align*}
\text{event}_{ij}             &amp; = \operatorname{Binomial}(n = 1, p_{ij}) \\ 
\operatorname{logit} (p_{ij}) &amp; = [\alpha_0 + \alpha_1 (\text{age}_{ij} - 18) + \alpha_2 (\text{age}_{ij} - 18)^2 + \alpha_3 (\text{age}_{ij} - 18)^3] \\
                              &amp; \; \; + [\beta_1 \text{pd}_{ij} + \beta_2 \text{female}_{i}] \\
\alpha_0, ..., \alpha_3       &amp; \sim \operatorname{Normal}(0, 4) \\
\beta_1 \text{ and } \beta_2  &amp; \sim \operatorname{Normal}(0, 4),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\operatorname{logit} (p_{ij}) = \operatorname{logit} \hat h(t_{ij})\)</span>. If you’d like to compare our results for those displayed by Singer and Willett in Equation 12.8, here are our posterior means.</p>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1102-1" data-line-number="1"><span class="kw">fixef</span>(fit12<span class="fl">.17</span>)[, <span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## Intercept    age_18 Iage_18E2 Iage_18E3        pd    female 
##   -4.5830    0.0599   -0.0075    0.0002    0.3981    0.5435</code></pre>
<p>The values are pretty close. Though we won’t compare <code>fit12.16</code> and <code>fit12.17</code> using deviances, we will use information criteria. Before you execute this code on your end, heads up! In my experience, large data sets like this often result in long computation times for Bayesian information criteria. Between the two, the LOO often takes longer. So here we’ll go with the WAIC. Even so, it took just under four hours to execute both <code>add_criterion()</code> lines. <strong>Proceed with causion</strong>.</p>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1104-1" data-line-number="1">fit12<span class="fl">.16</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.16</span>, <span class="st">&quot;waic&quot;</span>)  <span class="co"># 1.833328 hours</span></a>
<a class="sourceLine" id="cb1104-2" data-line-number="2">fit12<span class="fl">.17</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.17</span>, <span class="st">&quot;waic&quot;</span>)  <span class="co"># 1.901613 hours</span></a>
<a class="sourceLine" id="cb1104-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1104-4" data-line-number="4"><span class="kw">loo_compare</span>(fit12<span class="fl">.16</span>, fit12<span class="fl">.17</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit12.17     0.0       0.0 -2075.6      86.0          6.0     0.4    4151.3   171.9
## fit12.16   -12.1       5.0 -2087.7      86.4          5.0     0.4    4175.5   172.8</code></pre>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1106-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.16</span>, fit12<span class="fl">.17</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.16 fit12.17 
##        0        1</code></pre>
<p>Based on both the WAIC difference and the WAIC weights, <code>fit12.17</code> is the clear favorite. From that model, Here’s a plot of the antilogged (i.e., exponentiated) posteriors for <code>pd</code> and <code>female</code>, which yields their odds ratios.</p>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1108-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.17</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1108-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(b_pd<span class="op">:</span>b_female) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1108-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1108-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb1108-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span>, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1108-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>), <span class="dt">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1108-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1108-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">1.4</span>, <span class="fl">2.4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1108-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-51-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Here is our version of Figure 12.5.</p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1109-1" data-line-number="1">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1109-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">female =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1109-3" data-line-number="3">           <span class="dt">pd     =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(female, pd),</a>
<a class="sourceLine" id="cb1109-5" data-line-number="5">         <span class="dt">age_18 =</span> <span class="dv">-14</span><span class="op">:</span><span class="dv">21</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="dv">18</span>)</a>
<a class="sourceLine" id="cb1109-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb1109-8" data-line-number="8">f &lt;-</a>
<a class="sourceLine" id="cb1109-9" data-line-number="9"><span class="st">  </span><span class="kw">fitted</span>(fit12<span class="fl">.17</span>,</a>
<a class="sourceLine" id="cb1109-10" data-line-number="10">         <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-11" data-line-number="11"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-12" data-line-number="12"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">if_else</span>(female <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>),</a>
<a class="sourceLine" id="cb1109-14" data-line-number="14">         <span class="dt">pd  =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, pd),</a>
<a class="sourceLine" id="cb1109-15" data-line-number="15">                      <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;pd = &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>))) </a>
<a class="sourceLine" id="cb1109-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1109-17" data-line-number="17"><span class="co"># hazard (top panel)</span></a>
<a class="sourceLine" id="cb1109-18" data-line-number="18">p1 &lt;-</a>
<a class="sourceLine" id="cb1109-19" data-line-number="19"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-20" data-line-number="20"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">group =</span> pd, <span class="dt">color =</span> pd, <span class="dt">fill =</span> pd)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb1109-22" data-line-number="22">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-24" data-line-number="24"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">40</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-25" data-line-number="25"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;fitted hazard&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.04</span>))</a>
<a class="sourceLine" id="cb1109-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1109-27" data-line-number="27"><span class="co"># survival (bottom panel)</span></a>
<a class="sourceLine" id="cb1109-28" data-line-number="28">p2 &lt;-</a>
<a class="sourceLine" id="cb1109-29" data-line-number="29"><span class="st">  </span>f <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1109-30" data-line-number="30"><span class="st">  </span><span class="kw">group_by</span>(sex, pd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-31" data-line-number="31"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>), <span class="dt">.funs =</span> <span class="op">~</span><span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-32" data-line-number="32"><span class="st">  </span></a>
<a class="sourceLine" id="cb1109-33" data-line-number="33"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">group =</span> pd, <span class="dt">color =</span> pd, <span class="dt">fill =</span> pd)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-34" data-line-number="34"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-35" data-line-number="35"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb1109-36" data-line-number="36">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-37" data-line-number="37"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-38" data-line-number="38"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">40</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-39" data-line-number="39"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;fitted survival probability&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-40" data-line-number="40"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1109-41" data-line-number="41">        <span class="dt">strip.text.x =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb1109-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1109-43" data-line-number="43"><span class="co"># combine</span></a>
<a class="sourceLine" id="cb1109-44" data-line-number="44">(</a>
<a class="sourceLine" id="cb1109-45" data-line-number="45">  (p1 <span class="op">/</span><span class="st"> </span>p2) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1109-46" data-line-number="46"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1109-47" data-line-number="47"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1109-48" data-line-number="48"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1109-49" data-line-number="49"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sex)</a>
<a class="sourceLine" id="cb1109-50" data-line-number="50">) <span class="op">+</span></a>
<a class="sourceLine" id="cb1109-51" data-line-number="51"><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-52-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Note how with this many <code>age</code> levels, our discrete-time models are beginning to look like continuous-time models.</p>
</div>
<div id="two-caveats-the-problems-of-state-and-rate-dependence." class="section level3">
<h3><span class="header-section-number">12.3.3</span> Two caveats: The problems of state and rate dependence.</h3>
<blockquote>
<p>A time-varying predictor is <em>state-dependent</em> if its values at time <span class="math inline">\(t_j\)</span> are affected by an individual’s <em>state</em> (event occurrence status) at time <span class="math inline">\(t_j\)</span>: <span class="math inline">\(EVENT_{ij}\)</span>. A time-varying predictor is <em>rate-dependent</em> if its values at time <span class="math inline">\(t_j\)</span> are affected by the individuals value of <em>hazard</em> (the “rate”) at time <span class="math inline">\(t_j\)</span>: <span class="math inline">\(h (t_{ij})\)</span>. (p. 440, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
</div>
<div id="the-linear-additivity-assumption-uncovering-violations-and-simple-solutions" class="section level2">
<h2><span class="header-section-number">12.4</span> The linear additivity assumption: Uncovering violations and simple solutions</h2>
<blockquote>
<p>Because the focus on hazard causes you to analyze group level summaries, model violations can be more difficult to discern [than in other kinds of regression models]. We therefore devote this section to introducing practical strategies for diagnosing and correcting violations of the linear additivity assumption. (p. 443)</p>
</blockquote>
<div id="interactions-between-substantive-predictors." class="section level3">
<h3><span class="header-section-number">12.4.1</span> Interactions between substantive predictors.</h3>
<blockquote>
<p>We do not advocate fishing expeditions. Open searches for interactions can be counterproductive, leading to the discovery of many “effects” that are little more than sampling variation. But there <em>are</em> at least two circumstances when a guided search for interactions is crucial:</p>
<ul>
<li><em>When theory (or common sense!) suggests that two (or more) predictors will interact in the prediction of the outcome</em>. If you hypothesize the existence of interactions a priori, your search will be targeted and efficient.</li>
<li><em>When examining the effects of “question” predictor(s), variables whose effects you intend to emphasize in your report</em>. You need to be certain that these predictors’ effects do not differ according ot levels of other important predictors, lest you misinterpret your major findings.</li>
</ul>
<p>With this in mind, we now demonstrate how to (1) explore your data for the possibility of statistical interactions; and (2) include the additional appropriate terms when necessary. (p. 444, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Load the data from Keiley and Martin (2002)<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1110-1" data-line-number="1">firstarrest_pp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1110-2" data-line-number="2"><span class="st">  </span><span class="kw">read_csv</span>(<span class="st">&quot;data/firstarrest_pp.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1110-3" data-line-number="3"><span class="st">  </span><span class="co"># convert the column names to lower case</span></a>
<a class="sourceLine" id="cb1110-4" data-line-number="4"><span class="st">  </span><span class="kw">rename_all</span>(tolower)</a>
<a class="sourceLine" id="cb1110-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1110-6" data-line-number="6"><span class="kw">glimpse</span>(firstarrest_pp)</a></code></pre></div>
<pre><code>## Rows: 15,834
## Columns: 19
## $ id     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4,…
## $ time   &lt;dbl&gt; 15, 15, 15, 15, 15, 15, 15, 15, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 17, 17, 17, 17, …
## $ censor &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,…
## $ abused &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,…
## $ black  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ ablack &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ d8     &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0,…
## $ d9     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,…
## $ d10    &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ d11    &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ d12    &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,…
## $ d13    &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ d14    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ d15    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,…
## $ d16    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,…
## $ d17    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…
## $ d18    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ period &lt;dbl&gt; 8, 9, 10, 11, 12, 13, 14, 15, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 8, 9, 10, 11, 12, 13…
## $ event  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…</code></pre>
<p>The total <span class="math inline">\(N\)</span> is 1553.</p>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1112-1" data-line-number="1">firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1112-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1112-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1  1553</code></pre>
<p><span class="math inline">\(n = 887\)</span> were abused.</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1114-1" data-line-number="1">firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1114-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(abused <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1114-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1114-4" data-line-number="4"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   887</code></pre>
<p><span class="math inline">\(n = 342\)</span> were arrested between the ages of 8 and 18.</p>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1116-1" data-line-number="1">firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1116-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(censor <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1116-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1116-4" data-line-number="4"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   342</code></pre>
<p>Since the two focal predictors in this section with be <code>black</code> and <code>abused</code>, here are the counts broken down by both.</p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1118-1" data-line-number="1">firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1118-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1118-3" data-line-number="3"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1118-4" data-line-number="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1118-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(black, abused) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1118-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   black abused     n percent
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1     0      0   434    27.9
## 2     0      1   605    39.0
## 3     1      0   232    14.9
## 4     1      1   282    18.2</code></pre>
<p>Here’s how to hand compute the values for the sample logit(hazard) functions depicted in the top panels of Figure 12.6.</p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1120-1" data-line-number="1"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb1120-2" data-line-number="2">firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">event =</span> <span class="kw">if_else</span>(event <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;event&quot;</span>, <span class="st">&quot;no_event&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(period)  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(event, black, abused) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> event,</a>
<a class="sourceLine" id="cb1120-8" data-line-number="8">              <span class="dt">values_from =</span> n) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-9" data-line-number="9"><span class="st">  </span><span class="kw">drop_na</span>(event) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total  =</span> event <span class="op">+</span><span class="st"> </span>no_event,</a>
<a class="sourceLine" id="cb1120-11" data-line-number="11">         <span class="dt">logit  =</span> <span class="kw">log</span>(event <span class="op">/</span><span class="st"> </span>total <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>event <span class="op">/</span><span class="st"> </span>total)),</a>
<a class="sourceLine" id="cb1120-12" data-line-number="12">         <span class="dt">race   =</span> <span class="kw">factor</span>(<span class="kw">ifelse</span>(black <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Black&quot;</span>, <span class="st">&quot;White&quot;</span>),</a>
<a class="sourceLine" id="cb1120-13" data-line-number="13">                         <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;White&quot;</span>, <span class="st">&quot;Black&quot;</span>)),</a>
<a class="sourceLine" id="cb1120-14" data-line-number="14">         <span class="dt">abused =</span> <span class="kw">ifelse</span>(abused <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;abused&quot;</span>, <span class="st">&quot;not abused&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1120-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb1120-16" data-line-number="16"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1120-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> logit)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1120-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> abused, <span class="dt">group =</span> abused)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1120-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1120-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">breaks =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">19</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">19</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1120-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;sample logit(hazard)&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">-2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1120-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1120-23" data-line-number="23"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>race)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-58-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>For kicks and giggles, it might informative to fit a series of subset Bayesian models to make similar versions of those sample hazard functions. Before we fit the models, let’s make our lives easier and make a factor version of our time variable, <code>period</code>.</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1121-1" data-line-number="1">firstarrest_pp &lt;-</a>
<a class="sourceLine" id="cb1121-2" data-line-number="2"><span class="st">  </span>firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1121-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period_f =</span> <span class="kw">factor</span>(period))</a></code></pre></div>
<p>Fit the four subset models.</p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1122-1" data-line-number="1"><span class="co"># white, not abused</span></a>
<a class="sourceLine" id="cb1122-2" data-line-number="2">fit12<span class="fl">.18</span> &lt;-</a>
<a class="sourceLine" id="cb1122-3" data-line-number="3"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(black <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>abused <span class="op">==</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1122-4" data-line-number="4">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1122-5" data-line-number="5">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>period_f,</a>
<a class="sourceLine" id="cb1122-6" data-line-number="6">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1122-7" data-line-number="7">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1122-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1122-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.18&quot;</span>)</a>
<a class="sourceLine" id="cb1122-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1122-11" data-line-number="11"><span class="co"># white, abused</span></a>
<a class="sourceLine" id="cb1122-12" data-line-number="12">fit12<span class="fl">.19</span> &lt;-</a>
<a class="sourceLine" id="cb1122-13" data-line-number="13"><span class="st">  </span><span class="kw">update</span>(fit12<span class="fl">.18</span>,</a>
<a class="sourceLine" id="cb1122-14" data-line-number="14">         <span class="dt">newdata =</span> firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(black <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>abused <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1122-15" data-line-number="15">         <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1122-16" data-line-number="16">         <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1122-17" data-line-number="17">         <span class="dt">file =</span> <span class="st">&quot;fits/fit12.19&quot;</span>)</a>
<a class="sourceLine" id="cb1122-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1122-19" data-line-number="19"><span class="co"># black, not abused</span></a>
<a class="sourceLine" id="cb1122-20" data-line-number="20">fit12<span class="fl">.20</span> &lt;-</a>
<a class="sourceLine" id="cb1122-21" data-line-number="21"><span class="st">  </span><span class="kw">update</span>(fit12<span class="fl">.18</span>,</a>
<a class="sourceLine" id="cb1122-22" data-line-number="22">         <span class="dt">newdata =</span> firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(black <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>abused <span class="op">==</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1122-23" data-line-number="23">         <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1122-24" data-line-number="24">         <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1122-25" data-line-number="25">         <span class="dt">file =</span> <span class="st">&quot;fits/fit12.20&quot;</span>)</a>
<a class="sourceLine" id="cb1122-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1122-27" data-line-number="27"><span class="co"># black, abused</span></a>
<a class="sourceLine" id="cb1122-28" data-line-number="28">fit12<span class="fl">.21</span> &lt;-</a>
<a class="sourceLine" id="cb1122-29" data-line-number="29"><span class="st">  </span><span class="kw">update</span>(fit12<span class="fl">.18</span>,</a>
<a class="sourceLine" id="cb1122-30" data-line-number="30">         <span class="dt">newdata =</span> firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(black <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>abused <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1122-31" data-line-number="31">         <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1122-32" data-line-number="32">         <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1122-33" data-line-number="33">         <span class="dt">file =</span> <span class="st">&quot;fits/fit12.21&quot;</span>)</a></code></pre></div>
<p>We might use <code>fitted()</code> via our custom <code>make_fitted()</code> function to perform some of the pre-plotting computation and wrangling.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1123-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">period_f =</span> <span class="dv">8</span><span class="op">:</span><span class="dv">18</span>)</a>
<a class="sourceLine" id="cb1123-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1123-3" data-line-number="3"><span class="co"># this will simplify the `mutate()` code below</span></a>
<a class="sourceLine" id="cb1123-4" data-line-number="4">models &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;constant&quot;</span>, <span class="st">&quot;linear&quot;</span>, <span class="st">&quot;quadratic&quot;</span>, <span class="st">&quot;cubic&quot;</span>, <span class="st">&quot;general&quot;</span>)</a>
<a class="sourceLine" id="cb1123-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1123-6" data-line-number="6">f &lt;-</a>
<a class="sourceLine" id="cb1123-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">make_fitted</span>(fit12<span class="fl">.18</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),      <span class="co"># white, not abused</span></a>
<a class="sourceLine" id="cb1123-8" data-line-number="8">            <span class="kw">make_fitted</span>(fit12<span class="fl">.19</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),      <span class="co"># white, abused</span></a>
<a class="sourceLine" id="cb1123-9" data-line-number="9">            <span class="kw">make_fitted</span>(fit12<span class="fl">.20</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>),      <span class="co"># black, not abused</span></a>
<a class="sourceLine" id="cb1123-10" data-line-number="10">            <span class="kw">make_fitted</span>(fit12<span class="fl">.21</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># black, abused</span></a>
<a class="sourceLine" id="cb1123-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">race  =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;White&quot;</span>, <span class="st">&quot;Black&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1123-12" data-line-number="12">                        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;White&quot;</span>, <span class="st">&quot;Black&quot;</span>)),</a>
<a class="sourceLine" id="cb1123-13" data-line-number="13">         <span class="dt">abuse =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;not abused&quot;</span>, <span class="st">&quot;abused&quot;</span>, <span class="st">&quot;not abused&quot;</span>, <span class="st">&quot;abused&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">4</span>))</a>
<a class="sourceLine" id="cb1123-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1123-15" data-line-number="15"><span class="co"># what have we done?</span></a>
<a class="sourceLine" id="cb1123-16" data-line-number="16"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 44
## Columns: 7
## $ Estimate  &lt;dbl&gt; -6.128145, -7.755830, -5.423982, -4.486341, -7.810388, -4.115688, -3.844492, -3.036432, -…
## $ Est.Error &lt;dbl&gt; 0.9680716, 1.7239523, 0.7002682, 0.4659827, 1.8007659, 0.3791418, 0.3375237, 0.2284309, 0…
## $ Q2.5      &lt;dbl&gt; -8.365665, -11.947351, -6.983962, -5.506780, -12.087179, -4.930636, -4.552779, -3.508916,…
## $ Q97.5     &lt;dbl&gt; -4.586103, -5.231566, -4.234613, -3.673362, -5.144784, -3.418779, -3.236886, -2.615172, -…
## $ period_f  &lt;int&gt; 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 8, 9,…
## $ race      &lt;fct&gt; White, White, White, White, White, White, White, White, White, White, White, White, White…
## $ abuse     &lt;chr&gt; &quot;not abused&quot;, &quot;not abused&quot;, &quot;not abused&quot;, &quot;not abused&quot;, &quot;not abused&quot;, &quot;not abused&quot;, &quot;not …</code></pre>
<p>Now plot.</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1125-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1125-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period_f, <span class="dt">y =</span> Estimate, <span class="dt">group =</span> abuse, <span class="dt">color =</span> abuse)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1125-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1125-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1125-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">breaks =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">19</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">19</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1125-6" data-line-number="6"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;sample logit(hazard)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1125-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1125-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>race)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-61-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Notice how this looks different from the version of the plot, above, in that there are five points with very low values on the <span class="math inline">\(y\)</span>-axis. Did you notice the <code>drop_na(event)</code> line in the code when we computed the sample logit(hazard) values by hand? Those points with missing values in the data are what caused those very low log(hazard) estimates in the models. Next we’ll fit the primary statistical models with both <code>black</code> and <code>abused</code>, without and with their interaction term, based on the full data set. You’ll see that when we use all cases, those odd low logit(hazard) values go away.</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1126-1" data-line-number="1">fit12<span class="fl">.22</span> &lt;-</a>
<a class="sourceLine" id="cb1126-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> firstarrest_pp,</a>
<a class="sourceLine" id="cb1126-3" data-line-number="3">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1126-4" data-line-number="4">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10  <span class="op">+</span><span class="st"> </span>d11  <span class="op">+</span><span class="st"> </span>d12  <span class="op">+</span><span class="st"> </span>d13  <span class="op">+</span><span class="st"> </span>d14  <span class="op">+</span><span class="st"> </span>d15  <span class="op">+</span><span class="st"> </span>d16  <span class="op">+</span><span class="st"> </span>d17  <span class="op">+</span><span class="st"> </span>d18 <span class="op">+</span><span class="st"> </span>abused <span class="op">+</span><span class="st"> </span>black,</a>
<a class="sourceLine" id="cb1126-5" data-line-number="5">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1126-6" data-line-number="6">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1126-7" data-line-number="7">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1126-8" data-line-number="8">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.22&quot;</span>)</a>
<a class="sourceLine" id="cb1126-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1126-10" data-line-number="10">fit12<span class="fl">.23</span> &lt;-</a>
<a class="sourceLine" id="cb1126-11" data-line-number="11"><span class="st">  </span><span class="kw">update</span>(fit12<span class="fl">.22</span>,</a>
<a class="sourceLine" id="cb1126-12" data-line-number="12">         <span class="dt">newdata =</span> firstarrest_pp,</a>
<a class="sourceLine" id="cb1126-13" data-line-number="13">         event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10  <span class="op">+</span><span class="st"> </span>d11  <span class="op">+</span><span class="st"> </span>d12  <span class="op">+</span><span class="st"> </span>d13  <span class="op">+</span><span class="st"> </span>d14  <span class="op">+</span><span class="st"> </span>d15  <span class="op">+</span><span class="st"> </span>d16  <span class="op">+</span><span class="st"> </span>d17  <span class="op">+</span><span class="st"> </span>d18 <span class="op">+</span><span class="st"> </span>abused <span class="op">+</span><span class="st"> </span>black <span class="op">+</span><span class="st"> </span>abused<span class="op">:</span>black,</a>
<a class="sourceLine" id="cb1126-14" data-line-number="14">         <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1126-15" data-line-number="15">         <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1126-16" data-line-number="16">         <span class="dt">file =</span> <span class="st">&quot;fits/fit12.23&quot;</span>)</a></code></pre></div>
<p>Let’s compare the models with information criteria. Not unlike with <code>fit12.16</code> and <code>fit12.17</code>, these are big models for a big data set and it took about an hour on my 2012-era laptop to return the WAIC. The LOO would likely have taken longer. Proceed with caution.</p>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1127-1" data-line-number="1">fit12<span class="fl">.22</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.22</span>, <span class="st">&quot;waic&quot;</span>)  <span class="co"># 48.72123 mins</span></a>
<a class="sourceLine" id="cb1127-2" data-line-number="2">fit12<span class="fl">.23</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.23</span>, <span class="st">&quot;waic&quot;</span>)  <span class="co"># 13.57897 mins</span></a>
<a class="sourceLine" id="cb1127-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1127-4" data-line-number="4"><span class="kw">loo_compare</span>(fit12<span class="fl">.22</span>, fit12<span class="fl">.23</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit12.23     0.0       0.0 -1538.9      65.4         14.1     1.1    3077.8   130.7
## fit12.22    -0.8       2.2 -1539.7      65.3         12.9     1.0    3079.4   130.6</code></pre>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1129-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.22</span>, fit12<span class="fl">.23</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.22 fit12.23 
##    0.314    0.686</code></pre>
<p>Our results diverge a bit from those in the text. For the deviance test on page 446, Singer and Willett reported a difference of <span class="math inline">\(4.05 \; (p &lt; .05, df = 1)\)</span> in favor of the full model (i.e., <code>fit12.23</code>). Though both our WAIC difference score and the WAIC weights favor <code>fit12.23</code>, it’s by a hair.</p>
<p>“As in linear (or logistic) regression, we interpret interaction effects by simultaneously considering <em>all</em> the constituent parameters, for the cross-product term and its main-effect components” (p. 446, <em>emphasis</em> in the original). Rather than the point-estimate table Singer and Willett displayed at the bottom of the page, we’ll present the full posterior distributions odds ratios in a faceted plot.</p>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1131-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.23</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1131-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1131-3" data-line-number="3"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, b_abused, b_black, <span class="st">`</span><span class="dt">b_abused:black</span><span class="st">`</span>),</a>
<a class="sourceLine" id="cb1131-4" data-line-number="4">         <span class="dt">abused =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1131-5" data-line-number="5">         <span class="dt">black  =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1131-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(b_abused <span class="op">*</span><span class="st"> </span>abused <span class="op">+</span><span class="st"> </span>b_black <span class="op">*</span><span class="st"> </span>black  <span class="op">+</span><span class="st"> `</span><span class="dt">b_abused:black</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span>abused <span class="op">*</span><span class="st"> </span>black),</a>
<a class="sourceLine" id="cb1131-7" data-line-number="7">         <span class="dt">abused       =</span> <span class="kw">str_c</span>(<span class="st">&quot;abused = &quot;</span>, abused),</a>
<a class="sourceLine" id="cb1131-8" data-line-number="8">         <span class="dt">black        =</span> <span class="kw">str_c</span>(<span class="st">&quot;black = &quot;</span>, black)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1131-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1131-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span>, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_grid</span>(abused<span class="op">~</span>black)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-63-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here’s our version of the lower panel of Figure 12.6.</p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1132-1" data-line-number="1"><span class="co"># define the `newdata`</span></a>
<a class="sourceLine" id="cb1132-2" data-line-number="2">nd &lt;-</a>
<a class="sourceLine" id="cb1132-3" data-line-number="3"><span class="st">  </span>firstarrest_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1132-4" data-line-number="4"><span class="st">  </span><span class="kw">distinct</span>(abused, black, d8, d9, d10, d11, d12, d13, d14, d15, d16, d17, d18, period)</a>
<a class="sourceLine" id="cb1132-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1132-6" data-line-number="6"><span class="co"># use `fitted()` and wrangle</span></a>
<a class="sourceLine" id="cb1132-7" data-line-number="7"><span class="kw">make_fitted</span>(fit12<span class="fl">.23</span>,</a>
<a class="sourceLine" id="cb1132-8" data-line-number="8">            <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1132-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1132-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">abused =</span> <span class="kw">ifelse</span>(abused <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;abused&quot;</span>, <span class="st">&quot;not abused&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>(),</a>
<a class="sourceLine" id="cb1132-11" data-line-number="11">         <span class="dt">sex    =</span> <span class="kw">factor</span>(<span class="kw">ifelse</span>(black <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Black&quot;</span>, <span class="st">&quot;White&quot;</span>),</a>
<a class="sourceLine" id="cb1132-12" data-line-number="12">                         <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;White&quot;</span>, <span class="st">&quot;Black&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1132-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb1132-14" data-line-number="14"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1132-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1132-16" data-line-number="16">             <span class="dt">fill =</span> abused, <span class="dt">color =</span> abused)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">breaks =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">19</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">19</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-22" data-line-number="22"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;fitted logit(hazard)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-23" data-line-number="23"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">8</span>, <span class="dv">-2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-24" data-line-number="24"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1132-25" data-line-number="25"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sex)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-64-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="nonlinear-effects." class="section level3">
<h3><span class="header-section-number">12.4.2</span> Nonlinear effects.</h3>
<blockquote>
<p>There are two general strategies for exploring the linearity assumption. The simplest approach–although somewhat limited–is to fit additional models, replacing the raw predictor with a re-expressed version. Although the additional models also invoke a linearity constraint, use of re-expressed predictors guarantees that the effects represent nonlinear relationships for the <em>raw</em> predictors. The ladder of power (section 6.2.1) provides a dizzying array of options. The second approach is to categorize each continuous variable into a small number of groups, create a series of dummy variables representing group membership, and visually examine the <em>pattern of parameter estimates for consecutive dummies</em> to deduce the appropriate functional form. If the pattern is linear, retain the predictor in its raw state; if not, explore an alternative specification.</p>
<p>As the first approach is straightforward, we illustrate the second, using the depression onset data presented in section 12.3. (pp. 447–448, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Here’s another look at those <code>depression_pp</code> data.</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1133-1" data-line-number="1">depression_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1133-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 36,997
## Columns: 22
## $ id        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ onset     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ age       &lt;dbl&gt; 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 3…
## $ censor    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ censage   &lt;dbl&gt; 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 3…
## $ aged      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ female    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ nsibs     &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,…
## $ sibs12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ sibs34    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ sibs56    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ sibs78    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ sibs9plus &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ bigfamily &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ period    &lt;dbl&gt; 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,…
## $ event     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pd        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pdnow     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ one       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ age_18    &lt;dbl&gt; -14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9…
## $ age_18sq  &lt;dbl&gt; 196, 169, 144, 121, 100, 81, 64, 49, 36, 25, 16, 9, 4, 1, 0, 1, 4, 9, 16, 25, 36, 49, 64,…
## $ age_18cub &lt;dbl&gt; -2744, -2197, -1728, -1331, -1000, -729, -512, -343, -216, -125, -64, -27, -8, -1, 0, 1, …</code></pre>
<p>Our three models will be cubic with respect to our time variable, <code>age_18</code>. The focal predictor whose form (non)linear form we’re interested in is <code>nsibs</code>. Singer and Willett’s first model, Model A (see Table 12.4, p. 449), treated <code>nsibs</code> as linear. Fit the model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1135-1" data-line-number="1"><span class="co"># model a (linear)  </span></a>
<a class="sourceLine" id="cb1135-2" data-line-number="2"><span class="co"># 3.409222 hours</span></a>
<a class="sourceLine" id="cb1135-3" data-line-number="3">fit12<span class="fl">.24</span> &lt;-</a>
<a class="sourceLine" id="cb1135-4" data-line-number="4"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> depression_pp,</a>
<a class="sourceLine" id="cb1135-5" data-line-number="5">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1135-6" data-line-number="6">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>pd <span class="op">+</span><span class="st"> </span>female <span class="op">+</span><span class="st"> </span>nsibs,</a>
<a class="sourceLine" id="cb1135-7" data-line-number="7">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1135-8" data-line-number="8">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1135-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1135-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.24&quot;</span>)</a></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1136-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.24</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + Intercept + age_18 + I(age_18^2) + I(age_18^3) + pd + female + nsibs 
##    Data: depression_pp (Number of observations: 36997) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -4.35      0.12    -4.59    -4.12 1.00     2270     2430
## age_18        0.06      0.01     0.04     0.08 1.00     2415     2116
## Iage_18E2    -0.01      0.00    -0.01    -0.01 1.00     4695     3220
## Iage_18E3     0.00      0.00     0.00     0.00 1.00     3366     3561
## pd            0.36      0.17     0.03     0.67 1.00     2050     1765
## female        0.56      0.11     0.35     0.77 1.00     2711     2497
## nsibs        -0.08      0.02    -0.12    -0.04 1.00     2811     2330
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we invert the antilog of <code>nsibs</code> and summarize the posterior with <code>median_qi()</code>.</p>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1138-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.24</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1138-2" data-line-number="2"><span class="st">  </span><span class="kw">median_qi</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(b_nsibs)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1138-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   1/exp(b_nsibs) .lower .upper .width .point .interval
## 1          1.087  1.044  1.133   0.95 median        qi</code></pre>
<p>Singer and Willett described <code>nsibs</code> as “highly skewed” (p. 448). Let’s take a look.</p>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1140-1" data-line-number="1">depression_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1140-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1140-3" data-line-number="3"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1140-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb1140-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> nsibs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1140-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1140-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-69-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Yep, sure is. Here’s a way to save Singer and Willette’s discretized version of <code>nsibs</code> and then break the cases down in terms of <span class="math inline">\(n\)</span> and percentage, which matches nicely with the numbers at the bottom of page 449.</p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1141-1" data-line-number="1">depression_pp &lt;-</a>
<a class="sourceLine" id="cb1141-2" data-line-number="2"><span class="st">  </span>depression_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1141-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">nsibs_cat =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb1141-4" data-line-number="4">    nsibs <span class="op">==</span><span class="st"> </span><span class="dv">0</span>         <span class="op">~</span><span class="st"> &quot;0&quot;</span>,</a>
<a class="sourceLine" id="cb1141-5" data-line-number="5">    nsibs <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">~</span><span class="st"> &quot;1 or 2&quot;</span>,</a>
<a class="sourceLine" id="cb1141-6" data-line-number="6">    nsibs <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="op">~</span><span class="st"> &quot;3 or 4&quot;</span>,</a>
<a class="sourceLine" id="cb1141-7" data-line-number="7">    nsibs <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>) <span class="op">~</span><span class="st"> &quot;5 or 6&quot;</span>,</a>
<a class="sourceLine" id="cb1141-8" data-line-number="8">    nsibs <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>) <span class="op">~</span><span class="st"> &quot;7 or 8&quot;</span>,</a>
<a class="sourceLine" id="cb1141-9" data-line-number="9">    nsibs <span class="op">&gt;=</span><span class="st"> </span><span class="dv">9</span>         <span class="op">~</span><span class="st"> &quot;9 or more&quot;</span></a>
<a class="sourceLine" id="cb1141-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb1141-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb1141-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1141-13" data-line-number="13">depression_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1141-14" data-line-number="14"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1141-15" data-line-number="15"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1141-16" data-line-number="16"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1141-17" data-line-number="17"><span class="st">  </span><span class="kw">count</span>(nsibs_cat) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1141-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">1</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   nsibs_cat     n percent
##   &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;
## 1 0            98     7  
## 2 1 or 2      672    48.2
## 3 3 or 4      330    23.7
## 4 5 or 6      159    11.4
## 5 7 or 8       72     5.2
## 6 9 or more    62     4.5</code></pre>
<p>Now fit our version of Model B, in which we replace the original linear predictor <code>nsibs</code> with a series of dummies: <code>sibs12</code>, <code>sibs34</code>,…, <code>sibs9plus</code>.</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1143-1" data-line-number="1"><span class="co"># model b (nonlinear)  </span></a>
<a class="sourceLine" id="cb1143-2" data-line-number="2"><span class="co"># about 5 hours</span></a>
<a class="sourceLine" id="cb1143-3" data-line-number="3">fit12<span class="fl">.25</span> &lt;-</a>
<a class="sourceLine" id="cb1143-4" data-line-number="4"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> depression_pp,</a>
<a class="sourceLine" id="cb1143-5" data-line-number="5">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1143-6" data-line-number="6">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>pd <span class="op">+</span><span class="st"> </span>female <span class="op">+</span><span class="st"> </span>sibs12 <span class="op">+</span><span class="st"> </span>sibs34 <span class="op">+</span><span class="st"> </span>sibs56 <span class="op">+</span><span class="st"> </span>sibs78 <span class="op">+</span><span class="st"> </span>sibs9plus,</a>
<a class="sourceLine" id="cb1143-7" data-line-number="7">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1143-8" data-line-number="8">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1143-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1143-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.25&quot;</span>)</a></code></pre></div>
<p>Here’s the model summary.</p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1144-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.25</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + Intercept + age_18 + I(age_18^2) + I(age_18^3) + pd + female + sibs12 + sibs34 + sibs56 + sibs78 + sibs9plus 
##    Data: depression_pp (Number of observations: 36997) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -4.52      0.21    -4.93    -4.13 1.00     1181     1587
## age_18        0.06      0.01     0.04     0.08 1.00     2925     2270
## Iage_18E2    -0.01      0.00    -0.01    -0.01 1.00     5508     2807
## Iage_18E3     0.00      0.00     0.00     0.00 1.00     3698     3619
## pd            0.36      0.16     0.03     0.66 1.00     2996     2466
## female        0.56      0.11     0.35     0.77 1.00     3005     2586
## sibs12        0.04      0.20    -0.35     0.42 1.00     1171     1745
## sibs34        0.03      0.21    -0.39     0.44 1.00     1208     1727
## sibs56       -0.49      0.26    -1.02     0.01 1.00     1334     1720
## sibs78       -0.78      0.34    -1.46    -0.13 1.00     1251     1877
## sibs9plus    -0.68      0.35    -1.39    -0.03 1.00     1642     2049
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>It might be easier to compare the various <code>sibs*</code> coefficients with a coefficient plot.</p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1146-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.25</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1146-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot;sibs&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1146-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1146-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb1146-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1146-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_intervalh</span>(<span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.5</span>, <span class="fl">.9</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1146-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_color_grey</span>(<span class="st">&quot;CI level:&quot;</span>, <span class="dt">start =</span> <span class="fl">.8</span>, <span class="dt">end =</span> <span class="fl">.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1146-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;sibs coeficients&quot;</span>,</a>
<a class="sourceLine" id="cb1146-9" data-line-number="9">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1146-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1146-11" data-line-number="11">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1146-12" data-line-number="12">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-72-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here is the breakdown by <code>bigfamily</code>.</p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1147-1" data-line-number="1">depression_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1147-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1147-3" data-line-number="3"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1147-4" data-line-number="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1147-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(bigfamily) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1147-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   bigfamily     n percent
##       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1         0  1100    79.0
## 2         1   293    21.0</code></pre>
<p>Now fit our version of Model C, the dichotomized <code>bigfamily</code> model.</p>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1149-1" data-line-number="1"><span class="co"># model c (dichotomized)  </span></a>
<a class="sourceLine" id="cb1149-2" data-line-number="2"><span class="co"># 3.736503 hours</span></a>
<a class="sourceLine" id="cb1149-3" data-line-number="3">fit12<span class="fl">.26</span> &lt;-</a>
<a class="sourceLine" id="cb1149-4" data-line-number="4"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> depression_pp,</a>
<a class="sourceLine" id="cb1149-5" data-line-number="5">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1149-6" data-line-number="6">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">18</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_<span class="dv">18</span><span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>pd <span class="op">+</span><span class="st"> </span>female <span class="op">+</span><span class="st"> </span>bigfamily,</a>
<a class="sourceLine" id="cb1149-7" data-line-number="7">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1149-8" data-line-number="8">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1149-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1149-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.26&quot;</span>)</a></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1150-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.26</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + Intercept + age_18 + I(age_18^2) + I(age_18^3) + pd + female + bigfamily 
##    Data: depression_pp (Number of observations: 36997) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -4.48      0.11    -4.69    -4.27 1.00     2079     2323
## age_18        0.06      0.01     0.04     0.08 1.00     2889     2518
## Iage_18E2    -0.01      0.00    -0.01    -0.01 1.00     4086     3129
## Iage_18E3     0.00      0.00     0.00     0.00 1.00     3344     3179
## pd            0.35      0.16     0.04     0.66 1.00     2055     2071
## female        0.56      0.11     0.35     0.77 1.00     2147     2338
## bigfamily    -0.62      0.14    -0.91    -0.34 1.00     2823     2254
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The summaries look very similar to the values in the rightmost column of Table 12.4 in the text. Here is a look at the antilog of our <code>bigfamily</code> coefficient.</p>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1152-1" data-line-number="1"><span class="co"># just to make the x-axis pretty</span></a>
<a class="sourceLine" id="cb1152-2" data-line-number="2">breaks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">exp</span>(<span class="kw">fixef</span>(fit12<span class="fl">.26</span>)[<span class="st">&quot;bigfamily&quot;</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)]), <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.vector</span>()</a>
<a class="sourceLine" id="cb1152-3" data-line-number="3">labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">exp</span>(<span class="kw">fixef</span>(fit12<span class="fl">.26</span>)[<span class="st">&quot;bigfamily&quot;</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)]), <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.vector</span>()</a>
<a class="sourceLine" id="cb1152-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1152-5" data-line-number="5"><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1152-6" data-line-number="6"><span class="kw">posterior_samples</span>(fit12<span class="fl">.26</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1152-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">exp</span>(b_bigfamily), <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1152-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1152-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1152-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;bigfamily odds ratio&quot;</span>, <span class="dt">breaks =</span> breaks, <span class="dt">labels =</span> labels) <span class="op">+</span></a>
<a class="sourceLine" id="cb1152-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1152-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-75-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Now compute the WAIC estimates for <code>fit12.24</code> through <code>fit12.26</code> and compare them by their WAIC differences and WAIC weights.</p>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1153-1" data-line-number="1">fit12<span class="fl">.24</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.24</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)  <span class="co"># 1.524841 hours</span></a>
<a class="sourceLine" id="cb1153-2" data-line-number="2">fit12<span class="fl">.25</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.25</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)  <span class="co"># 1.285394 hours</span></a>
<a class="sourceLine" id="cb1153-3" data-line-number="3">fit12<span class="fl">.26</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.26</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)  <span class="co"># 1.741655 hours</span></a>
<a class="sourceLine" id="cb1153-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1153-5" data-line-number="5"><span class="kw">loo_compare</span>(fit12<span class="fl">.24</span>, fit12<span class="fl">.25</span>, fit12<span class="fl">.26</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit12.26     0.0       0.0 -2066.3      85.7          6.8     0.5    4132.5   171.3
## fit12.24    -2.9       2.9 -2069.2      85.8          7.1     0.5    4138.4   171.5
## fit12.25    -3.6       1.1 -2069.9      85.8         10.8     0.7    4139.8   171.7</code></pre>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1155-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.24</span>, fit12<span class="fl">.25</span>, fit12<span class="fl">.26</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.24 fit12.25 fit12.26 
##    0.049    0.025    0.926</code></pre>
<p>Our WAIC estimates are very similar to the AIC estimates presented in Table 12.4. By both the differences and the weights, <code>fit12.16</code> (Model C) is the best among the three. Though its rank is decisive with the weights, it’s less impressive if you compare the <code>se_diff</code> values with the <code>elpd_diff</code> values. Those suggest there’s a lot of uncertainty in our WAIC differences.</p>
</div>
</div>
<div id="the-proportionality-assumption-uncovering-violations-and-simple-solutions" class="section level2">
<h2><span class="header-section-number">12.5</span> The proportionality assumption: Uncovering violations and simple solutions</h2>
<blockquote>
<p>All the discrete hazard models postulated so far invoke another common, but restrictive assumption: that each predictor has an identical effect in every time period under study. This constraint, known as the <em>proportionality assumption</em>, stipulates that a predictor’s effect does not depend on the respondent’s duration in the initial state….</p>
<p>Yet is it not possible, even likely, that the effects of some predictors will <em>vary</em> over time? (p. 451, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="discrete-time-hazard-models-that-do-not-invoke-a-proportionality-assumption." class="section level3">
<h3><span class="header-section-number">12.5.1</span> Discrete-time hazard models that do not invoke a proportionality assumption.</h3>
<p>“There are dozens of ways of violating the proportionality assumption” (p. 452). We see three such examples in panels B through D in Figure 12.7. Here’s our version of the plot.</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1157-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1157-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">z =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1157-3" data-line-number="3">           <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="fl">-2.1</span> <span class="op">+</span><span class="st"> </span><span class="fl">-0.2</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="fl">1.1</span> <span class="op">*</span><span class="st"> </span>z,</a>
<a class="sourceLine" id="cb1157-5" data-line-number="5">         <span class="dt">z =</span> <span class="kw">factor</span>(z)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1157-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1157-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">size =</span> z))</a>
<a class="sourceLine" id="cb1157-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1157-10" data-line-number="10">p2 &lt;-</a>
<a class="sourceLine" id="cb1157-11" data-line-number="11"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">z =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1157-12" data-line-number="12">           <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="fl">-4.8</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.28</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span>z <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span> <span class="op">*</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>z,</a>
<a class="sourceLine" id="cb1157-14" data-line-number="14">         <span class="dt">z =</span> <span class="kw">factor</span>(z)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb1157-16" data-line-number="16"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1157-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">size =</span> z))</a>
<a class="sourceLine" id="cb1157-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1157-19" data-line-number="19">p3 &lt;-</a>
<a class="sourceLine" id="cb1157-20" data-line-number="20"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">z =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1157-21" data-line-number="21">           <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-22" data-line-number="22"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="fl">-4.8</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="fl">4.3</span> <span class="op">*</span><span class="st"> </span>z <span class="op">+</span><span class="st"> </span><span class="fl">-0.5</span> <span class="op">*</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>z,</a>
<a class="sourceLine" id="cb1157-23" data-line-number="23">         <span class="dt">z =</span> <span class="kw">factor</span>(z)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1157-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1157-25" data-line-number="25"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1157-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">size =</span> z))</a>
<a class="sourceLine" id="cb1157-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1157-28" data-line-number="28">p4 &lt;-</a>
<a class="sourceLine" id="cb1157-29" data-line-number="29"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">z1 =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1157-30" data-line-number="30">           <span class="dt">x  =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-31" data-line-number="31"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">z2 =</span> <span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1157-32" data-line-number="32">         <span class="dt">y  =</span> <span class="fl">-2.8</span> <span class="op">+</span><span class="st"> </span><span class="fl">-0.2</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="fl">1.8</span> <span class="op">*</span><span class="st"> </span>z1 <span class="op">+</span><span class="st"> </span><span class="fl">-1.4</span> <span class="op">*</span><span class="st"> </span>z1 <span class="op">*</span><span class="st"> </span>z2,</a>
<a class="sourceLine" id="cb1157-33" data-line-number="33">         <span class="dt">z1 =</span> <span class="kw">factor</span>(z1)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-34" data-line-number="34"><span class="st">  </span></a>
<a class="sourceLine" id="cb1157-35" data-line-number="35"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1157-36" data-line-number="36"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">size =</span> z1))</a>
<a class="sourceLine" id="cb1157-37" data-line-number="37"></a>
<a class="sourceLine" id="cb1157-38" data-line-number="38"><span class="co"># combine</span></a>
<a class="sourceLine" id="cb1157-39" data-line-number="39">(</a>
<a class="sourceLine" id="cb1157-40" data-line-number="40">  (p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span>p4) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1157-41" data-line-number="41"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;A&quot;</span>) </a>
<a class="sourceLine" id="cb1157-42" data-line-number="42">) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1157-43" data-line-number="43"><span class="st">  </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1157-44" data-line-number="44"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;time period&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">8</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1157-45" data-line-number="45"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;logit hazard&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="fl">-0.5</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1157-46" data-line-number="46"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1157-47" data-line-number="47">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-77-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In case is wasn’t clear, I just winged it on the equations for the <code>y</code> values in each subplot. If you’d like to annotate the subplots with the arrows and <span class="math inline">\(\beta\)</span> labels as depicted in the original Figure 12.7, consider it a homework exercise.</p>
</div>
<div id="investigating-the-proportionality-assumption-in-practice." class="section level3">
<h3><span class="header-section-number">12.5.2</span> Investigating the proportionality assumption in practice.</h3>
<p>Load the data from <a href="https://scholar.google.com/scholar?cluster=10047024316925658696&amp;hl=en&amp;oi=scholarr">Graham’s (1997) dissertation</a>.</p>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1158-1" data-line-number="1">mathdropout_pp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1158-2" data-line-number="2"><span class="st">  </span><span class="kw">read_csv</span>(<span class="st">&quot;data/mathdropout_pp.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1158-3" data-line-number="3"><span class="st">  </span><span class="co"># convert the column names to lower case</span></a>
<a class="sourceLine" id="cb1158-4" data-line-number="4"><span class="st">  </span><span class="kw">rename_all</span>(tolower)</a>
<a class="sourceLine" id="cb1158-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1158-6" data-line-number="6"><span class="kw">glimpse</span>(mathdropout_pp)</a></code></pre></div>
<pre><code>## Rows: 9,558
## Columns: 19
## $ id     &lt;dbl&gt; 201303, 201303, 201304, 201304, 201304, 201305, 201305, 201311, 201311, 201311, 201311, 2013…
## $ lastpd &lt;dbl&gt; 2, 2, 3, 3, 3, 2, 2, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 3, 3, 3, 1, 5, 5, 5, 5, 5, 2, 2, 3, 3, 3,…
## $ female &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ censor &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1,…
## $ one    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ hs11   &lt;dbl&gt; 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0,…
## $ hs12   &lt;dbl&gt; 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0,…
## $ coll1  &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,…
## $ coll2  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ coll3  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ fhs11  &lt;dbl&gt; 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0,…
## $ fhs12  &lt;dbl&gt; 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0,…
## $ fcoll1 &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,…
## $ fcoll2 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ fcoll3 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ period &lt;dbl&gt; 1, 2, 1, 2, 3, 1, 2, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 1, 1, 2, 3, 4, 5, 1, 2, 1, 2, 3,…
## $ event  &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0,…
## $ ltime  &lt;dbl&gt; 0, 1, 0, 1, 2, 0, 1, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 0, 0, 1, 2, 3, 4, 0, 1, 0, 1, 2,…
## $ fltime &lt;dbl&gt; 0, 1, 0, 1, 2, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 1, 2, 3, 4, 0, 1, 0, 1, 2,…</code></pre>
<p>The data are composed of <span class="math inline">\(n = 3790\)</span> high school students.</p>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1160-1" data-line-number="1">mathdropout_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1  3790</code></pre>
<p>Here is the division by <code>female</code>.</p>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1162-1" data-line-number="1">mathdropout_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1162-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(id, female) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1162-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(female) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1162-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   female     n percent
##    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1      0  1875    49.5
## 2      1  1915    50.5</code></pre>
<p>Singer and Willett also wrote: “only 93 men and 39 women took a mathematics class in each of the next five terms” (p. 456). I think this is a typo. Here’s the break down by <code>censor</code> and <code>female</code> at the fifth time period (<code>period == 5</code>).</p>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1164-1" data-line-number="1">mathdropout_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1164-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(period <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1164-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(censor, female)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   censor female     n
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
## 1      0      0    39
## 2      0      1    39
## 3      1      0    93
## 4      1      1    51</code></pre>
<p>Fitting the three models displayed in Table 12.5 is a mild extension from our previous models. From a <code>brm()</code> perspective, there’s nothing new, here.</p>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1166-1" data-line-number="1">fit12<span class="fl">.27</span> &lt;-</a>
<a class="sourceLine" id="cb1166-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> mathdropout_pp,</a>
<a class="sourceLine" id="cb1166-3" data-line-number="3">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1166-4" data-line-number="4">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>hs11 <span class="op">+</span><span class="st"> </span>hs12 <span class="op">+</span><span class="st"> </span>coll1 <span class="op">+</span><span class="st"> </span>coll2 <span class="op">+</span><span class="st"> </span>coll3 <span class="op">+</span><span class="st"> </span>female,</a>
<a class="sourceLine" id="cb1166-5" data-line-number="5">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1166-6" data-line-number="6">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1166-7" data-line-number="7">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1166-8" data-line-number="8">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.27&quot;</span>)</a>
<a class="sourceLine" id="cb1166-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1166-10" data-line-number="10">fit12<span class="fl">.28</span> &lt;-</a>
<a class="sourceLine" id="cb1166-11" data-line-number="11"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> mathdropout_pp,</a>
<a class="sourceLine" id="cb1166-12" data-line-number="12">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1166-13" data-line-number="13">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>hs11 <span class="op">+</span><span class="st"> </span>hs12 <span class="op">+</span><span class="st"> </span>coll1 <span class="op">+</span><span class="st"> </span>coll2 <span class="op">+</span><span class="st"> </span>coll3 <span class="op">+</span><span class="st"> </span>fhs11 <span class="op">+</span><span class="st"> </span>fhs12 <span class="op">+</span><span class="st"> </span>fcoll1 <span class="op">+</span><span class="st"> </span>fcoll2 <span class="op">+</span><span class="st"> </span>fcoll3,</a>
<a class="sourceLine" id="cb1166-14" data-line-number="14">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1166-15" data-line-number="15">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1166-16" data-line-number="16">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1166-17" data-line-number="17">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.28&quot;</span>)</a>
<a class="sourceLine" id="cb1166-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1166-19" data-line-number="19">fit12<span class="fl">.29</span> &lt;-</a>
<a class="sourceLine" id="cb1166-20" data-line-number="20"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> mathdropout_pp,</a>
<a class="sourceLine" id="cb1166-21" data-line-number="21">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1166-22" data-line-number="22">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>hs11 <span class="op">+</span><span class="st"> </span>hs12 <span class="op">+</span><span class="st"> </span>coll1 <span class="op">+</span><span class="st"> </span>coll2 <span class="op">+</span><span class="st"> </span>coll3 <span class="op">+</span><span class="st"> </span>female <span class="op">+</span><span class="st"> </span>fltime,</a>
<a class="sourceLine" id="cb1166-23" data-line-number="23">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1166-24" data-line-number="24">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1166-25" data-line-number="25">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1166-26" data-line-number="26">      <span class="dt">file =</span> <span class="st">&quot;fits/fit12.29&quot;</span>)</a></code></pre></div>
<p>Heads up about the <code>formula</code> for <code>fit12.28</code> (Model B). Many of the examples in the text and the corresponding data sets we’ve been working with included pre-computed interaction terms. We have been quietly ignoring those and making our interactions by hand in our <code>formula</code> arguments. Here we went ahead with the text and just used <code>event | trials(1) ~ 0 + hs11 + hs12 + coll1 + coll2 + coll3 + fhs11 + fhs12 + fcoll1 + fcoll2 + fcoll3</code>. If you wanted a more verbose version of that code, we could have specified either</p>
<ul>
<li><code>event | trials(1) ~ 0 + hs11 + hs12 + coll1 + coll2 + coll3 + female:hs11 + female:hs12 + female:coll1 + female:coll2 + female:coll3</code> or</li>
<li><code>event | trials(1) ~ 0 + hs11 + hs12 + coll1 + coll2 + coll3 + female:(hs11 + hs12 + coll1 + coll2 + coll3)</code>.</li>
</ul>
<p>All three return the same results. Anyway, let’s check the model summaries.</p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1167-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.27</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + hs11 + hs12 + coll1 + coll2 + coll3 + female 
##    Data: mathdropout_pp (Number of observations: 9558) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## hs11      -2.13      0.06    -2.25    -2.02 1.00     3632     3041
## hs12      -0.94      0.05    -1.03    -0.85 1.00     3847     3351
## coll1     -1.45      0.06    -1.57    -1.32 1.00     4234     2948
## coll2     -0.62      0.08    -0.77    -0.47 1.00     4774     2821
## coll3     -0.77      0.15    -1.06    -0.49 1.00     5414     3086
## female     0.38      0.05     0.28     0.47 1.00     2812     3040
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1169-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.28</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + hs11 + hs12 + coll1 + coll2 + coll3 + fhs11 + fhs12 + fcoll1 + fcoll2 + fcoll3 
##    Data: mathdropout_pp (Number of observations: 9558) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## hs11      -2.01      0.07    -2.15    -1.88 1.00     4113     2849
## hs12      -0.96      0.06    -1.08    -0.85 1.00     4260     3156
## coll1     -1.48      0.09    -1.66    -1.32 1.00     3919     2829
## coll2     -0.71      0.10    -0.91    -0.52 1.00     4192     2962
## coll3     -0.87      0.19    -1.25    -0.52 1.00     4536     3184
## fhs11      0.16      0.10    -0.04     0.34 1.00     4154     2783
## fhs12      0.42      0.08     0.26     0.57 1.00     4443     3030
## fcoll1     0.44      0.12     0.21     0.67 1.00     3738     2962
## fcoll2     0.58      0.14     0.30     0.86 1.00     3917     3029
## fcoll3     0.60      0.29     0.05     1.18 1.00     4688     3271
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1171-1" data-line-number="1"><span class="kw">print</span>(fit12<span class="fl">.29</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: event | trials(1) ~ 0 + hs11 + hs12 + coll1 + coll2 + coll3 + female + fltime 
##    Data: mathdropout_pp (Number of observations: 9558) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## hs11      -2.05      0.07    -2.18    -1.92 1.00     2788     3029
## hs12      -0.93      0.05    -1.02    -0.83 1.00     3355     2872
## coll1     -1.50      0.06    -1.63    -1.37 1.00     3676     3135
## coll2     -0.72      0.09    -0.89    -0.55 1.00     3556     2766
## coll3     -0.91      0.16    -1.22    -0.61 1.00     3500     2957
## female     0.23      0.08     0.08     0.38 1.00     2275     2578
## fltime     0.12      0.05     0.03     0.21 1.00     2328     2703
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The results are similar to those in Table 12.5. Based on <code>fit12.27</code> (Model A), here is the posterior for the odds ratio for <code>female</code>.</p>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1173-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.27</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1173-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">exp</span>(b_female), <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1173-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1173-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1173-5" data-line-number="5"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;odds ratio for female&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1173-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-83-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>With regard to the interaction terms for <code>fit12.28</code> (Model B), Singer and Willett remarked: “Notice how the estimates rise over time” (p. 457). It might be easiest to observe that in a plot.</p>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1174-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.28</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1174-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_f&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1174-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(<span class="kw">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>),</a>
<a class="sourceLine" id="cb1174-4" data-line-number="4">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="kw">str_c</span>(<span class="st">&quot;fhs&quot;</span>, <span class="dv">11</span><span class="op">:</span><span class="dv">12</span>), <span class="kw">str_c</span>(<span class="st">&quot;fcoll&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1174-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1174-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1174-7" data-line-number="7"><span class="st">  </span><span class="kw">stat_intervalh</span>(<span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.5</span>, <span class="fl">.9</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1174-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_color_grey</span>(<span class="st">&quot;CI level:&quot;</span>, <span class="dt">start =</span> <span class="fl">.8</span>, <span class="dt">end =</span> <span class="fl">.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1174-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;interaction terms&quot;</span>,</a>
<a class="sourceLine" id="cb1174-10" data-line-number="10">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1174-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1174-12" data-line-number="12">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1174-13" data-line-number="13">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-84-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Make and save the subplots for Figure 12.8.</p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1175-1" data-line-number="1"><span class="co"># Within-group sample hazard functions</span></a>
<a class="sourceLine" id="cb1175-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb1175-3" data-line-number="3"><span class="st">  </span>mathdropout_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">event =</span> <span class="kw">if_else</span>(event <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;event&quot;</span>, <span class="st">&quot;no_event&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(period) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(event, female) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-8" data-line-number="8"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> event,</a>
<a class="sourceLine" id="cb1175-9" data-line-number="9">              <span class="dt">values_from =</span> n) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total =</span> event <span class="op">+</span><span class="st"> </span>no_event,</a>
<a class="sourceLine" id="cb1175-11" data-line-number="11">         <span class="dt">logit =</span> <span class="kw">log</span>(event <span class="op">/</span><span class="st"> </span>total <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>event <span class="op">/</span><span class="st"> </span>total))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">female =</span> <span class="kw">factor</span>(female,</a>
<a class="sourceLine" id="cb1175-13" data-line-number="13">                         <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1175-14" data-line-number="14">                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb1175-16" data-line-number="16"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1175-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> logit)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> female),</a>
<a class="sourceLine" id="cb1175-19" data-line-number="19">            <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;sample logit(hazard)&quot;</span>, <span class="dt">breaks =</span> <span class="dv">-2</span><span class="op">:</span><span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-21" data-line-number="21"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Within-group sample hazard functions&quot;</span>)</a>
<a class="sourceLine" id="cb1175-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1175-23" data-line-number="23"><span class="co"># Model A: Main effect of female</span></a>
<a class="sourceLine" id="cb1175-24" data-line-number="24">nd &lt;-</a>
<a class="sourceLine" id="cb1175-25" data-line-number="25"><span class="st">  </span>mathdropout_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-26" data-line-number="26"><span class="st">  </span><span class="kw">distinct</span>(female, period, hs11, hs12, coll1, coll2, coll3)</a>
<a class="sourceLine" id="cb1175-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1175-28" data-line-number="28">p2 &lt;-</a>
<a class="sourceLine" id="cb1175-29" data-line-number="29"><span class="st">  </span><span class="kw">make_fitted</span>(fit12<span class="fl">.27</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-30" data-line-number="30"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">female =</span> <span class="kw">factor</span>(female,</a>
<a class="sourceLine" id="cb1175-31" data-line-number="31">                         <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1175-32" data-line-number="32">                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-33" data-line-number="33"><span class="st">  </span></a>
<a class="sourceLine" id="cb1175-34" data-line-number="34"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1175-35" data-line-number="35"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1175-36" data-line-number="36">             <span class="dt">fill =</span> female, <span class="dt">color =</span> female)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-37" data-line-number="37"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-38" data-line-number="38"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-39" data-line-number="39"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-40" data-line-number="40"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;fitted logit(hazard)&quot;</span>, <span class="dt">breaks =</span> <span class="dv">-2</span><span class="op">:</span><span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-41" data-line-number="41"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Model A: Main effect of female&quot;</span>)</a>
<a class="sourceLine" id="cb1175-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1175-43" data-line-number="43"><span class="co"># Model B: Completely general\ninteraction between female and time</span></a>
<a class="sourceLine" id="cb1175-44" data-line-number="44">nd &lt;-</a>
<a class="sourceLine" id="cb1175-45" data-line-number="45"><span class="st">  </span>mathdropout_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-46" data-line-number="46"><span class="st">  </span><span class="kw">distinct</span>(female, period, hs11, hs12, coll1, coll2, coll3, fhs11, fhs12, fcoll1, fcoll2, fcoll3)</a>
<a class="sourceLine" id="cb1175-47" data-line-number="47"></a>
<a class="sourceLine" id="cb1175-48" data-line-number="48">p3 &lt;-</a>
<a class="sourceLine" id="cb1175-49" data-line-number="49"><span class="st">  </span><span class="kw">make_fitted</span>(fit12<span class="fl">.28</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-50" data-line-number="50"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">female =</span> <span class="kw">factor</span>(female,</a>
<a class="sourceLine" id="cb1175-51" data-line-number="51">                         <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1175-52" data-line-number="52">                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-53" data-line-number="53"><span class="st">  </span></a>
<a class="sourceLine" id="cb1175-54" data-line-number="54"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1175-55" data-line-number="55"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1175-56" data-line-number="56">             <span class="dt">fill =</span> female, <span class="dt">color =</span> female)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-57" data-line-number="57"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-58" data-line-number="58"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-59" data-line-number="59"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-60" data-line-number="60"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;fitted logit(hazard)&quot;</span>, <span class="dt">breaks =</span> <span class="dv">-2</span><span class="op">:</span><span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-61" data-line-number="61"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Model B: Completely general</span><span class="ch">\n</span><span class="st">interaction between female and time&quot;</span>)</a>
<a class="sourceLine" id="cb1175-62" data-line-number="62"></a>
<a class="sourceLine" id="cb1175-63" data-line-number="63"><span class="co"># Model C: Interaction\nbetween female and time</span></a>
<a class="sourceLine" id="cb1175-64" data-line-number="64">nd &lt;-</a>
<a class="sourceLine" id="cb1175-65" data-line-number="65"><span class="st">  </span>mathdropout_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-66" data-line-number="66"><span class="st">  </span><span class="kw">distinct</span>(female, period, hs11, hs12, coll1, coll2, coll3, fltime)</a>
<a class="sourceLine" id="cb1175-67" data-line-number="67"></a>
<a class="sourceLine" id="cb1175-68" data-line-number="68">p4 &lt;-</a>
<a class="sourceLine" id="cb1175-69" data-line-number="69"><span class="st">  </span><span class="kw">make_fitted</span>(fit12<span class="fl">.29</span>, <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-70" data-line-number="70"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">female =</span> <span class="kw">factor</span>(female,</a>
<a class="sourceLine" id="cb1175-71" data-line-number="71">                         <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1175-72" data-line-number="72">                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-73" data-line-number="73"><span class="st">  </span></a>
<a class="sourceLine" id="cb1175-74" data-line-number="74"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1175-75" data-line-number="75"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> period, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1175-76" data-line-number="76">             <span class="dt">fill =</span> female, <span class="dt">color =</span> female)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-77" data-line-number="77"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-78" data-line-number="78"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-79" data-line-number="79"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-80" data-line-number="80"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;fitted logit(hazard)&quot;</span>, <span class="dt">breaks =</span> <span class="dv">-2</span><span class="op">:</span><span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1175-81" data-line-number="81"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Model C: Interaction</span><span class="ch">\n</span><span class="st">between female and time&quot;</span>) </a></code></pre></div>
<p>Now combine the subplots, augment them in bulk, and return our version of Figure 12.8.</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1176-1" data-line-number="1">(p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span>p4 <span class="op">+</span><span class="st"> </span><span class="kw">plot_layout</span>(<span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1176-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1176-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;term&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb1176-4" data-line-number="4">                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;HS 11&quot;</span>, <span class="st">&quot;HS 12&quot;</span>, <span class="st">&quot;C 1&quot;</span>, <span class="st">&quot;C 2&quot;</span>, <span class="st">&quot;C 3&quot;</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1176-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">2.3</span>, <span class="dv">0</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1176-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-86-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Compute the information criteria for the three models. Since these were much faster to compute than for some of the earlier models in this chapter, we’ll go ahead and compute both the LOO and the WAIC.</p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1177-1" data-line-number="1">fit12<span class="fl">.27</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.27</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))  <span class="co"># 2.016566 mins</span></a>
<a class="sourceLine" id="cb1177-2" data-line-number="2">fit12<span class="fl">.28</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.28</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))  <span class="co"># 1.755284 mins</span></a>
<a class="sourceLine" id="cb1177-3" data-line-number="3">fit12<span class="fl">.29</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit12<span class="fl">.29</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))  <span class="co"># 2.884658 mins</span></a></code></pre></div>
<p>Now compare the models with information criteria differences and weights.</p>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1178-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.27</span>, fit12<span class="fl">.28</span>, fit12<span class="fl">.29</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_loo se_elpd_loo p_loo   se_p_loo looic   se_looic
## fit12.29     0.0       0.0 -4905.9     51.3         7.0     0.1   9811.8   102.6 
## fit12.28    -2.2       1.2 -4908.1     51.3        10.0     0.2   9816.2   102.6 
## fit12.27    -2.3       2.5 -4908.2     51.2         6.0     0.1   9816.4   102.5</code></pre>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1180-1" data-line-number="1"><span class="kw">loo_compare</span>(fit12<span class="fl">.27</span>, fit12<span class="fl">.28</span>, fit12<span class="fl">.29</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##          elpd_diff se_diff elpd_waic se_elpd_waic p_waic  se_p_waic waic    se_waic
## fit12.29     0.0       0.0 -4905.9      51.3          7.0     0.1    9811.8   102.6
## fit12.28    -2.2       1.2 -4908.1      51.3         10.0     0.2    9816.2   102.6
## fit12.27    -2.3       2.5 -4908.2      51.2          6.0     0.1    9816.3   102.5</code></pre>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1182-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.27</span>, fit12<span class="fl">.28</span>, fit12<span class="fl">.29</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.27 fit12.28 fit12.29 
##    0.086    0.092    0.822</code></pre>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1184-1" data-line-number="1"><span class="kw">model_weights</span>(fit12<span class="fl">.27</span>, fit12<span class="fl">.28</span>, fit12<span class="fl">.29</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit12.27 fit12.28 fit12.29 
##    0.086    0.092    0.821</code></pre>
<p>You’ll note both the LOO and WAIC estimates are very close to those displayed in Table 12.5. When we take their standard errors into account, <code>fit12.29</code> (Model C) is marginally better than the other two models. <code>fit12.29</code> also took most of the LOO and WAIC weights.</p>
<blockquote>
<p>How do we interpret the gender differential implied by Model C? Because we have centered <em>TIME</em> at 1, the coefficient for <em>FEMALE</em> (0.2275) estimates the differential in time period 1, which here is 11th grade. Antilogging yields 1.26, which leads us to estimate that in 11th grade, the odds of ending one’s mathematics course-taking career are 26% higher for females. (p. 460, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Let’s examine those results with our Bayesian fit.</p>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1186-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.29</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">log odds</span><span class="st">`</span> =<span class="st"> </span>b_female,</a>
<a class="sourceLine" id="cb1186-3" data-line-number="3">         <span class="st">`</span><span class="dt">odds ratio</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(b_female)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot;odds&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1186-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>), <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-9" data-line-number="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;the effects of female in two metrics&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-89-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Now examine the odds ratio for three different educational periods.</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1187-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit12<span class="fl">.29</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">12th grade</span><span class="st">`</span>              =<span class="st"> </span><span class="kw">exp</span>(b_female <span class="op">+</span><span class="st"> </span>b_fltime),</a>
<a class="sourceLine" id="cb1187-3" data-line-number="3">         <span class="st">`</span><span class="dt">1st semester of college</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(b_female <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>b_fltime),</a>
<a class="sourceLine" id="cb1187-4" data-line-number="4">         <span class="st">`</span><span class="dt">3rd semester of college</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(b_female <span class="op">+</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>b_fltime)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot; &quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1187-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1187-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>), <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1187-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1187-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;The interaction effect in different periods&quot;</span>,</a>
<a class="sourceLine" id="cb1187-11" data-line-number="11">       <span class="dt">x =</span> <span class="st">&quot;odds ratio&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1187-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1187-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-90-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="the-no-unobserved-heterogeneity-assumption-no-simple-solution" class="section level2">
<h2><span class="header-section-number">12.6</span> The no unobserved heterogeneity assumption: No simple solution</h2>
<blockquote>
<p>All the hazard models discussed in this book–both the discrete-time models we are discussing now and the continuous-time models we will soon introduce–impose an additional assumption to which we have alluded: the assumption of no unobserved heterogeneity. Every model assumes that the population hazard function for individual <span class="math inline">\(i\)</span> depends only on his or her predictor values. Any pair of individuals who share identical predictor profiles will have identical population functions….</p>
<p>Many data sets will not conform to this assumption. As in the multilevel model for change (and regular regression for that matter), pairs of individuals who share predictor profiles are very likely to have different outcomes….</p>
<p>Unobserved heterogeneity can have serious consequences. In their classic <a href="http://pure.iiasa.ac.at/id/eprint/2602/1/RR-86-03.pdf">1985 paper</a>, Vaupel and Yaskin elegantly demonstrate what they call “heterogeneity’s ruses”–that ability of unobserved heterogeneity to create the misimpression that a hazard function follows a particular form, when in fact it may not….</p>
<p>Is it possible to fit a hazard model that accounts for unobserved heterogeneity? As you might expect, doing so requires that we have either additional data (for example, data on repeated events within individuals) or that we invoke other–perhaps less tenable–assumptions about the distribution of event time errors (<a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4780071105">Aalen, 1988</a>; <a href="https://www.cambridge.org/core/books/longitudinal-analysis-of-labor-market-data/0D46228F1D5803E54310FA89FD8118C0">Heckman and Singer, 1984</a>; <a href="http://www.ressources-actuarielles.net/EXT/ISFA/1226.nsf/769998e0a65ea348c1257052003eb94f/2d6493f9f0d93b50c125774b0045c00b/$FILE/Vaupel-Demography-16-1979-3.pdf">Vaupel, Manton, &amp; Stallard, 1979</a>; <a href="https://www.ncbi.nlm.nih.gov/pubmed/9147597">Scheike &amp; Jensen, 1997</a>; <a href="https://www.semanticscholar.org/paper/DISCRETE-TIME-BIVARIATE-HAZARDS-WITH-UNOBSERVED-A-Mare/c13ff07817b0b0a28774806db29c2491e0ec6a3d">Mare, 1994</a>). As a result, most empirical researchers–and we–proceed ahead, if not ignoring the problem, at least not addressing it. In the remainder of this book, we assume that all heterogeneity is observed and attributable to the predictors included in our models.</p>
</blockquote>
</div>
<div id="residual-analysis" class="section level2">
<h2><span class="header-section-number">12.7</span> Residual analysis</h2>
<blockquote>
<p>Before concluding that your model is sound, you should ascertain how well it performs for individual cases. As in regular regression, we [can] address this question by examining residuals.</p>
<p>Residuals compare–usually through subtraction–an outcome’s “observed” value to its model-based “expected” value. For a discrete-time hazard model, a simple difference will not suffice because each person has not a single outcome but a set of outcomes–one for each time period when he or she was at risk. This suggests the need for a residual defined at the <em>person-period</em> level. A further complication is that the observed outcome in every time period has a value of either 0 or 1 while its expected value—the predicted hazard probability—lies between these extremes. (p. 463, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Starting on page 464, Singer and Willett illustrated a residual analysis using Model D from Table 11.3. In the last chapter, we called that <code>fit11.10</code>. Here it is, again.</p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1188-1" data-line-number="1">fit11<span class="fl">.10</span> &lt;-</a>
<a class="sourceLine" id="cb1188-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> sex_pp,</a>
<a class="sourceLine" id="cb1188-3" data-line-number="3">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb1188-4" data-line-number="4">      event <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>d7 <span class="op">+</span><span class="st"> </span>d8 <span class="op">+</span><span class="st"> </span>d9 <span class="op">+</span><span class="st"> </span>d10 <span class="op">+</span><span class="st"> </span>d11 <span class="op">+</span><span class="st"> </span>d12 <span class="op">+</span><span class="st"> </span>pt <span class="op">+</span><span class="st"> </span>pas,</a>
<a class="sourceLine" id="cb1188-5" data-line-number="5">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1188-6" data-line-number="6">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1188-7" data-line-number="7">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1188-8" data-line-number="8">      <span class="dt">file =</span> <span class="st">&quot;fits/fit11.10&quot;</span>)</a></code></pre></div>
<p>With <strong>brms</strong>, users can extract the residuals of a <code>brm()</code> fit with the <code>residuals()</code> function.</p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1189-1" data-line-number="1"><span class="kw">residuals</span>(fit11<span class="fl">.10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1189-2" data-line-number="2"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:822, 1:4] -0.0968 -0.0526 0.8174 -0.0839 -0.0448 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:4] &quot;Estimate&quot; &quot;Est.Error&quot; &quot;Q2.5&quot; &quot;Q97.5&quot;</code></pre>
<p>The output is similar to what we get from <code>fitted()</code>. We have a numeric array of 822 rows and 4 columns. There are 822 rows because that is the number of rows in the original data set with which we fit the model, <code>sex_pp</code>.</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1191-1" data-line-number="1">sex_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 822
## Columns: 11
## $ id     &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 7, 7, 7, 9, 9,…
## $ period &lt;dbl&gt; 7, 8, 9, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 12, 7, 8, 9, 10, 11, 7, …
## $ event  &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0,…
## $ d7     &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0,…
## $ d8     &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1,…
## $ d9     &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,…
## $ d10    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,…
## $ d11    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
## $ d12    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ pt     &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0,…
## $ pas    &lt;dbl&gt; 1.9788670, 1.9788670, 1.9788670, -0.5454916, -0.5454916, -0.5454916, -0.5454916, -0.5454916,…</code></pre>
<p>Just as we often express the uncertainty in our Bayesian models with parameter summaries from the posterior, we also express the uncertainty of our residuals. Thus, the four columns returned by the <code>residuals()</code> function are the familiar summary columns of <code>Estimate</code>, <code>Est.Error</code>, <code>Q2.5</code>, and <code>Q97.5</code>. On page 465, Singer and Willett showcased the deviance residuals for eight participants. We’re going to diverge from them a little. In the plot, below, we’ll look at the residuals for the first 10 cases in the data, by <code>period</code>.</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1193-1" data-line-number="1"><span class="kw">residuals</span>(fit11<span class="fl">.10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1193-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1193-3" data-line-number="3"><span class="st">  </span><span class="kw">bind_cols</span>(sex_pp) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1193-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">event  =</span> <span class="kw">factor</span>(event),</a>
<a class="sourceLine" id="cb1193-5" data-line-number="5">         <span class="dt">period =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;period &quot;</span>, period),</a>
<a class="sourceLine" id="cb1193-6" data-line-number="6">                         <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;period &quot;</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1193-7" data-line-number="7"><span class="st">  </span><span class="co"># reduce the number of cases</span></a>
<a class="sourceLine" id="cb1193-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">&lt;</span><span class="st"> </span><span class="dv">11</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1193-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1193-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> id, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>, <span class="dt">color =</span> event)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1193-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1193-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">fatten =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1193-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1193-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">labels =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="st">&quot;&quot;</span>, <span class="dv">10</span>), <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1193-15" data-line-number="15"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;residual&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1193-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>, </a>
<a class="sourceLine" id="cb1193-17" data-line-number="17">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1193-18" data-line-number="18"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>period, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-94-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>As is often the case in coefficient plots, the dots are the posterior means and the intersecting lines are the percentile-based 95% intervals. In the <code>sex_pp</code> data, the <code>event</code> variable encodes when participants experience the event within a given time range. Hopefully the color coding highlights how with hazard models, the residuals are always positive when the criterion variable is a 1 and always negative when the criterion is 0.</p>
<p>Now we have a bit of a handle on the output from <code>residuals()</code>, let’s plot in bulk.</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1194-1" data-line-number="1"><span class="kw">residuals</span>(fit11<span class="fl">.10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-3" data-line-number="3"><span class="st">  </span><span class="kw">bind_cols</span>(sex_pp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">event =</span> <span class="kw">factor</span>(event)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1194-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> id, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>, <span class="dt">color =</span> event)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1194-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1194-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">fatten =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1194-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1194-10" data-line-number="10"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;residual&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1194-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>, </a>
<a class="sourceLine" id="cb1194-12" data-line-number="12">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-95-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This plot is our analogue to the top portion of Singer and Willette’s Figure 12.9. But whereas we plotted our residual summaries, they plotted the expected values of their <em>deviance residuals</em>. In contrast with the material on page 464, I am not going to discuss deviance residuals or the sums of the squared deviance residuals. Our <strong>brms</strong> workflow offers an alternative. Before we offer our alternative, we might focus on deviance residuals for just a moment:</p>
<blockquote>
<p>Deviance residuals are so named because, when squared, they represent an individual’s contribution to the deviance statistic for that time period. The sum of the squared deviance residuals across all the records in a person-period data set yields the deviance statistic for the specified model….</p>
<p>The absolute value of a deviance residual indicates how well the model fits that person’s data for that period. Large absolute values identify person-period records whose outcomes are poorly predicted. (p. 464)</p>
</blockquote>
<p>Back in Chapter 11, we computed the LOO for <code>fit11.10</code>. Let’s take a look at that.</p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1195-1" data-line-number="1"><span class="kw">loo</span>(fit11<span class="fl">.10</span>)</a></code></pre></div>
<pre><code>## 
## Computed from 4000 by 822 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -322.6 17.6
## p_loo         8.0  0.6
## looic       645.1 35.1
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k &lt; 0.5).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>Notice the part of the output that read “All Pareto k estimates are good (k &lt; 0.5).” We can pull those Pareto k estimates like so.</p>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1197-1" data-line-number="1"><span class="kw">loo</span>(fit11<span class="fl">.10</span>)<span class="op">$</span>diagnostics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1197-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1197-3" data-line-number="3"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 822
## Columns: 2
## $ pareto_k &lt;dbl&gt; -0.032388134, -0.008484953, 0.086619632, -0.065923005, 0.016843525, -0.110736705, 0.005088…
## $ n_eff    &lt;dbl&gt; 2357.788, 2687.321, 1818.382, 4990.905, 5142.514, 5254.677, 4909.712, 4457.979, 4186.437, …</code></pre>
<p>We formatted the output for convenience. Notice there are 822 rows—one for each case in the data. Almost like a computational byproduct, <strong>brms</strong> returned <code>pareto_k</code> and <code>n_eff</code> values when we computed the LOO estimates for the model. Our focus will be on the <code>pareto_k</code> column. Here are those <code>pareto_k</code> values in a plot.</p>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1199-1" data-line-number="1"><span class="kw">loo</span>(fit11<span class="fl">.10</span>)<span class="op">$</span>diagnostics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1199-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1199-3" data-line-number="3"><span class="st">  </span><span class="co"># attach the `id` values</span></a>
<a class="sourceLine" id="cb1199-4" data-line-number="4"><span class="st">  </span><span class="kw">bind_cols</span>(sex_pp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1199-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1199-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> id, <span class="dt">y =</span> pareto_k)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1199-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1199-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pareto_k <span class="op">&gt;</span><span class="st"> </span><span class="fl">.2</span>),</a>
<a class="sourceLine" id="cb1199-9" data-line-number="9">            <span class="kw">aes</span>(<span class="dt">x =</span> id <span class="op">+</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">label =</span> id),</a>
<a class="sourceLine" id="cb1199-10" data-line-number="10">            <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">hjust =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1199-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-98-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To learn the technical details about <code>pareto_k</code>, check out Vehtari, Gelman, and Gabry’s <a href="https://arxiv.org/abs/1507.04544"><em>Practical Bayesian model evaluation using leave-one-out cross-validation and WAIC</em></a> or Vehtari, Simpson, Gelman, Yao, and Gabry’s <a href="https://arxiv.org/abs/1507.02646"><em>Pareto smoothed importance sampling</em></a>. In short, we can use <code>pareto_k</code> values to flag cases that were overly-influential on the model in a way that’s a little like Singer and Willett’s deviance residuals. As pointed out in the <a href="https://cran.r-project.org/web/packages/loo/loo.pdf">reference manual</a> for the <strong>loo</strong> package, which <strong>brms</strong> used to compute all this, the makers of the <strong>loo</strong> package warn against <code>pareto_k</code> values when they get much larger than <span class="math inline">\(0.5\)</span>. We should be a little worried by values that exceed the <span class="math inline">\(0.7\)</span> threshold and it’s very likely a problem when they get larger than <span class="math inline">\(1\)</span>. In this case, they’re all below <span class="math inline">\(0.4\)</span> and all is good.</p>
<p>To learn more about <code>pareto_k</code> values and what the <strong>loo</strong> package can do for you, check out Vehtari and Gabry’s vignette, <a href="https://cran.r-project.org/web/packages/loo/vignettes/loo2-example.html"><em>Using the loo package</em></a>.</p>
</div>
<div id="reference-11" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://www.oxfordscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968">Singer, J. D., &amp; Willett, J. B. (2003). <em>Applied longitudinal data analysis: Modeling change and event occurrence</em>. New York, NY, US: Oxford University Press.</a></p>
</div>
<div id="session-info-11" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1200-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_2.0.3 patchwork_1.0.0 brms_2.12.0     Rcpp_1.0.4.6    forcats_0.5.0   stringr_1.4.0  
##  [7] dplyr_0.8.5     purrr_0.3.3     readr_1.3.1     tidyr_1.0.2     tibble_3.0.0    ggplot2_3.3.0  
## [13] tidyverse_1.3.0
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1     ellipsis_0.3.0       ggridges_0.5.2       rsconnect_0.8.16     markdown_1.1        
##   [6] base64enc_0.1-3      fs_1.4.1             rstudioapi_0.11      farver_2.0.3         rstan_2.19.3        
##  [11] svUnit_0.7-12        DT_0.13              fansi_0.4.1          mvtnorm_1.1-0        lubridate_1.7.8     
##  [16] xml2_1.3.1           bridgesampling_1.0-0 knitr_1.28           shinythemes_1.1.2    bayesplot_1.7.1     
##  [21] jsonlite_1.6.1       broom_0.5.5          dbplyr_1.4.2         shiny_1.4.0.2        compiler_3.6.3      
##  [26] httr_1.4.1           backports_1.1.6      assertthat_0.2.1     Matrix_1.2-18        fastmap_1.0.1       
##  [31] cli_2.0.2            later_1.0.0          htmltools_0.4.0      prettyunits_1.1.1    tools_3.6.3         
##  [36] igraph_1.2.5         coda_0.19-3          gtable_0.3.0         glue_1.4.0           reshape2_1.4.4      
##  [41] cellranger_1.1.0     vctrs_0.2.4          nlme_3.1-144         crosstalk_1.1.0.1    xfun_0.13           
##  [46] ps_1.3.2             rvest_0.3.5          mime_0.9             miniUI_0.1.1.1       lifecycle_0.2.0     
##  [51] gtools_3.8.2         zoo_1.8-7            scales_1.1.0         colourpicker_1.0     hms_0.5.3           
##  [56] promises_1.1.0       Brobdingnag_1.2-6    parallel_3.6.3       inline_0.3.15        shinystan_2.5.0     
##  [61] yaml_2.2.1           gridExtra_2.3        loo_2.2.0            StanHeaders_2.21.0-1 stringi_1.4.6       
##  [66] dygraphs_1.1.1.6     pkgbuild_1.0.6       rlang_0.4.5          pkgconfig_2.0.3      matrixStats_0.56.0  
##  [71] evaluate_0.14        lattice_0.20-38      rstantools_2.0.0     htmlwidgets_1.5.1    labeling_0.3        
##  [76] tidyselect_1.0.0     processx_3.4.2       plyr_1.8.6           magrittr_1.5         bookdown_0.18       
##  [81] R6_2.4.1             generics_0.0.2       DBI_1.1.0            pillar_1.4.3         haven_2.2.0         
##  [86] withr_2.1.2          xts_0.12-0           abind_1.4-5          modelr_0.1.6         crayon_1.3.4        
##  [91] arrayhelpers_1.1-0   utf8_1.1.4           rmarkdown_2.1        grid_3.6.3           readxl_1.3.1        
##  [96] callr_3.4.3          threejs_0.3.3        reprex_0.3.0         digest_0.6.25        xtable_1.8-4        
## [101] httpuv_1.5.2         stats4_3.6.3         munsell_0.5.0        viridisLite_0.3.0    shinyjs_1.1</code></pre>
</div>
<div id="footnote-1" class="section level2 unnumbered">
<h2>Footnote</h2>

</div>
</div>







<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>In their reference section, Singer and Willett indicated this was a manuscript submitted for publication. To my knowledge, it was never published.<a href="extending-the-discrete-time-hazard-model.html#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fitting-basic-discrete-time-hazard-models.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
