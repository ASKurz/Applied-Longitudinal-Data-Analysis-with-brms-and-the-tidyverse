<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Doing Data Analysis with the Multilevel Model for Change | Applied Longitudinal Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Doing Data Analysis with the Multilevel Model for Change | Applied Longitudinal Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  <meta name="github-repo" content="ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Doing Data Analysis with the Multilevel Model for Change | Applied Longitudinal Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is a reworking of Singer and Willett’s classic (2003) text within a contemporary Bayesian framework with emphasis of the brms and tidyverse packages within the R computational framework." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introducing-the-multilevel-model-for-change.html"/>
<link rel="next" href="treating-time-more-flexibly.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html"><i class="fa fa-check"></i><b>1</b> A Framework for Investigating Change over Time</a><ul>
<li class="chapter" data-level="1.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#when-might-you-study-change-over-time"><i class="fa fa-check"></i><b>1.1</b> When might you study change over time?</a></li>
<li class="chapter" data-level="1.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#distinguishing-between-two-types-of-questions-about-change"><i class="fa fa-check"></i><b>1.2</b> Distinguishing between two types of questions about change</a></li>
<li class="chapter" data-level="1.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#three-important-features-of-a-study-of-change"><i class="fa fa-check"></i><b>1.3</b> Three important features of a study of change</a><ul>
<li class="chapter" data-level="1.3.1" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#multiple-waves-of-data."><i class="fa fa-check"></i><b>1.3.1</b> Multiple waves of data.</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-sensible-metric-for-time."><i class="fa fa-check"></i><b>1.3.2</b> A sensible metric for time.</a></li>
<li class="chapter" data-level="1.3.3" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#a-continuous-outcome-that-changes-systematically-over-time."><i class="fa fa-check"></i><b>1.3.3</b> A continuous outcome that changes systematically over time.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-change-over-time.html"><a href="a-framework-for-investigating-change-over-time.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html"><i class="fa fa-check"></i><b>2</b> Exploring Longitudinal Data on Change</a><ul>
<li class="chapter" data-level="2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#creating-a-longitudinal-data-set"><i class="fa fa-check"></i><b>2.1</b> Creating a longitudinal data set</a><ul>
<li class="chapter" data-level="2.1.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-level-data-set."><i class="fa fa-check"></i><b>2.1.1</b> The person-level data set.</a></li>
<li class="chapter" data-level="2.1.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#the-person-period-data-set."><i class="fa fa-check"></i><b>2.1.2</b> The person-period data set.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#descriptive-analysis-of-individual-change-over-time"><i class="fa fa-check"></i><b>2.2</b> Descriptive analysis of individual change over time</a><ul>
<li class="chapter" data-level="2.2.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#empirical-growth-plots."><i class="fa fa-check"></i><b>2.2.1</b> Empirical growth plots.</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-a-trajectory-to-summarize-each-persons-empirical-growth-record."><i class="fa fa-check"></i><b>2.2.2</b> Using a trajectory to summarize each person’s empirical growth record.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-differences-in-change-across-people"><i class="fa fa-check"></i><b>2.3</b> Exploring differences in change across people</a><ul>
<li class="chapter" data-level="2.3.1" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#examining-the-entire-set-of-smooth-trajectories."><i class="fa fa-check"></i><b>2.3.1</b> Examining the entire set of smooth trajectories.</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#using-the-results-of-model-fitting-to-frame-questions-about-change."><i class="fa fa-check"></i><b>2.3.2</b> Using the results of model fitting to frame questions about change.</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#exploring-the-relationship-between-change-and-time-invariant-predictors."><i class="fa fa-check"></i><b>2.3.3</b> Exploring the relationship between change and time-invariant predictors.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#improving-the-precision-and-reliability-of-ols-single-level-bayesian-estimated-rates-of-change-lessons-for-research-design"><i class="fa fa-check"></i><b>2.4</b> Improving the precision and reliability of <del>OLS</del> single-level-Bayesian-estimated rates of change: Lessons for research design</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="exploring-longitudinal-data-on-change.html"><a href="exploring-longitudinal-data-on-change.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>3</b> Introducing the Multilevel Model for Change</a><ul>
<li class="chapter" data-level="3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#what-is-the-purpose-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>3.1</b> What is the purpose of the multilevel model for change?</a></li>
<li class="chapter" data-level="3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-1-submodel-for-individual-change"><i class="fa fa-check"></i><b>3.2</b> The level-1 submodel for individual change</a><ul>
<li class="chapter" data-level="3.2.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-structural-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.1</b> The structural part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-stochastic-part-of-the-level-1-submodel."><i class="fa fa-check"></i><b>3.2.2</b> The stochastic part of the level-1 submodel.</a></li>
<li class="chapter" data-level="3.2.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#relating-the-level-1-submodel-to-the-ols-exploratory-methods-of-chapter-2."><i class="fa fa-check"></i><b>3.2.3</b> Relating the level-1 submodel to the OLS exploratory methods of chapter 2.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-level-2-submodel-for-systematic-interindividual-differences-in-change"><i class="fa fa-check"></i><b>3.3</b> The level-2 submodel for systematic interindividual differences in change</a><ul>
<li class="chapter" data-level="3.3.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#structural-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.1</b> Structural components of the level-2 submodel.</a></li>
<li class="chapter" data-level="3.3.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#stochastic-components-of-the-level-2-submodel."><i class="fa fa-check"></i><b>3.3.2</b> Stochastic components of the level-2 submodel.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#fitting-the-multilevel-model-for-change-to-data"><i class="fa fa-check"></i><b>3.4</b> Fitting the multilevel model for change to data</a><ul>
<li class="chapter" data-level="3.4.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#the-advantages-of-maximum-likelihood-bayesian-estimation."><i class="fa fa-check"></i><b>3.4.1</b> The advantages of <del>maximum likelihood</del> Bayesian estimation.</a></li>
<li class="chapter" data-level="3.4.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#using-maximum-likelihood-modern-bayesian-methods-to-fit-a-multilevel-model."><i class="fa fa-check"></i><b>3.4.2</b> Using <del>maximum likelihood</del> modern Bayesian methods to fit a multilevel model.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-fixed-effects"><i class="fa fa-check"></i><b>3.5</b> Examining estimated fixed effects</a><ul>
<li class="chapter" data-level="3.5.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-estimated-fixed-effects."><i class="fa fa-check"></i><b>3.5.1</b> Interpreting estimated fixed effects.</a></li>
<li class="chapter" data-level="3.5.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-fixed-effects."><i class="fa fa-check"></i><b>3.5.2</b> Single parameter tests for the fixed effects.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#examining-estimated-variance-components"><i class="fa fa-check"></i><b>3.6</b> Examining estimated variance components</a><ul>
<li class="chapter" data-level="3.6.1" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#interpreting-the-estimated-variance-components."><i class="fa fa-check"></i><b>3.6.1</b> Interpreting the estimated variance components.</a></li>
<li class="chapter" data-level="3.6.2" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#single-parameter-tests-for-the-variance-components."><i class="fa fa-check"></i><b>3.6.2</b> Single parameter tests for the variance components.</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#bonus-how-did-you-simulate-that-data"><i class="fa fa-check"></i><b>3.7</b> Bonus: How did you simulate that data?</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="introducing-the-multilevel-model-for-change.html"><a href="introducing-the-multilevel-model-for-change.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html"><i class="fa fa-check"></i><b>4</b> Doing Data Analysis with the Multilevel Model for Change</a><ul>
<li class="chapter" data-level="4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#example-changes-in-adolescent-alcohol-use"><i class="fa fa-check"></i><b>4.1</b> Example: Changes in adolescent alcohol use</a></li>
<li class="chapter" data-level="4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-composite-specification-of-the-multilevel-model-for-change"><i class="fa fa-check"></i><b>4.2</b> The composite specification of the multilevel model for change</a><ul>
<li class="chapter" data-level="4.2.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-structural-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.1</b> The structural component of the composite model.</a></li>
<li class="chapter" data-level="4.2.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-stochastic-component-of-the-composite-model."><i class="fa fa-check"></i><b>4.2.2</b> The stochastic component of the composite model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#methods-of-estimation-revisited"><i class="fa fa-check"></i><b>4.3</b> Methods of estimation, revisited</a></li>
<li class="chapter" data-level="4.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#first-steps-fitting-two-unconditional-multilevel-models-for-change"><i class="fa fa-check"></i><b>4.4</b> First steps: Fitting two unconditional multilevel models for change</a><ul>
<li class="chapter" data-level="4.4.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-means-model."><i class="fa fa-check"></i><b>4.4.1</b> The unconditional means model.</a></li>
<li class="chapter" data-level="4.4.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-unconditional-growth-model."><i class="fa fa-check"></i><b>4.4.2</b> The unconditional growth model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#quantifying-the-proportion-of-outcome-variation-explained."><i class="fa fa-check"></i><b>4.4.3</b> Quantifying the proportion of outcome variation “explained.”</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#practical-data-analytic-strategies-for-model-building"><i class="fa fa-check"></i><b>4.5</b> Practical data analytic strategies for model building</a><ul>
<li class="chapter" data-level="4.5.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#a-taxonomy-of-statistical-models."><i class="fa fa-check"></i><b>4.5.1</b> A taxonomy of statistical models.</a></li>
<li class="chapter" data-level="4.5.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#interpreting-fitted-models."><i class="fa fa-check"></i><b>4.5.2</b> Interpreting fitted models.</a></li>
<li class="chapter" data-level="4.5.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#displaying-prototypical-change-trajectories."><i class="fa fa-check"></i><b>4.5.3</b> Displaying prototypical change trajectories.</a></li>
<li class="chapter" data-level="4.5.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#recentering-predictors-to-improve-interpretation."><i class="fa fa-check"></i><b>4.5.4</b> Recentering predictors to improve interpretation.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#comparing-models-using-deviance-statistics"><i class="fa fa-check"></i><b>4.6</b> Comparing models using deviance statistics</a><ul>
<li class="chapter" data-level="4.6.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#the-deviance-statistic."><i class="fa fa-check"></i><b>4.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="4.6.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#when-and-how-can-you-compare-deviance-statistics"><i class="fa fa-check"></i><b>4.6.2</b> When and how can you compare deviance statistics?</a></li>
<li class="chapter" data-level="4.6.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#implementing-deviance-based-hypothesis-tests."><i class="fa fa-check"></i><b>4.6.3</b> Implementing deviance-based hypothesis tests.</a></li>
<li class="chapter" data-level="4.6.4" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#aic-and-bic-waic-and-loo-statistics-comparing-nonnested-models-using-information-criteria-and-cross-validation."><i class="fa fa-check"></i><b>4.6.4</b> <del>AIC and BIC</del> WAIC and LOO statistics: Comparing nonnested models using information criteria [and cross validation].</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#using-wald-statistics-to-test-composite-hypotheses-about-fixed-effects"><i class="fa fa-check"></i><b>4.7</b> Using Wald statistics to test composite hypotheses about fixed effects</a></li>
<li class="chapter" data-level="4.8" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#evaluating-the-tenability-of-a-models-assumptions"><i class="fa fa-check"></i><b>4.8</b> Evaluating the tenability of a model’s assumptions</a><ul>
<li class="chapter" data-level="4.8.1" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-functional-form."><i class="fa fa-check"></i><b>4.8.1</b> Checking functional form.</a></li>
<li class="chapter" data-level="4.8.2" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-normality."><i class="fa fa-check"></i><b>4.8.2</b> Checking normality.</a></li>
<li class="chapter" data-level="4.8.3" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#checking-homoscedasticity."><i class="fa fa-check"></i><b>4.8.3</b> Checking homoscedasticity.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#model-based-empirical-bayes-estimates-of-the-individual-growth-parameters"><i class="fa fa-check"></i><b>4.9</b> Model-based (Empirical Bayes) estimates of the individual growth parameters</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="doing-data-analysis-with-the-multilevel-model-for-change.html"><a href="doing-data-analysis-with-the-multilevel-model-for-change.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html"><i class="fa fa-check"></i><b>5</b> Treating Time More Flexibly</a><ul>
<li class="chapter" data-level="5.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#variably-spaced-measurement-occasions"><i class="fa fa-check"></i><b>5.1</b> Variably spaced measurement occasions</a><ul>
<li class="chapter" data-level="5.1.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#the-structure-of-variably-spaced-data-sets."><i class="fa fa-check"></i><b>5.1.1</b> The structure of variably spaced data sets.</a></li>
<li class="chapter" data-level="5.1.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#postulating-and-fitting-multilevel-models-with-variably-spaced-waves-of-data."><i class="fa fa-check"></i><b>5.1.2</b> Postulating and fitting multilevel models with variably spaced waves of data.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#varying-numbers-of-measurement-occasions"><i class="fa fa-check"></i><b>5.2</b> Varying numbers of measurement occasions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#analyzing-data-sets-in-which-the-number-of-waves-per-person-varies."><i class="fa fa-check"></i><b>5.2.1</b> Analyzing data sets in which the number of waves per person varies.</a></li>
<li class="chapter" data-level="5.2.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#practical-problems-that-may-arise-when-analyzing-unbalanced-data-sets."><i class="fa fa-check"></i><b>5.2.2</b> Practical problems that may arise when analyzing unbalanced data sets.</a></li>
<li class="chapter" data-level="5.2.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#distinguishing-among-different-types-of-missingness."><i class="fa fa-check"></i><b>5.2.3</b> Distinguishing among different types of missingness.</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#time-varying-predictors"><i class="fa fa-check"></i><b>5.3</b> Time-varying predictors</a><ul>
<li class="chapter" data-level="5.3.1" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#including-the-main-effect-of-a-time-varying-predictor."><i class="fa fa-check"></i><b>5.3.1</b> Including the main effect of a time-varying predictor.</a></li>
<li class="chapter" data-level="5.3.2" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#allowing-the-effect-of-a-time-varying-predictor-to-vary-over-time."><i class="fa fa-check"></i><b>5.3.2</b> Allowing the effect of a time-varying predictor to vary over time.</a></li>
<li class="chapter" data-level="5.3.3" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-time-varying-predictors."><i class="fa fa-check"></i><b>5.3.3</b> Recentering time-varying predictors.</a></li>
<li class="chapter" data-level="5.3.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#an-important-caveat-the-problem-of-reciprocal-causation."><i class="fa fa-check"></i><b>5.3.4</b> An important caveat: The problem of reciprocal causation.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#recentering-the-effect-of-time"><i class="fa fa-check"></i><b>5.4</b> Recentering the effect of <em>TIME</em></a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="treating-time-more-flexibly.html"><a href="treating-time-more-flexibly.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html"><i class="fa fa-check"></i><b>6</b> Modeling Discontinuous and Nonlinear Change</a><ul>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="modeling-discontinuous-and-nonlinear-change.html"><a href="modeling-discontinuous-and-nonlinear-change.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html"><i class="fa fa-check"></i><b>7</b> Examining the Multilevel Model’s Error Covariance Structure</a><ul>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="examining-the-multilevel-models-error-covariance-structure.html"><a href="examining-the-multilevel-models-error-covariance-structure.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html"><i class="fa fa-check"></i><b>8</b> Modeling Change Using Covariance Structure Analysis</a><ul>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="modeling-change-using-covariance-structure-analysis.html"><a href="modeling-change-using-covariance-structure-analysis.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html"><i class="fa fa-check"></i><b>9</b> A Framework for Investigating Event Occurrence</a><ul>
<li class="chapter" data-level="9.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#should-you-conduct-a-survival-analysis-the-whether-and-when-test"><i class="fa fa-check"></i><b>9.1</b> Should you conduct a survival analysis? The “whether” and “when” test</a><ul>
<li class="chapter" data-level="9.1.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#time-to-relapse-among-recently-treated-alcoholics."><i class="fa fa-check"></i><b>9.1.1</b> Time to relapse among recently treated alcoholics.</a></li>
<li class="chapter" data-level="9.1.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#length-of-stay-in-teaching."><i class="fa fa-check"></i><b>9.1.2</b> Length of stay in teaching.</a></li>
<li class="chapter" data-level="9.1.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#age-at-first-suicide-ideation."><i class="fa fa-check"></i><b>9.1.3</b> Age at first suicide ideation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#framing-a-research-question-about-event-occurrence"><i class="fa fa-check"></i><b>9.2</b> Framing a research question about event occurrence</a><ul>
<li class="chapter" data-level="9.2.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#defining-event-occurrence."><i class="fa fa-check"></i><b>9.2.1</b> Defining event occurrence.</a></li>
<li class="chapter" data-level="9.2.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#identifying-the-beginning-of-time."><i class="fa fa-check"></i><b>9.2.2</b> Identifying the “beginning of time.”</a></li>
<li class="chapter" data-level="9.2.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#specifying-a-metric-for-time."><i class="fa fa-check"></i><b>9.2.3</b> Specifying a metric for time.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#censoring-how-complete-are-the-data-on-event-occurrence"><i class="fa fa-check"></i><b>9.3</b> Censoring: How complete are the data on event occurrence?</a><ul>
<li class="chapter" data-level="9.3.1" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-and-why-does-censoring-arise"><i class="fa fa-check"></i><b>9.3.1</b> How and why does censoring arise?</a></li>
<li class="chapter" data-level="9.3.2" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#different-types-of-censoring."><i class="fa fa-check"></i><b>9.3.2</b> Different types of censoring.</a></li>
<li class="chapter" data-level="9.3.3" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#how-does-censoring-affect-statistical-analysis"><i class="fa fa-check"></i><b>9.3.3</b> How does censoring affect statistical analysis?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="a-framework-for-investigating-event-occurrence.html"><a href="a-framework-for-investigating-event-occurrence.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html"><i class="fa fa-check"></i><b>10</b> Describing Discrete-Time Event Occurrence Data</a><ul>
<li class="chapter" data-level="10.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-life-table"><i class="fa fa-check"></i><b>10.1</b> The life table</a></li>
<li class="chapter" data-level="10.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data"><i class="fa fa-check"></i><b>10.2</b> A framework for characterizing the distribution of discrete-time event occurrence data</a><ul>
<li class="chapter" data-level="10.2.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-function."><i class="fa fa-check"></i><b>10.2.1</b> Survivor function.</a></li>
<li class="chapter" data-level="10.2.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#median-lifetime."><i class="fa fa-check"></i><b>10.2.2</b> Median lifetime.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes"><i class="fa fa-check"></i><b>10.3</b> Developing intuition about hazard functions, survivor functions, and median lifetimes</a><ul>
<li class="chapter" data-level="10.3.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#identifying-periods-of-high-and-low-risk-using-hazard-functions."><i class="fa fa-check"></i><b>10.3.1</b> Identifying periods of high and low risk using hazard functions.</a></li>
<li class="chapter" data-level="10.3.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard."><i class="fa fa-check"></i><b>10.3.2</b> Survivor functions as a context for evaluating the magnitude of hazard.</a></li>
<li class="chapter" data-level="10.3.3" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#strengths-and-limitations-of-estimated-median-lifetimes."><i class="fa fa-check"></i><b>10.3.3</b> Strengths and limitations of estimated median lifetimes.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#quantifying-the-effects-of-sampling-variation"><i class="fa fa-check"></i><b>10.4</b> Quantifying the effects of sampling variation</a><ul>
<li class="chapter" data-level="10.4.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-standard-error-of-the-estimated-hazard-probabilities."><i class="fa fa-check"></i><b>10.4.1</b> The standard error of the estimated hazard probabilities.</a></li>
<li class="chapter" data-level="10.4.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#standard-error-of-the-estimated-survival-probabilities."><i class="fa fa-check"></i><b>10.4.2</b> Standard error of the estimated survival probabilities.</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#a-simple-and-useful-strategy-for-constructing-the-life-table"><i class="fa fa-check"></i><b>10.5</b> A simple and useful strategy for constructing the life table</a><ul>
<li class="chapter" data-level="10.5.1" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#the-person-period-data-set.-1"><i class="fa fa-check"></i><b>10.5.1</b> The person-period data set.</a></li>
<li class="chapter" data-level="10.5.2" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#using-the-person-period-data-set-to-construct-the-life-table."><i class="fa fa-check"></i><b>10.5.2</b> Using the person-period data set to construct the life table.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#bonus-fit-the-discrete-time-hazard-models-with-brms"><i class="fa fa-check"></i><b>10.6</b> Bonus: Fit the discrete-time hazard models with brms</a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="describing-discrete-time-event-occurrence-data.html"><a href="describing-discrete-time-event-occurrence-data.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html"><i class="fa fa-check"></i><b>11</b> Fitting Basic Discrete-Time Hazard Models</a><ul>
<li class="chapter" data-level="11.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#toward-a-statistical-model-for-discrete-time-hazard"><i class="fa fa-check"></i><b>11.1</b> Toward a statistical model for discrete-time hazard</a><ul>
<li class="chapter" data-level="11.1.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#plots-of-within-group-hazard-functions-and-survivor-functions."><i class="fa fa-check"></i><b>11.1.1</b> Plots of within-group hazard functions and survivor functions.</a></li>
<li class="chapter" data-level="11.1.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-kind-of-statistical-model-do-these-graphs-suggest"><i class="fa fa-check"></i><b>11.1.2</b> What kind of statistical model do these graphs suggest?</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#formal-representation-of-the-population-discrete-time-hazard-model"><i class="fa fa-check"></i><b>11.2</b> formal representation of the population discrete-time hazard model</a><ul>
<li class="chapter" data-level="11.2.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#what-do-the-parameters-represent"><i class="fa fa-check"></i><b>11.2.1</b> What do the parameters represent?</a></li>
<li class="chapter" data-level="11.2.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#an-alternative-representation-of-the-model."><i class="fa fa-check"></i><b>11.2.2</b> An alternative representation of the model.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-a-discrete-time-hazard-model-to-data"><i class="fa fa-check"></i><b>11.3</b> Fitting a discrete-time hazard model to data</a><ul>
<li class="chapter" data-level="11.3.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#adding-predictors-to-the-person-period-data-set."><i class="fa fa-check"></i><b>11.3.1</b> Adding predictors to the person-period data set.</a></li>
<li class="chapter" data-level="11.3.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#maximum-likelihood-estimates-and-bayesian-posteriors-for-the-discrete-time-hazard-model."><i class="fa fa-check"></i><b>11.3.2</b> Maximum likelihood estimates [and Bayesian posteriors] for the discrete-time hazard model.</a></li>
<li class="chapter" data-level="11.3.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#fitting-the-discrete-time-hazard-model-to-data."><i class="fa fa-check"></i><b>11.3.3</b> Fitting the discrete-time hazard model to data.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#interpreting-parameter-estimates"><i class="fa fa-check"></i><b>11.4</b> Interpreting parameter estimates</a><ul>
<li class="chapter" data-level="11.4.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-time-indicators."><i class="fa fa-check"></i><b>11.4.1</b> The time indicators.</a></li>
<li class="chapter" data-level="11.4.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#dichotomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.2</b> Dichotomous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#continuous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.3</b> Continuous substantive predictors.</a></li>
<li class="chapter" data-level="11.4.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#polytomous-substantive-predictors."><i class="fa fa-check"></i><b>11.4.4</b> Polytomous substantive predictors.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#displaying-fitted-hazard-and-survivor-functions"><i class="fa fa-check"></i><b>11.5</b> Displaying fitted hazard and survivor functions</a><ul>
<li class="chapter" data-level="11.5.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#a-strategy-for-a-single-categorical-substantive-predictor."><i class="fa fa-check"></i><b>11.5.1</b> A strategy for a single categorical substantive predictor.</a></li>
<li class="chapter" data-level="11.5.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#extending-this-strategy-to-multiple-predictors-some-of-which-are-continuous."><i class="fa fa-check"></i><b>11.5.2</b> Extending this strategy to multiple predictors (some of which are continuous).</a></li>
<li class="chapter" data-level="11.5.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#two-cautions-when-interpreting-fitted-hazard-and-survivor-functions."><i class="fa fa-check"></i><b>11.5.3</b> Two cautions when interpreting fitted hazard and survivor functions.</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-models-using-deviance-statistics-and-information-criteria"><i class="fa fa-check"></i><b>11.6</b> Comparing models using <del>deviance statistics and</del> information criteria</a><ul>
<li class="chapter" data-level="11.6.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-deviance-statistic.-1"><i class="fa fa-check"></i><b>11.6.1</b> The deviance statistic.</a></li>
<li class="chapter" data-level="11.6.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-individual-predictors."><i class="fa fa-check"></i><b>11.6.2</b> Deviance-based hypothesis tests for individual predictors.</a></li>
<li class="chapter" data-level="11.6.3" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#deviance-based-hypothesis-tests-for-groups-of-predictors."><i class="fa fa-check"></i><b>11.6.3</b> Deviance-based hypothesis tests for groups of predictors.</a></li>
<li class="chapter" data-level="11.6.4" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#comparing-nonnested-models-using-waic-and-loo."><i class="fa fa-check"></i><b>11.6.4</b> Comparing nonnested models using [WAIC and LOO].</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#statistical-inference-using-uncertainty-in-the-bayesian-posterior"><i class="fa fa-check"></i><b>11.7</b> Statistical inference using [uncertainty in the Bayesian posterior]</a><ul>
<li class="chapter" data-level="11.7.1" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#the-wald-chi-square-statistic."><i class="fa fa-check"></i><b>11.7.1</b> The <del>Wald chi-square statistic</del>.</a></li>
<li class="chapter" data-level="11.7.2" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#asymmetric-credible-intervals-for-parameters-and-odds-ratios."><i class="fa fa-check"></i><b>11.7.2</b> [Asymmetric credible intervals] for parameters and odds ratios.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="fitting-basic-discrete-time-hazard-models.html"><a href="fitting-basic-discrete-time-hazard-models.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html"><i class="fa fa-check"></i><b>12</b> Extending the Discrete-Time Hazard Model</a><ul>
<li class="chapter" data-level="12.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#alternative-specification-for-the-main-effect-of-time"><i class="fa fa-check"></i><b>12.1</b> Alternative specification for the “main effect” of <em>TIME</em></a><ul>
<li class="chapter" data-level="12.1.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#an-ordered-series-of-polynomial-specifications-for-time."><i class="fa fa-check"></i><b>12.1.1</b> An ordered series of polynomial specifications for <em>TIME</em>.</a></li>
<li class="chapter" data-level="12.1.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#criteria-for-comparing-alternative-specification."><i class="fa fa-check"></i><b>12.1.2</b> Criteria for comparing alternative specification.</a></li>
<li class="chapter" data-level="12.1.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-parameters-from-linear-quadratic-and-cubic-specifications."><i class="fa fa-check"></i><b>12.1.3</b> Interpreting parameters from linear, quadratic, and cubic specifications.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model"><i class="fa fa-check"></i><b>12.2</b> Using the complementary log-log link to specify a discrete-time hazard model</a><ul>
<li class="chapter" data-level="12.2.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-clog-log-transformation-when-and-why-it-is-useful."><i class="fa fa-check"></i><b>12.2.1</b> The clog-log transformation: When and why it is useful.</a></li>
<li class="chapter" data-level="12.2.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#a-discrete-time-hazard-model-using-the-complementary-log-log-link."><i class="fa fa-check"></i><b>12.2.2</b> A discrete-time hazard model using the complementary log-log link.</a></li>
<li class="chapter" data-level="12.2.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#choosing-between-logit-and-clog-log-links-for-discrete-time-hazard-models."><i class="fa fa-check"></i><b>12.2.3</b> Choosing between logit and clog-log links for discrete-time hazard models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#time-varying-predictors-1"><i class="fa fa-check"></i><b>12.3</b> Time-varying predictors</a><ul>
<li class="chapter" data-level="12.3.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#assumptions-underlying-a-model-with-time-varying-predictors."><i class="fa fa-check"></i><b>12.3.1</b> Assumptions underlying a model with time-varying predictors.</a></li>
<li class="chapter" data-level="12.3.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interpreting-and-displaying-time-varying-predictors-effects."><i class="fa fa-check"></i><b>12.3.2</b> Interpreting and displaying time-varying predictors’ effects.</a></li>
<li class="chapter" data-level="12.3.3" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#two-caveats-the-problems-of-state-and-rate-dependence."><i class="fa fa-check"></i><b>12.3.3</b> Two caveats: The problems of state and rate dependence.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-linear-additivity-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.4</b> The linear additivity assumption: Uncovering violations and simple solutions</a><ul>
<li class="chapter" data-level="12.4.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#interactions-between-substantive-predictors."><i class="fa fa-check"></i><b>12.4.1</b> Interactions between substantive predictors.</a></li>
<li class="chapter" data-level="12.4.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#nonlinear-effects."><i class="fa fa-check"></i><b>12.4.2</b> Nonlinear effects.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-proportionality-assumption-uncovering-violations-and-simple-solutions"><i class="fa fa-check"></i><b>12.5</b> The proportionality assumption: Uncovering violations and simple solutions</a><ul>
<li class="chapter" data-level="12.5.1" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#discrete-time-hazard-models-that-do-not-invoke-a-proportionality-assumption."><i class="fa fa-check"></i><b>12.5.1</b> Discrete-time hazard models that do not invoke a proportionality assumption.</a></li>
<li class="chapter" data-level="12.5.2" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#investigating-the-proportionality-assumption-in-practice."><i class="fa fa-check"></i><b>12.5.2</b> Investigating the proportionality assumption in practice.</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#the-no-unobserved-heterogeneity-assumption-no-simple-solution"><i class="fa fa-check"></i><b>12.6</b> The no unobserved heterogeneity assumption: No simple solution</a></li>
<li class="chapter" data-level="12.7" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#residual-analysis"><i class="fa fa-check"></i><b>12.7</b> Residual analysis</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="extending-the-discrete-time-hazard-model.html"><a href="extending-the-discrete-time-hazard-model.html#footnote-1"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Applied Longitudinal Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="doing-data-analysis-with-the-multilevel-model-for-change" class="section level1">
<h1><span class="header-section-number">4</span> Doing Data Analysis with the Multilevel Model for Change</h1>
<p>“We now delve deeper into the specification, estimation, and interpretation of the multilevel model for change” (p. 75).</p>
<div id="example-changes-in-adolescent-alcohol-use" class="section level2">
<h2><span class="header-section-number">4.1</span> Example: Changes in adolescent alcohol use</h2>
<p>Load the data.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb188-2" data-line-number="2"></a>
<a class="sourceLine" id="cb188-3" data-line-number="3">alcohol1_pp &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/alcohol1_pp.csv&quot;</span>)</a>
<a class="sourceLine" id="cb188-4" data-line-number="4"></a>
<a class="sourceLine" id="cb188-5" data-line-number="5"><span class="kw">head</span>(alcohol1_pp)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##      id   age   coa  male age_14 alcuse  peer  cpeer  ccoa
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1     1    14     1     0      0   1.73 1.26   0.247 0.549
## 2     1    15     1     0      1   2    1.26   0.247 0.549
## 3     1    16     1     0      2   2    1.26   0.247 0.549
## 4     2    14     1     1      0   0    0.894 -0.124 0.549
## 5     2    15     1     1      1   0    0.894 -0.124 0.549
## 6     2    16     1     1      2   1    0.894 -0.124 0.549</code></pre>
<p>Do note we already have an <span class="math inline">\((\text{age} - 14)\)</span> variable in the data, <code>age_14</code>.</p>
<p>Here’s our version of Figure 4.1, using <code>stat_smooth()</code> to get the exploratory OLS trajectories.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">alcohol1_pp <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">14</span>, <span class="dv">23</span>, <span class="dv">32</span>, <span class="dv">41</span>, <span class="dv">56</span>, <span class="dv">65</span>, <span class="dv">82</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb190-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> alcuse)) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-5" data-line-number="5"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb190-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">17</span>),</a>
<a class="sourceLine" id="cb190-8" data-line-number="8">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>By this figure, Singer and Willett suggested the simple linear level-1 submodel following the form</p>
<p><span class="math display">\[\begin{align*}
\text{alcuse}_{ij} &amp; = \pi_{0i} + \pi_{1i} (\text{age}_{ij} - 14) + \epsilon_{ij}\\
\epsilon_{ij} &amp; \sim \operatorname{Normal} (0, \sigma_\epsilon^2),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\pi_{0i}\)</span> is the initial status of participant <span class="math inline">\(i\)</span>, <span class="math inline">\(\pi_{1i}\)</span> is participant <span class="math inline">\(i\)</span>’s rate of change, and <span class="math inline">\(\epsilon_{ij}\)</span> is the variation in participant <span class="math inline">\(i\)</span>’s data not accounted for in the model.</p>
<p>Singer and Willett made their Figure 4.2 “with a random sample of 32 of the adolescents” (p. 78). If we just wanted a random sample of rows, the <code>sample_n()</code> function would do the job. But since we’re working with long data, we’ll need some <code>group_by()</code> + <code>nest()</code> mojo. I got the trick from <a href="https://twitter.com/JennyBryan">Jenny Bryan</a>’s <a href="https://jennybc.github.io/purrr-tutorial/ls12_different-sized-samples.html"><em>Sample from groups, n varies by group</em></a>. Setting the seed makes the results from <code>sample_n()</code> reproducible. Here are the top panels.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb191-2" data-line-number="2"></a>
<a class="sourceLine" id="cb191-3" data-line-number="3">alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-5" data-line-number="5"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-6" data-line-number="6"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">32</span>, <span class="dt">replace =</span> T) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-7" data-line-number="7"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">coa =</span> <span class="kw">ifelse</span>(coa <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;coa = 0&quot;</span>, <span class="st">&quot;coa = 1&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-9" data-line-number="9"></a>
<a class="sourceLine" id="cb191-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> alcuse, <span class="dt">group =</span> id)) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-11" data-line-number="11"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">17</span>),</a>
<a class="sourceLine" id="cb191-13" data-line-number="13">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>coa)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We have similar data wrangling needs for the bottom panels.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb192-2" data-line-number="2"></a>
<a class="sourceLine" id="cb192-3" data-line-number="3">alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-5" data-line-number="5"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-7" data-line-number="7"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">32</span>, <span class="dt">replace =</span> T) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hp =</span> <span class="kw">ifelse</span>(peer <span class="op">&lt;</span><span class="st"> </span><span class="kw">mean</span>(peer), <span class="st">&quot;low peer&quot;</span>, <span class="st">&quot;high peer&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hp =</span> <span class="kw">factor</span>(hp, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;low peer&quot;</span>, <span class="st">&quot;high peer&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-11" data-line-number="11"></a>
<a class="sourceLine" id="cb192-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> alcuse, <span class="dt">group =</span> id)) <span class="op">+</span></a>
<a class="sourceLine" id="cb192-13" data-line-number="13"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb192-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">17</span>),</a>
<a class="sourceLine" id="cb192-15" data-line-number="15">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb192-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb192-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>hp)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Based on the exploratory analyses, Singer and Willett posited the initial level-2 submodel might take the form</p>
<p><span class="math display">\[\begin{align*}
\pi_{0i} &amp; = \gamma_{00} + \gamma_{01} \text{coa}_i + \zeta_{0i}\\
\pi_{1i} &amp; = \gamma_{10} + \gamma_{11} \text{coa}_i + \zeta_{1i} \\

\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp; \sim \operatorname{Normal} \Bigg ( 
\begin{bmatrix} 0 \\ 0 \end{bmatrix}, 
\begin{bmatrix} \sigma_0^2 &amp; \sigma_{01}\\ \sigma_{01} &amp; \sigma_1^2 \end{bmatrix}
\Bigg ),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{00}\)</span> and <span class="math inline">\(\gamma_{10}\)</span> are the level-2 intercepts, the population averages when <span class="math inline">\(\text{coa} = 0\)</span>, <span class="math inline">\(\gamma_{10}\)</span> and <span class="math inline">\(\gamma_{11}\)</span> are the level-2 slopes expressing the difference when <span class="math inline">\(\text{coa} = 1\)</span> and <span class="math inline">\(\zeta_{0i}\)</span> and <span class="math inline">\(\zeta_{1i}\)</span> are the unexplained variation across the <span class="math inline">\(\text{id}\)</span>-level intercepts and slopes. Since we’ll be fitting the model with <code>brms::brm()</code>, the <span class="math inline">\(\Sigma\)</span> matrix will be parameterized in the <span class="math inline">\(\sigma\)</span> metric. So we might reexpress the model as</p>
<p><span class="math display">\[\begin{align*}
\pi_{0i} &amp; = \gamma_{00} + \gamma_{01} \text{coa}_i + \zeta_{0i}\\
\pi_{1i} &amp; = \gamma_{10} + \gamma_{11} \text{coa}_i + \zeta_{1i} \\

\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp; \sim \operatorname{Normal} \Bigg ( 
\begin{bmatrix} 0 \\ 0 \end{bmatrix}, 
\begin{bmatrix} \sigma_0 &amp; \rho_{01}\\ \rho_{01} &amp; \sigma_1 \end{bmatrix}
\Bigg ).
\end{align*}\]</span></p>
</div>
<div id="the-composite-specification-of-the-multilevel-model-for-change" class="section level2">
<h2><span class="header-section-number">4.2</span> The composite specification of the multilevel model for change</h2>
<p>With a little algebra, we can combine the level-1 and level-2 submodels into the composite multilevel model for change, which follows the form</p>
<p><span class="math display">\[\begin{align*}
\text{alcuse}_{ij} &amp; = \big [ \gamma_{00} + \gamma_{10} \text{age_14}_{ij} + \gamma_{01} \text{coa}_i + \gamma_{11} (\text{coa}_i \times \text{age_14}_{ij}) \big ] \\
&amp; \;\;\;\;\; + [ \zeta_{0i} + \zeta_{1i} \text{age_14}_{ij} + \epsilon_{ij} ] \\
\epsilon_{ij} &amp; \sim \operatorname{Normal} (0, \sigma_\epsilon^2) \\

\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp; \sim \operatorname{Normal} 
\Bigg ( 
\begin{bmatrix} 0 \\ 0 \end{bmatrix}, 
\begin{bmatrix} \sigma_0^2 &amp; \sigma_{01} \\ \sigma_{01} &amp; \sigma_1^2 \end{bmatrix}
\Bigg ),
\end{align*}\]</span></p>
<p>where the brackets in the first line partition the structural model (i.e., the model for <span class="math inline">\(\mu\)</span>) and the stochastic components (i.e., the <span class="math inline">\(\sigma\)</span> terms). We should note that this is the format that most closely mirrors what we use in the <code>formula</code> argument in <code>brms::brm()</code>. As long as <code>age</code> is not centered on the mean, our <strong>brms</strong> syntax would be: <code>formula = alcuse ~ 0 + Intercept + age_c + coa + age_c:coa + (1 + age_c | id)</code>.</p>
<div id="the-structural-component-of-the-composite-model." class="section level3">
<h3><span class="header-section-number">4.2.1</span> The structural component of the composite model.</h3>
<blockquote>
<p>Although their interpretation is identical, the <span class="math inline">\(\gamma\)</span>s in the composite model describe patterns of change in a different way. Rather than postulating first how <em>ALCUSE</em> is related to <em>TIME</em> and the individual growth parameters, and second how the individual growth parameters are related to <em>COA</em>, the composite specification in equation 4.3 postulates that <em>ALCUSE</em> depends <em>simultaneously</em> on: (1) the level-1 predictor, <em>TIME</em>; (2) the level-2 predictor, <em>COA</em>; and (3) the <em>cross-level</em> interaction, <em>COA</em> by <em>TIME</em>. From this perspective, the composite model’s structural portion strongly resembles a regular regression model with predictors, <em>TIME</em> and <em>COA</em>, appearing as main effects (associated with <span class="math inline">\(\gamma_{10}\)</span> and <span class="math inline">\(\gamma_{01}\)</span>, respectively) and in a <em>cross-level</em> interaction (associated with <span class="math inline">\(\gamma_{11}\)</span>). (p. 82, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="the-stochastic-component-of-the-composite-model." class="section level3">
<h3><span class="header-section-number">4.2.2</span> The stochastic component of the composite model.</h3>
<blockquote>
<p>A distinctive feature of the composite multilevel model is its composite residual, the three terms in the second set of brackets on the right of equation 4.3 that combine together the level-1 residual and the two level-2 residuals:</p>
<p><span class="math display">\[\text{Composite residual: } [ \zeta_{0i} +  \zeta_{1i} \text{age_14}_{ij} + \epsilon_{ij} ].\]</span>
The composite residual is not a simple sum. Instead, the second level-2 residual, <span class="math inline">\(\zeta_{1i}\)</span>, is multiplied by the level-1 predictor, <span class="math inline">\([\text{age_14}_{ij}]\)</span>, before joining its siblings. Despite its unusual construction, the interpretation of the composite residual is straightforward: it describes the difference between the observed and expected value of <span class="math inline">\([\text{alcuse}]\)</span> for individual <span class="math inline">\(i\)</span> on occasion <span class="math inline">\(j\)</span>.</p>
<p>The mathematical form of the composite residual reveals two important properties about the occasion-specific residuals not readily apparent in the level-1/level-2 specification: they can be both <em>autocorrelated</em> and <em>heteroscedastic</em> within person. (p. 84, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
</div>
<div id="methods-of-estimation-revisited" class="section level2">
<h2><span class="header-section-number">4.3</span> Methods of estimation, revisited</h2>
<p>In this section, the authors introduced generalized least squares (GLS) estimation and iterative generalized least squares (IGLS) estimation and then distinguished between full and restricted maximum likelihood estimation. Since our goal is to fit these models as Bayesians, we won’t be using or discussing any of these in this project. There are, of course, different ways to approach Bayesian estimation. Though we’re using Hamiltonian Monte Carlo, we could use other algorithms, such as the Gibbs sampler. However, all that is outside of the scope of this project.</p>
<p>I suppose the only thing to add is that whereas GLS estimates come from mimimizing a weighted function of the residuals and maximum likelihood estimates come from maximizing the log-likelihood function, the results of our Bayesian analyses (i.e., the posterior distribution) come from the consequences of Bayes theorem,</p>
<p><span class="math display">\[
p(\theta | d) = \frac{p(d | \theta) p(\theta)}{p(d)}.
\]</span></p>
<p>If you really want to dive into the details of this, I suggest referencing a proper introductory Bayesian textbook, such as McElreath (<a href="https://xcelab.net/rm/statistical-rethinking/">2015</a>), Kruschke (<a href="http://www.indiana.edu/~kruschke/DoingBayesianDataAnalysis/">2015</a>), or Gelman, Carlin, Stern, Dunson, Vehtari, and Rubin (<a href="http://www.stat.columbia.edu/~gelman/book/">2013</a>). I haven’t had time to check it out, but I’ve heard Labmert’s (<a href="https://ben-lambert.com/a-students-guide-to-bayesian-statistics/">2018</a>) text is good, too. And for details specific to Stan, and thus <strong>brms</strong>, you might check out the documentation resources at <a href="https://mc-stan.org/users/documentation/">https://mc-stan.org/users/documentation/</a>.</p>
</div>
<div id="first-steps-fitting-two-unconditional-multilevel-models-for-change" class="section level2">
<h2><span class="header-section-number">4.4</span> First steps: Fitting two unconditional multilevel models for change</h2>
<p>Singer and Willett recommended that before you fit your full theoretical multilevel model of change–the one with all the interesting covariates–you should fit two simpler preliminary models. The first is the <em>unconditional means model</em>. The second is the <em>unconditional growth model</em>.</p>
<p>I agree. In addition to the reasons they cover in the text, this is just good pragmatic data analysis. Start simple and build up to the more complicated models only after you’re confident you understand what’s going on with the simpler ones. And if you’re new to them, you’ll discover this is especially so with Bayesian methods.</p>
<div id="the-unconditional-means-model." class="section level3">
<h3><span class="header-section-number">4.4.1</span> The unconditional means model.</h3>
<p>The likelihood for the unconditional means model follows the formula</p>
<p><span class="math display">\[\begin{align*}
\text{alcuse}_{ij} &amp; =  \gamma_{00} +  \zeta_{0i} + \epsilon_{ij} \\
\epsilon_{ij} &amp; \sim \operatorname{Normal} (0, \sigma_\epsilon^2) \\
\zeta_{0i} &amp; \sim \operatorname{Normal} (0, \sigma_0^2).
\end{align*}\]</span></p>
<p>Let’s open <strong>brms</strong>.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>Up till this point, we haven’t focused on priors. It would have been reasonable to wonder if we’d been using them at all. Yes, we have. Even if you don’t specify priors in the <code>brm()</code> function, it’ll compute default weakly-informative priors for you. You might be wondering, <em>What might these default priors look like?</em> The <code>get_prior()</code> function let us take a look.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1"><span class="kw">get_prior</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb194-2" data-line-number="2">          <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb194-3" data-line-number="3">          alcuse <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id))</a></code></pre></div>
<pre><code>##                 prior     class      coef group resp dpar nlpar bound
## 1 student_t(3, 1, 10) Intercept                                      
## 2 student_t(3, 0, 10)        sd                                      
## 3                            sd              id                      
## 4                            sd Intercept    id                      
## 5 student_t(3, 0, 10)     sigma</code></pre>
<p>For this model, all three priors are based on Student’s <span class="math inline">\(t\)</span>-distribution. In case you’re rusty, the Normal distribution is just a special case of Student’s <span class="math inline">\(t\)</span>-distribution. Whereas the Normal is defined by two parameters (<span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>), the <span class="math inline">\(t\)</span> distribution is defined by <span class="math inline">\(\nu\)</span>, <span class="math inline">\(\mu\)</span>, and <span class="math inline">\(\sigma\)</span>. In frequentist circles, <span class="math inline">\(\nu\)</span> is often called the degrees of freedom. More generally, it’s also referred to as a normality parameter. We’ll examine the prior more closely in a bit.</p>
<p>For now, let’s practice setting our priors by manually specifying them within <code>brm()</code>. You do with the <code>prior</code> argument. There are actually several ways to do this. To explore all the options, check out the <code>set_prior</code> section of the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf">reference manual</a>. I typically define my individual priors with the <code>prior()</code> function. When there are more than one priors to define, I typically bind them together within <code>c(...)</code>.</p>
<p>Other than the addition of our fancy <code>prior</code> statement, the rest of the settings within <code>brm()</code> are much like those in prior chapters. Let’s fit the model.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1">fit4<span class="fl">.1</span> &lt;-</a>
<a class="sourceLine" id="cb196-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb196-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb196-4" data-line-number="4">      alcuse <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id),</a>
<a class="sourceLine" id="cb196-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb196-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sd),</a>
<a class="sourceLine" id="cb196-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb196-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb196-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb196-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit04.01&quot;</span>)</a></code></pre></div>
<p>Here are the results.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1"><span class="kw">print</span>(fit4<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: alcuse ~ 1 + (1 | id) 
##    Data: alcohol1_pp (Number of observations: 246) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 82) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.77      0.08     0.62     0.94 1.00     1662     2274
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.92      0.10     0.72     1.12 1.00     2602     2734
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.76      0.04     0.68     0.84 1.00     3219     3327
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Compare the results to those listed under “Model A” in Table 4.1. It’s important to keep in mind that <strong>brms</strong> returns ‘sigma’ and ‘sd(Intercept)’ in the standard deviation metric rather than the variance metric. “<em>But I want them in the variance metric like in the text!</em>”, you say. Okay fine. The best way to do the transformations is after saving the results from <code>posterior_samples()</code>.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit4<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb199-2" data-line-number="2"></a>
<a class="sourceLine" id="cb199-3" data-line-number="3"><span class="kw">glimpse</span>(post[, <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>])</a></code></pre></div>
<pre><code>## Rows: 4,000
## Columns: 12
## $ b_Intercept         &lt;dbl&gt; 1.0327617, 1.0176357, 0.8999551, 1.0666116, 0.9471380, 1.0461035, 0.9…
## $ sd_id__Intercept    &lt;dbl&gt; 0.9317019, 0.9259266, 0.7670859, 0.6670863, 0.7075109, 0.7324726, 0.8…
## $ sigma               &lt;dbl&gt; 0.7657679, 0.7630844, 0.8073889, 0.6964495, 0.7029354, 0.7410712, 0.7…
## $ `r_id[1,Intercept]` &lt;dbl&gt; 0.7525755, 1.1180550, 0.4892602, 0.9660265, 0.9259051, 0.8063631, 0.7…
## $ `r_id[2,Intercept]` &lt;dbl&gt; 0.07598890, -0.13078777, -0.26457278, -0.64529871, -0.72063809, -0.55…
## $ `r_id[3,Intercept]` &lt;dbl&gt; 1.3955514, 0.8532742, 0.8310599, 1.3219625, 1.2018000, 0.3310101, 1.5…
## $ `r_id[4,Intercept]` &lt;dbl&gt; 0.41462311, 0.40985772, -0.48227528, 0.57693850, 0.74470742, -0.04842…
## $ `r_id[5,Intercept]` &lt;dbl&gt; -0.94622094, -1.39462489, -0.47880633, -0.55613003, -0.61670702, -0.5…
## $ `r_id[6,Intercept]` &lt;dbl&gt; 1.125702, 1.736155, 1.708224, 1.919763, 1.945292, 1.292308, 1.628131,…
## $ `r_id[7,Intercept]` &lt;dbl&gt; 0.8668786, 0.9029424, 0.4616220, 0.5419488, 0.9775908, 0.1501572, 1.2…
## $ `r_id[8,Intercept]` &lt;dbl&gt; 0.06167846, -0.36815820, -1.12403522, -0.27823892, -0.99175538, -0.47…
## $ `r_id[9,Intercept]` &lt;dbl&gt; 0.30049368, 0.45626836, 0.09886899, 1.03263516, 0.97242471, -0.417528…</code></pre>
<p>Since all we’re interested in are the variance components, we’ll <code>select()</code> out the relevant columns from <code>post</code>, compute the squared versions, and save the results in a mini data frame, <code>v</code>.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1">v &lt;-</a>
<a class="sourceLine" id="cb201-2" data-line-number="2"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb201-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(sigma, sd_id__Intercept) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb201-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sigma_2_epsilon =</span> sigma<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb201-5" data-line-number="5">         <span class="dt">sigma_2_0       =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb201-6" data-line-number="6"></a>
<a class="sourceLine" id="cb201-7" data-line-number="7"><span class="kw">head</span>(v)</a></code></pre></div>
<pre><code>##       sigma sd_id__Intercept sigma_2_epsilon sigma_2_0
## 1 0.7657679        0.9317019       0.5864005 0.8680685
## 2 0.7630844        0.9259266       0.5822978 0.8573400
## 3 0.8073889        0.7670859       0.6518768 0.5884208
## 4 0.6964495        0.6670863       0.4850419 0.4450042
## 5 0.7029354        0.7075109       0.4941182 0.5005717
## 6 0.7410712        0.7324726       0.5491865 0.5365161</code></pre>
<p>We can view their distributions like this.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1">v <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb203-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb203-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb203-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.5</span>, <span class="fl">.75</span>, <span class="dv">1</span>), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.25</span>),</a>
<a class="sourceLine" id="cb203-8" data-line-number="8">                     <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="fl">1.25</span>, <span class="dt">by =</span> <span class="fl">.25</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In case it’s hard to follow what just happened, the estimates in the <strong>brms</strong>-default standard-deviation metric are the two panels on the top. Those on the bottom are in the Singer-and-Willett style variance metric. Like we discussed toward the end of last chapter, the variance parameters won’t often be Gaussian. In my experience, they’re typically skewed to the right. There’s nothing wrong with that. This is a recurrent pattern among distributions that are constrained to be zero and above.</p>
<p>If you’re interested, you can summarize those posteriors like so.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">v <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb204-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb204-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb204-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb204-5" data-line-number="5">            <span class="dt">median =</span> <span class="kw">median</span>(value),</a>
<a class="sourceLine" id="cb204-6" data-line-number="6">            <span class="dt">sd     =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb204-7" data-line-number="7">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb204-8" data-line-number="8">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb204-9" data-line-number="9"><span class="st">  </span><span class="co"># this last bit just rounds the output</span></a>
<a class="sourceLine" id="cb204-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   name              mean median    sd    ll    ul
##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 sd_id__Intercept 0.767  0.762 0.083 0.616 0.939
## 2 sigma            0.756  0.755 0.041 0.68  0.841
## 3 sigma_2_0        0.596  0.580 0.13  0.38  0.882
## 4 sigma_2_epsilon  0.574  0.570 0.062 0.463 0.707</code></pre>
<p>For this model, our posterior medians are closer to the estimates in the text (Table 4.1) than the means. However, our posterior standard deviations are pretty close to the standard errors in the text.</p>
<p>One of the advantages of our Bayesian method is that when we compute something like the intraclass correlation coefficient <span class="math inline">\(\rho\)</span>, we get an entire distribution for the parameter rather than a measly point estimates. This is always the case with Bayes. The algebraic transformations of the posterior distribution are themselves distributions. Before we compute <span class="math inline">\(\rho\)</span>, do pay close attention to the formulia,</p>
<p><span class="math display">\[
\rho = \frac{\sigma_0^2}{\sigma_0^2 + \sigma_\epsilon^2}.
\]</span></p>
<p>Even though our <strong>brms</strong> output yields the variance parameters in the standard-deviation metric, the formula for <span class="math inline">\(\rho\)</span> demands we use variances. That’s nothing a little squaring can’t fix. Here’s what our <span class="math inline">\(\rho\)</span> looks like.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">v <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb206-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">rho =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sd_id__Intercept<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb206-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb206-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rho)) <span class="op">+</span></a>
<a class="sourceLine" id="cb206-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb206-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(rho), <span class="dt">limits =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb206-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb206-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-14-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Though the posterior for <span class="math inline">\(\rho\)</span> is indeed centered around .5, look at how wide and uncertain that distribution is. The bulk of the posterior mass takes up almost half of the parameter space. If you wanted the summary statistics, you might do what we did for the variance parameters, above.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1">v <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb207-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">rho =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sd_id__Intercept<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb207-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(rho),</a>
<a class="sourceLine" id="cb207-4" data-line-number="4">            <span class="dt">median =</span> <span class="kw">median</span>(rho),</a>
<a class="sourceLine" id="cb207-5" data-line-number="5">            <span class="dt">sd     =</span> <span class="kw">sd</span>(rho),</a>
<a class="sourceLine" id="cb207-6" data-line-number="6">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(rho, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb207-7" data-line-number="7">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(rho, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb207-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##    mean median    sd    ll    ul
## 1 0.505  0.505 0.063 0.376 0.625</code></pre>
<p>Concerning <span class="math inline">\(\rho\)</span>, Singer and Willett pointed out</p>
<blockquote>
<p>it summarizes the size of the residual autocorrelation in the composite unconditional means mode…</p>
<p>Each person has a different composite residual on each occasion of measurement. But notice the difference in the subscripts of the pieces of the composite residual: while the level-1 residual, <span class="math inline">\(\epsilon_{ij}\)</span> has two subscripts (<span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>), the level-2 residual, <span class="math inline">\(\zeta_{0i}\)</span>, has only one (<span class="math inline">\(i\)</span>). Each person can have a different <span class="math inline">\(\epsilon_{ij}\)</span> on each occasion, but has only one <span class="math inline">\(\zeta_{0i}\)</span> across every occasion. The repeated presence of <span class="math inline">\(\zeta_{0i}\)</span> in individual <span class="math inline">\(i\)</span>’s composite residual links his or her composite residuals across occasions. The error autocorrelation coefficient quantifies the magnitude of this linkage; in the unconditional means model, the error autocorrelation coefficient <em>is</em> the intraclass correlation coefficient. Thus, we estimate that, for each person, the average correlation between any pair of composite residuals–between occasions 1 and 2, or 2 and 3, or 1 and 3–is [.5]. (pp. 96–97, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Because of the differences in how they’re estimated with and presented by <code>brm()</code>, we focused right on the variance components. But before we move on to the next section, we should back up a bit. On page 93, Singer and Willett discussed their estimate for <span class="math inline">\(\gamma_{00}\)</span>. Here’s ours.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1"><span class="kw">fixef</span>(fit4<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##            Estimate Est.Error     Q2.5    Q97.5
## Intercept 0.9183551 0.1003442 0.722879 1.118637</code></pre>
<p>They talked about how squaring that value puts it back to the natural metric the data were originally collected in. [Recall that as discussed earlier in the text the <code>alcuse</code> variable was square-root transformed because of excessive skew.] If you want a quick and dirty look, you can square our results, too.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1"><span class="kw">fixef</span>(fit4<span class="fl">.1</span>)<span class="op">^</span><span class="dv">2</span> </a></code></pre></div>
<pre><code>##            Estimate  Est.Error     Q2.5    Q97.5
## Intercept 0.8433761 0.01006895 0.522554 1.251349</code></pre>
<p>However, I do not recommend this method. Though it did okay at transforming the posterior mean (i.e., Estimate), it’s not a great way to get the summary statistics correct. To do that, you’ll need to work with the posterior samples themselves. Remember how we saved them as <code>post</code>? Let’s refresh ourselves and look at the first few columns.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1">post[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>##   b_Intercept sd_id__Intercept     sigma
## 1   1.0327617        0.9317019 0.7657679
## 2   1.0176357        0.9259266 0.7630844
## 3   0.8999551        0.7670859 0.8073889
## 4   1.0666116        0.6670863 0.6964495
## 5   0.9471380        0.7075109 0.7029354
## 6   1.0461035        0.7324726 0.7410712</code></pre>
<p>See that <code>b_Intercept</code> column there? That contains our posterior draws from <span class="math inline">\(\gamma_{00}\)</span>. If you want proper summary statistics from the transformed estimate, get them after transforming that column.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb215-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">gamma_00_squared =</span> b_Intercept<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb215-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(gamma_<span class="dv">00</span>_squared),</a>
<a class="sourceLine" id="cb215-4" data-line-number="4">            <span class="dt">median =</span> <span class="kw">median</span>(gamma_<span class="dv">00</span>_squared),</a>
<a class="sourceLine" id="cb215-5" data-line-number="5">            <span class="dt">sd     =</span> <span class="kw">sd</span>(gamma_<span class="dv">00</span>_squared),</a>
<a class="sourceLine" id="cb215-6" data-line-number="6">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(gamma_<span class="dv">00</span>_squared, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb215-7" data-line-number="7">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(gamma_<span class="dv">00</span>_squared, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb215-9" data-line-number="9"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>())</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   name   value
##   &lt;chr&gt;  &lt;dbl&gt;
## 1 mean   0.853
## 2 median 0.84 
## 3 sd     0.185
## 4 ll     0.523
## 5 ul     1.25</code></pre>
<p>And one last bit before we move on to the next section. Remember how we discovered what the <code>brm()</code> default priors were for our model with the handy <code>get_prior()</code> function? Let’s refresh ourselves on how that worked.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1"><span class="kw">get_prior</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb217-2" data-line-number="2">          <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb217-3" data-line-number="3">          alcuse <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id))</a></code></pre></div>
<pre><code>##                 prior     class      coef group resp dpar nlpar bound
## 1 student_t(3, 1, 10) Intercept                                      
## 2 student_t(3, 0, 10)        sd                                      
## 3                            sd              id                      
## 4                            sd Intercept    id                      
## 5 student_t(3, 0, 10)     sigma</code></pre>
<p>We inserted the data and the model and <code>get_prior()</code> returned the default priors. Especially for new Bayesians, or even for experienced Bayesians working with unfamiliar models, it can be handy to plot your priors to get a sense of them.</p>
<p>Base <strong>R</strong> has an array of functions based on the <span class="math inline">\(t\)</span> distribution (e.g., <code>rt()</code>, <code>dt()</code>). These functions are limited in that while they allow users to select the desired <span class="math inline">\(\nu\)</span> values (i.e., degrees of freedom), they fix <span class="math inline">\(\mu = 0\)</span> and <span class="math inline">\(\sigma = 1\)</span>. If you want to stick with the base <strong>R</strong> functions, you can find tricky ways around this. To avoid overwhelming anyone new to Bayes or the multilevel model or <strong>R</strong> or some exasperating combination, let’s just make things simpler and use a different function. As it turns out, the <a href="https://cran.r-project.org/web/packages/metRology/index.html"><strong>metrology</strong> package</a> contains a <code>dt.scaled()</code> function that allows users to define all three parameters for Student’s <span class="math inline">\(t\)</span>.</p>
<p>We’ll start with the default intercept prior, <span class="math inline">\(t(\nu = 3, \mu = 1, \sigma = 10)\)</span>. Here’s the density in the range <span class="math inline">\([-100, 100]\)</span>.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-100</span>, <span class="dt">to =</span> <span class="dv">100</span>, <span class="dt">length.out =</span> <span class="fl">1e3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb219-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> metRology<span class="op">::</span><span class="kw">dt.scaled</span>(x, <span class="dt">df =</span> <span class="dv">3</span>, <span class="dt">mean =</span> <span class="dv">1</span>, <span class="dt">sd =</span> <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb219-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb219-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb219-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb219-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb219-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;prior for &quot;</span>, gamma[<span class="dv">0</span>][<span class="dv">0</span>])),</a>
<a class="sourceLine" id="cb219-8" data-line-number="8">       <span class="dt">x =</span> <span class="st">&quot;parameter space&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb219-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-21-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Though it’s centered on 1, the bulk of the mass seems to range from -40 to 40. Given the model estimate ended up about 0.9, it looks like that was a pretty broad and minimally-informative prior. However, the prior isn’t flat and it does help guard against wasting time and HMC iterations sampling from ridiculous regions of the parameter space such as -10,000 or +500,000,000. No adolescent is drinking that much (or that little–how does one drink a negative value?).</p>
<p>Here’s the shape of the variance priors.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">100</span>, <span class="dt">length.out =</span> <span class="fl">1e3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> metRology<span class="op">::</span><span class="kw">dt.scaled</span>(x, <span class="dt">df =</span> <span class="dv">3</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb220-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb220-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb220-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb220-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb220-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;prior for both &quot;</span>, sigma[<span class="dv">0</span>], <span class="st">&quot; and &quot;</span>, sigma[epsilon])),</a>
<a class="sourceLine" id="cb220-8" data-line-number="8">       <span class="dt">x =</span> <span class="st">&quot;parameter space&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb220-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-22-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Recall that by <strong>brms</strong> default, the variance parameters have a lower-limit of 0. So specifying a Student’s <span class="math inline">\(t\)</span> or other Gaussian-like prior on them ends up cutting the distribution off at 0. Given that our estimates were both below 1, it appears that these priors were minimally informative. But again, they did help prevent <code>brm()</code> from sampling from negative values or from obscenely-large values.</p>
<p><em>These priors look kinda silly</em>, you might say. <em>Anyone with a little common sense can do better</em>. Well, sure. Probably. Maybe. But keep in mind we’re still getting the layout of the land. And plus, this was a pretty simple model. Selecting high-quality priors gets tricky as the models get more complicated. In other chapters, we’ll explore other ways to specify priors for our multilevel models. But to keep things simple for now, let’s keep practicing inspecting and using the defaults with <code>get_prior()</code> and so on.</p>
</div>
<div id="the-unconditional-growth-model." class="section level3">
<h3><span class="header-section-number">4.4.2</span> The unconditional growth model.</h3>
<p>Using the composite formula, our next model, the unconditional growth model, follows the form</p>
<p><span class="math display">\[\begin{align*}
\text{alcuse}_{ij} &amp; = \gamma_{00} + \gamma_{10} \text{age_14}_{ij} + \zeta_{0i} + \zeta_{1i} \text{age_14}_{ij} + \epsilon_{ij} \\
\epsilon_{ij} &amp; \sim \operatorname{Normal} (0, \sigma_\epsilon^2) \\
\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp; \sim \operatorname{Normal} 
\Bigg ( 
\begin{bmatrix} 0 \\ 0 \end{bmatrix}, 
\begin{bmatrix} \sigma_0^2 &amp; \sigma_{01} \\ \sigma_{01} &amp; \sigma_1^2 \end{bmatrix}
\Bigg ).
\end{align*}\]</span></p>
<p>With it, we now have a full composite stochastic model. Let’s query the <code>brms::brm()</code> default priors when we apply this model to our data.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1"><span class="kw">get_prior</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb221-2" data-line-number="2">          <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb221-3" data-line-number="3">          alcuse <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">|</span><span class="st"> </span>id))</a></code></pre></div>
<pre><code>##                  prior class      coef group resp dpar nlpar bound
## 1                          b                                      
## 2                          b    age_14                            
## 3                          b Intercept                            
## 4               lkj(1)   cor                                      
## 5                        cor              id                      
## 6  student_t(3, 0, 10)    sd                                      
## 7                         sd              id                      
## 8                         sd    age_14    id                      
## 9                         sd Intercept    id                      
## 10 student_t(3, 0, 10) sigma</code></pre>
<p>Several things of note: First, notice how we continue to use the <code>student_t(3, 0, 10)</code> for all three of our standard-deviation-metric variance parameters. Since we’re now estimating <span class="math inline">\(\sigma_0\)</span> and <span class="math inline">\(\sigma_1\)</span>, which themselves have a correlation, <span class="math inline">\(\rho_{01}\)</span>, we have a prior of <code>class = cor</code>. I’m going to put off what is meant by the name <code>lkj</code>, but for the moment just realize that this prior is essentially noninformative within this context.</p>
<p>There’s a major odd development with this output. Notice how there’s the <code>prior</code> column is empty for the rows for our two coefficients of class <code>b</code>. And if you’re a little confused, recall that because our predictor <code>age_14</code> is not mean-centered, we’ve used the <code>0 + Intercept</code> syntax, which switches the model intercept parameter to the class of <code>b</code>. Anyway, it might seem odd that the <code>prior</code> values for those rows are blank. From the <code>set_prior</code> section of the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf">reference manual</a> for <strong>brms</strong> version 2.12.0, we read: “The default prior for population-level effects (including monotonic and category specific effects) is an improper flat prior over the reals” (p. 179). At present, these priors are uniform across the entire parameter space. They’re not just weak, their entirely noninformative. That is, the likelihood dominates the posterior for those parameters.</p>
<p>Here’s how to fit the model with these priors.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">fit4<span class="fl">.2</span> &lt;-</a>
<a class="sourceLine" id="cb223-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb223-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb223-4" data-line-number="4">      alcuse <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">|</span><span class="st"> </span>id),</a>
<a class="sourceLine" id="cb223-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sd),</a>
<a class="sourceLine" id="cb223-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb223-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">lkj</span>(<span class="dv">1</span>), <span class="dt">class =</span> cor)),</a>
<a class="sourceLine" id="cb223-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb223-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb223-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit04.02&quot;</span>)</a></code></pre></div>
<p>How did we do?</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1"><span class="kw">print</span>(fit4<span class="fl">.2</span>, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: alcuse ~ 0 + Intercept + age_14 + (1 + age_14 | id) 
##    Data: alcohol1_pp (Number of observations: 246) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 82) 
##                       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.786     0.099    0.598    0.995 1.003     1148     1952
## sd(age_14)               0.358     0.094    0.141    0.519 1.004      405      464
## cor(Intercept,age_14)   -0.106     0.266   -0.493    0.592 1.004      675      795
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept    0.648     0.108    0.438    0.870 1.003     1806     2103
## age_14       0.273     0.064    0.149    0.399 1.001     3237     2825
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.609     0.052    0.518    0.718 1.003      521     1239
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>If your compare our results with those in the “Model B” column in Table 4.1, you’ll see our summary results match well with those in the text. Our <span class="math inline">\(\gamma\)</span>s (i.e., ‘Population-Level Effects:’) are near identical. The leftmost panel in Figure 4.3 shows the prototypical trajectory, based on the <span class="math inline">\(\gamma\)</span>s. A quick way to get that within our <strong>brms</strong> framework is with the <code>conditional_effects()</code> function. Here’s the default output.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1"><span class="kw">conditional_effects</span>(fit4<span class="fl">.2</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-25-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>Staying with <code>conditional_effects()</code> allows users some flexibility for customizing the plot(s). For example, the default behavior is to depict the trajectory in terms of its 95% intervals and posterior median. If you’d prefer the 80% intervals and the posterior mean, customize it like so.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1"><span class="kw">conditional_effects</span>(fit4<span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb227-2" data-line-number="2">                    <span class="dt">robust =</span> F,</a>
<a class="sourceLine" id="cb227-3" data-line-number="3">                    <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.9</span>))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-26-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>We’ll explore more options with <code>brms::conditional_effects()</code> with Model C. For now, let’s turn our focus on the stochastic elements in the model. Here we extract the posterior samples and do the conversions to see how they compare with Singer and Willett’s.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit4<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb228-2" data-line-number="2"></a>
<a class="sourceLine" id="cb228-3" data-line-number="3">v &lt;-</a>
<a class="sourceLine" id="cb228-4" data-line-number="4"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb228-5" data-line-number="5"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">sigma_2_epsilon =</span> sigma<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb228-6" data-line-number="6">            <span class="dt">sigma_2_0       =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb228-7" data-line-number="7">            <span class="dt">sigma_2_1       =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb228-8" data-line-number="8">            <span class="dt">sigma_01        =</span> sd_id__Intercept <span class="op">*</span><span class="st"> </span>cor_id__Intercept__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>sd_id__age_<span class="dv">14</span>)</a>
<a class="sourceLine" id="cb228-9" data-line-number="9"></a>
<a class="sourceLine" id="cb228-10" data-line-number="10"><span class="kw">head</span>(v)</a></code></pre></div>
<pre><code>##   sigma_2_epsilon sigma_2_0 sigma_2_1    sigma_01
## 1       0.4641867 0.4946951 0.1548531 -0.08353620
## 2       0.3582816 0.4775434 0.1404647 -0.01830842
## 3       0.4210113 0.7406254 0.1261567 -0.07041419
## 4       0.3491970 0.5348618 0.1102675 -0.04012958
## 5       0.3573036 0.7199475 0.1797023 -0.11079723
## 6       0.3713001 0.7513729 0.1304161 -0.11221189</code></pre>
<p>This time, our <code>v</code> object only contains the stochastic components in the variance metric. Let’s plot.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">v <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb230-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb230-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb230-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb230-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb230-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb230-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb230-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-28-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>For each, their posterior mass is centered near the point estimates Singer and Willet reported in the text. Here are the summary statistics.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">v <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb231-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb231-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb231-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb231-5" data-line-number="5">            <span class="dt">median =</span> <span class="kw">median</span>(value),</a>
<a class="sourceLine" id="cb231-6" data-line-number="6">            <span class="dt">sd     =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb231-7" data-line-number="7">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb231-8" data-line-number="8">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb231-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   name              mean median    sd     ll    ul
##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 sigma_01        -0.047 -0.042 0.074 -0.207 0.081
## 2 sigma_2_0        0.628  0.619 0.159  0.357 0.989
## 3 sigma_2_1        0.137  0.135 0.063  0.02  0.269
## 4 sigma_2_epsilon  0.374  0.367 0.064  0.268 0.516</code></pre>
<p>Happily, they’re quite comparable to those in the text.</p>
<p>We’ve been pulling the posterior samples for all parameters with <code>posterior_samples()</code> and subsetting to a few variables of interest, such as the variance parameters. But it our primary interest is just the iterations for the variance parameters, we can extract them in a more focused way with the <code>VarCorr()</code> function. Here’s how we’d do so for <code>fit4.2</code>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1"><span class="kw">VarCorr</span>(fit4<span class="fl">.2</span>, <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb233-2" data-line-number="2"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## List of 2
##  $ id        :List of 3
##   ..$ sd : num [1:4000, 1:2] 0.703 0.691 0.861 0.731 0.848 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ iterations: NULL
##   .. .. ..$ parameters: chr [1:2] &quot;Intercept&quot; &quot;age_14&quot;
##   ..$ cor: num [1:4000, 1:2, 1:2] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 3
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:2] &quot;Intercept&quot; &quot;age_14&quot;
##   .. .. ..$ : chr [1:2] &quot;Intercept&quot; &quot;age_14&quot;
##   ..$ cov: num [1:4000, 1:2, 1:2] 0.495 0.478 0.741 0.535 0.72 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 3
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:2] &quot;Intercept&quot; &quot;age_14&quot;
##   .. .. ..$ : chr [1:2] &quot;Intercept&quot; &quot;age_14&quot;
##  $ residual__:List of 1
##   ..$ sd: num [1:4000, 1] 0.681 0.599 0.649 0.591 0.598 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ iterations: NULL
##   .. .. ..$ parameters: chr &quot;&quot;</code></pre>
<p>That last part, the contents of the second higher-level list indexed by <code>$ residual</code>, contains the contents for <span class="math inline">\(\sigma_\epsilon\)</span>. On page 100 in the text, Singer and Willett compared <span class="math inline">\(\sigma_\epsilon^2\)</span> from the first model to that from the second. We might do that like so.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1"><span class="kw">cbind</span>(<span class="kw">VarCorr</span>(fit4<span class="fl">.1</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb235-2" data-line-number="2">      <span class="kw">VarCorr</span>(fit4<span class="fl">.2</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="op">~</span>.<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(<span class="st">&quot;fit4.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">fit4.1 - fit4.2</span><span class="st">`</span> =<span class="st"> </span>fit4<span class="fl">.1</span> <span class="op">-</span><span class="st"> </span>fit4<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;fit4.1&quot;</span>, <span class="st">&quot;fit4.2&quot;</span>, <span class="st">&quot;fit4.1 - fit4.2&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb235-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-14" data-line-number="14"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(sigma[epsilon]<span class="op">^</span><span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-16" data-line-number="16"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-31-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>To compute a formal summary of the decline in <span class="math inline">\(\sigma_\epsilon^2\)</span> after adding time to the model, we might summarize like before.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1"><span class="kw">cbind</span>(<span class="kw">VarCorr</span>(fit4<span class="fl">.1</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb236-2" data-line-number="2">      <span class="kw">VarCorr</span>(fit4<span class="fl">.2</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="op">~</span>.<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(<span class="st">&quot;fit4.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">proportion_decline =</span> (fit4<span class="fl">.1</span> <span class="op">-</span><span class="st"> </span>fit4<span class="fl">.2</span>) <span class="op">/</span><span class="st"> </span>fit4<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-7" data-line-number="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(proportion_decline),</a>
<a class="sourceLine" id="cb236-8" data-line-number="8">            <span class="dt">median =</span> <span class="kw">median</span>(proportion_decline),</a>
<a class="sourceLine" id="cb236-9" data-line-number="9">            <span class="dt">sd     =</span> <span class="kw">sd</span>(proportion_decline),</a>
<a class="sourceLine" id="cb236-10" data-line-number="10">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(proportion_decline, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb236-11" data-line-number="11">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(proportion_decline, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##    mean median    sd    ll    ul
## 1 0.341  0.356 0.136 0.036 0.561</code></pre>
<p>In case it wasn’t clear, when we presented <code>fit4.1 – fit4.2</code> in the density plot, that was a simple difference score. However, we computed <code>proportion_decline</code> above by dividing that difference score by <code>fit4.1</code>; that’s what put the difference in a proportion metric. Anyway, Singer and Willett’s method led them to summarize the decline as .40. Our method was a more conservative .34-ish. And very happily, our method allows us to describe the proportion decline with summary statistics for the full posterior, such as with the <span class="math inline">\(SD\)</span> and the 95% intervals.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb238-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> cor_id__Intercept__age_<span class="dv">14</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb238-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb238-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb238-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(rho[<span class="dv">0</span>][<span class="dv">1</span>]), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb238-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb238-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-33-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The estimate Singer and Willett hand-computed in the text, -.22, is near the mean of our posterior distribution for <span class="math inline">\(\rho_{01}\)</span>. However, our distribution provides a full expression of the uncertainty in the parameter. As are many other values within the parameter space, zero is indeed a credible value for <span class="math inline">\(\rho_{01}\)</span>.</p>
<p>On page 101, we get the generic formula for computing the residual variance for a given occasion <span class="math inline">\(j\)</span>,</p>
<p><span class="math display">\[
\sigma_{\text{Residual}_j}^2 = \sigma_0^2 + \sigma_1^2 \text{time}_j + 2 \sigma_{01} \text{time}_j + \sigma_\epsilon^2.
\]</span></p>
<p>If we were just interested in applying it to one of our <code>age</code> values, say 14, we might apply the formula to the posterior like this.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb239-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">sigma_2_residual_j =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb239-3" data-line-number="3"><span class="st">              </span>sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb239-4" data-line-number="4"><span class="st">              </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sd_id__Intercept <span class="op">*</span><span class="st"> </span>cor_id__Intercept__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>sd_id__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb239-5" data-line-number="5"><span class="st">              </span>sigma<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb239-6" data-line-number="6"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##   sigma_2_residual_j
## 1          0.9588818
## 2          0.8358250
## 3          1.1616367
## 4          0.8840587
## 5          1.0772511
## 6          1.1226730</code></pre>
<p>But given we’d like to do so over several values of <code>age</code>, it might be better to wrap the equation in a custom function. Let’s call it <code>make_s2rj()</code>.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">make_s2rj &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb241-2" data-line-number="2">  post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb241-3" data-line-number="3"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">sigma_2_residual_j =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sd_id__Intercept <span class="op">*</span><span class="st"> </span>cor_id__Intercept__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>sd_id__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb241-4" data-line-number="4"><span class="st">    </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb241-5" data-line-number="5">}</a></code></pre></div>
<p>Now we can put our custom <code>make_s2rj()</code> function to work within the <code>purrr::map()</code> paradigm. We’ll plot the results.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">age =</span> <span class="dv">14</span><span class="op">:</span><span class="dv">16</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_c =</span> age <span class="op">-</span><span class="st"> </span><span class="dv">14</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">s2rj =</span> <span class="kw">map</span>(age_c, make_s2rj)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>(s2rj) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">str_c</span>(<span class="st">&quot;age = &quot;</span>, age)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb242-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> s2rj)) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-9" data-line-number="9"><span class="st">  </span><span class="co"># just for reference </span></a>
<a class="sourceLine" id="cb242-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Behold the shape of longitudinal heteroscedasticity.&quot;</span>,</a>
<a class="sourceLine" id="cb242-13" data-line-number="13">       <span class="dt">x =</span> <span class="kw">expression</span>(sigma[<span class="kw">italic</span>(Residual[j])]<span class="op">^</span><span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-36-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We see a subtle increase over time, particularly from <code>age = 15</code> to <code>age = 16</code>. Yep, that’s heteroscedasticity. It is indeed “beyond the bland homoscedasticity we assume of residuals in cross-sectional data” (p. 101).</p>
<p>We might also be interested in computing the autocorrelation between the composite residuals on occasions <span class="math inline">\(j\)</span> and <span class="math inline">\(j’\)</span>, which follows the formula</p>
<p><span class="math display">\[
\rho_{\text{Residual}_j, \text{Residual}_{j&#39;}} = \frac{\sigma_0^2 + \sigma_{01} (\text{time}_j + \text{time}_{j&#39;}) + \sigma_1^2 \text{time}_j \text{time}_{j&#39;}} {\sqrt{\sigma_{\text{Residual}_j}^2 \sigma_{\text{Residual}_{j&#39;}}^2 }}.
\]</span></p>
<p>We only want to do that by hand once. Let’s make a custom function following the formula.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1"> make_rho_rj_rjp &lt;-<span class="st"> </span><span class="cf">function</span>(j, jp) {</a>
<a class="sourceLine" id="cb243-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb243-3" data-line-number="3">  <span class="co"># define the elements in the denominator  </span></a>
<a class="sourceLine" id="cb243-4" data-line-number="4">  s2rj_j  &lt;-<span class="st"> </span><span class="kw">make_s2rj</span>(j)</a>
<a class="sourceLine" id="cb243-5" data-line-number="5">  s2rj_jp &lt;-<span class="st"> </span><span class="kw">make_s2rj</span>(jp)</a>
<a class="sourceLine" id="cb243-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb243-7" data-line-number="7">  <span class="co"># compute</span></a>
<a class="sourceLine" id="cb243-8" data-line-number="8">  post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-9" data-line-number="9"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">r =</span> (sd_id__Intercept<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-10" data-line-number="10"><span class="st">                     </span>sd_id__Intercept <span class="op">*</span><span class="st"> </span>cor_id__Intercept__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>sd_id__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>(j <span class="op">+</span><span class="st"> </span>jp) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-11" data-line-number="11"><span class="st">                     </span>sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>j <span class="op">*</span><span class="st"> </span>jp) <span class="op">/</span></a>
<a class="sourceLine" id="cb243-12" data-line-number="12"><span class="st">                </span><span class="kw">sqrt</span>(s2rj_j <span class="op">*</span><span class="st"> </span>s2rj_jp)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-13" data-line-number="13"><span class="st">    </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb243-14" data-line-number="14">}</a></code></pre></div>
<p>If you only cared about measures of central tendency, such as the posterior median, you could use the funciton like this.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1"><span class="kw">make_rho_rj_rjp</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">median</span>()</a></code></pre></div>
<pre><code>## [1] 0.5666644</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1"><span class="kw">make_rho_rj_rjp</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">median</span>()</a></code></pre></div>
<pre><code>## [1] 0.7174044</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1"><span class="kw">make_rho_rj_rjp</span>(<span class="dv">0</span>, <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">median</span>()</a></code></pre></div>
<pre><code>## [1] 0.5140162</code></pre>
<p>Here are the full posteriors.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">occasion =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_c  =</span> occasion <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb250-3" data-line-number="3">         <span class="dt">j      =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb250-4" data-line-number="4">         <span class="dt">jp     =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r =</span> <span class="kw">map2</span>(j, jp, make_rho_rj_rjp)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-6" data-line-number="6"><span class="st">  </span><span class="kw">unnest</span>(r) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">str_c</span>(<span class="st">&quot;occasions &quot;</span>, j <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot; and &quot;</span>, jp <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb250-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> r)) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-10" data-line-number="10"><span class="st">  </span><span class="co"># just for reference</span></a>
<a class="sourceLine" id="cb250-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.75</span>), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(rho[Residual[<span class="kw">italic</span>(j)]][Residual[<span class="kw">italic</span>(j<span class="op">*</span>minute)]]), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-15" data-line-number="15"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Behold the shapes of our autocorrelations!&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-39-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="quantifying-the-proportion-of-outcome-variation-explained." class="section level3">
<h3><span class="header-section-number">4.4.3</span> Quantifying the proportion of outcome variation “explained.”</h3>
<p>Because of the way the multilevel model partitions off variance into different sources (e.g., <span class="math inline">\(\sigma_0^2\)</span>, <span class="math inline">\(\sigma_1^2\)</span>, and <span class="math inline">\(\sigma_\epsilon^2\)</span> in the unconditional growth model), the conventional <span class="math inline">\(R^2\)</span> is not applicable for evaluating models in the traditional OLS sense of percent of variance explained. Several pseudo <span class="math inline">\(R^2\)</span> statistics are frequently used instead. Be warned, “statisticians have yet to agree on appropriate summaries (<a href="https://methods.sagepub.com/book/introducing-multilevel-modeling">Kreft &amp; deLeeuw, 1998</a>; <a href="https://www.researchgate.net/publication/235726240_Modeled_Variance_in_Two-Level_Models">Snidjers &amp; Bosker, 1994</a>[; <a href="https://www.researchgate.net/publication/303887200_An_R_2_statistic_for_fixed_effects_in_the_generalized_linear_mixed_model">Jaeger, Edwards,
Das, &amp; Sen, 2017</a>; <a href="https://www.tandfonline.com/doi/abs/10.1080/15374416.2018.1528550">Rights &amp; Cole; 2018</a>; <a href="https://www.researchgate.net/publication/336105908_New_Recommendations_on_the_Use_of_R-Squared_Differences_in_Multilevel_Model_Comparisons">Rights &amp; Sterba, 2019</a>])” (p. 102) and none of the solutions presented in this section are magic bullets.</p>
<div id="an-overall-summary-of-total-outcome-variability-explained." class="section level4">
<h4><span class="header-section-number">4.4.3.1</span> An overall summary of total outcome variability explained.</h4>
<blockquote>
<p>In multiple regression, one simple way of computing a summary <span class="math inline">\(R^2\)</span> statistic is to square the sample correlation between observed and predicted values of the outcome. The same approach can be used in the multilevel model for change. All you need to do is: (1) compute the predicted outcome value for each person on each occasion of measurement; and (2) square the sample correlation between observed and predicted values. The resultant pseudo-<span class="math inline">\(R^2\)</span> statistic assesses the proportion of total outcome variation “explained” by the <em>multilevel model’s specific contribution of predictors</em>. (p. 102, <em>emphasis</em> added)</p>
</blockquote>
<p>Singer and Willett called this <span class="math inline">\(R_{y, \hat y}^2\)</span>. They then walked through an example with their Model B (<code>fit4.2</code>), the unconditional growth model. Within our <strong>brms</strong> paradigm, we typically use the <code>fitted()</code> function to return predicted outcome values for cases within the data. The default option for the <code>fitted()</code> function is to return these predictions after accounting for the level-2 clustering. As we will see, Singer and Willett’s <span class="math inline">\(R_{y, \hat y}^2\)</span> statistic only accounts for predictors (i.e., <code>age_14</code>, in this case), not clustering variables (i.e., <code>id</code>, in this case). To follow Singer and Willett’s specification, we need to set <code>re_formula = NA</code>, which will instruct <code>fitted()</code> to return the expected values without reference to the level-2 clustering. Here’s a look at the first six rows of that output.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1"><span class="kw">fitted</span>(fit4<span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb251-2" data-line-number="2">       <span class="dt">re_formula =</span> <span class="ot">NA</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb251-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##       Estimate  Est.Error      Q2.5     Q97.5
## [1,] 0.6482574 0.10815896 0.4376040 0.8698159
## [2,] 0.9211839 0.09978151 0.7282534 1.1251522
## [3,] 1.1941103 0.12844911 0.9395229 1.4535722
## [4,] 0.6482574 0.10815896 0.4376040 0.8698159
## [5,] 0.9211839 0.09978151 0.7282534 1.1251522
## [6,] 1.1941103 0.12844911 0.9395229 1.4535722</code></pre>
<p>Within our Bayesian/<strong>brms</strong> paradigm, out expected values come with expressions of uncertainty in terms of the posterior standard deviation and percentile-based 95% intervals. If we followed Singer and Willett’s method in the text, we’d only work with the posterior means as presented within the <code>Estimate</code> column. But since we’re Bayesians, we should attempt to work with the model uncertainty. One approach is to set <code>summary = F</code>.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb253-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb253-3" data-line-number="3">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb253-4" data-line-number="4">         <span class="dt">re_formula =</span> <span class="ot">NA</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-5" data-line-number="5"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb253-6" data-line-number="6"><span class="st">  </span><span class="kw">set_names</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb253-7" data-line-number="7"><span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;iter&quot;</span>)</a>
<a class="sourceLine" id="cb253-8" data-line-number="8"></a>
<a class="sourceLine" id="cb253-9" data-line-number="9"><span class="kw">head</span>(f)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 247
##   iter    `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`   `9`  `10`  `11`  `12`  `13`  `14`  `15`
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1     0.653 1.02   1.38 0.653 1.02   1.38 0.653 1.02   1.38 0.653 1.02   1.38 0.653 1.02   1.38
## 2 2     0.620 0.956  1.29 0.620 0.956  1.29 0.620 0.956  1.29 0.620 0.956  1.29 0.620 0.956  1.29
## 3 3     0.825 1.01   1.19 0.825 1.01   1.19 0.825 1.01   1.19 0.825 1.01   1.19 0.825 1.01   1.19
## 4 4     0.766 0.976  1.19 0.766 0.976  1.19 0.766 0.976  1.19 0.766 0.976  1.19 0.766 0.976  1.19
## 5 5     0.949 1.14   1.33 0.949 1.14   1.33 0.949 1.14   1.33 0.949 1.14   1.33 0.949 1.14   1.33
## 6 6     0.904 1.12   1.34 0.904 1.12   1.34 0.904 1.12   1.34 0.904 1.12   1.34 0.904 1.12   1.34
## # … with 231 more variables: `16` &lt;dbl&gt;, `17` &lt;dbl&gt;, `18` &lt;dbl&gt;, `19` &lt;dbl&gt;, `20` &lt;dbl&gt;,
## #   `21` &lt;dbl&gt;, `22` &lt;dbl&gt;, `23` &lt;dbl&gt;, `24` &lt;dbl&gt;, `25` &lt;dbl&gt;, `26` &lt;dbl&gt;, `27` &lt;dbl&gt;, `28` &lt;dbl&gt;,
## #   `29` &lt;dbl&gt;, `30` &lt;dbl&gt;, `31` &lt;dbl&gt;, `32` &lt;dbl&gt;, `33` &lt;dbl&gt;, `34` &lt;dbl&gt;, `35` &lt;dbl&gt;, `36` &lt;dbl&gt;,
## #   `37` &lt;dbl&gt;, `38` &lt;dbl&gt;, `39` &lt;dbl&gt;, `40` &lt;dbl&gt;, `41` &lt;dbl&gt;, `42` &lt;dbl&gt;, `43` &lt;dbl&gt;, `44` &lt;dbl&gt;,
## #   `45` &lt;dbl&gt;, `46` &lt;dbl&gt;, `47` &lt;dbl&gt;, `48` &lt;dbl&gt;, `49` &lt;dbl&gt;, `50` &lt;dbl&gt;, `51` &lt;dbl&gt;, `52` &lt;dbl&gt;,
## #   `53` &lt;dbl&gt;, `54` &lt;dbl&gt;, `55` &lt;dbl&gt;, `56` &lt;dbl&gt;, `57` &lt;dbl&gt;, `58` &lt;dbl&gt;, `59` &lt;dbl&gt;, `60` &lt;dbl&gt;,
## #   `61` &lt;dbl&gt;, `62` &lt;dbl&gt;, `63` &lt;dbl&gt;, `64` &lt;dbl&gt;, `65` &lt;dbl&gt;, `66` &lt;dbl&gt;, `67` &lt;dbl&gt;, `68` &lt;dbl&gt;,
## #   `69` &lt;dbl&gt;, `70` &lt;dbl&gt;, `71` &lt;dbl&gt;, `72` &lt;dbl&gt;, `73` &lt;dbl&gt;, `74` &lt;dbl&gt;, `75` &lt;dbl&gt;, `76` &lt;dbl&gt;,
## #   `77` &lt;dbl&gt;, `78` &lt;dbl&gt;, `79` &lt;dbl&gt;, `80` &lt;dbl&gt;, `81` &lt;dbl&gt;, `82` &lt;dbl&gt;, `83` &lt;dbl&gt;, `84` &lt;dbl&gt;,
## #   `85` &lt;dbl&gt;, `86` &lt;dbl&gt;, `87` &lt;dbl&gt;, `88` &lt;dbl&gt;, `89` &lt;dbl&gt;, `90` &lt;dbl&gt;, `91` &lt;dbl&gt;, `92` &lt;dbl&gt;,
## #   `93` &lt;dbl&gt;, `94` &lt;dbl&gt;, `95` &lt;dbl&gt;, `96` &lt;dbl&gt;, `97` &lt;dbl&gt;, `98` &lt;dbl&gt;, `99` &lt;dbl&gt;,
## #   `100` &lt;dbl&gt;, `101` &lt;dbl&gt;, `102` &lt;dbl&gt;, `103` &lt;dbl&gt;, `104` &lt;dbl&gt;, `105` &lt;dbl&gt;, `106` &lt;dbl&gt;,
## #   `107` &lt;dbl&gt;, `108` &lt;dbl&gt;, `109` &lt;dbl&gt;, `110` &lt;dbl&gt;, `111` &lt;dbl&gt;, `112` &lt;dbl&gt;, `113` &lt;dbl&gt;,
## #   `114` &lt;dbl&gt;, `115` &lt;dbl&gt;, …</code></pre>
<p>With those settings, <code>fitted()</code> returned a <span class="math inline">\(4,000 \times 246\)</span> numeric array. The 4,000 rows corresponded to the 4,000 post-warmup HMC draws. Each of the 246 columns corresponded to one of the 246 rows in the original <code>alcohol1_pp</code> data. To make the output more useful, we converted it to a data frame, named the columns by the row numbers corresponding to the original <code>alcohol1_pp</code> data, and converted the row names to an <code>iter</code> column.</p>
<p>In the next code block, we’ll convert <code>f</code> to the long format and use <code>left_join()</code> to join it with the relevant subset of the <code>alcohol1_pp</code> data.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb255-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>iter,</a>
<a class="sourceLine" id="cb255-4" data-line-number="4">               <span class="dt">names_to =</span> <span class="st">&quot;row&quot;</span>,</a>
<a class="sourceLine" id="cb255-5" data-line-number="5">               <span class="dt">values_to =</span> <span class="st">&quot;fitted&quot;</span>,</a>
<a class="sourceLine" id="cb255-6" data-line-number="6">               <span class="dt">names_ptypes =</span> <span class="kw">list</span>(<span class="dt">row =</span> <span class="kw">integer</span>())) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-7" data-line-number="7"><span class="st">  </span><span class="kw">left_join</span>(</a>
<a class="sourceLine" id="cb255-8" data-line-number="8">    alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-9" data-line-number="9"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-10" data-line-number="10"><span class="st">      </span><span class="kw">select</span>(row, alcuse),</a>
<a class="sourceLine" id="cb255-11" data-line-number="11">    <span class="dt">by =</span> <span class="st">&quot;row&quot;</span></a>
<a class="sourceLine" id="cb255-12" data-line-number="12">  ) </a>
<a class="sourceLine" id="cb255-13" data-line-number="13"></a>
<a class="sourceLine" id="cb255-14" data-line-number="14">f</a></code></pre></div>
<pre><code>## # A tibble: 984,000 x 4
##    iter    row fitted alcuse
##    &lt;chr&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 1         1  0.653   1.73
##  2 1         2  1.02    2   
##  3 1         3  1.38    2   
##  4 1         4  0.653   0   
##  5 1         5  1.02    0   
##  6 1         6  1.38    1   
##  7 1         7  0.653   1   
##  8 1         8  1.02    2   
##  9 1         9  1.38    3.32
## 10 1        10  0.653   0   
## # … with 983,990 more rows</code></pre>
<p>If we collapse the distinction across the 4,000 HMC draws, here is the squared correlation between <code>fitted</code> and <code>alcuse</code>.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">r  =</span> <span class="kw">cor</span>(fitted, alcuse),</a>
<a class="sourceLine" id="cb257-3" data-line-number="3">            <span class="dt">r2 =</span> <span class="kw">cor</span>(fitted, alcuse)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       r     r2
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.186 0.0345</code></pre>
<p>This is close to the <span class="math inline">\(R_{y, \hat y}^2 = .043\)</span> Singer and Willett reported in the text. It might seem unsatisfying how this seemingly ignores model uncertainty by collapsing across HMC iterations. Here’s a look at what happens is we compute the <span class="math inline">\(R_{y, \hat y}^2\)</span> separately for each iteration.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> iter <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">r  =</span> <span class="kw">cor</span>(fitted, alcuse),</a>
<a class="sourceLine" id="cb259-5" data-line-number="5">            <span class="dt">r2 =</span> <span class="kw">cor</span>(fitted, alcuse)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4,000 x 3
##     iter     r     r2
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     1 0.208 0.0434
##  2     2 0.208 0.0434
##  3     3 0.208 0.0434
##  4     4 0.208 0.0434
##  5     5 0.208 0.0434
##  6     6 0.208 0.0434
##  7     7 0.208 0.0434
##  8     8 0.208 0.0434
##  9     9 0.208 0.0434
## 10    10 0.208 0.0434
## # … with 3,990 more rows</code></pre>
<p>Now for every level of <code>iter</code>, <span class="math inline">\(R_{y, \hat y}^2 = .0434\)</span>, which matches up nicely with the text. But it seems odd that the value should be the same for each of the 4,000 HMC draws. Sadly, my efforts to debug my workflow have been unsuccessful. If you see a flaw in this method, please <a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse/issues">share on GitHub</a>.</p>
<p>Just for kicks, here’s a more compact alternative to our <code>fitted()</code> + <code>left_join()</code> approach that more closely resembles the work flow Singer and Willett showed on pages 102 and 103.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">age_14 =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fitted =</span> <span class="kw">map</span>(age_<span class="dv">14</span>, <span class="op">~</span><span class="st"> </span>post<span class="op">$</span>b_Intercept <span class="op">+</span><span class="st"> </span>post<span class="op">$</span>b_age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-3" data-line-number="3"><span class="st">  </span><span class="kw">full_join</span>(alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(id, age_<span class="dv">14</span>, alcuse),</a>
<a class="sourceLine" id="cb261-4" data-line-number="4">            <span class="dt">by =</span> <span class="st">&quot;age_14&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-6" data-line-number="6"><span class="st">  </span><span class="kw">unnest</span>(fitted) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>, <span class="dt">times =</span> alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>())) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">r  =</span> <span class="kw">cor</span>(fitted, alcuse),</a>
<a class="sourceLine" id="cb261-10" data-line-number="10">            <span class="dt">r2 =</span> <span class="kw">cor</span>(fitted, alcuse)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4,000 x 3
##     iter     r     r2
##    &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     1 0.208 0.0434
##  2     2 0.208 0.0434
##  3     3 0.208 0.0434
##  4     4 0.208 0.0434
##  5     5 0.208 0.0434
##  6     6 0.208 0.0434
##  7     7 0.208 0.0434
##  8     8 0.208 0.0434
##  9     9 0.208 0.0434
## 10    10 0.208 0.0434
## # … with 3,990 more rows</code></pre>
<p>Either way, our results agree with those in the text: about “4.3% of the total variability in <em>ALCUSE</em> is associated with linear time” (p. 103, <em>emphasis</em> in the original).</p>
</div>
<div id="pseudo-r2-statistics-computed-from-the-variance-components." class="section level4">
<h4><span class="header-section-number">4.4.3.2</span> Pseudo-<span class="math inline">\(R^2\)</span> statistics computed from the variance components.</h4>
<blockquote>
<p>Residual variation–that portion of the outcome variation unexplained by a model’s predictors–provides another criterion for comparison. When you fit a series of models, you hope that added predictors further explain unexplained outcome variation, causing residual variation to decline. The magnitude of this decline quantifies the improvement in fit. A large decline suggests that the predictors make a big difference; a small, or zero, decline suggests that they do not. To assess these declines on a common scale, we compute the <em>proportional reduction in residual variance</em> as we add predictors.</p>
<p>Each unconditional model yields residual variances that serve as yardsticks for comparison. The unconditional means model provides a baseline estimate of <span class="math inline">\(\sigma_\epsilon^2\)</span>; the unconditional growth model provides baseline estimates of <span class="math inline">\(\sigma_0^2\)</span> and <span class="math inline">\(\sigma_1^2\)</span>. Each leads to its own pseudo-<span class="math inline">\(R^2\)</span> statistic. (p. 103, <em>emphasis</em> in the original)</p>
</blockquote>
<p>This provides three more pseudo-<span class="math inline">\(R^2\)</span> statistics: <span class="math inline">\(R_\epsilon^2\)</span>, <span class="math inline">\(R_0^2\)</span>, and <span class="math inline">\(R_1^2\)</span>. The formula for the first is</p>
<p><span class="math display">\[
R_\epsilon^2 = \frac{\sigma_\epsilon^2 (\text{unconditional means model}) - \sigma_\epsilon^2 (\text{unconditional growth model})}{\sigma_\epsilon^2 (\text{unconditional means model})}.
\]</span></p>
<p>We’ve actually already computed this one, above, under the name where we referred to it as the decline in <span class="math inline">\(\sigma_\epsilon^2\)</span> after adding time to the model. Here it is again.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1"><span class="kw">cbind</span>(<span class="kw">VarCorr</span>(fit4<span class="fl">.1</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb263-2" data-line-number="2">      <span class="kw">VarCorr</span>(fit4<span class="fl">.2</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="op">~</span>.<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(<span class="st">&quot;fit4.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r_2_epsilon =</span> (fit4<span class="fl">.1</span> <span class="op">-</span><span class="st"> </span>fit4<span class="fl">.2</span>) <span class="op">/</span><span class="st"> </span>fit4<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-7" data-line-number="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(r_<span class="dv">2</span>_epsilon),</a>
<a class="sourceLine" id="cb263-8" data-line-number="8">            <span class="dt">median =</span> <span class="kw">median</span>(r_<span class="dv">2</span>_epsilon),</a>
<a class="sourceLine" id="cb263-9" data-line-number="9">            <span class="dt">sd     =</span> <span class="kw">sd</span>(r_<span class="dv">2</span>_epsilon),</a>
<a class="sourceLine" id="cb263-10" data-line-number="10">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(r_<span class="dv">2</span>_epsilon, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb263-11" data-line-number="11">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(r_<span class="dv">2</span>_epsilon, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb263-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##    mean median    sd    ll    ul
## 1 0.341  0.356 0.136 0.036 0.561</code></pre>
<p>Here’s a look at the full distribution for our <span class="math inline">\(\sigma_\epsilon^2\)</span>.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1"><span class="kw">cbind</span>(<span class="kw">VarCorr</span>(fit4<span class="fl">.1</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb265-2" data-line-number="2">      <span class="kw">VarCorr</span>(fit4<span class="fl">.2</span>, <span class="dt">summary =</span> F)[[<span class="dv">2</span>]][[<span class="dv">1</span>]]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb265-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb265-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="op">~</span>.<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb265-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(<span class="st">&quot;fit4.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb265-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r_2_epsilon =</span> (fit4<span class="fl">.1</span> <span class="op">-</span><span class="st"> </span>fit4<span class="fl">.2</span>) <span class="op">/</span><span class="st"> </span>fit4<span class="fl">.1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb265-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> r_<span class="dv">2</span>_epsilon)) <span class="op">+</span></a>
<a class="sourceLine" id="cb265-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb265-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb265-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(Pseudo<span class="op">~</span><span class="kw">italic</span>(R)[epsilon]<span class="op">^</span><span class="dv">2</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb265-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb265-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-47-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>When we use the full posteriors of our two <span class="math inline">\(\epsilon_\epsilon^2\)</span> parameters, we end up with a slightly smaller statistic than the one in the text. So our conclusion is about 35% of the intraindividual variance is accounted for by time.</p>
<p>If we consider additional models with predictors for the <span class="math inline">\(\zeta\)</span>s, we can examine similar pseudo <span class="math inline">\(R^2\)</span> statistics following the generic form</p>
<p><span class="math display">\[
R_\zeta^2 = \frac{\sigma_\zeta^2 (\text{unconditional growth model}) - \sigma_\zeta^2 (\text{subsequent model})}{\sigma_\zeta^2 (\text{unconditional growth model})},
\]</span></p>
<p>where <span class="math inline">\(\zeta\)</span> could refer to <span class="math inline">\(\zeta_{0i}\)</span>, <span class="math inline">\(\zeta_{1i}\)</span>, and so on. If you look back up at the shape of the full posterior of <span class="math inline">\(R_\epsilon^2\)</span>, you’ll notice part of the left tail crosses zero. “Unlike traditional <span class="math inline">\(R^2\)</span> statistics, which will always be positive (or zero), some of these statistics can be negative” (p. 104)! If you compute them, interpret pseudo-<span class="math inline">\(R^2\)</span> statistics with a grain of salt.</p>
</div>
</div>
</div>
<div id="practical-data-analytic-strategies-for-model-building" class="section level2">
<h2><span class="header-section-number">4.5</span> Practical data analytic strategies for model building</h2>
<blockquote>
<p>A sound statistical model includes all necessary predictors and no unnecessary ones. But how do you separate the wheat from the chaff? We suggest you rely on a combination of substantive theory, research questions, and statistical evidence. <em>Never</em> let a computer select predictors mechanically. (pp. 104–105, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="a-taxonomy-of-statistical-models." class="section level3">
<h3><span class="header-section-number">4.5.1</span> A taxonomy of statistical models.</h3>
<blockquote>
<p>We suggest that you base decisions to enter, retain, and remove predictors on a combination of logic, theory, and prior research, supplemented by judicious [parameter evaluation] and comparison of model fit. At the outset, you might examine the effect of each predictor individually. You might then focus on predictors of primary interest (while including others whose effects you want to control). As in regular regression, you can add predictors singly or in groups and you can address issues of functional form using interactions and transformations. As you develop the taxonomy, you will progress toward a “final model” whose interpretation addresses your research questions. We place quotes around this term to emphasize that we believe no statistical model is <em>ever</em> final; it is simply a placeholder until a better model is found. (p. 105, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="interpreting-fitted-models." class="section level3">
<h3><span class="header-section-number">4.5.2</span> Interpreting fitted models.</h3>
<blockquote>
<p>You need not interpret every model you fit, especially those designed to guide interim decision making. When writing up findings for presentation and publication, we suggest that you identify a manageable subset of models that, taken together, tells a persuasive story parsimoniously. At a minimum, this includes the unconditional means model, the unconditional growth model, and a “final model”. You may also want to present intermediate models that either provide important building blocks or tell interesting stories in their own right. (p. 106)</p>
</blockquote>
<p>In the dawn of the post-replication crisis era, it’s astonishing to reread and transcribe this section and the one above. I like a lot of what the authors had to say. Much of it seems like good pragmatic advice. But if they were to rewrite these sections again, I wonder what changes they’d make. Would they recommend researchers <a href="https://www.pnas.org/content/pnas/115/11/2600.full.pdf">preregister</a> their primary hypothesis, variables of interest, and perhaps their model building strategy? Would they be interested in a <a href="https://journals.sagepub.com/doi/10.1177/1745691616658637">multiverse analysis</a>? Would the still recommend sharing only a subset of one’s analyses in the era of sharing platforms like <a href="https://github.com">GitHub</a> and the <a href="https://osf.io">Open Science Framework</a>? Would they weigh in on developments in <a href="https://www.wiley.com/en-us/Causal+Inference+in+Statistics%3A+A+Primer-p-9781119186847">causal inference</a>?</p>
<div id="model-c-the-uncontrolled-effects-of-coa." class="section level4">
<h4><span class="header-section-number">4.5.2.1</span> Model C: The uncontrolled effects of COA.</h4>
<p>The default priors for Model C are the same as for the unconditional growth model. All we’ve done is add parameters of <code>class = b</code>. As these default to improper flat priors, we have nothing to add to the <code>prior</code> argument to include them. Feel free to check with <code>get_prior()</code>. For the sake of practice, this model follows the form</p>
<p><span class="math display">\[\begin{align*}
\text{alcuse}_{ij} &amp; = \gamma_{00} + \gamma_{01} \text{coa}_i + \gamma_{10} \text{age_14}_{ij} + \gamma_{11} \text{coa}_i \times \text{age_14}_{ij} + \zeta_{0i} + \zeta_{1i} \text{age_14}_{ij} + \epsilon_{ij} \\
\epsilon_{ij} &amp; \sim \text{Normal} (0, \sigma_\epsilon^2) \\
\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp; \sim \text{Normal} 
\Bigg ( 
\begin{bmatrix} 0 \\ 0 \end{bmatrix}, 
\begin{bmatrix} \sigma_0^2 &amp; \sigma_{01} \\ \sigma_{01} &amp; \sigma_1^2 \end{bmatrix}
\Bigg ).
\end{align*}\]</span></p>
<p>Fit the model.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1">fit4<span class="fl">.3</span> &lt;-</a>
<a class="sourceLine" id="cb266-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb266-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb266-4" data-line-number="4">      alcuse <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span>coa <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span><span class="op">:</span>coa <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">|</span><span class="st"> </span>id),</a>
<a class="sourceLine" id="cb266-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sd),</a>
<a class="sourceLine" id="cb266-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb266-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">lkj</span>(<span class="dv">1</span>), <span class="dt">class =</span> cor)),</a>
<a class="sourceLine" id="cb266-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb266-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb266-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit04.03&quot;</span>)</a></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1"><span class="kw">print</span>(fit4<span class="fl">.3</span>, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: alcuse ~ 0 + Intercept + age_14 + coa + age_14:coa + (1 + age_14 | id) 
##    Data: alcohol1_pp (Number of observations: 246) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 82) 
##                       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.700     0.101    0.500    0.898 1.003      823     1429
## sd(age_14)               0.367     0.094    0.142    0.529 1.008      337      286
## cor(Intercept,age_14)   -0.105     0.287   -0.513    0.679 1.008      481      370
## 
## Population-Level Effects: 
##            Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept     0.314     0.134    0.054    0.574 1.002     1998     2417
## age_14        0.294     0.085    0.128    0.460 1.001     2775     2957
## coa           0.739     0.201    0.334    1.132 1.002     2028     2141
## age_14:coa   -0.050     0.126   -0.303    0.197 1.001     2956     2987
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.608     0.052    0.517    0.720 1.007      425      674
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our <span class="math inline">\(\gamma\)</span>s are quite similar to those presented in the text. Our <span class="math inline">\(\sigma_\epsilon\)</span> for this model is about the same as with <code>fit4.2</code>. Let’s practice with <code>conditional_effects()</code> to plot the consequences of this model.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1"><span class="kw">conditional_effects</span>(fit4<span class="fl">.3</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-49-1.png" width="240" style="display: block; margin: auto;" /><img src="04_files/figure-gfm/unnamed-chunk-49-2.png" width="240" style="display: block; margin: auto;" /><img src="04_files/figure-gfm/unnamed-chunk-49-3.png" width="240" style="display: block; margin: auto;" /></p>
<p>This time we got back three plots. The first two were of the lower-order parameters <span class="math inline">\(\gamma_{10}\)</span> and <span class="math inline">\(\gamma_{01}\)</span>. Note how the plot for <code>coa</code> treated it as a continuous variable. This is because the variable was saved as an integer in the original data set.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1">fit4<span class="fl">.3</span><span class="op">$</span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb270-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 246
## Columns: 5
## $ alcuse    &lt;dbl&gt; 1.732051, 2.000000, 2.000000, 0.000000, 0.000000, 1.000000, 1.000000, 2.000000,…
## $ Intercept &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ age_14    &lt;dbl&gt; 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2…
## $ coa       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ id        &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9…</code></pre>
<p>Coding it as an integer further complicated things for the third plot returned by <code>conditional_effects()</code>, the one for the interaction of <code>age_14</code> and <code>coa</code>, <span class="math inline">\(\gamma_{11}\)</span>.</p>
<p>Since <code>coa</code> is binary, the natural way to express its interaction with <code>age_14</code> would be with <code>age_14</code> on the <span class="math inline">\(x\)</span>-axis and two separate trajectories, one for each value of <code>coa</code>. That’s what Singer and Willett very sensibly did with the middle panel of Figure 4.3. However, the <code>conditional_effects()</code>function defaults to expressing interactions such that the first variable in the term–in this case,<code>age_14</code>–is on the <span class="math inline">\(x\)</span>-axis and the second variable in the term–<code>coa</code>, treated as an integer–is depicted in three lines corresponding its mean and its mean <span class="math inline">\(\pm\)</span> one standard deviation. This is great for continuous variables, but incoherent for categorical ones. The fix is to adjust the data and refit the model.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1">fit4<span class="fl">.4</span> &lt;-</a>
<a class="sourceLine" id="cb272-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(fit4<span class="fl">.3</span>,</a>
<a class="sourceLine" id="cb272-3" data-line-number="3">         <span class="dt">newdata =</span> alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">coa =</span> <span class="kw">factor</span>(coa)),</a>
<a class="sourceLine" id="cb272-4" data-line-number="4">         <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb272-5" data-line-number="5">         <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb272-6" data-line-number="6">         <span class="dt">file =</span> <span class="st">&quot;fits/fit04.04&quot;</span>)</a></code></pre></div>
<p>We might compare the updated model with its predecessor. To get a focused look, we can use the <code>posterior_summary()</code> function with a little subsetting.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1"><span class="kw">posterior_summary</span>(fit4<span class="fl">.3</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##              Estimate Est.Error   Q2.5 Q97.5
## b_Intercept     0.314     0.134  0.054 0.574
## b_age_14        0.294     0.085  0.128 0.460
## b_coa           0.739     0.201  0.334 1.132
## b_age_14:coa   -0.050     0.126 -0.303 0.197</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1"><span class="kw">posterior_summary</span>(fit4<span class="fl">.4</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##               Estimate Est.Error   Q2.5 Q97.5
## b_Intercept      0.314     0.134  0.054 0.574
## b_age_14         0.294     0.085  0.128 0.460
## b_coa1           0.739     0.201  0.334 1.132
## b_age_14:coa1   -0.050     0.126 -0.303 0.197</code></pre>
<p>The results are about the same. The payoff comes when we try again with <code>conditional_effects()</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1"><span class="kw">conditional_effects</span>(fit4<span class="fl">.4</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-52-1.png" width="240" style="display: block; margin: auto;" /><img src="04_files/figure-gfm/unnamed-chunk-52-2.png" width="240" style="display: block; margin: auto;" /><img src="04_files/figure-gfm/unnamed-chunk-52-3.png" width="240" style="display: block; margin: auto;" /></p>
<p>Much better. Now the plot for <span class="math inline">\(\gamma_{01}\)</span> treats <code>coa</code> as binary and our plot for the interaction between <code>age_14</code> and <code>coa</code> is much close to the one in Figure 4.3. Since we’re already on a <code>conditional_effects()</code> tangent, we may as well go further. When working with models like <code>fit4.3</code> where you have multiple fixed effects, sometimes you only want the plots for a subset of those effects. For example, if our main goal is to do a good job tastefully reproducing the middle plot in Figure 4.3, we only need the interaction plot. In such a case, use the <code>effects</code> argument.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" data-line-number="1"><span class="kw">conditional_effects</span>(fit4<span class="fl">.4</span>, <span class="dt">effects =</span> <span class="st">&quot;age_14:coa&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-53-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>Earlier we discussed how <code>conditional_effects()</code> lets users adjust some of the output. But if you want an extensive overhaul, it’s better to save the output of <code>conditional_effects()</code> as an object and manipulate that object with the <code>plot()</code> function.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1">ce &lt;-<span class="st"> </span><span class="kw">conditional_effects</span>(fit4<span class="fl">.4</span>, <span class="dt">effects =</span> <span class="st">&quot;age_14:coa&quot;</span>)</a>
<a class="sourceLine" id="cb279-2" data-line-number="2"></a>
<a class="sourceLine" id="cb279-3" data-line-number="3"><span class="kw">str</span>(ce)</a></code></pre></div>
<pre><code>## List of 1
##  $ age_14:coa:&#39;data.frame&#39;:  200 obs. of  13 variables:
##   ..$ age_14    : num [1:200] 0 0 0.0202 0.0202 0.0404 ...
##   ..$ coa       : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##   ..$ alcuse    : num [1:200] 0.922 0.922 0.922 0.922 0.922 ...
##   ..$ Intercept : num [1:200] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ intercept : num [1:200] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ id        : logi [1:200] NA NA NA NA NA NA ...
##   ..$ cond__    : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ effect1__ : num [1:200] 0 0 0.0202 0.0202 0.0404 ...
##   ..$ effect2__ : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##   ..$ estimate__: num [1:200] 0.318 1.055 0.324 1.059 0.33 ...
##   ..$ se__      : num [1:200] 0.135 0.146 0.134 0.145 0.133 ...
##   ..$ lower__   : num [1:200] 0.0545 0.7652 0.0612 0.7713 0.0689 ...
##   ..$ upper__   : num [1:200] 0.574 1.344 0.578 1.347 0.583 ...
##   ..- attr(*, &quot;effects&quot;)= chr [1:2] &quot;age_14&quot; &quot;coa&quot;
##   ..- attr(*, &quot;response&quot;)= chr &quot;alcuse&quot;
##   ..- attr(*, &quot;surface&quot;)= logi FALSE
##   ..- attr(*, &quot;categorical&quot;)= logi FALSE
##   ..- attr(*, &quot;ordinal&quot;)= logi FALSE
##   ..- attr(*, &quot;points&quot;)=&#39;data.frame&#39;:    246 obs. of  6 variables:
##   .. ..$ age_14   : num [1:246] 0 1 2 0 1 2 0 1 2 0 ...
##   .. ..$ coa      : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##   .. ..$ resp__   : num [1:246] 1.73 2 2 0 0 ...
##   .. ..$ cond__   : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ effect1__: num [1:246] 0 1 2 0 1 2 0 1 2 0 ...
##   .. ..$ effect2__: Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  - attr(*, &quot;class&quot;)= chr &quot;brms_conditional_effects&quot;</code></pre>
<p>Our <code>ce</code> is an object of class “’brms_conditional_effects” which contains a list of a single data frame. Had we omitted our <code>effects</code> argument, above, we’d have a list of 3 instead. Anyway, these data frames contain the necessary information to produce the plot. The advantage of saving <code>ce</code> this way is we can now insert it into the <code>plot()</code> function. The simple output is the same as before.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1"><span class="kw">plot</span>(ce)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-55-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>The <code>plot()</code> function will allow us to do other things, like add in the original data or omit the white grid lines.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1">ce <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb282-2" data-line-number="2"><span class="st">  </span><span class="kw">plot</span>(<span class="dt">points =</span> T,</a>
<a class="sourceLine" id="cb282-3" data-line-number="3">       <span class="dt">point_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">width =</span> <span class="fl">.05</span>, <span class="dt">height =</span> <span class="fl">.05</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>),</a>
<a class="sourceLine" id="cb282-4" data-line-number="4">       <span class="dt">theme =</span> <span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-56-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>And for even more control, you can tack on typical <strong>ggplot2</strong> functions. But when you want to do so, make sure to set the <code>plot = FALSE</code> argument and then subset after the right parenthesis of the <code>plot()</code> function.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1"><span class="kw">plot</span>(ce, </a>
<a class="sourceLine" id="cb283-2" data-line-number="2">     <span class="dt">theme =</span> <span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb283-3" data-line-number="3">                   <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()),</a>
<a class="sourceLine" id="cb283-4" data-line-number="4">     <span class="dt">plot =</span> <span class="ot">FALSE</span>)[[<span class="dv">1</span>]] <span class="op">+</span></a>
<a class="sourceLine" id="cb283-5" data-line-number="5"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb283-6" data-line-number="6">           <span class="dt">x =</span> <span class="fl">2.1</span>, <span class="dt">y =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">1.55</span>),</a>
<a class="sourceLine" id="cb283-7" data-line-number="7">           <span class="dt">label =</span> <span class="kw">str_c</span>(<span class="st">&quot;coa = &quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb283-8" data-line-number="8">           <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="fl">3.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;age&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>), <span class="dt">labels =</span> <span class="dv">13</span><span class="op">:</span><span class="dv">17</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-57-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>But anyway, let’s get back on track and talk about the variance components. Singer and Willett contrasted <span class="math inline">\(\sigma_\epsilon^2\)</span> from Model B to the new one from Model C. We might use <code>VarCorr()</code> to do the same.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1"><span class="kw">VarCorr</span>(fit4<span class="fl">.2</span>)[[<span class="dv">2</span>]]</a></code></pre></div>
<pre><code>## $sd
##   Estimate  Est.Error      Q2.5     Q97.5
##  0.6091221 0.05178938 0.5178184 0.7180072</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1"><span class="kw">VarCorr</span>(fit4<span class="fl">.3</span>)[[<span class="dv">2</span>]]</a></code></pre></div>
<pre><code>## $sd
##   Estimate  Est.Error      Q2.5     Q97.5
##  0.6075042 0.05160899 0.5173927 0.7195604</code></pre>
<p>We could have also extracted that information by subsetting <code>posterior_summary()</code>.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1"><span class="kw">posterior_summary</span>(fit4<span class="fl">.2</span>)[<span class="st">&quot;sigma&quot;</span>, ]</a></code></pre></div>
<pre><code>##   Estimate  Est.Error       Q2.5      Q97.5 
## 0.60912214 0.05178938 0.51781844 0.71800716</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1"><span class="kw">posterior_summary</span>(fit4<span class="fl">.3</span>)[<span class="st">&quot;sigma&quot;</span>, ]</a></code></pre></div>
<pre><code>##   Estimate  Est.Error       Q2.5      Q97.5 
## 0.60750423 0.05160899 0.51739275 0.71956038</code></pre>
<p>Anyway, to get these in a variance metric, just square their posterior samples and summarize.</p>
<p>Our next task is to formally compare <code>fit4.2</code> and <code>fit4.3</code> in terms of declines in <span class="math inline">\(\sigma_0^2\)</span> and <span class="math inline">\(\sigma_1^2\)</span>.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1"><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb292-2" data-line-number="2">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb292-3" data-line-number="3"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">fit2_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb292-4" data-line-number="4">              <span class="dt">fit2_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb292-5" data-line-number="5">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb292-6" data-line-number="6"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">fit3_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb292-7" data-line-number="7">              <span class="dt">fit3_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb292-8" data-line-number="8">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb292-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">decline~&#39;in&#39;~sigma[0]^2</span><span class="st">`</span> =<span class="st"> </span>(fit2_sigma_<span class="dv">2</span>_<span class="dv">0</span> <span class="op">-</span><span class="st"> </span>fit3_sigma_<span class="dv">2</span>_<span class="dv">0</span>) <span class="op">/</span><span class="st"> </span>fit2_sigma_<span class="dv">2</span>_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb292-10" data-line-number="10">         <span class="st">`</span><span class="dt">decline~&#39;in&#39;~sigma[1]^2</span><span class="st">`</span> =<span class="st"> </span>(fit2_sigma_<span class="dv">2</span>_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>fit3_sigma_<span class="dv">2</span>_<span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>fit2_sigma_<span class="dv">2</span>_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb292-11" data-line-number="11"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot;decline&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb292-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb292-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb292-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb292-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb292-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb292-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb292-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb292-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">labeller =</span> label_parsed, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-60-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Here are the percents of variance declined from <code>fit4.2</code> to <code>fit4.3</code>.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1"><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb293-2" data-line-number="2">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-3" data-line-number="3"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">fit2_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb293-4" data-line-number="4">              <span class="dt">fit2_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb293-5" data-line-number="5">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-6" data-line-number="6"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">fit3_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb293-7" data-line-number="7">              <span class="dt">fit3_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb293-8" data-line-number="8">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">decline~&#39;in&#39;~sigma[0]^2</span><span class="st">`</span> =<span class="st"> </span>(fit2_sigma_<span class="dv">2</span>_<span class="dv">0</span> <span class="op">-</span><span class="st"> </span>fit3_sigma_<span class="dv">2</span>_<span class="dv">0</span>) <span class="op">/</span><span class="st"> </span>fit2_sigma_<span class="dv">2</span>_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb293-10" data-line-number="10">         <span class="st">`</span><span class="dt">decline~&#39;in&#39;~sigma[1]^2</span><span class="st">`</span> =<span class="st"> </span>(fit2_sigma_<span class="dv">2</span>_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>fit3_sigma_<span class="dv">2</span>_<span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>fit2_sigma_<span class="dv">2</span>_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-11" data-line-number="11"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot;decline&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-12" data-line-number="12"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-13" data-line-number="13"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb293-14" data-line-number="14">            <span class="dt">median =</span> <span class="kw">median</span>(value),</a>
<a class="sourceLine" id="cb293-15" data-line-number="15">            <span class="dt">sd     =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb293-16" data-line-number="16">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb293-17" data-line-number="17">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   name                      mean  median     sd     ll    ul
##   &lt;chr&gt;                    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 decline~&#39;in&#39;~sigma[0]^2  0.152  0.207   0.335 -0.659 0.650
## 2 decline~&#39;in&#39;~sigma[1]^2 -1.96  -0.0549 27.2   -6.91  0.873</code></pre>
<p>In this case, we end up with massive uncertainty when working with the full posteriors. This is particularly the case with the difference in <span class="math inline">\(\sigma_1^2\)</span>, which is left skewed for days. Here are the results when we only use point estimates.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1"><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb295-2" data-line-number="2">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb295-3" data-line-number="3"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">fit2_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb295-4" data-line-number="4">              <span class="dt">fit2_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb295-5" data-line-number="5">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb295-6" data-line-number="6"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">fit3_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb295-7" data-line-number="7">              <span class="dt">fit3_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb295-8" data-line-number="8">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb295-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise_all</span>(median) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb295-10" data-line-number="10"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">% decline in sigma_2_0</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(fit2_sigma_<span class="dv">2</span>_<span class="dv">0</span> <span class="op">-</span><span class="st"> </span>fit3_sigma_<span class="dv">2</span>_<span class="dv">0</span>) <span class="op">/</span><span class="st"> </span>fit2_sigma_<span class="dv">2</span>_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb295-11" data-line-number="11">            <span class="st">`</span><span class="dt">% decline in sigma_2_1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(fit2_sigma_<span class="dv">2</span>_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>fit3_sigma_<span class="dv">2</span>_<span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>fit2_sigma_<span class="dv">2</span>_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>##   % decline in sigma_2_0 % decline in sigma_2_1
## 1               20.73695              -4.800244</code></pre>
<p>“These variance components are now called <em>partial</em> or <em>conditional</em> variances because they quantify the interindividual differences in change that remain unexplained by the model’s predictors” (p. 108, emphasis in the original).</p>
</div>
<div id="model-d-the-controlled-effects-of-coa." class="section level4">
<h4><span class="header-section-number">4.5.2.2</span> Model D: The controlled effects of COA.</h4>
<p>This model follows the form</p>
<p><span class="math display">\[\begin{align*}
\text{alcuse}_{ij} &amp; = \gamma_{00} + \gamma_{01} \text{coa}_i + \gamma_{02} \text{peer}_i + \gamma_{10} \text{age_14}_{ij} \\
&amp; \;\;\; + \gamma_{11} \text{coa}_i \times \text{age_14}_{ij} + \gamma_{12} \text{peer}_i \times \text{age_14}_{ij} \\
&amp; \;\;\; + \zeta_{0i} + \zeta_{1i} \text{age_14}_{ij} + \epsilon_{ij} \\
\epsilon_{ij} &amp; \sim \text{Normal} (0, \sigma_\epsilon^2) \\
\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp; \sim \text{Normal} 
\Bigg ( 
\begin{bmatrix} 0 \\ 0 \end{bmatrix}, 
\begin{bmatrix} \sigma_0^2 &amp; \sigma_{01} \\ \sigma_{01} &amp; \sigma_1^2 \end{bmatrix}
\Bigg ).
\end{align*}\]</span></p>
<p>Fit that joint.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1">fit4<span class="fl">.5</span> &lt;-</a>
<a class="sourceLine" id="cb297-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb297-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb297-4" data-line-number="4">      alcuse <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span>coa <span class="op">+</span><span class="st"> </span>peer <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span><span class="op">:</span>coa <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span><span class="op">:</span>peer <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">|</span><span class="st"> </span>id),</a>
<a class="sourceLine" id="cb297-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sd),</a>
<a class="sourceLine" id="cb297-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb297-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">lkj</span>(<span class="dv">1</span>), <span class="dt">class =</span> cor)),</a>
<a class="sourceLine" id="cb297-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb297-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb297-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit04.05&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" data-line-number="1"><span class="kw">print</span>(fit4<span class="fl">.5</span>, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: alcuse ~ 0 + Intercept + age_14 + coa + peer + age_14:coa + age_14:peer + (1 + age_14 | id) 
##    Data: alcohol1_pp (Number of observations: 246) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 82) 
##                       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.481     0.099    0.291    0.677 1.001      687     1661
## sd(age_14)               0.363     0.080    0.205    0.519 1.008      296      649
## cor(Intercept,age_14)    0.122     0.334   -0.415    0.866 1.004      307      457
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept     -0.315     0.149   -0.612   -0.009 1.001     1573     2265
## age_14         0.434     0.118    0.201    0.667 1.004     1421     2066
## coa            0.578     0.168    0.239    0.911 1.000     2305     2525
## peer           0.694     0.116    0.464    0.920 1.001     1550     1976
## age_14:coa    -0.017     0.129   -0.268    0.231 1.003     2230     2567
## age_14:peer   -0.151     0.089   -0.329    0.025 1.002     1551     2126
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.607     0.048    0.519    0.703 1.002      500     1300
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>All our <span class="math inline">\(\gamma\)</span> estimates are similar to those presented in Table 4.1. Let’s compute the variances and the covariance, <span class="math inline">\(\sigma_{01}^2\)</span>. Here are the plots.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" data-line-number="1"> v &lt;-</a>
<a class="sourceLine" id="cb300-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit4<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb300-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">sigma_2_epsilon =</span> sigma<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb300-4" data-line-number="4">            <span class="dt">sigma_2_0       =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb300-5" data-line-number="5">            <span class="dt">sigma_2_1       =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb300-6" data-line-number="6">            <span class="dt">sigma_01        =</span> sd_id__Intercept <span class="op">*</span><span class="st"> </span>cor_id__Intercept__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>sd_id__age_<span class="dv">14</span>)</a>
<a class="sourceLine" id="cb300-7" data-line-number="7"></a>
<a class="sourceLine" id="cb300-8" data-line-number="8">v <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb300-9" data-line-number="9"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb300-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb300-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb300-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb300-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb300-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-64-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>And now we compute the summary statistics.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1">v <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb301-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb301-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb301-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb301-5" data-line-number="5">            <span class="dt">median =</span> <span class="kw">median</span>(value),</a>
<a class="sourceLine" id="cb301-6" data-line-number="6">            <span class="dt">sd     =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb301-7" data-line-number="7">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb301-8" data-line-number="8">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb301-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   name             mean median    sd     ll    ul
##   &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 sigma_01        0.006  0.013 0.054 -0.12  0.091
## 2 sigma_2_0       0.242  0.233 0.097  0.084 0.458
## 3 sigma_2_1       0.138  0.132 0.059  0.042 0.269
## 4 sigma_2_epsilon 0.371  0.368 0.058  0.269 0.494</code></pre>
<p>Like the <span class="math inline">\(\gamma\)</span>’s, our variance components are all similar to those in the text.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1"><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb303-2" data-line-number="2">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb303-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">fit4.2_sigma_2_epsilon =</span> sigma<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb303-4" data-line-number="4">            <span class="dt">fit4.2_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb303-5" data-line-number="5">            <span class="dt">fit4.2_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb303-6" data-line-number="6">  <span class="kw">posterior_samples</span>(fit4<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb303-7" data-line-number="7"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">fit4.5_sigma_2_epsilon =</span> sigma<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb303-8" data-line-number="8">            <span class="dt">fit4.5_sigma_2_0 =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb303-9" data-line-number="9">            <span class="dt">fit4.5_sigma_2_1 =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb303-10" data-line-number="10">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb303-11" data-line-number="11"><span class="st">  </span><span class="kw">summarise_all</span>(median) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb303-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">% decline in sigma_2_epsilon</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(fit4<span class="fl">.2</span>_sigma_<span class="dv">2</span>_epsilon <span class="op">-</span><span class="st"> </span>fit4<span class="fl">.5</span>_sigma_<span class="dv">2</span>_epsilon) <span class="op">/</span><span class="st"> </span>fit4<span class="fl">.2</span>_sigma_<span class="dv">2</span>_epsilon,</a>
<a class="sourceLine" id="cb303-13" data-line-number="13">         <span class="st">`</span><span class="dt">% decline in sigma_2_0</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(fit4<span class="fl">.2</span>_sigma_<span class="dv">2</span>_<span class="dv">0</span> <span class="op">-</span><span class="st"> </span>fit4<span class="fl">.5</span>_sigma_<span class="dv">2</span>_<span class="dv">0</span>) <span class="op">/</span><span class="st"> </span>fit4<span class="fl">.2</span>_sigma_<span class="dv">2</span>_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb303-14" data-line-number="14">         <span class="st">`</span><span class="dt">% decline in sigma_2_1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(fit4<span class="fl">.2</span>_sigma_<span class="dv">2</span>_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>fit4<span class="fl">.5</span>_sigma_<span class="dv">2</span>_<span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>fit4<span class="fl">.2</span>_sigma_<span class="dv">2</span>_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb303-15" data-line-number="15"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot;%&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb303-16" data-line-number="16"><span class="st">  </span><span class="kw">select</span>(name, value)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name                          value
##   &lt;chr&gt;                         &lt;dbl&gt;
## 1 % decline in sigma_2_epsilon -0.299
## 2 % decline in sigma_2_0       62.4  
## 3 % decline in sigma_2_1        2.47</code></pre>
<p>The percentages in which our variance componence declined relative to the unconditional growth model are of similar orders of magnitude as those presented in the text.</p>
</div>
<div id="model-e-a-tentative-final-model-for-the-controlled-effects-of-coa." class="section level4">
<h4><span class="header-section-number">4.5.2.3</span> Model E: A tentative “final model” for the controlled effects of <code>coa</code>.</h4>
<p>This model is just like the last, but with the simple omission of the <span class="math inline">\(\gamma_{12}\)</span> parameter.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" data-line-number="1">fit4<span class="fl">.6</span> &lt;-</a>
<a class="sourceLine" id="cb305-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> alcohol1_pp, </a>
<a class="sourceLine" id="cb305-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb305-4" data-line-number="4">      alcuse <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span>coa <span class="op">+</span><span class="st"> </span>peer <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span><span class="op">:</span>peer <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">|</span><span class="st"> </span>id),</a>
<a class="sourceLine" id="cb305-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sd),</a>
<a class="sourceLine" id="cb305-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb305-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">lkj</span>(<span class="dv">1</span>), <span class="dt">class =</span> cor)),</a>
<a class="sourceLine" id="cb305-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb305-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb305-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit04.06&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" data-line-number="1"><span class="kw">print</span>(fit4<span class="fl">.6</span>, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: alcuse ~ 0 + Intercept + age_14 + coa + peer + age_14:peer + (1 + age_14 | id) 
##    Data: alcohol1_pp (Number of observations: 246) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~id (Number of levels: 82) 
##                       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.482     0.102    0.274    0.676 1.002      574     1118
## sd(age_14)               0.362     0.083    0.200    0.521 1.008      303      687
## cor(Intercept,age_14)    0.120     0.343   -0.419    0.879 1.006      267      346
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## Intercept     -0.313     0.156   -0.626   -0.006 1.000     1732     2244
## age_14         0.423     0.109    0.206    0.640 1.001     1821     2419
## coa            0.572     0.151    0.279    0.879 1.003     1939     2531
## peer           0.695     0.116    0.464    0.917 1.002     1857     2474
## age_14:peer   -0.150     0.087   -0.318    0.024 1.000     1754     2224
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
## sigma    0.606     0.048    0.516    0.705 1.005      361     1112
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <span class="math inline">\(\gamma\)</span>’s all look well behaved. Here are the variance component summaries.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" data-line-number="1"> v &lt;-</a>
<a class="sourceLine" id="cb308-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit4<span class="fl">.6</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb308-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">sigma_2_epsilon =</span> sigma<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb308-4" data-line-number="4">            <span class="dt">sigma_2_0       =</span> sd_id__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb308-5" data-line-number="5">            <span class="dt">sigma_2_1       =</span> sd_id__age_<span class="dv">14</span><span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb308-6" data-line-number="6">            <span class="dt">sigma_01        =</span> sd_id__Intercept <span class="op">*</span><span class="st"> </span>cor_id__Intercept__age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span>sd_id__age_<span class="dv">14</span>)</a>
<a class="sourceLine" id="cb308-7" data-line-number="7"></a>
<a class="sourceLine" id="cb308-8" data-line-number="8">v <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb308-9" data-line-number="9"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb308-10" data-line-number="10"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb308-11" data-line-number="11"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean   =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb308-12" data-line-number="12">            <span class="dt">median =</span> <span class="kw">median</span>(value),</a>
<a class="sourceLine" id="cb308-13" data-line-number="13">            <span class="dt">sd     =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb308-14" data-line-number="14">            <span class="dt">ll     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb308-15" data-line-number="15">            <span class="dt">ul     =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb308-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   name             mean median    sd     ll    ul
##   &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 sigma_01        0.005  0.01  0.054 -0.116 0.093
## 2 sigma_2_0       0.243  0.233 0.098  0.075 0.457
## 3 sigma_2_1       0.138  0.132 0.06   0.04  0.271
## 4 sigma_2_epsilon 0.37   0.365 0.059  0.267 0.497</code></pre>
</div>
</div>
<div id="displaying-prototypical-change-trajectories." class="section level3">
<h3><span class="header-section-number">4.5.3</span> Displaying prototypical change trajectories.</h3>
<p>On page 111, Singer and Willett computed the various levels of the <span class="math inline">\(\pi\)</span> coefficients when <code>coa == 0</code> or <code>coa == 1</code>. To follow along, we’ll want to work directly with the posterior samples of <code>fit4.3</code>.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb310-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit4<span class="fl">.3</span>) </a>
<a class="sourceLine" id="cb310-2" data-line-number="2"></a>
<a class="sourceLine" id="cb310-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb310-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb310-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##   b_Intercept  b_age_14     b_coa b_age_14:coa
## 1   0.2618439 0.2495084 0.8431245  -0.08459538
## 2   0.2911188 0.3038611 0.9213667  -0.10428155
## 3   0.3188864 0.2983608 0.8543070  -0.09359624
## 4   0.1661855 0.3694042 0.9406988  -0.20639550
## 5   0.3612977 0.2752802 0.6327648   0.04498002
## 6   0.2614384 0.2797979 0.7827562  -0.07184190</code></pre>
<p>Here we apply the formulas to the posterior samples and then summarize with posterior means.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb312-1" data-line-number="1">post <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb312-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb312-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">pi_0_coa0 =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_coa          <span class="op">*</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb312-4" data-line-number="4">            <span class="dt">pi_1_coa0 =</span> b_age_<span class="dv">14</span>    <span class="op">+</span><span class="st"> `</span><span class="dt">b_age_14:coa</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb312-5" data-line-number="5">            <span class="dt">pi_0_coa1 =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_coa          <span class="op">*</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb312-6" data-line-number="6">            <span class="dt">pi_1_coa1 =</span> b_age_<span class="dv">14</span>    <span class="op">+</span><span class="st"> `</span><span class="dt">b_age_14:coa</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb312-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb312-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb312-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior_mean =</span> <span class="kw">mean</span>(value) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   name      posterior_mean
##   &lt;chr&gt;              &lt;dbl&gt;
## 1 pi_0_coa0          0.314
## 2 pi_0_coa1          1.05 
## 3 pi_1_coa0          0.294
## 4 pi_1_coa1          0.245</code></pre>
<p>We already plotted these trajectories and their 95% intervals a few sections up. If we want to work with the full composite model to predict <span class="math inline">\(Y_{ij}\)</span> (i.e., <code>alcuse</code>) directly, we multiply the <code>b_coa</code>, <code>b_age_14</code>, and <code>b_age_14:coa</code> vectors by the appropriate values of <code>coa</code> and <code>peer</code>. For example, here’s what you’d code if you wanted the initial <code>alcuse</code> status for when <code>coa == 1</code>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" data-line-number="1">post <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb314-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_coa <span class="op">*</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>b_age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> `</span><span class="dt">b_age_14:coa</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="op">*</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##   b_Intercept  b_age_14     b_coa b_age_14:coa         y
## 1   0.2618439 0.2495084 0.8431245  -0.08459538 1.1049684
## 2   0.2911188 0.3038611 0.9213667  -0.10428155 1.2124855
## 3   0.3188864 0.2983608 0.8543070  -0.09359624 1.1731934
## 4   0.1661855 0.3694042 0.9406988  -0.20639550 1.1068843
## 5   0.3612977 0.2752802 0.6327648   0.04498002 0.9940625
## 6   0.2614384 0.2797979 0.7827562  -0.07184190 1.0441946</code></pre>
<p>If you were to take the mean of that new <code>y</code> column, you’d discover it’s the same as the mean of our <code>pi_0_coa1</code>, above.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb316-1" data-line-number="1">post <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb316-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb316-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_coa <span class="op">*</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>b_age_<span class="dv">14</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> `</span><span class="dt">b_age_14:coa</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="op">*</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb316-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pi_0_coa1 =</span> <span class="kw">mean</span>(y))</a></code></pre></div>
<pre><code>##   pi_0_coa1
## 1  1.053244</code></pre>
<p>Singer and Willett suggested four strategies to help researchers pick the prototypical values of the predictors to focus on:</p>
<ul>
<li>Substantively interesting values (e.g., typical ages, values corresponding to transition points)</li>
<li>A range of percentiles (e.g., 25<sup>th</sup>, 50<sup>th</sup>, and 75<sup>th</sup>)</li>
<li>Just the sample mean</li>
<li>The sample mean <span class="math inline">\(\pm\)</span> something like 1 standard deviation</li>
</ul>
<p>They next discuss the right panel of Figure 4.3. We could continue to work directly with the <code>posterior_samples()</code> to make our version of that figure. But it you want to accompany the posterior mean trajectories with their 95% intervals, and I hope you do, the <code>posterior_samples()</code> method will get tedious. Happily, <strong>brms</strong> offers users and alternative with the <code>fitted()</code> function. Since the right panel is somewhat complicated, it’ll behove us to practice with the simpler left panel, first.</p>
<p>In <code>fit4.2</code> (i.e., Model C), <code>age_14</code> is the only predictor. Here we’ll specify the values along the range in the original data, ranging from 0 to 2. However, we end up specifying a bunch of values within that range in addition to the two endpoints. This is because the 95% intervals typically have a bowtie shape. To depict that shape well, we need more than a couple values. We save those values as a tibble called <code>nd</code> (i.e., new data). We make use of them within fitted with the <code>newdata = nd</code> argument.</p>
<p>Since we’re only interested in the general trajectory, the consequence of the <span class="math inline">\(\gamma\)</span>’s, we end up coding <code>re_formula = NA</code>. In so doing, we ask <code>fitted()</code> to ignore the group-level effects. In this example, that means we are ignoring the <code>id</code>-level deviations from the overall trajectories. If you’re confused by that that means, don’t worry. That part of the model should become more clear as we go along in the text.</p>
<p>Since <code>fitted()</code> returns an array, we then convert the results into a data frame for use within the <strong>tidyverse</strong> framework. For plotting, it’s handy to bind those results together with the <code>nd</code>, the predictor values we used to compute the fitted values with. In the final wrangling step, we use our <code>age_14</code> values to compute the <code>age</code> values.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" data-line-number="1">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb318-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">age_14 =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb318-3" data-line-number="3"></a>
<a class="sourceLine" id="cb318-4" data-line-number="4">f &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb318-5" data-line-number="5"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.2</span>, </a>
<a class="sourceLine" id="cb318-6" data-line-number="6">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb318-7" data-line-number="7">         <span class="dt">re_formula =</span> <span class="ot">NA</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb318-8" data-line-number="8"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb318-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb318-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span><span class="dv">14</span>)</a>
<a class="sourceLine" id="cb318-11" data-line-number="11"></a>
<a class="sourceLine" id="cb318-12" data-line-number="12"><span class="kw">head</span>(f)</a></code></pre></div>
<pre><code>##    Estimate Est.Error      Q2.5     Q97.5     age_14      age
## 1 0.6482574 0.1081590 0.4376040 0.8698159 0.00000000 14.00000
## 2 0.6670799 0.1063590 0.4620157 0.8842208 0.06896552 14.06897
## 3 0.6859024 0.1047164 0.4842801 0.8978622 0.13793103 14.13793
## 4 0.7047250 0.1032386 0.5068118 0.9121371 0.20689655 14.20690
## 5 0.7235475 0.1019329 0.5299203 0.9271172 0.27586207 14.27586
## 6 0.7423700 0.1008058 0.5503669 0.9437117 0.34482759 14.34483</code></pre>
<p>Since we only had one predictor, <code>age_14</code>, for which we specified 30 specific values, we ended up with 30 rows in our output. By default, <code>fitted()</code> summarized the fitted values with posterior means (<code>Estimate</code>), standard deviations (<code>Est.Error</code>), and percentile-based 95% intervals (<code>Q2.5</code> and <code>Q97.5</code>). The other columns are the values we bound to them. Here’s how we might use these to make our <code>fitted()</code> version of the leftmost panel of Figure 4.3.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb320-1" data-line-number="1">f <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb320-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb320-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb320-4" data-line-number="4">              <span class="dt">fill =</span> <span class="st">&quot;grey75&quot;</span>, <span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb320-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb320-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;alcuse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb320-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">17</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb320-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-74-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>With <code>fit4.6</code> (i.e., Model E), we now have three predictors. We’d like to see the full range across <code>age_14</code> for four combinations of <code>coa</code> and <code>peer</code> values. To my mind, the easiest way to get those values right is with a little <code>crossing()</code> and <code>expand()</code>.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb321-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb321-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">coa  =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb321-3" data-line-number="3">           <span class="dt">peer =</span> <span class="kw">c</span>(.<span class="dv">655</span>, <span class="fl">1.381</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb321-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(coa, peer),</a>
<a class="sourceLine" id="cb321-5" data-line-number="5">         <span class="dt">age_14 =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb321-6" data-line-number="6"></a>
<a class="sourceLine" id="cb321-7" data-line-number="7"><span class="kw">head</span>(nd, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##      coa  peer age_14
##    &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     0 0.655 0     
##  2     0 0.655 0.0690
##  3     0 0.655 0.138 
##  4     0 0.655 0.207 
##  5     0 0.655 0.276 
##  6     0 0.655 0.345 
##  7     0 0.655 0.414 
##  8     0 0.655 0.483 
##  9     0 0.655 0.552 
## 10     0 0.655 0.621</code></pre>
<p>Now we use <code>fitted()</code> much like before.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" data-line-number="1">f &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb323-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb323-3" data-line-number="3">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb323-4" data-line-number="4">         <span class="dt">re_formula =</span> <span class="ot">NA</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb323-5" data-line-number="5"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb323-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb323-7" data-line-number="7"><span class="st">  </span><span class="co"># a little wrangling will make plotting much easier</span></a>
<a class="sourceLine" id="cb323-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age  =</span> age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span><span class="dv">14</span>,</a>
<a class="sourceLine" id="cb323-9" data-line-number="9">         <span class="dt">coa  =</span> <span class="kw">ifelse</span>(coa <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;coa = 0&quot;</span>, <span class="st">&quot;coa = 1&quot;</span>),</a>
<a class="sourceLine" id="cb323-10" data-line-number="10">         <span class="dt">peer =</span> <span class="kw">factor</span>(peer))</a>
<a class="sourceLine" id="cb323-11" data-line-number="11"></a>
<a class="sourceLine" id="cb323-12" data-line-number="12"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 120
## Columns: 8
## $ Estimate  &lt;dbl&gt; 0.1425897, 0.1649825, 0.1873752, 0.2097680, 0.2321607, 0.2545535, 0.2769462, 0.…
## $ Est.Error &lt;dbl&gt; 0.1134501, 0.1117202, 0.1101835, 0.1088480, 0.1077213, 0.1068100, 0.1061196, 0.…
## $ Q2.5      &lt;dbl&gt; -0.078688764, -0.053886847, -0.028335511, -0.004650132, 0.020322470, 0.04483448…
## $ Q97.5     &lt;dbl&gt; 0.3669462, 0.3856548, 0.4047552, 0.4244724, 0.4453436, 0.4642707, 0.4854083, 0.…
## $ coa       &lt;chr&gt; &quot;coa = 0&quot;, &quot;coa = 0&quot;, &quot;coa = 0&quot;, &quot;coa = 0&quot;, &quot;coa = 0&quot;, &quot;coa = 0&quot;, &quot;coa = 0&quot;, &quot;c…
## $ peer      &lt;fct&gt; 0.655, 0.655, 0.655, 0.655, 0.655, 0.655, 0.655, 0.655, 0.655, 0.655, 0.655, 0.…
## $ age_14    &lt;dbl&gt; 0.00000000, 0.06896552, 0.13793103, 0.20689655, 0.27586207, 0.34482759, 0.41379…
## $ age       &lt;dbl&gt; 14.00000, 14.06897, 14.13793, 14.20690, 14.27586, 14.34483, 14.41379, 14.48276,…</code></pre>
<p>For our version of the right panel of Figure 4.3, most of the action is in <code>ggplot()</code>, <code>geom_ribbon()</code>, <code>geom_line()</code>, and <code>facet_wrap()</code>. All the rest is cosmetic.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" data-line-number="1">f <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb325-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">color =</span> peer, <span class="dt">fill =</span> peer)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb325-4" data-line-number="4">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">size =</span> peer)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue3&quot;</span>, <span class="st">&quot;red3&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue3&quot;</span>, <span class="st">&quot;red3&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;alcuse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;High peer values are in red; low ones are in blue.&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">17</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb325-13" data-line-number="13">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>coa)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-77-1.png" width="441.6" style="display: block; margin: auto;" /></p>
<p>In my opinion, it works better to split the plot into two when you include the 95% intervals.</p>
</div>
<div id="recentering-predictors-to-improve-interpretation." class="section level3">
<h3><span class="header-section-number">4.5.4</span> Recentering predictors to improve interpretation.</h3>
<blockquote>
<p>The easiest strategy for recentering a time-invariant predictor is to subtract its sample mean from each observed value. When we center a predictor on its sample mean, the level-2 fitted intercepts represent the average fitted values of initial status (or rate of change). We can also recenter a time-invariant predictor by subtracting another meaningful value… Recentering works best when the centering constant is substantively meaningful. (pp. 113–114)</p>
</blockquote>
<p>As we’ll see later, centering can also make it easier to select meaningful priors on the model intercept. If you look at our <code>alcohol1_pp</code> data, you’ll see we already have centered versions of our time-invariant predictors. They’re the last two columns, <code>cpeer</code> and <code>ccoa</code>.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" data-line-number="1">alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb326-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 246
## Columns: 9
## $ id     &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 1…
## $ age    &lt;dbl&gt; 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16…
## $ coa    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ male   &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0…
## $ age_14 &lt;dbl&gt; 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0…
## $ alcuse &lt;dbl&gt; 1.732051, 2.000000, 2.000000, 0.000000, 0.000000, 1.000000, 1.000000, 2.000000, 3.…
## $ peer   &lt;dbl&gt; 1.2649111, 1.2649111, 1.2649111, 0.8944272, 0.8944272, 0.8944272, 0.8944272, 0.894…
## $ cpeer  &lt;dbl&gt; 0.2469111, 0.2469111, 0.2469111, -0.1235728, -0.1235728, -0.1235728, -0.1235728, -…
## $ ccoa   &lt;dbl&gt; 0.549, 0.549, 0.549, 0.549, 0.549, 0.549, 0.549, 0.549, 0.549, 0.549, 0.549, 0.549…</code></pre>
<p>If you wanted to center them by hand, you’d just execute something like this.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" data-line-number="1">alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb328-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">peer_c =</span> peer <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(peer))</a></code></pre></div>
<pre><code>## # A tibble: 246 x 10
##       id   age   coa  male age_14 alcuse  peer  cpeer  ccoa peer_c
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     1    14     1     0      0   1.73 1.26   0.247 0.549  0.247
##  2     1    15     1     0      1   2    1.26   0.247 0.549  0.247
##  3     1    16     1     0      2   2    1.26   0.247 0.549  0.247
##  4     2    14     1     1      0   0    0.894 -0.124 0.549 -0.123
##  5     2    15     1     1      1   0    0.894 -0.124 0.549 -0.123
##  6     2    16     1     1      2   1    0.894 -0.124 0.549 -0.123
##  7     3    14     1     1      0   1    0.894 -0.124 0.549 -0.123
##  8     3    15     1     1      1   2    0.894 -0.124 0.549 -0.123
##  9     3    16     1     1      2   3.32 0.894 -0.124 0.549 -0.123
## 10     4    14     1     1      0   0    1.79   0.771 0.549  0.771
## # … with 236 more rows</code></pre>
<p>Did you notice how our <code>peer_c</code> values, above, deviated slightly from those in <code>cpeer</code>? That’s because <code>peer_c</code> was based on the exact sample mean. Those in <code>cpeer</code> are based on the sample mean as provided in the text, 1.018, which is introduces rounding error. For the sake of simplicity, we’ll go with centered variables matching up with the text.</p>
<p>Here we’ll hastily fit the models with help from the <code>update()</code> function.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" data-line-number="1">fit4<span class="fl">.7</span> &lt;-</a>
<a class="sourceLine" id="cb330-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(fit4<span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb330-3" data-line-number="3">         <span class="dt">newdata =</span> alcohol1_pp,</a>
<a class="sourceLine" id="cb330-4" data-line-number="4">         alcuse <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span>coa <span class="op">+</span><span class="st"> </span>cpeer <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span><span class="op">:</span>cpeer <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">|</span><span class="st"> </span>id),</a>
<a class="sourceLine" id="cb330-5" data-line-number="5">         <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb330-6" data-line-number="6">         <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb330-7" data-line-number="7">         <span class="dt">file =</span> <span class="st">&quot;fits/fit04.07&quot;</span>)</a>
<a class="sourceLine" id="cb330-8" data-line-number="8"></a>
<a class="sourceLine" id="cb330-9" data-line-number="9">fit4<span class="fl">.8</span> &lt;-</a>
<a class="sourceLine" id="cb330-10" data-line-number="10"><span class="st">  </span><span class="kw">update</span>(fit4<span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb330-11" data-line-number="11">         <span class="dt">newdata =</span> alcohol1_pp,</a>
<a class="sourceLine" id="cb330-12" data-line-number="12">         alcuse <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span>ccoa <span class="op">+</span><span class="st"> </span>peer <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span><span class="op">:</span>peer <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span> <span class="op">|</span><span class="st"> </span>id),</a>
<a class="sourceLine" id="cb330-13" data-line-number="13">         <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb330-14" data-line-number="14">         <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb330-15" data-line-number="15">         <span class="dt">file =</span> <span class="st">&quot;fits/fit04.08&quot;</span>)</a></code></pre></div>
<p>Here we reproduce the <span class="math inline">\(\gamma\)</span>s from <code>fit4.6</code> and compare the to the updates from <code>fit4.7</code> and <code>fit4.8</code>.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb331-1" data-line-number="1"><span class="kw">fixef</span>(fit4<span class="fl">.6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5  Q97.5
## Intercept     -0.313     0.156 -0.626 -0.006
## age_14         0.423     0.109  0.206  0.640
## coa            0.572     0.151  0.279  0.879
## peer           0.695     0.116  0.464  0.917
## age_14:peer   -0.150     0.087 -0.318  0.024</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" data-line-number="1"><span class="kw">fixef</span>(fit4<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##              Estimate Est.Error   Q2.5 Q97.5
## Intercept       0.393     0.107  0.177 0.602
## age_14          0.271     0.065  0.146 0.397
## coa             0.572     0.149  0.287 0.870
## cpeer           0.692     0.113  0.465 0.907
## age_14:cpeer   -0.150     0.087 -0.323 0.016</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" data-line-number="1"><span class="kw">fixef</span>(fit4<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5 Q97.5
## Intercept     -0.059     0.140 -0.327 0.224
## age_14         0.424     0.111  0.209 0.642
## ccoa           0.572     0.148  0.285 0.863
## peer           0.697     0.113  0.478 0.921
## age_14:peer   -0.150     0.087 -0.321 0.023</code></pre>
</div>
</div>
<div id="comparing-models-using-deviance-statistics" class="section level2">
<h2><span class="header-section-number">4.6</span> Comparing models using deviance statistics</h2>
<p>As you will see, we will also make use of deviance within our Bayesian Stan-based paradigm. But we’ll do so a little differently than what Singer and Willett presented.</p>
<div id="the-deviance-statistic." class="section level3">
<h3><span class="header-section-number">4.6.1</span> The deviance statistic.</h3>
<p>As it turns out, we Bayesians use the log-likelihood (LL), too. Recall how the numerator in the right-hand side of Bayes’ Theorem was <span class="math inline">\(p(\text{data} | \theta) p(\theta)\)</span>? That first part, <span class="math inline">\(p(\text{data} | \theta)\)</span>, is the likelihood. In words, the likelihood is the <em>probability of the data given the parameters</em>. We generally work with the log of the likelihood rather than the likelihood itself because it’s easier to work with statistically.</p>
<p>When you’re working with <strong>brms</strong>, you can extract the LL with the <code>log_lik()</code> function. Here’s an example with <code>fit4.1</code>, our unconditional means model.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" data-line-number="1"><span class="kw">log_lik</span>(fit4<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb337-2" data-line-number="2"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:4000, 1:246] -0.654 -0.788 -0.795 -0.65 -0.587 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL</code></pre>
<p>You may have noticed we didn’t just get a single value back. Rather, we got an array of 4,000 rows and 246 columns. The reason we got 4,000 rows is because that’s how many post-warmup iterations we drew from the posterior. I.e., we set <code>brm(..., iter = 2000, warmup = 1000, chains = 4)</code>. With respect to the 246 columns, that’s how many rows there are in the <code>alcohol1_pp</code> data. So for each case in the data, we get an entire posterior distribution of LL values.</p>
<p>With the multilevel model, we can define deviance for a given model as its LL times -2,</p>
<p><span class="math display">\[
\text{Deviance} = -2 LL_\text{current model}.
\]</span></p>
<p>Here that is in code for <code>fit4.1</code>.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb339-1" data-line-number="1">ll &lt;-</a>
<a class="sourceLine" id="cb339-2" data-line-number="2"><span class="st">  </span><span class="kw">log_lik</span>(fit4<span class="fl">.1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb339-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb339-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">rowSums</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb339-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">deviance =</span> <span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb339-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(ll, deviance, <span class="kw">everything</span>())</a>
<a class="sourceLine" id="cb339-7" data-line-number="7"></a>
<a class="sourceLine" id="cb339-8" data-line-number="8"><span class="kw">dim</span>(ll)</a></code></pre></div>
<pre><code>## [1] 4000  248</code></pre>
<p>Because we used HMC, deviance is a distribution rather than a single number. Here’s what it looks like for <code>fit4.1</code>.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" data-line-number="1">ll <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb341-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> deviance)) <span class="op">+</span></a>
<a class="sourceLine" id="cb341-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb341-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb341-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-83-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Much like the frequentists, we Bayesian generally prefer models with smaller deviance distributions.</p>
<p>The reasons frequentists multiply the LL by -2 is because after doing so, the difference in deviances between two models follows a <span class="math inline">\(\chi^2\)</span> distribution and the old <span class="math inline">\(\chi^2\)</span>-difference test is widely-used in frequentist statistics. Bayesians often just go ahead and use the -2 multiplication, too. It’s largely out of tradition. But as we’ll see, some contemporary Bayesians are challenging that tradition.</p>
</div>
<div id="when-and-how-can-you-compare-deviance-statistics" class="section level3">
<h3><span class="header-section-number">4.6.2</span> When and how can you compare deviance statistics?</h3>
<p>As for the frequentists, deviance values/distributions in the Bayesian context are only meaningful in the relative sense. You cannot directly interpret a single models deviance distribution by the magnitude or sign of its central tendency. But you can compare two or more models by the relative locations of their deviance distributions. When doing so, they must have been computed using the same data (i.e., no differences in missingness in the predictors) and the models must be nested.</p>
<p>However, in contemporary Bayesian practice we don’t tend to compare models with deviance. For details on why, check out Chapter 6 in McElreath’s <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical Rethinking</em></a>. McElreath also covered the topic in several online lectures (e.g., <a href="https://www.youtube.com/watch?v=vSjL2Zc-gEQ&amp;list=PLDcUM9US4XdMdZOhJWJJD4mDBMnbTWw_z&amp;index=8">here</a> and <a href="https://www.youtube.com/watch?v=gjrsYDJbRh0&amp;list=PLDcUM9US4XdNM4Edgs7weiyIguLSToZRI&amp;index=8">here</a>).</p>
</div>
<div id="implementing-deviance-based-hypothesis-tests." class="section level3">
<h3><span class="header-section-number">4.6.3</span> Implementing deviance-based hypothesis tests.</h3>
<p>In this project, we are not going to practice comparing deviances using frequentist <span class="math inline">\(\chi^2\)</span> tests. We will, however, cover Bayesian information criteria.</p>
</div>
<div id="aic-and-bic-waic-and-loo-statistics-comparing-nonnested-models-using-information-criteria-and-cross-validation." class="section level3">
<h3><span class="header-section-number">4.6.4</span> <del>AIC and BIC</del> WAIC and LOO statistics: Comparing nonnested models using information criteria [and cross validation].</h3>
<p>We do not use the AIC or the BIC within the Stan ecosystem. The AIC is frequentist and cannot handle models with priors. The BIC is interesting in it’s a double misnomer. It is neither Bayesian nor is it a proper information criterion–though it does scale like one. However, it might be useful for our purposes to walk out the AIC a bit. It’ll ground our discussion of the WAIC and LOO. From <a href="https://www.jstor.org/stable/pdf/24774528.pdf?casa_token=cOkknddLwBsAAAAA:nwbGR1IDJtZHzGmhEUDJBLfELsSJUzgTR_r5j_gur7goLCihSBVdFhXeCZVxGKbj0B0Dr_4dZs52PsP4NEoFAM0M5OR7LusQSqGgGuyX147xIButrjzT">Spiegelhalter, Best, Carlin and van der Linde (2014)</a>, we read:</p>
<blockquote>
<p>Suppose that we have a given set of candidate models, and we would like a criterion to assess which is ‘better’ in a defined sense. Assume that a model for observed data <span class="math inline">\(y\)</span> postulates a density <span class="math inline">\(p(y | \theta)\)</span> (which may include covariates etc.), and call <span class="math inline">\(D(\theta) = -2 \log {p(y | \theta)}\)</span> the deviance, here considered as a function of <span class="math inline">\(\theta\)</span>. Classical model choice uses hypothesis testing for comparing nested models, e.g. the deviance (likelihood ratio) test in generalized linear models. For non nested models, alternatives include the Akaike information criterion</p>
<p><span class="math display">\[AIC = -2 \log {p(y | \hat{\theta})} + 2k\]</span></p>
<p>where <span class="math inline">\(\hat{\theta}\)</span> is the maximum likelihood estimate and <span class="math inline">\(k\)</span> is the number of parameters in the model (dimension of <span class="math inline">\(\Theta\)</span>).</p>
<p>AIC is built with the aim of favouring models that are likely to make good predictions. Since we generally do not have independent validation data, we can assess which model best predicts the <em>observed</em> data by using the deviance, but if parameters have been estimated we need some penalty for this double use of the data. AIC’s penalty of <em>2k</em> has been shown to be asymptotically equivalent to leave-one-out cross-validation. However, AIC does not work in models with informative prior information, such as hierarchical models, since the prior effectively acts to ‘restrict’ the freedom of the model parameters, so the appropriate ‘number of parameters’ is generally unclear. (pp. 485–486, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For the past two decades, the Deviance Information Criterion (DIC; <a href="https://rss.onlinelibrary.wiley.com/doi/full/10.1111/1467-9868.00353">Spiegelhalter, Best, Carlin, &amp; van der Linde, 2002</a>) has been a popular information criterion among Bayesians. Let’s define <span class="math inline">\(D\)</span> as the posterior distribution of deviance values and <span class="math inline">\(\bar D\)</span> as its mean. If you compute deviance based on the posterior mean, you have <span class="math inline">\(\hat D\)</span>. Within a multi-parameter model, this would be the deviance based on the collection of the posterior mean of each parameter. With these, we define the DIC as</p>
<p><span class="math display">\[\text{DIC} = \bar D + (\bar D + \hat D) + \bar D + p_D,\]</span></p>
<p>where <span class="math inline">\(p_D\)</span> is the number of effective parameters in the model, which is also sometimes referred to as the penalty term. As McElreath pointed out in <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical Rethinking</em></a>, the <span class="math inline">\(p_D\)</span></p>
<blockquote>
<p>is just the expected distance between the deviance in-sample and the deviance out-of-sample. In the case of flat priors, DIC reduces directly to AIC, because the expected distance is just the number of parameters. But more generally, <span class="math inline">\(p_D\)</span> will be some fraction of the number of parameters, because regularizing priors constrain a model’s flexibility. (p. 191)</p>
</blockquote>
<p>As you’ll see, you can get the <span class="math inline">\(p_D\)</span> for <code>brms::brm()</code> models. However, the DIC is limited in that it requires a multivariate Gaussian posterior and I’m not aware of a convenience function within <strong>brms</strong> that will compute the DIC. Which is fine. The DIC has been overshadowed in recent years by newer methods. But for a great talk on the DIC, check out the authoritative David Spiegelhalter’s <a href="https://www.youtube.com/watch?v=H-59eqmHuuQ&amp;frags=pl%2Cwn"><em>Retrospective read paper: Bayesian measure of model complexity and fit</em></a>.</p>
<div id="the-widely-applicable-information-criterion-waic." class="section level4">
<h4><span class="header-section-number">4.6.4.1</span> The Widely Applicable Information Criterion (WAIC).</h4>
<p>The main information criterion within our Stan ecosystem paradigm is the Widely Applicable Information Criterion (WAIC; <a href="http://www.jmlr.org/papers/volume11/watanabe10a/watanabe10a.pdf">Watanabe, 2010</a>). From McElreath, again, we read:</p>
<blockquote>
<p>It does not require a multivariate Gaussian posterior, and it is often more accurate than DIC. There are types of models for which it is hard to define at all, however. We’ll discuss that issue more, after defining WAIC.</p>
<p>The distinguishing feature of WAIC is that it is <em>pointwise</em>. This means that uncertainty in prediction is considered case-by-case, or point-by-point, in the data. This is useful, because some observations are much harder to predict than others and may also have different uncertainty… You can think of WAIC as handling uncertainty where it actually matters: for each independent observation.</p>
<p>Define <span class="math inline">\(\text{Pr} (y_i)\)</span> as the average likelihood of observation <span class="math inline">\(i\)</span> in the training sample. This means we compute the likelihood of <span class="math inline">\(y_i\)</span> for each set of parameters samples from the posterior distribution. Then we average the likelihoods for each observation <span class="math inline">\(i\)</span> and finally sum over all observations. This produces the first part of WAIC, the log-pointwise-predictive-density,</p>
<p><span class="math display">\[\text{lppd} = \sum_{i = 1}^N \text{log Pr} (y_i)\]</span></p>
<p>You might say this out loud as:</p>
<blockquote>
<p><em>The log-pointwise-predictive-density is the total across observations of the logarithm of the average likelihood of each observation.</em></p>
</blockquote>
<p>The lppd is just a pointwise analog of deviance, averaged over the posterior distribution. If you multiplied it by -2, it’d be similar to the deviance, in fact.</p>
<p>The second piece of WAIC is the effective number of parameters <span class="math inline">\(p_\text{WAIC}\)</span>. Define <span class="math inline">\(V(y_i)\)</span> as the variance in log-likelihood for observation <span class="math inline">\(i\)</span> in the training sample. This means we compute the log-likelihood of <span class="math inline">\(y_i\)</span> for each sample from the posterior distribution. Then we take the variance of those values. This is <span class="math inline">\(V(y_i)\)</span>. Now <span class="math inline">\(p_\text{WAIC}\)</span> is defined as:</p>
<p><span class="math display">\[p_\text{WAIC} = \sum_{i=1}^N V(y_i)\]</span></p>
<p>Now WAIC is defined as:</p>
<p><span class="math display">\[\text{WAIC} = -2(\text{lppd} - p_\text{WAIC})\]</span></p>
<p>And this value is yet another estimate of out-of-sample deviance. (pp. 191–192, emphasis in the original)</p>
</blockquote>
<p>In <a href="https://bookdown.org/content/3890/overfitting-regularization-and-information-criteria.html#waic.">Chapter 6 of my project</a> translating McElreath’s Statistical Rethinking into <strong>brms</strong> and <strong>tidyverse</strong> code, I walk out how to hand compute the WAIC for a <code>brm()</code> fit. I’m not going to repeat the exercise, here. But do see the project and McElreath’s text if you’re interested. Rather, I’d like to get down to business. In <strong>brms</strong>, you can get a model’s WAIC with the <code>waic()</code> function.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" data-line-number="1"><span class="kw">waic</span>(fit4<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Computed from 4000 by 246 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -312.2 12.0
## p_waic        54.8  4.7
## waic         624.5 24.0
## 
## 42 (17.1%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>We’ll come back to that warning message, later. For now, notice the main output is a <span class="math inline">\(3 \times 2\)</span> data frame with named rows. For the statistic in each row, you get a point estimate and a standard error. The WAIC is on the bottom. The effective number of parameters, the <span class="math inline">\(p_\text{WAIC}\)</span>, is in the middle. Notice the <code>elpd_waic</code> on the top. That’s what you get without the <span class="math inline">\(-2 \times ...\)</span> in the formula. Remember how that part is just to put things in a metric amenable to <span class="math inline">\(\chi^2\)</span>-difference testing? Well, not all Bayesians like that and within the Stan ecosystem you’ll also see the WAIC expressed instead as the <span class="math inline">\(\text{elpd}_\text{WAIC}\)</span>.</p>
<p>The current recommended workflow within <strong>brms</strong> is to attach the WAIC information to the model fit. You do it with the <code>add_criterion()</code> function.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" data-line-number="1">fit4<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit4<span class="fl">.1</span>, <span class="st">&quot;waic&quot;</span>)</a></code></pre></div>
<p>And now you can access that information directly with good-old <code>$</code> indexing.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" data-line-number="1">fit4<span class="fl">.1</span><span class="op">$</span>criteria<span class="op">$</span>waic</a></code></pre></div>
<pre><code>## 
## Computed from 4000 by 246 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -312.2 12.0
## p_waic        54.8  4.7
## waic         624.5 24.0
## 
## 42 (17.1%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>You might notice how that value is similar to the AIC and BIC values for Model A in Table 4.1. But it’s not identical and we shouldn’t expect it to be. It was computed by a different formula that accounts for priors. For our purposes, this is much better than the frequentist AIC and BIC. We need statistics that can handle priors.</p>
</div>
<div id="leave-one-out-cross-validation-loo-cv." class="section level4">
<h4><span class="header-section-number">4.6.4.2</span> Leave-one-out cross-validation (LOO-CV).</h4>
<p>We have another big option for model comparison within the Stan ecosystem. It involves leave-one-out cross-validation (LOO-CV). It’s often the case that we aren’t just interested in modeling the data we have in hand. The hope is our findings would generalize to other data we could have collected or may collect in the future. We’d like our findings to tell us something more general about the world at large. But unless you’re studying something highly uniform like the weights of hydrogen atoms, chances are your data have idiosyncrasies that won’t generalize well to other data. Sure, if we had all the information on all the relevant variables, we could explain the discrepancies across samples with hidden moderators and such. But we don’t have all the data and we typically don’t even know what all the relevant variables are.</p>
<p>Welcome to science.</p>
<p>To address this problem, you might recommend we collect data from two samples for each project. Starting with sample A, we’d fit a series of models and settle on one or a small subset that both speak to our scientific hypothesis and seem to fit the sample A data well. Then we’d switch to sample B and rerun our primary model(s) from A to make sure our findings generalize. In this paradigm, we might call the A data <em>in sample</em> and the B data <em>out of sample</em>–or out of sample A, anyways.</p>
<p>The problem is we often have time and funding constraints. We only have sample A and we may never collect sample B. So we’ll need to make the most out of A. Happily, tricky statisticians have our back. Instead, what we might do is divide our data into <span class="math inline">\(k\)</span> equally-sized subsets. Call those subsets <em>folds</em>. If we leave one of the folds out, we can fit the model with the remaining data and then see how well that model speaks to the left-out fold. After doing this for every fold, we can get an average performance across folds.</p>
<p>Note how as <span class="math inline">\(k\)</span> increases, the number of cases with a fold get smaller. In the extreme, <span class="math inline">\(k = N\)</span>, the number of cases within the data. At that point, <span class="math inline">\(k\)</span>-fold cross-validation turns into leave-one-out cross-validation (LOO-CV).</p>
<p>But there’s a practical difficulty with LOO-CV: it’s costly. As you may have noticed, it takes some time to fit a Bayesian multilevel model. For large data and/or complicated models, sometimes it takes hours or days. Most of us just don’t have enough time or computational resources to fit that many models. Happily, we have an approximation to pure LOO-CV. <a href="https://arxiv.org/abs/1507.04544">Vehtari, Gelman, and Gabry (2017)</a> proposed Pareto smoothed importance-sampling leave-one-out cross-validation (PSIS-LOO) as an efficient way to approximate true LOO-CV. At this point, it’s probably best to let the statisticians speak for themselves:</p>
<blockquote>
<p>To maintain comparability with the given dataset and to get easier interpretation of the differences in scale of effective number of parameters, we define a measure of predictive accuracy for the <span class="math inline">\(n\)</span> data points taken one at a time:</p>
<p><span class="math display">\[\begin{align*}
\text{elpd} &amp; = \text{expected log pointwise predictive density for a new dataset} \\
&amp; = \sum_{i = 1}^n \int p_t (\tilde{y}_i) \log p (\tilde{y}_i | y) d \tilde{y}_i,
\end{align*}\]</span></p>
<p>where <span class="math inline">\(p_t (\tilde{y}_i)\)</span> is the distribution representing the true data-generating process for <span class="math inline">\(\tilde{y}_i\)</span>. The <span class="math inline">\(p_t (\tilde{y}_i)\)</span>’s are unknown, and we will use cross-validation or WAIC to approximate. In a regression, these distributions are also implicitly conditioned on any predictors in the model…</p>
<p>The Bayesian LOO estimate of out-of-sample predictive fit is</p>
<p><span class="math display">\[\text{elpd}_{\text{loo}} = \sum_{i = 1}^n \log p (y_i | y - _i),\]</span></p>
<p>where</p>
<p><span class="math display">\[p (y_i | y - _i) = \int p (y_i | \theta) p (\theta | y - _i) d \theta\]</span></p>
<p>is the leave-one-out predictive density given the data without the ith data point. (pp. 2–3)</p>
</blockquote>
<p>For the rest of the details, check out the original paper. Our goal is to practice using the PSIS-LOO. Since this is the only version of the LOO we’ll be using in this project, I’m just going to refer to it as the LOO from here on. To use the LOO to evaluate a <code>brm()</code> fit, you just use the <code>loo()</code> function. Though you don’t have to save the results as an object, we’ll be forward thinking and do so here.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" data-line-number="1">l_fit4<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">loo</span>(fit4<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## Warning: Found 3 observations with a pareto_k &gt; 0.7 in model &#39;fit4.1&#39;. It is recommended to set
## &#39;reloo = TRUE&#39; in order to calculate the ELPD without the assumption that these observations are
## negligible. This will refit the model 3 times to compute the ELPDs for the problematic observations
## directly.</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" data-line-number="1"><span class="kw">print</span>(l_fit4<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Computed from 4000 by 246 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -315.5 12.3
## p_loo        58.0  4.9
## looic       630.9 24.6
## ------
## Monte Carlo SE of elpd_loo is NA.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     220   89.4%   706       
##  (0.5, 0.7]   (ok)        23    9.3%   380       
##    (0.7, 1]   (bad)        3    1.2%   99        
##    (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;      
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>Remember that warning message we got from the <code>waic()</code> a while back? We get more information along those lines from the <code>loo()</code>. As it turns out, a few of the cases in the data were unduly influential in the model fit. Within the <code>loo()</code> paradigm, those are indexed by the <code>pareto_k</code> values. As it turns out, the Pareto <span class="math inline">\(k\)</span> <a href="https://cran.r-project.org/web/packages/loo/vignettes/loo2-example.html#plotting-pareto-k-diagnostics">can be used as a diagnostic tool</a>. Each case in the data gets its own <span class="math inline">\(k\)</span> value and we like it when those <span class="math inline">\(k\)</span>’s are low. We typically get worried when those <span class="math inline">\(k\)</span>’s exceed 0.7 and the <code>loo()</code> function spits out a warning message when they do.</p>
<p>If you didn’t know, the <strong>brms</strong> functions like the <code>waic()</code> and <code>loo()</code> actually come from the <a href="https://CRAN.R-project.org/package=loo"><strong>loo</strong> package</a>. Explicitly loading <strong>loo</strong> will buy us some handy convenience functions.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb351-1" data-line-number="1"><span class="kw">library</span>(loo)</a></code></pre></div>
<p>We’ll be leveraging those <span class="math inline">\(k\)</span> values with the <code>pareto_k_table()</code> and <code>pareto_k_ids()</code> functions. Both functions take objects created by the <code>loo()</code> or <code>psis()</code> functions. Let’s take a look at the <code>pareto_k_table()</code> function first.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" data-line-number="1"><span class="kw">pareto_k_table</span>(l_fit4<span class="fl">.1</span>) </a></code></pre></div>
<pre><code>## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     220   89.4%   706       
##  (0.5, 0.7]   (ok)        23    9.3%   380       
##    (0.7, 1]   (bad)        3    1.2%   99        
##    (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;</code></pre>
<p>This is the same table that popped out earlier after using the <code>loo()</code>. Recall that this data set has 246 observations (i.e., execute <code>count(alcohol1_pp)</code>). With <code>pareto_k_table()</code>, we see how the Pareto <span class="math inline">\(k\)</span> values have been categorized into bins ranging from “good” to “very bad”. Clearly, we like nice and low <span class="math inline">\(k\)</span>’s. In this example, most of our observations are “good” or “ok.” Three are in the “bad” <span class="math inline">\(k\)</span> range. We can take a closer look by placing our <code>loo()</code> object into <code>plot()</code>.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" data-line-number="1"><span class="kw">plot</span>(l_fit4<span class="fl">.1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-90-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>We got back a nice diagnostic plot for those <span class="math inline">\(k\)</span> values, ordered by row number. We can see that our three observations with the “bad” <span class="math inline">\(k\)</span> values were earlier in the data and it appears their <span class="math inline">\(k\)</span> values are just a smidge above the recommended threshold. If we wanted to further verify to ourselves which observations those were, we’d use the <code>pareto_k_ids()</code> function.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb355-1" data-line-number="1"><span class="kw">pareto_k_ids</span>(l_fit4<span class="fl">.1</span>, <span class="dt">threshold =</span> <span class="fl">.7</span>)</a></code></pre></div>
<pre><code>## [1]  27  33 112</code></pre>
<p>Note our use of the <code>threshold</code> argument. Play around with it to see how it works. In case you’re curious, here are those rows.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" data-line-number="1">alcohol1_pp[<span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">33</span>, <span class="dv">112</span>), ]</a></code></pre></div>
<pre><code>## # A tibble: 3 x 9
##      id   age   coa  male age_14 alcuse  peer  cpeer   ccoa
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     9    16     1     1      2   3.46  0    -1.02   0.549
## 2    11    16     1     1      2   3.16  0    -1.02   0.549
## 3    38    14     0     0      0   0     1.26  0.247 -0.451</code></pre>
<p>If you want an explicit look at those <span class="math inline">\(k\)</span> values, execute <code>l_fit4.1$diagnostics$pareto_k</code>. For the sake of space, I’m going to omit the output.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb359-1" data-line-number="1">l_fit4<span class="fl">.1</span><span class="op">$</span>diagnostics<span class="op">$</span>pareto_k</a></code></pre></div>
<p>The <code>pareto_k</code> values can be used to examine cases that are overly-influential on the model parameters, something like a Cook’s <span class="math inline">\(D_{i}\)</span>. See, for example <a href="https://stackoverflow.com/questions/39578834/linear-model-diagnostics-for-bayesian-models-using-rstan/39595436">this discussion on stackoverflow.com</a> in which several members of the <a href="http://mc-stan.org">Stan team</a> weighed in. The issue is also discussed in <a href="https://arxiv.org/abs/1507.04544">this paper</a> and in <a href="https://www.youtube.com/watch?v=FUROJM3u5HQ&amp;feature=youtu.be&amp;a=">this presentation by Aki Vehtari</a>.</p>
<p>Anyway, the implication of all this is these values suggest <code>fit4.1</code> (i.e., Model A) might not be the best model of the data. Happily, we have other models to compare it to. That leads into the next section:</p>
</div>
<div id="you-can-compare-bayesian-models-with-the-waic-and-loo." class="section level4">
<h4><span class="header-section-number">4.6.4.3</span> You can compare Bayesian models with the WAIC and LOO.</h4>
<p>Remember how we used the <code>add_criterion()</code> function, above. That’ll work for both WAIC and the LOO. Let’s do that for Models A through E.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1">fit4<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit4<span class="fl">.1</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb360-2" data-line-number="2">fit4<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit4<span class="fl">.2</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb360-3" data-line-number="3">fit4<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit4<span class="fl">.3</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb360-4" data-line-number="4">fit4<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(fit4<span class="fl">.5</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a></code></pre></div>
<p>And to refresh, we can pull the WAIC and LOO information with <code>$</code> indexing. Here’s how to get the LOO info for <code>fit4.2</code>.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" data-line-number="1">fit4<span class="fl">.2</span><span class="op">$</span>criteria<span class="op">$</span>loo</a></code></pre></div>
<pre><code>## 
## Computed from 4000 by 246 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -291.5 12.9
## p_loo        95.9  7.7
## looic       583.0 25.8
## ------
## Monte Carlo SE of elpd_loo is NA.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     126   51.2%   341       
##  (0.5, 0.7]   (ok)        92   37.4%   81        
##    (0.7, 1]   (bad)       25   10.2%   16        
##    (1, Inf)   (very bad)   3    1.2%   8         
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>Sigh. Turns out there are even more overly-influential cases in the unconditional growth model. In the case of a real data analysis, this might suggest we need a more robust model. One possible solution might be switching out our Gaussian likelihood for the robust Student’s <span class="math inline">\(t\)</span>-distribution. For an introduction, you might check out my blog post on the topic, <a href="https://solomonkurz.netlify.com/post/robust-linear-regression-with-the-robust-student-s-t-distribution/"><em>Robust Linear Regression with Student’s <span class="math inline">\(t\)</span>-Distribution</em></a>. But that’ll take us farther afield than I want to go, right now.</p>
<p>The point to focus on, here, is we can use the <code>loo_compare()</code> function to compare fits by their WAIC or LOO. Let’s practice with the WAIC.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" data-line-number="1">ws &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(fit4<span class="fl">.1</span>, fit4<span class="fl">.2</span>, fit4<span class="fl">.3</span>, fit4<span class="fl">.5</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)</a>
<a class="sourceLine" id="cb363-2" data-line-number="2"></a>
<a class="sourceLine" id="cb363-3" data-line-number="3"><span class="kw">print</span>(ws)</a></code></pre></div>
<pre><code>##        elpd_diff se_diff
## fit4.5   0.0       0.0  
## fit4.3  -4.9       3.6  
## fit4.2  -6.7       4.2  
## fit4.1 -40.9       8.0</code></pre>
<p>Remember how we said that some contemporary Bayesians aren’t fans of putting Bayesian information criteria in a <span class="math inline">\(\chi^2\)</span> metric? Well, it turns out <a href="https://twitter.com/avehtari">Aki Vehtari</a>, of the Stan team and <strong>loo</strong> package fame–and also the primary author in that <a href="https://arxiv.org/abs/1507.04544">PSIS-LOO paper</a> from before–, is one of those Bayesians. So instead of getting difference scores in the WAIC metric, we get them in the <span class="math inline">\(\text{elpd}_\text{WAIC}\)</span> metric instead. But remember, if you prefer these estimates in the traditional metric, just multiply by -2.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" data-line-number="1"><span class="kw">cbind</span>(<span class="dt">waic_diff =</span> ws[, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>,</a>
<a class="sourceLine" id="cb365-2" data-line-number="2">      <span class="dt">se        =</span> ws[, <span class="dv">2</span>] <span class="op">*</span><span class="st">  </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>##        waic_diff        se
## fit4.5  0.000000  0.000000
## fit4.3  9.851001  7.267540
## fit4.2 13.444486  8.488034
## fit4.1 81.723541 16.097508</code></pre>
<p>The reason we multiplied the <code>se_diff</code> column (i.e., the standard errors for the difference estimates) by 2 is because you can’t have negative standard errors. That’d be silly.</p>
<p>But anyway, notice that the <code>brm()</code> fits have been rank ordered with the smallest differences at the top. Each row in the output is the difference of one of the fits compared to the best-fitting fit. Since <code>fit4.5</code> apparently had the lowest WAIC value, it was ranked at the top. And notice how its <code>waic_diff</code> is 0. That, of course, is because <span class="math inline">\(x - x = 0\)</span>. So all the other difference scores are follow the formula <span class="math inline">\(\text{Difference}_x = \text{WAIC}_\text{fit_x} - \text{WAIC}_\text{fit_4.5}\)</span>.</p>
<p>Concerning our <code>ws</code> object, we can get more information on our models’ WAIC information if we include a <code>simplify = F</code> argument within <code>print()</code>.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" data-line-number="1"><span class="kw">print</span>(ws, <span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit4.5    0.0       0.0  -271.4      11.2         73.9    5.7     542.7   22.4 
## fit4.3   -4.9       3.6  -276.3      11.5         80.9    6.3     552.6   23.0 
## fit4.2   -6.7       4.2  -278.1      11.8         82.4    6.5     556.2   23.5 
## fit4.1  -40.9       8.0  -312.2      12.0         54.8    4.7     624.5   24.0</code></pre>
<p>Their WAIC estimates and the associated standard errors are in the final two columns. In the two before that, we get the <span class="math inline">\(p_\text{WAIC}\)</span> estimates and their standard errors. We can get similar information for the LOO.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" data-line-number="1"><span class="kw">loo_compare</span>(fit4<span class="fl">.1</span>, fit4<span class="fl">.2</span>, fit4<span class="fl">.3</span>, fit4<span class="fl">.5</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb369-2" data-line-number="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit4.5    0.0       0.0  -282.3     12.0        84.9    6.7    564.6   24.0  
## fit4.3   -6.2       3.8  -288.5     12.4        93.1    7.2    577.0   24.7  
## fit4.2   -9.2       4.6  -291.5     12.9        95.9    7.7    583.0   25.8  
## fit4.1  -33.2       8.3  -315.5     12.3        58.0    4.9    630.9   24.6</code></pre>
<p>If you wanted a more focused comparison, say between <code>fit1</code> and <code>fit2</code>, you’d just simplify your input.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" data-line-number="1"><span class="kw">loo_compare</span>(fit4<span class="fl">.1</span>, fit4<span class="fl">.2</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb371-2" data-line-number="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##        elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## fit4.2    0.0       0.0  -291.5     12.9        95.9    7.7    583.0   25.8  
## fit4.1  -24.0       7.7  -315.5     12.3        58.0    4.9    630.9   24.6</code></pre>
<p>We’ll get more practice with these methods as we go along. But for your own edification, you might check out <a href="https://CRAN.R-project.org/package=loo">the vignettes</a> put out by the <strong>loo</strong> team.</p>
</div>
</div>
</div>
<div id="using-wald-statistics-to-test-composite-hypotheses-about-fixed-effects" class="section level2">
<h2><span class="header-section-number">4.7</span> Using Wald statistics to test composite hypotheses about fixed effects</h2>
<p>I’m not going to address issues of composite null-hypothesis tests using the Wald statistic. However, we can address some of these issues from a different more estimation-based perspective. Consider the initial question posed on page 123:</p>
<blockquote>
<p>Suppose, for example, you wanted to test whether the entire true change trajectory for a particular type of adolescent–say, a child of non-alcoholic parents with an average value of <em>PEER</em>–differs from a “null” trajectory (one with zero intercept and zero slope). This is tantamount to asking whether the average child of non-alcoholic parents drinks no alcohol at age 14 and remains abstinent over time.</p>
</blockquote>
<p>Singer and Willett then expressed their joint null hypothesis as</p>
<p><span class="math display">\[H_0: \gamma_{00} = 0 \; \text{and} \; \gamma_{10} = 0.\]</span></p>
<p>This is a substantive question we can address more informatively with <code>fitted()</code>. First, let’s provide the necessary values for our predictor variables, <code>coa</code>, <code>peer</code>, and <code>age_14</code>.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" data-line-number="1">mu_peer &lt;-<span class="st"> </span><span class="kw">mean</span>(alcohol1_pp<span class="op">$</span>peer)</a>
<a class="sourceLine" id="cb373-2" data-line-number="2"></a>
<a class="sourceLine" id="cb373-3" data-line-number="3">nd &lt;-</a>
<a class="sourceLine" id="cb373-4" data-line-number="4"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">coa    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb373-5" data-line-number="5">         <span class="dt">peer   =</span> mu_peer,</a>
<a class="sourceLine" id="cb373-6" data-line-number="6">         <span class="dt">age_14 =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb373-7" data-line-number="7"></a>
<a class="sourceLine" id="cb373-8" data-line-number="8"><span class="kw">head</span>(nd)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##     coa  peer age_14
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     0  1.02 0     
## 2     0  1.02 0.0690
## 3     0  1.02 0.138 
## 4     0  1.02 0.207 
## 5     0  1.02 0.276 
## 6     0  1.02 0.345</code></pre>
<p>Now we use <code>fitted()</code> to examine the model-implied trajectory for a child of non-alcoholic parents and average <code>peer</code> values.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb375-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb375-3" data-line-number="3">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb375-4" data-line-number="4">         <span class="dt">re_formula =</span> <span class="ot">NA</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb375-5" data-line-number="5"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb375-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb375-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span><span class="dv">14</span>) </a>
<a class="sourceLine" id="cb375-8" data-line-number="8"></a>
<a class="sourceLine" id="cb375-9" data-line-number="9">f <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb375-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb375-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb375-12" data-line-number="12">              <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb375-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb375-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;alcuse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb375-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Zero is credible for neither</span><span class="ch">\n</span><span class="st">the intercept nor the slope.&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb375-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">17</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb375-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb375-18" data-line-number="18">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-102-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>Recall that the result of our Bayesian analyses are the probability of the parameters given the data, <span class="math inline">\(p(\theta | d)\)</span>. Based on our plot, there is much less than a .05 probability either intercept or slope for teens of this demographic are zero. If you really wanted to fixate on zero, you could even use <code>geom_hline()</code> to insert a horizontal line at zero in the figure. But all that fixating on zero detracts from what to my mind are the more important parts of the model. The intercept at <code>age = 14</code> is about 1/3 and the endpoint when <code>age = 16</code> is almost at <span class="math inline">\(1\)</span>. Those are our effect sizes. If you wanted to quantify those effect sizes more precisely, just query our <code>fitted()</code> object, <code>f</code>.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb376-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(age, Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb376-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(age <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">14</span>, <span class="dv">16</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb376-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate_all</span>(round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   age Estimate Q2.5 Q97.5
## 1  14     0.39 0.18  0.61
## 2  16     0.94 0.67  1.21</code></pre>
<p>Works like a champ. But we haven’t fully covered part of Singer and Willett’s joint hypothesis text. They proposed a joint Null that included the <span class="math inline">\(\gamma_{10} = 0\)</span>. Though it’s clear from the plot that the trajectory increases, we can address the issue more directly with a difference score. For our difference, we’ll subtract the estimate at <code>age = 14</code> from the one at <code>age = 15</code>. But to that, we’ll have to return to <code>fitted()</code>. So far, we’ve been using the default output which returns summaries of the posterior. To compute a proper difference score, we’ll need to work with all the posterior draws in order to approximate the full distribution. We do that by setting <code>summary = F</code>. And since we’re only interested in the estimates from these two <code>age</code> values, we’ll streamline our <code>nd</code> data.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb378-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb378-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">coa    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb378-3" data-line-number="3">         <span class="dt">peer   =</span> mu_peer,</a>
<a class="sourceLine" id="cb378-4" data-line-number="4">         <span class="dt">age_14 =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb378-5" data-line-number="5"></a>
<a class="sourceLine" id="cb378-6" data-line-number="6">f &lt;-</a>
<a class="sourceLine" id="cb378-7" data-line-number="7"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb378-8" data-line-number="8">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb378-9" data-line-number="9">         <span class="dt">re_formula =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb378-10" data-line-number="10">         <span class="dt">summary =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb378-11" data-line-number="11"><span class="st">  </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb378-12" data-line-number="12"></a>
<a class="sourceLine" id="cb378-13" data-line-number="13"><span class="kw">str</span>(f)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    4000 obs. of  2 variables:
##  $ X1: num  0.411 0.511 0.63 0.427 0.426 ...
##  $ X2: num  0.679 0.751 0.83 0.66 0.726 ...</code></pre>
<p>Now our <code>f</code> object has 4,000 rows and 2 columns. Each of the rows corresponds to one of the 4,000 post-warmup posterior draws. The columns correspond to the two rows in our <code>nd</code> data. To get a slope based on this combination of predictor values, we simply subtract the first column from the second.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb380-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb380-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">difference =</span> X2 <span class="op">-</span><span class="st"> </span>X1)</a>
<a class="sourceLine" id="cb380-4" data-line-number="4"></a>
<a class="sourceLine" id="cb380-5" data-line-number="5">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb380-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> difference)) <span class="op">+</span></a>
<a class="sourceLine" id="cb380-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb380-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb380-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Based on 4,000 posterior draws, not a single one</span><span class="ch">\n</span><span class="st">suggests the slope is even close to zero. Rather, the</span><span class="ch">\n</span><span class="st">posterior mass is concentrated around 0.25.&quot;</span>,</a>
<a class="sourceLine" id="cb380-10" data-line-number="10">       <span class="dt">x =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(gamma[<span class="dv">0</span>][<span class="dv">1</span>], <span class="st">&quot; (i.e., the difference between the two time points)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb380-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb380-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-105-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Here are the posterior mean and 95% intervals.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb381-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb381-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(difference),</a>
<a class="sourceLine" id="cb381-3" data-line-number="3">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(difference, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb381-4" data-line-number="4">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(difference, <span class="dt">probs =</span> <span class="fl">.975</span>))</a></code></pre></div>
<pre><code>##        mean        ll        ul
## 1 0.2702342 0.1462111 0.3974354</code></pre>
<p>On page 125, Singer and Willett further mused:</p>
<blockquote>
<p>When we examined the OLS estimated change trajectories in figure 4.2, we noticed that among children of non-alcoholic parents, those with low values of <em>CPEER</em> tended to have a lower initial status and steeper slopes than those with high values of <em>CPEER</em>. We might therefore ask whether the former group “catches up” to the latter. This is a question about the “vertical” separation between these two groups[’] true change trajectories at some later age, say 16.</p>
</blockquote>
<p>Within their joint hypothesis testing paradigm, they pose this as testing</p>
<p><span class="math display">\[H_0: 0\gamma_{00} + 0\gamma_{01} + 1\gamma_{02} + 0\gamma_{10} + 2\gamma_{12} = 0.\]</span></p>
<p>From our perspective, this is a differences of differences analysis. That is, first we’ll compute the model implied <code>alcuse</code> estimates for the four combinations of the two levels of <code>age</code> and <code>peer</code>, holding <code>coa</code> constant at 0. Second, we’ll compute the differences between the two <code>peer</code> levels at each <code>age</code>. Third and finally, we’ll compute a difference of those differences.</p>
<p>For our first step, recall it was <code>fit4.7</code> that used the <code>cpeer</code> variable.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" data-line-number="1"><span class="co"># first step</span></a>
<a class="sourceLine" id="cb383-2" data-line-number="2">nd &lt;-</a>
<a class="sourceLine" id="cb383-3" data-line-number="3"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">age_14 =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb383-4" data-line-number="4">           <span class="dt">cpeer  =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">363</span>, <span class="fl">.363</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb383-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">coa =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb383-6" data-line-number="6"></a>
<a class="sourceLine" id="cb383-7" data-line-number="7"><span class="kw">head</span>(nd)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   age_14  cpeer   coa
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1      0 -0.363     0
## 2      0  0.363     0
## 3      2 -0.363     0
## 4      2  0.363     0</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb385-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb385-3" data-line-number="3">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb385-4" data-line-number="4">         <span class="dt">re_formula =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb385-5" data-line-number="5">         <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb385-6" data-line-number="6"><span class="st">  </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb385-7" data-line-number="7"></a>
<a class="sourceLine" id="cb385-8" data-line-number="8"><span class="kw">head</span>(f)</a></code></pre></div>
<pre><code>##           X1        X2        X3       X4
## 1 0.17502405 0.6605243 0.8520849 1.298802
## 2 0.20817809 0.6776782 0.9387258 1.235208
## 3 0.12742797 0.7246396 0.8466041 1.216695
## 4 0.09864766 0.6662694 0.8765035 1.239332
## 5 0.13072997 0.7271179 1.0898833 1.436752
## 6 0.08935016 0.5745774 0.9410148 1.032745</code></pre>
<p>For our initial difference scores, we’ll subtract the estimates for the lower level of <code>cpeer</code> from the higher ones.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" data-line-number="1"><span class="co"># step 2</span></a>
<a class="sourceLine" id="cb387-2" data-line-number="2">f &lt;-</a>
<a class="sourceLine" id="cb387-3" data-line-number="3"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb387-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">difference at 14</span><span class="st">`</span> =<span class="st"> </span>X2 <span class="op">-</span><span class="st"> </span>X1,</a>
<a class="sourceLine" id="cb387-5" data-line-number="5">            <span class="st">`</span><span class="dt">difference at 16</span><span class="st">`</span> =<span class="st"> </span>X4 <span class="op">-</span><span class="st"> </span>X3)</a>
<a class="sourceLine" id="cb387-6" data-line-number="6"></a>
<a class="sourceLine" id="cb387-7" data-line-number="7"><span class="kw">head</span>(f)</a></code></pre></div>
<pre><code>##   difference at 14 difference at 16
## 1        0.4855003       0.44671666
## 2        0.4695001       0.29648254
## 3        0.5972116       0.37009095
## 4        0.5676217       0.36282849
## 5        0.5963879       0.34686832
## 6        0.4852272       0.09173039</code></pre>
<p>For our final difference score, we’ll subtract the first difference score from the second.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb389-1" data-line-number="1"><span class="co"># step 3</span></a>
<a class="sourceLine" id="cb389-2" data-line-number="2">f &lt;-</a>
<a class="sourceLine" id="cb389-3" data-line-number="3"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb389-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">difference in differences</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">difference at 16</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">difference at 14</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb389-5" data-line-number="5"></a>
<a class="sourceLine" id="cb389-6" data-line-number="6"><span class="kw">head</span>(f)</a></code></pre></div>
<pre><code>##   difference at 14 difference at 16 difference in differences
## 1        0.4855003       0.44671666                -0.0387836
## 2        0.4695001       0.29648254                -0.1730176
## 3        0.5972116       0.37009095                -0.2271206
## 4        0.5676217       0.36282849                -0.2047932
## 5        0.5963879       0.34686832                -0.2495196
## 6        0.4852272       0.09173039                -0.3934969</code></pre>
<p>Here we’ll plot all three.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb391-1" data-line-number="1">f <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb391-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb391-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb391-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb391-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb391-7" data-line-number="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;different differences&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb391-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb391-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-110-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Singer and Willett concluded they could “reject the null hypothesis at any conventional level of significance” (p. 126). If we must appeal to the Null, here are the posterior means and 95% intervals for our differences.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb392-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb392-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb392-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb392-5" data-line-number="5">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb392-6" data-line-number="6">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb392-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   name                        mean     ll    ul
##   &lt;chr&gt;                      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 difference at 14           0.502  0.338 0.658
## 2 difference at 16           0.284  0.049 0.526
## 3 difference in differences -0.218 -0.468 0.023</code></pre>
<p>Our results contrast a bit from Singer and Willett’s. Though the bulk of our posterior mass is concentrated around -0.22, zero is a credible value within the difference of differences density. Our best bet is the differences begin to converge over time. However, that rate of that convergence is subtle and somewhat imprecise relative to the effect size. Interpret with caution.</p>
</div>
<div id="evaluating-the-tenability-of-a-models-assumptions" class="section level2">
<h2><span class="header-section-number">4.8</span> Evaluating the tenability of a model’s assumptions</h2>
<p>“Whenever you fit a statistical model, you invoke assumptions” (p. 127). This is the case for multilevel Bayesian models, too.</p>
<div id="checking-functional-form." class="section level3">
<h3><span class="header-section-number">4.8.1</span> Checking functional form.</h3>
<p>We’ve already checked the functional form at level-1 with our version of Figure 4.1. When we made our version of Figure 4.1, we relied on <code>ggplot2::stat_smooth()</code> to compute the <code>id</code>-level OLS trajectories. To make our variants of Figure 4.4, we’ll have to back up and compute them externally with <code>lm()</code>. Here we’ll do so in bulk with a nested data frame. The <strong>broom</strong> package will help us extract the results.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb394-2" data-line-number="2"></a>
<a class="sourceLine" id="cb394-3" data-line-number="3">o &lt;-</a>
<a class="sourceLine" id="cb394-4" data-line-number="4"><span class="st">  </span>alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb394-5" data-line-number="5"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>id, <span class="op">-</span>coa, <span class="op">-</span>peer) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb394-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ols =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(<span class="dt">data =</span> ., alcuse <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_<span class="dv">14</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb394-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tidy =</span> <span class="kw">map</span>(ols, tidy)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb394-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>(tidy) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb394-9" data-line-number="9"><span class="st">  </span><span class="co"># this is unnecessary, but will help with plotting</span></a>
<a class="sourceLine" id="cb394-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">factor</span>(term, </a>
<a class="sourceLine" id="cb394-11" data-line-number="11">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;age_14&quot;</span>),</a>
<a class="sourceLine" id="cb394-12" data-line-number="12">                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;pi[0]&quot;</span>, <span class="st">&quot;pi[1]&quot;</span>)))</a>
<a class="sourceLine" id="cb394-13" data-line-number="13"></a>
<a class="sourceLine" id="cb394-14" data-line-number="14"><span class="kw">head</span>(o)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##      id   coa  peer data             ols    term  estimate std.error statistic p.value
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;           &lt;list&gt; &lt;fct&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1     1     1 1.26  &lt;tibble [3 × 6]&gt; &lt;lm&gt;   pi[0]    1.78     0.0999    17.8    0.0357
## 2     1     1 1.26  &lt;tibble [3 × 6]&gt; &lt;lm&gt;   pi[1]    0.134    0.0774     1.73   0.333 
## 3     2     1 0.894 &lt;tibble [3 × 6]&gt; &lt;lm&gt;   pi[0]   -0.167    0.373     -0.447  0.732 
## 4     2     1 0.894 &lt;tibble [3 × 6]&gt; &lt;lm&gt;   pi[1]    0.5      0.289      1.73   0.333 
## 5     3     1 0.894 &lt;tibble [3 × 6]&gt; &lt;lm&gt;   pi[0]    0.947    0.118      8.03   0.0789
## 6     3     1 0.894 &lt;tibble [3 × 6]&gt; &lt;lm&gt;   pi[1]    1.16     0.0914    12.7    0.0501</code></pre>
<p>Now plot.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1">o <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb396-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(coa<span class="op">:</span>peer, term<span class="op">:</span>estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb396-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(coa<span class="op">:</span>peer) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb396-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb396-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb396-9" data-line-number="9">        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">11</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_grid</span>(term<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-113-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>With a little more wrangling, we can extract the Pearson’s correlation coefficients for each panel.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" data-line-number="1">o <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb397-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(coa<span class="op">:</span>peer, term<span class="op">:</span>estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb397-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(coa<span class="op">:</span>peer) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb397-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(term, name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb397-5" data-line-number="5"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb397-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r =</span> <span class="kw">map_dbl</span>(data, <span class="op">~</span><span class="kw">cor</span>(.)[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
## # Groups:   term, name [4]
##   term  name  data                   r
##   &lt;fct&gt; &lt;chr&gt; &lt;list&gt;             &lt;dbl&gt;
## 1 pi[0] coa   &lt;tibble [82 × 2]&gt;  0.39 
## 2 pi[0] peer  &lt;tibble [82 × 2]&gt;  0.580
## 3 pi[1] coa   &lt;tibble [82 × 2]&gt; -0.04 
## 4 pi[1] peer  &lt;tibble [82 × 2]&gt; -0.19</code></pre>
</div>
<div id="checking-normality." class="section level3">
<h3><span class="header-section-number">4.8.2</span> Checking normality.</h3>
<p>The basic multilevel model of change yields three variance parameters, <span class="math inline">\(\epsilon_{ij}\)</span>, <span class="math inline">\(\zeta_{0i}\)</span>, and <span class="math inline">\(\zeta_{1i}\)</span>. Each measurement occasion in the model receives a model-implied estimate for each. Singer and Willett referred to those estimates as <span class="math inline">\(\hat{\epsilon}_{ij}\)</span>, <span class="math inline">\(\hat{\zeta}_{0i}\)</span>, and <span class="math inline">\(\hat{\zeta}_{1i}\)</span>. As with frequentist software, our Bayesian software <strong>brms</strong> will return these estimates.</p>
<p>To extract our Bayesian draws for the <span class="math inline">\(\hat{\epsilon}_{ij}\)</span>’s, we use the <code>residuals()</code> function.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" data-line-number="1">e &lt;-<span class="st"> </span><span class="kw">residuals</span>(fit4<span class="fl">.6</span>)</a>
<a class="sourceLine" id="cb399-2" data-line-number="2"></a>
<a class="sourceLine" id="cb399-3" data-line-number="3"><span class="kw">str</span>(e)</a></code></pre></div>
<pre><code>##  num [1:246, 1:4] 0.2876 0.2573 -0.0409 -0.393 -0.5973 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:4] &quot;Estimate&quot; &quot;Est.Error&quot; &quot;Q2.5&quot; &quot;Q97.5&quot;</code></pre>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" data-line-number="1"><span class="kw">head</span>(e)</a></code></pre></div>
<pre><code>##         Estimate Est.Error       Q2.5      Q97.5
## [1,]  0.28763647 0.3250755 -0.3914337 0.89494825
## [2,]  0.25734974 0.3037230 -0.3407331 0.84803822
## [3,] -0.04088621 0.4411031 -0.9181669 0.82197153
## [4,] -0.39302478 0.3443342 -1.0392050 0.31328261
## [5,] -0.59734674 0.3181534 -1.2262349 0.02541651
## [6,]  0.19833131 0.4624338 -0.6917016 1.09272430</code></pre>
<p>For our <code>fit5</code>, the <code>residuals()</code> function returned a <span class="math inline">\(246 \times 4\)</span> numeric array. Each row corresponded to one of the rows of the original data set. The four vectors are the familiar summaries <code>Estimate</code>, <code>Est.Error</code>, <code>Q2.5</code>, and <code>Q97.5</code>. If we’d like to work with these in a <strong>ggplot2</strong>-made plot, we’ll have to convert our <code>e</code> object to a data frame.</p>
<p>After we make the conversion, we then make the top left panel of Figure 4.5.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" data-line-number="1">e &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb403-2" data-line-number="2"><span class="st">  </span>e <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb403-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb403-4" data-line-number="4"></a>
<a class="sourceLine" id="cb403-5" data-line-number="5">e <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb403-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">sample =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_qq</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb403-9" data-line-number="9"><span class="st">  </span><span class="kw">ylim</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Normal score&quot;</span>,</a>
<a class="sourceLine" id="cb403-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">hat</span>(epsilon)[<span class="kw">italic</span>(ij)])) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-116-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>For the right plot on the top, we need to add an <code>id</code> index. That’s as easy as appending the one from the original data. If you followed closely with the text, you may have also noticed this panel is of the standardized residuals. That just means we’ll have to hand-standardize ours before plotting.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" data-line-number="1">e <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb404-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_cols</span>(alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(id)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb404-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">z =</span> (Estimate <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Estimate)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(Estimate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb404-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb404-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> id, <span class="dt">y =</span> z)) <span class="op">+</span></a>
<a class="sourceLine" id="cb404-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb404-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb404-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="kw">expression</span>(<span class="kw">italic</span>(std)<span class="op">~</span><span class="kw">hat</span>(epsilon)[<span class="kw">italic</span>(ij)]), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb404-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-117-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>We’ll need to use the <code>ranef()</code> function to return the estimates for the <span class="math inline">\(\zeta\)</span>’s.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw">ranef</span>(fit4<span class="fl">.6</span>)</a>
<a class="sourceLine" id="cb405-2" data-line-number="2"></a>
<a class="sourceLine" id="cb405-3" data-line-number="3"><span class="kw">str</span>(z)</a></code></pre></div>
<pre><code>## List of 1
##  $ id: num [1:82, 1:4, 1:2] 0.306 -0.488 0.32 -0.36 -0.566 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 3
##   .. ..$ : chr [1:82] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. ..$ : chr [1:4] &quot;Estimate&quot; &quot;Est.Error&quot; &quot;Q2.5&quot; &quot;Q97.5&quot;
##   .. ..$ : chr [1:2] &quot;Intercept&quot; &quot;age_14&quot;</code></pre>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" data-line-number="1">z[[<span class="dv">1</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, , <span class="st">&quot;Intercept&quot;</span>]</a></code></pre></div>
<pre><code>##     Estimate Est.Error       Q2.5      Q97.5
## 1  0.3060223 0.3227010 -0.2960562 0.96774592
## 2 -0.4877992 0.3433833 -1.2087988 0.13958551
## 3  0.3203825 0.3285308 -0.3448843 0.95481492
## 4 -0.3596063 0.3580504 -1.0893187 0.29984702
## 5 -0.5664465 0.3299580 -1.2326926 0.06957911
## 6  0.8217839 0.3655567  0.1586649 1.58692704</code></pre>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" data-line-number="1">z[[<span class="dv">1</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, , <span class="st">&quot;age_14&quot;</span>]</a></code></pre></div>
<pre><code>##      Estimate Est.Error         Q2.5     Q97.5
## 1  0.06515672 0.2416886 -0.436878006 0.5218283
## 2 -0.08440817 0.2538519 -0.573436784 0.4333823
## 3  0.45812318 0.2629633 -0.009684557 1.0047397
## 4  0.15313668 0.2715482 -0.345840207 0.7329594
## 5 -0.30909870 0.2462948 -0.792318683 0.1900630
## 6  0.25283161 0.2686093 -0.296467669 0.7683498</code></pre>
<p>For our <code>fit5</code>, the <code>ranef()</code> function returned a list of 1, indexed by <code>id</code>. Therein lay a 3-dimensional array. The first two dimensions are the same as what we got from <code>residuals()</code>, above. The third dimension had two levels: <code>Intercept</code> and <code>age_14</code>. In other words, the third dimension is the one that differentiated between <span class="math inline">\(\hat{\zeta}_{0i}\)</span> and <span class="math inline">\(\hat{\zeta}_{1i}\)</span>. to make this thing a little more useful, let’s convert it to a long-formatted data frame.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" data-line-number="1">z &lt;-</a>
<a class="sourceLine" id="cb411-2" data-line-number="2"><span class="st">  </span><span class="kw">rbind</span>(z[[<span class="dv">1</span>]][ , , <span class="st">&quot;Intercept&quot;</span>],</a>
<a class="sourceLine" id="cb411-3" data-line-number="3">        z[[<span class="dv">1</span>]][ , , <span class="st">&quot;age_14&quot;</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ranef =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;hat(zeta)[0][italic(i)]&quot;</span>, <span class="st">&quot;hat(zeta)[1][italic(i)]&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb411-6" data-line-number="6"></a>
<a class="sourceLine" id="cb411-7" data-line-number="7"><span class="kw">glimpse</span>(z)</a></code></pre></div>
<pre><code>## Rows: 164
## Columns: 5
## $ Estimate  &lt;dbl&gt; 0.30602233, -0.48779924, 0.32038254, -0.35960629, -0.56644649, 0.82178386, 0.21…
## $ Est.Error &lt;dbl&gt; 0.3227010, 0.3433833, 0.3285308, 0.3580504, 0.3299580, 0.3655567, 0.3385925, 0.…
## $ Q2.5      &lt;dbl&gt; -0.29605623, -1.20879884, -0.34488425, -1.08931868, -1.23269262, 0.15866490, -0…
## $ Q97.5     &lt;dbl&gt; 0.96774592, 0.13958551, 0.95481492, 0.29984702, 0.06957911, 1.58692704, 0.92773…
## $ ranef     &lt;chr&gt; &quot;hat(zeta)[0][italic(i)]&quot;, &quot;hat(zeta)[0][italic(i)]&quot;, &quot;hat(zeta)[0][italic(i)]&quot;…</code></pre>
<p>Now we’re ready to plot the remaining panels on the left of Figure 4.5.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb413-1" data-line-number="1">z <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb413-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">sample =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_qq</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb413-5" data-line-number="5"><span class="st">  </span><span class="kw">ylim</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Normal score&quot;</span>,</a>
<a class="sourceLine" id="cb413-7" data-line-number="7">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>ranef, <span class="dt">labeller =</span> label_parsed, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-120-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Here are the ones on the right.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" data-line-number="1">z <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb414-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb414-3" data-line-number="3">    <span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb414-4" data-line-number="4">      alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(id),</a>
<a class="sourceLine" id="cb414-5" data-line-number="5">      alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(id)</a>
<a class="sourceLine" id="cb414-6" data-line-number="6">      )</a>
<a class="sourceLine" id="cb414-7" data-line-number="7">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb414-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ranef =</span> <span class="kw">str_c</span>(<span class="st">&quot;italic(std)~&quot;</span>, ranef)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb414-9" data-line-number="9"><span class="st">  </span><span class="co"># note we have to group them before standardizing</span></a>
<a class="sourceLine" id="cb414-10" data-line-number="10"><span class="st">  </span><span class="kw">group_by</span>(ranef) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb414-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">z =</span> (Estimate <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Estimate)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(Estimate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb414-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb414-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> id, <span class="dt">y =</span> z)) <span class="op">+</span></a>
<a class="sourceLine" id="cb414-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb414-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb414-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb414-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb414-18" data-line-number="18"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>ranef, <span class="dt">labeller =</span> label_parsed, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-121-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>If you were paying close attention, you may have noticed that for all three of our <code>id</code>-level deviation estimates, they were summarized not only by a posterior mean but by standard deviations and 95% intervals, too. To give a sense of what that means, here are those last two plots, again, but this time including vertical bars defined by the 95% intervals.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" data-line-number="1">z <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb415-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb415-3" data-line-number="3">    <span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb415-4" data-line-number="4">      alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(id),</a>
<a class="sourceLine" id="cb415-5" data-line-number="5">      alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(id)</a>
<a class="sourceLine" id="cb415-6" data-line-number="6">      )</a>
<a class="sourceLine" id="cb415-7" data-line-number="7">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb415-8" data-line-number="8"></a>
<a class="sourceLine" id="cb415-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> id, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb415-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb415-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">shape =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb415-12" data-line-number="12"><span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb415-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb415-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>ranef, <span class="dt">labeller =</span> label_parsed, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-122-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>When you go Bayesian, even your residuals get full posterior distributions.</p>
</div>
<div id="checking-homoscedasticity." class="section level3">
<h3><span class="header-section-number">4.8.3</span> Checking homoscedasticity.</h3>
<p>Here we examine the homoscedasticity assumption by plotting the residual estimates against our predictors. We’ll start with the upper left panel of Figure 4.6.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" data-line-number="1">e <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb416-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_cols</span>(alcohol1_pp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb416-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb416-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb416-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb416-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb416-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">hat</span>(epsilon)[<span class="kw">italic</span>(ij)])) <span class="op">+</span></a>
<a class="sourceLine" id="cb416-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">17</span>),</a>
<a class="sourceLine" id="cb416-9" data-line-number="9">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb416-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-123-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Here’s a quick way to get the remaining four panels.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1">z <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb417-3" data-line-number="3">    <span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb417-4" data-line-number="4">      alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(id, coa, peer),</a>
<a class="sourceLine" id="cb417-5" data-line-number="5">      alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(id, coa, peer)</a>
<a class="sourceLine" id="cb417-6" data-line-number="6">      )</a>
<a class="sourceLine" id="cb417-7" data-line-number="7">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb417-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(Estimate, ranef, coa, peer) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-9" data-line-number="9"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(Estimate, ranef)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb417-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-14" data-line-number="14"><span class="st">  </span><span class="kw">ylim</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;covariate value&quot;</span>,</a>
<a class="sourceLine" id="cb417-16" data-line-number="16">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb417-18" data-line-number="18">        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_grid</span>(ranef<span class="op">~</span>name, <span class="dt">labeller =</span> label_parsed, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-124-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="model-based-empirical-bayes-estimates-of-the-individual-growth-parameters" class="section level2">
<h2><span class="header-section-number">4.9</span> Model-based (Empirical Bayes) estimates of the individual growth parameters</h2>
<p>In this section, the authors discussed two methods for constructing <code>id</code>-level trajectories: a) use a weighted average of the OLS and multilevel estimates and b) rely solely on the multilevel model by making use of the three sources of residual variation. Our method will be the latter.</p>
<p>Here are the data for <code>id == 23</code>.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" data-line-number="1">alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb418-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(id<span class="op">:</span>coa, cpeer, alcuse) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb418-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span><span class="dv">23</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##      id   age   coa cpeer alcuse
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1    23    14     1 -1.02   1   
## 2    23    15     1 -1.02   1   
## 3    23    16     1 -1.02   1.73</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" data-line-number="1">post_<span class="dv">23</span> &lt;-</a>
<a class="sourceLine" id="cb420-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit4<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb420-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb420-4" data-line-number="4"><span class="st">  </span><span class="co"># make our pis</span></a>
<a class="sourceLine" id="cb420-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pi[0][&quot;,23&quot;]</span><span class="st">`</span> =<span class="st"> </span>b_Intercept <span class="op">+</span><span class="st"> </span>b_coa <span class="op">*</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>b_cpeer <span class="op">*</span><span class="st"> </span><span class="fl">-1.018</span>,</a>
<a class="sourceLine" id="cb420-6" data-line-number="6">         <span class="st">`</span><span class="dt">pi[1][&quot;,23&quot;]</span><span class="st">`</span> =<span class="st"> </span>b_age_<span class="dv">14</span> <span class="op">+</span><span class="st"> `</span><span class="dt">b_age_14:cpeer</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="fl">-1.018</span>)</a>
<a class="sourceLine" id="cb420-7" data-line-number="7"></a>
<a class="sourceLine" id="cb420-8" data-line-number="8"><span class="kw">head</span>(post_<span class="dv">23</span>)</a></code></pre></div>
<pre><code>##   b_Intercept  b_age_14     b_coa   b_cpeer b_age_14:cpeer pi[0][&quot;,23&quot;] pi[1][&quot;,23&quot;]
## 1   0.4177742 0.3288345 0.5996322 0.6687331    -0.02671047   0.33663602    0.3560258
## 2   0.4429282 0.3220195 0.4890968 0.6466944    -0.11915811   0.27369007    0.4433224
## 3   0.4260338 0.3028079 0.4798662 0.8226055    -0.15641917   0.06848761    0.4620426
## 4   0.3824585 0.3377296 0.5130731 0.7818481    -0.14104218   0.09961022    0.4813105
## 5   0.4289239 0.4171968 0.3574086 0.8214710    -0.17184547  -0.04992496    0.5921355
## 6   0.3319638 0.3274581 0.5437074 0.6683571    -0.27100334   0.19528367    0.6033395</code></pre>
<p>It doesn’t help us much now, but the reason we’ve formatted the names for our two <span class="math inline">\(\pi\)</span> columns so oddly is because those names will work much nicer in the figure we’ll make, below. Just wait and see.</p>
<p>Anyways, more than a couple point estimates, we returned the draws from the full posterior distribution. We might summarize them.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1">post_<span class="dv">23</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;pi&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb422-5" data-line-number="5">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb422-6" data-line-number="6">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   name              mean     ll    ul
##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 &quot;pi[0][\&quot;,23\&quot;]&quot; 0.262 -0.065 0.607
## 2 &quot;pi[1][\&quot;,23\&quot;]&quot; 0.423  0.211 0.637</code></pre>
<p>Or we could plot them.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1">post_<span class="dv">23</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb424-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;pi&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb424-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb424-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-7" data-line-number="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;participant-specific parameter estimates&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">labeller =</span> label_parsed, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-128-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Yet this approach neglects the <span class="math inline">\(\zeta\)</span>’s. W’ve been extracting the <span class="math inline">\(\zeta\)</span>’s with <code>ranef()</code>. We also get them when we use <code>posterior_samples()</code>. Here we’ll extract both the <span class="math inline">\(\gamma\)</span>’s as well as the <span class="math inline">\(\zeta\)</span>’s for <code>id == 23</code>.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1">post_<span class="dv">23</span> &lt;-</a>
<a class="sourceLine" id="cb425-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit4<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb425-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>), <span class="kw">contains</span>(<span class="st">&quot;23&quot;</span>))</a>
<a class="sourceLine" id="cb425-4" data-line-number="4"></a>
<a class="sourceLine" id="cb425-5" data-line-number="5"><span class="kw">glimpse</span>(post_<span class="dv">23</span>)</a></code></pre></div>
<pre><code>## Rows: 4,000
## Columns: 7
## $ b_Intercept          &lt;dbl&gt; 0.4177742, 0.4429282, 0.4260338, 0.3824585, 0.4289239, 0.3319638, 0.…
## $ b_age_14             &lt;dbl&gt; 0.3288345, 0.3220195, 0.3028079, 0.3377296, 0.4171968, 0.3274581, 0.…
## $ b_coa                &lt;dbl&gt; 0.5996322, 0.4890968, 0.4798662, 0.5130731, 0.3574086, 0.5437074, 0.…
## $ b_cpeer              &lt;dbl&gt; 0.6687331, 0.6466944, 0.8226055, 0.7818481, 0.8214710, 0.6683571, 0.…
## $ `b_age_14:cpeer`     &lt;dbl&gt; -0.02671047, -0.11915811, -0.15641917, -0.14104218, -0.17184547, -0.…
## $ `r_id[23,Intercept]` &lt;dbl&gt; 0.271850140, 0.383131729, 0.672762382, 0.921352031, 0.671065247, 0.0…
## $ `r_id[23,age_14]`    &lt;dbl&gt; -0.1491509044, -0.0431086861, -0.1270336410, -0.1731686206, 0.214594…</code></pre>
<p>With the <code>r_id</code> prefix, <strong>brms</strong> tells you these are residual estimates for the levels in the <code>id</code> grouping variable. Within the brackets, we learn these particular columns are for <code>id == 23</code>, the first with respect to the <code>Intercept</code> and second with respect to the <code>age_14</code> parameter. Let’s put them to use.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" data-line-number="1">post_<span class="dv">23</span> &lt;-</a>
<a class="sourceLine" id="cb427-2" data-line-number="2"><span class="st">  </span>post_<span class="dv">23</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb427-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pi[0][&quot;,23&quot;]</span><span class="st">`</span> =<span class="st"> </span>b_Intercept <span class="op">+</span><span class="st"> </span>b_coa <span class="op">*</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>b_cpeer <span class="op">*</span><span class="st"> </span><span class="fl">-1.018</span> <span class="op">+</span><span class="st"> `</span><span class="dt">r_id[23,Intercept]</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb427-4" data-line-number="4">         <span class="st">`</span><span class="dt">pi[1][&quot;,23&quot;]</span><span class="st">`</span> =<span class="st"> </span>b_age_<span class="dv">14</span> <span class="op">+</span><span class="st"> `</span><span class="dt">b_age_14:cpeer</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="fl">-1.018</span> <span class="op">+</span><span class="st"> `</span><span class="dt">r_id[23,age_14]</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb427-5" data-line-number="5"></a>
<a class="sourceLine" id="cb427-6" data-line-number="6"><span class="kw">glimpse</span>(post_<span class="dv">23</span>)</a></code></pre></div>
<pre><code>## Rows: 4,000
## Columns: 9
## $ b_Intercept          &lt;dbl&gt; 0.4177742, 0.4429282, 0.4260338, 0.3824585, 0.4289239, 0.3319638, 0.…
## $ b_age_14             &lt;dbl&gt; 0.3288345, 0.3220195, 0.3028079, 0.3377296, 0.4171968, 0.3274581, 0.…
## $ b_coa                &lt;dbl&gt; 0.5996322, 0.4890968, 0.4798662, 0.5130731, 0.3574086, 0.5437074, 0.…
## $ b_cpeer              &lt;dbl&gt; 0.6687331, 0.6466944, 0.8226055, 0.7818481, 0.8214710, 0.6683571, 0.…
## $ `b_age_14:cpeer`     &lt;dbl&gt; -0.02671047, -0.11915811, -0.15641917, -0.14104218, -0.17184547, -0.…
## $ `r_id[23,Intercept]` &lt;dbl&gt; 0.271850140, 0.383131729, 0.672762382, 0.921352031, 0.671065247, 0.0…
## $ `r_id[23,age_14]`    &lt;dbl&gt; -0.1491509044, -0.0431086861, -0.1270336410, -0.1731686206, 0.214594…
## $ `pi[0][&quot;,23&quot;]`       &lt;dbl&gt; 0.60848616, 0.65682180, 0.74124999, 1.02096225, 0.62114029, 0.275693…
## $ `pi[1][&quot;,23&quot;]`       &lt;dbl&gt; 0.20687489, 0.40021375, 0.33500899, 0.30814191, 0.80672987, 0.288120…</code></pre>
<p>Here are our updated summaries.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1">post_<span class="dv">23</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb429-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;pi&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb429-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb429-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb429-5" data-line-number="5">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb429-6" data-line-number="6">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb429-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   name              mean     ll    ul
##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 &quot;pi[0][\&quot;,23\&quot;]&quot; 0.570 -0.105  1.27
## 2 &quot;pi[1][\&quot;,23\&quot;]&quot; 0.509 -0.022  1.03</code></pre>
<p>And here are the updated density plots.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1">post_<span class="dv">23</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb431-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;pi&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb431-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb431-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb431-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;grey25&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb431-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb431-7" data-line-number="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;participant-specific parameter estimates&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb431-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb431-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">labeller =</span> label_parsed, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-132-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We’ve been focusing on the <span class="math inline">\(\pi\)</span> parameters. Notice that when we turn our attention to Figure 4.7, we’re now shifting focus slightly to the consequences of those parameters. We’re not attending to trajectories. It’s important to pick up on this distinction because it has consequences for our programming workflow. If you wanted to keep a parameter-centric workflow, we could continue to expand on our <code>posterior_samples()</code> by applying the full composite formula to explicitly add in predictions for various levels of <code>age_14</code>. And we could do that separately or in bulk for the eight participants highlighted in the figure.</p>
<p>However pedagogically useful that might be, it’d be very tedious. If we instead take a trajectory-centric perspective, it’ll be more natural and efficient to work with a <code>fitted()</code>-based workflow. Let’s define our <code>nd</code> data.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb432-2" data-line-number="2"><span class="st">  </span>alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb432-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(id<span class="op">:</span>coa, age_<span class="dv">14</span><span class="op">:</span>alcuse, cpeer) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb432-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">14</span>, <span class="dv">23</span>, <span class="dv">32</span>, <span class="dv">41</span>, <span class="dv">56</span>, <span class="dv">65</span>, <span class="dv">82</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb432-5" data-line-number="5"><span class="st">  </span><span class="co"># these next two lines will make plotting easier</span></a>
<a class="sourceLine" id="cb432-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id_label =</span> <span class="kw">ifelse</span>(id <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>, <span class="kw">str_c</span>(<span class="st">&quot;0&quot;</span>, id), id)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb432-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id_label =</span> <span class="kw">str_c</span>(<span class="st">&quot;id = &quot;</span>, id_label))</a>
<a class="sourceLine" id="cb432-8" data-line-number="8"></a>
<a class="sourceLine" id="cb432-9" data-line-number="9"><span class="kw">glimpse</span>(nd)</a></code></pre></div>
<pre><code>## Rows: 24
## Columns: 7
## $ id       &lt;dbl&gt; 4, 4, 4, 14, 14, 14, 23, 23, 23, 32, 32, 32, 41, 41, 41, 56, 56, 56, 65, 65, 65,…
## $ age      &lt;dbl&gt; 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, …
## $ coa      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
## $ age_14   &lt;dbl&gt; 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2
## $ alcuse   &lt;dbl&gt; 0.000000, 2.000000, 1.732051, 2.828427, 3.605551, 2.828427, 1.000000, 1.000000, …
## $ cpeer    &lt;dbl&gt; 0.7708544, 0.7708544, 0.7708544, 0.9820000, 0.9820000, 0.9820000, -1.0180000, -1…
## $ id_label &lt;chr&gt; &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 14&quot;, &quot;id = 14&quot;, &quot;id = 14&quot;, &quot;id = 23&quot;, &quot;id…</code></pre>
<p>We’ve isolated the relevant predictor variables for our eight focal participants. Next we’ll pump them through <code>fitted()</code> and wrangle as usual.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb434-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.7</span>,</a>
<a class="sourceLine" id="cb434-3" data-line-number="3">         <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb434-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb434-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(nd)</a>
<a class="sourceLine" id="cb434-6" data-line-number="6"></a>
<a class="sourceLine" id="cb434-7" data-line-number="7"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 24
## Columns: 11
## $ Estimate  &lt;dbl&gt; 1.1344894, 1.4480688, 1.7616482, 2.3767968, 2.7029029, 3.0290089, 0.5696337, 1.…
## $ Est.Error &lt;dbl&gt; 0.3562022, 0.2989615, 0.4499632, 0.3646575, 0.3058667, 0.4386758, 0.3439383, 0.…
## $ Q2.5      &lt;dbl&gt; 0.38839366, 0.85915855, 0.88588203, 1.70822381, 2.09593268, 2.17085481, -0.1046…
## $ Q97.5     &lt;dbl&gt; 1.801852, 2.030939, 2.670164, 3.124590, 3.316853, 3.903620, 1.266930, 1.667805,…
## $ id        &lt;dbl&gt; 4, 4, 4, 14, 14, 14, 23, 23, 23, 32, 32, 32, 41, 41, 41, 56, 56, 56, 65, 65, 65…
## $ age       &lt;dbl&gt; 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15,…
## $ coa       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
## $ age_14    &lt;dbl&gt; 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2
## $ alcuse    &lt;dbl&gt; 0.000000, 2.000000, 1.732051, 2.828427, 3.605551, 2.828427, 1.000000, 1.000000,…
## $ cpeer     &lt;dbl&gt; 0.7708544, 0.7708544, 0.7708544, 0.9820000, 0.9820000, 0.9820000, -1.0180000, -…
## $ id_label  &lt;chr&gt; &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 14&quot;, &quot;id = 14&quot;, &quot;id = 14&quot;, &quot;id = 23&quot;, &quot;i…</code></pre>
<p>Notice how this time we omitted the <code>re_formula = NA</code> argument. By default, <code>re_formula = NULL</code>, the consequence of which is the output is based on all the parameters in the multilevel model, not just the <span class="math inline">\(\gamma\)</span>’s. Here are what they look like.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb436-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;alcuse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-5" data-line-number="5"><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">13</span>, <span class="dv">17</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb436-7" data-line-number="7">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id_label, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-135-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Now we’ve warmed up, let’s add in the data and the other lines so make the full version of Figure 4.7. Before we do so, we’ll revisit <code>fitted()</code>. Notice the return of the <code>re_formula = NA</code> argument. The trajectories in our <code>f_gamma_only</code> data frame will only be sensitive to the <span class="math inline">\(\gamma\)</span>s.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb437-1" data-line-number="1">f_gamma_only &lt;-</a>
<a class="sourceLine" id="cb437-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.7</span>,</a>
<a class="sourceLine" id="cb437-3" data-line-number="3">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb437-4" data-line-number="4">         <span class="dt">re_formula =</span> <span class="ot">NA</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb437-5" data-line-number="5"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb437-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(nd)</a>
<a class="sourceLine" id="cb437-7" data-line-number="7"></a>
<a class="sourceLine" id="cb437-8" data-line-number="8"><span class="kw">glimpse</span>(f_gamma_only)</a></code></pre></div>
<pre><code>## Rows: 24
## Columns: 11
## $ Estimate  &lt;dbl&gt; 1.4986587, 1.6539408, 1.8092228, 1.6446802, 1.7683040, 1.8919278, 0.2615448, 0.…
## $ Est.Error &lt;dbl&gt; 0.1385486, 0.1360113, 0.1881993, 0.1526199, 0.1500623, 0.2123077, 0.1729135, 0.…
## $ Q2.5      &lt;dbl&gt; 1.23327430, 1.39161355, 1.44773073, 1.34457723, 1.47848970, 1.48072747, -0.0651…
## $ Q97.5     &lt;dbl&gt; 1.7802269, 1.9240787, 2.1693423, 1.9508109, 2.0659062, 2.3016916, 0.6065649, 1.…
## $ id        &lt;dbl&gt; 4, 4, 4, 14, 14, 14, 23, 23, 23, 32, 32, 32, 41, 41, 41, 56, 56, 56, 65, 65, 65…
## $ age       &lt;dbl&gt; 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15, 16, 14, 15,…
## $ coa       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
## $ age_14    &lt;dbl&gt; 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2
## $ alcuse    &lt;dbl&gt; 0.000000, 2.000000, 1.732051, 2.828427, 3.605551, 2.828427, 1.000000, 1.000000,…
## $ cpeer     &lt;dbl&gt; 0.7708544, 0.7708544, 0.7708544, 0.9820000, 0.9820000, 0.9820000, -1.0180000, -…
## $ id_label  &lt;chr&gt; &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 14&quot;, &quot;id = 14&quot;, &quot;id = 14&quot;, &quot;id = 23&quot;, &quot;i…</code></pre>
<p>Let’s plot!</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb439-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-3" data-line-number="3"><span class="st">  </span><span class="co"># `id`-specific lines</span></a>
<a class="sourceLine" id="cb439-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate),</a>
<a class="sourceLine" id="cb439-5" data-line-number="5">            <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-6" data-line-number="6"><span class="st">  </span><span class="co"># gamma-centric lines</span></a>
<a class="sourceLine" id="cb439-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> f_gamma_only,</a>
<a class="sourceLine" id="cb439-8" data-line-number="8">            <span class="kw">aes</span>(<span class="dt">y =</span> Estimate),</a>
<a class="sourceLine" id="cb439-9" data-line-number="9">            <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-10" data-line-number="10"><span class="st">  </span><span class="co"># OLS lines</span></a>
<a class="sourceLine" id="cb439-11" data-line-number="11"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">data =</span> nd,</a>
<a class="sourceLine" id="cb439-12" data-line-number="12">              <span class="kw">aes</span>(<span class="dt">y =</span> alcuse),</a>
<a class="sourceLine" id="cb439-13" data-line-number="13">              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F,</a>
<a class="sourceLine" id="cb439-14" data-line-number="14">              <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-15" data-line-number="15"><span class="st">  </span><span class="co"># data points</span></a>
<a class="sourceLine" id="cb439-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> nd,</a>
<a class="sourceLine" id="cb439-17" data-line-number="17">             <span class="kw">aes</span>(<span class="dt">y =</span> alcuse)) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;alcuse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-19" data-line-number="19"><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">13</span>, <span class="dv">17</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-20" data-line-number="20"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb439-21" data-line-number="21">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb439-22" data-line-number="22"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id_label, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-137-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Though our purpose was largely to reproduce Figure 4.7, we might push ourselves a little further. Our Bayesian estimates came with measures of uncertainty, the posterior standard deviations and the 95% intervals. Whenever possible, it’s good form to include some expression of our uncertainty in our plots. Here let’s focus on the <code>id</code>-specific trajectories.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb440-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb440-3" data-line-number="3"><span class="st">  </span><span class="co"># `id`-specific 95% intervals</span></a>
<a class="sourceLine" id="cb440-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb440-5" data-line-number="5">              <span class="dt">fill =</span> <span class="st">&quot;grey75&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb440-6" data-line-number="6"><span class="st">  </span><span class="co"># `id`-specific lines</span></a>
<a class="sourceLine" id="cb440-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb440-8" data-line-number="8"><span class="st">  </span><span class="co"># data points</span></a>
<a class="sourceLine" id="cb440-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> nd,</a>
<a class="sourceLine" id="cb440-10" data-line-number="10">             <span class="kw">aes</span>(<span class="dt">y =</span> alcuse)) <span class="op">+</span></a>
<a class="sourceLine" id="cb440-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;alcuse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb440-12" data-line-number="12"><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">13</span>, <span class="dv">17</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb440-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb440-14" data-line-number="14">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb440-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id_label, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-138-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>This also clarifies an important visualization point. If you only care about plotting straight lines, you only need two points. However, if you want to express shapes with curves, such as the typically-bowtie-shaped 95% intervals, you need estimates over a larger number of predictor values. Back to <code>fitted()</code>!</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" data-line-number="1"><span class="co"># we need an expanded version of the `nd`</span></a>
<a class="sourceLine" id="cb441-2" data-line-number="2">nd_expanded &lt;-</a>
<a class="sourceLine" id="cb441-3" data-line-number="3"><span class="st">  </span>alcohol1_pp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb441-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(id, coa, cpeer) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb441-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">14</span>, <span class="dv">23</span>, <span class="dv">32</span>, <span class="dv">41</span>, <span class="dv">56</span>, <span class="dv">65</span>, <span class="dv">82</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb441-6" data-line-number="6"><span class="st">  </span><span class="co"># this part is important!</span></a>
<a class="sourceLine" id="cb441-7" data-line-number="7"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(id, coa, cpeer),</a>
<a class="sourceLine" id="cb441-8" data-line-number="8">         <span class="dt">age_14 =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb441-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id_label =</span> <span class="kw">ifelse</span>(id <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>, <span class="kw">str_c</span>(<span class="st">&quot;0&quot;</span>, id), id)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb441-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id_label =</span> <span class="kw">str_c</span>(<span class="st">&quot;id = &quot;</span>, id_label),</a>
<a class="sourceLine" id="cb441-11" data-line-number="11">         <span class="dt">age      =</span> age_<span class="dv">14</span> <span class="op">+</span><span class="st"> </span><span class="dv">14</span>)</a>
<a class="sourceLine" id="cb441-12" data-line-number="12"></a>
<a class="sourceLine" id="cb441-13" data-line-number="13"><span class="co"># pump our `nd_expanded` into `fitted()`</span></a>
<a class="sourceLine" id="cb441-14" data-line-number="14">f &lt;-</a>
<a class="sourceLine" id="cb441-15" data-line-number="15"><span class="st">  </span><span class="kw">fitted</span>(fit4<span class="fl">.7</span>,</a>
<a class="sourceLine" id="cb441-16" data-line-number="16">         <span class="dt">newdata =</span> nd_expanded) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb441-17" data-line-number="17"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb441-18" data-line-number="18"><span class="st">  </span><span class="kw">bind_cols</span>(nd_expanded)</a>
<a class="sourceLine" id="cb441-19" data-line-number="19"></a>
<a class="sourceLine" id="cb441-20" data-line-number="20"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 240
## Columns: 10
## $ Estimate  &lt;dbl&gt; 1.134489, 1.156116, 1.177742, 1.199368, 1.220994, 1.242620, 1.264246, 1.285873,…
## $ Est.Error &lt;dbl&gt; 0.3562022, 0.3456284, 0.3357889, 0.3267502, 0.3185803, 0.3113477, 0.3051190, 0.…
## $ Q2.5      &lt;dbl&gt; 0.3883937, 0.4351870, 0.4735158, 0.5249442, 0.5708991, 0.6107689, 0.6502656, 0.…
## $ Q97.5     &lt;dbl&gt; 1.801852, 1.806147, 1.819295, 1.827235, 1.835426, 1.843173, 1.854218, 1.865515,…
## $ id        &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4…
## $ coa       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ cpeer     &lt;dbl&gt; 0.7708544, 0.7708544, 0.7708544, 0.7708544, 0.7708544, 0.7708544, 0.7708544, 0.…
## $ age_14    &lt;dbl&gt; 0.00000000, 0.06896552, 0.13793103, 0.20689655, 0.27586207, 0.34482759, 0.41379…
## $ id_label  &lt;chr&gt; &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;id = 04&quot;, &quot;i…
## $ age       &lt;dbl&gt; 14.00000, 14.06897, 14.13793, 14.20690, 14.27586, 14.34483, 14.41379, 14.48276,…</code></pre>
<p>Notice how we now have many more rows. Let’s plot.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb443-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-3" data-line-number="3"><span class="st">  </span><span class="co"># `id`-specific 95% intervals</span></a>
<a class="sourceLine" id="cb443-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb443-5" data-line-number="5">              <span class="dt">fill =</span> <span class="st">&quot;grey75&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-6" data-line-number="6"><span class="st">  </span><span class="co"># `id`-specific lines</span></a>
<a class="sourceLine" id="cb443-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-8" data-line-number="8"><span class="st">  </span><span class="co"># data points</span></a>
<a class="sourceLine" id="cb443-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> nd,</a>
<a class="sourceLine" id="cb443-10" data-line-number="10">             <span class="kw">aes</span>(<span class="dt">y =</span> alcuse)) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;alcuse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-12" data-line-number="12"><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">13</span>, <span class="dv">17</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb443-14" data-line-number="14">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id_label, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-140-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Singer and Willett pointed out that one of the ways in which the multilevel model is more parsimonious than a series of <code>id</code>-specific single-level models is that all <code>id</code> levels share the same <span class="math inline">\(\sigma_\epsilon\)</span> parameter. At this point, we should just point out that it’s possible to relax this assumption with modern Bayesian software, such as <strong>brms</strong>. For ideas on how, check out <a href="https://twitter.com/wdonald_1985">Donald Williams</a>’ work (e.g., <a href="https://psyarxiv.com/gwatq">this preprint</a>).</p>
</div>
<div id="reference-3" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://www.oxfordscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968">Singer, J. D., &amp; Willett, J. B. (2003). <em>Applied longitudinal data analysis: Modeling change and event occurrence</em>. New York, NY, US: Oxford University Press.</a></p>
</div>
<div id="session-info-3" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] broom_0.5.5     loo_2.2.0       brms_2.12.0     Rcpp_1.0.4.6    forcats_0.5.0   stringr_1.4.0  
##  [7] dplyr_0.8.5     purrr_0.3.3     readr_1.3.1     tidyr_1.0.2     tibble_3.0.0    ggplot2_3.3.0  
## [13] tidyverse_1.3.0
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1     ellipsis_0.3.0       ggridges_0.5.2       rsconnect_0.8.16    
##   [5] markdown_1.1         base64enc_0.1-3      fs_1.4.1             rstudioapi_0.11     
##   [9] farver_2.0.3         rstan_2.19.3         DT_0.13              fansi_0.4.1         
##  [13] mvtnorm_1.1-0        lubridate_1.7.8      xml2_1.3.1           bridgesampling_1.0-0
##  [17] splines_3.6.3        robustbase_0.93-6    knitr_1.28           shinythemes_1.1.2   
##  [21] bayesplot_1.7.1      jsonlite_1.6.1       dbplyr_1.4.2         shiny_1.4.0.2       
##  [25] compiler_3.6.3       httr_1.4.1           backports_1.1.6      assertthat_0.2.1    
##  [29] Matrix_1.2-18        fastmap_1.0.1        cli_2.0.2            later_1.0.0         
##  [33] htmltools_0.4.0      prettyunits_1.1.1    tools_3.6.3          igraph_1.2.5        
##  [37] coda_0.19-3          gtable_0.3.0         glue_1.4.0           reshape2_1.4.4      
##  [41] cellranger_1.1.0     vctrs_0.2.4          nlme_3.1-144         crosstalk_1.1.0.1   
##  [45] xfun_0.13            ps_1.3.2             rvest_0.3.5          mime_0.9            
##  [49] miniUI_0.1.1.1       lifecycle_0.2.0      gtools_3.8.2         DEoptimR_1.0-8      
##  [53] MASS_7.3-51.5        zoo_1.8-7            scales_1.1.0         colourpicker_1.0    
##  [57] hms_0.5.3            promises_1.1.0       Brobdingnag_1.2-6    parallel_3.6.3      
##  [61] inline_0.3.15        RColorBrewer_1.1-2   shinystan_2.5.0      yaml_2.2.1          
##  [65] gridExtra_2.3        StanHeaders_2.21.0-1 stringi_1.4.6        dygraphs_1.1.1.6    
##  [69] checkmate_2.0.0      pkgbuild_1.0.6       rlang_0.4.5          pkgconfig_2.0.3     
##  [73] matrixStats_0.56.0   evaluate_0.14        lattice_0.20-38      rstantools_2.0.0    
##  [77] htmlwidgets_1.5.1    labeling_0.3         tidyselect_1.0.0     processx_3.4.2      
##  [81] plyr_1.8.6           magrittr_1.5         bookdown_0.18        R6_2.4.1            
##  [85] generics_0.0.2       DBI_1.1.0            pillar_1.4.3         haven_2.2.0         
##  [89] withr_2.1.2          mgcv_1.8-31          xts_0.12-0           abind_1.4-5         
##  [93] metRology_0.9-28-1   modelr_0.1.6         crayon_1.3.4         utf8_1.1.4          
##  [97] rmarkdown_2.1        grid_3.6.3           readxl_1.3.1         callr_3.4.3         
## [101] threejs_0.3.3        reprex_0.3.0         digest_0.6.25        xtable_1.8-4        
## [105] numDeriv_2016.8-1.1  httpuv_1.5.2         stats4_3.6.3         munsell_0.5.0       
## [109] shinyjs_1.1</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introducing-the-multilevel-model-for-change.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="treating-time-more-flexibly.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
