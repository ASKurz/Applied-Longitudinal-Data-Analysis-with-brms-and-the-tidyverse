<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Examining the Multilevel Model’s Error Covariance Structure – *Applied longitudinal data analysis* in brms and the tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08.html" rel="next">
<link href="./06.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7d082c015fa132ca880f975003d7bf2f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="7&nbsp; Examining the Multilevel Model’s Error Covariance Structure – Applied longitudinal data analysis in brms and the tidyverse">
<meta property="og:description" content="">
<meta property="og:image" content="https://solomon.quarto.pub/alda/07_files/figure-html/unnamed-chunk-4-1.png">
<meta property="og:site_name" content="*Applied longitudinal data analysis* in brms and the tidyverse">
<meta property="og:image:height" content="384">
<meta property="og:image:width" content="576">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Examining the Multilevel Model’s Error Covariance Structure</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"><em>Applied longitudinal data analysis</em> in brms and the tidyverse</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What and why</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">A Framework for Investigating Change over Time</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploring Longitudinal Data on Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introducing the Multilevel Model for Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Doing Data Analysis with the Multilevel Model for Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Treating Time More Flexibly</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modeling Discontinuous and Nonlinear Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Examining the Multilevel Model’s Error Covariance Structure</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Change Using Covariance Structure Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">A Framework for Investigating Event Occurrence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Describing Discrete-Time Event Occurrence Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fitting Basic Discrete-Time Hazard Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Extending the Discrete-Time Hazard Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Describing Continuous-Time Event Occurrence Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-standard-specification-of-the-multilevel-model-for-change" id="toc-the-standard-specification-of-the-multilevel-model-for-change" class="nav-link active" data-scroll-target="#the-standard-specification-of-the-multilevel-model-for-change"><span class="header-section-number">7.1</span> The “standard” specification of the multilevel model for change</a></li>
  <li><a href="#using-the-composite-model-to-understand-assumptions-about-the-error-covariance-matrix" id="toc-using-the-composite-model-to-understand-assumptions-about-the-error-covariance-matrix" class="nav-link" data-scroll-target="#using-the-composite-model-to-understand-assumptions-about-the-error-covariance-matrix"><span class="header-section-number">7.2</span> Using the composite model to understand assumptions about the error covariance matrix</a>
  <ul>
  <li><a href="#variance-of-the-composite-residual" id="toc-variance-of-the-composite-residual" class="nav-link" data-scroll-target="#variance-of-the-composite-residual"><span class="header-section-number">7.2.1</span> Variance of the composite residual</a></li>
  <li><a href="#covariance-of-the-composite-residuals" id="toc-covariance-of-the-composite-residuals" class="nav-link" data-scroll-target="#covariance-of-the-composite-residuals"><span class="header-section-number">7.2.2</span> Covariance of the composite residuals</a></li>
  <li><a href="#autocorrelation-of-the-composite-residuals" id="toc-autocorrelation-of-the-composite-residuals" class="nav-link" data-scroll-target="#autocorrelation-of-the-composite-residuals"><span class="header-section-number">7.2.3</span> Autocorrelation of the composite residuals</a></li>
  </ul></li>
  <li><a href="#postulating-an-alternative-error-covariance-structure" id="toc-postulating-an-alternative-error-covariance-structure" class="nav-link" data-scroll-target="#postulating-an-alternative-error-covariance-structure"><span class="header-section-number">7.3</span> Postulating an alternative error covariance structure</a>
  <ul>
  <li><a href="#unstructured-error-covariance-matrix" id="toc-unstructured-error-covariance-matrix" class="nav-link" data-scroll-target="#unstructured-error-covariance-matrix"><span class="header-section-number">7.3.1</span> Unstructured error covariance matrix</a></li>
  <li><a href="#compound-symmetric-error-covariance-matrix" id="toc-compound-symmetric-error-covariance-matrix" class="nav-link" data-scroll-target="#compound-symmetric-error-covariance-matrix"><span class="header-section-number">7.3.2</span> Compound symmetric error covariance matrix</a></li>
  <li><a href="#heterogeneous-compound-symmetric-error-covariance-matrix" id="toc-heterogeneous-compound-symmetric-error-covariance-matrix" class="nav-link" data-scroll-target="#heterogeneous-compound-symmetric-error-covariance-matrix"><span class="header-section-number">7.3.3</span> Heterogeneous compound symmetric error covariance matrix</a></li>
  <li><a href="#autoregressive-error-covariance-matrix" id="toc-autoregressive-error-covariance-matrix" class="nav-link" data-scroll-target="#autoregressive-error-covariance-matrix"><span class="header-section-number">7.3.4</span> Autoregressive error covariance matrix</a></li>
  <li><a href="#heterogeneous-autoregressive-error-covariance-matrix" id="toc-heterogeneous-autoregressive-error-covariance-matrix" class="nav-link" data-scroll-target="#heterogeneous-autoregressive-error-covariance-matrix"><span class="header-section-number">7.3.5</span> Heterogeneous autoregressive error covariance matrix</a></li>
  <li><a href="#toeplitz-error-covariance-matrix" id="toc-toeplitz-error-covariance-matrix" class="nav-link" data-scroll-target="#toeplitz-error-covariance-matrix"><span class="header-section-number">7.3.6</span> Toeplitz error covariance matrix</a></li>
  <li><a href="#does-choosing-the-correct-error-covariance-structure-really-matter" id="toc-does-choosing-the-correct-error-covariance-structure-really-matter" class="nav-link" data-scroll-target="#does-choosing-the-correct-error-covariance-structure-really-matter"><span class="header-section-number">7.3.7</span> Does choosing the “correct” error covariance structure really matter?</a></li>
  <li><a href="#bonus-did-we-trade-multilevel-for-multivariate" id="toc-bonus-did-we-trade-multilevel-for-multivariate" class="nav-link" data-scroll-target="#bonus-did-we-trade-multilevel-for-multivariate"><span class="header-section-number">7.3.8</span> Bonus: Did we trade multilevel for multivariate?</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments">Comments</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Examining the Multilevel Model’s Error Covariance Structure</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>In this chapter…, we focus on the model’s <em>random</em> effects as embodied in its error covariance structure. Doing so allows us to both describe the particular error covariance structure that the “standard” multilevel model for change invokes and it also allows us to broaden its representation to other—sometimes more tenable assumptions—about its behavior. <span class="citation" data-cites="singerAppliedLongitudinalData2003">(<a href="references.html#ref-singerAppliedLongitudinalData2003" role="doc-biblioref">Singer &amp; Willett, 2003, p. 243</a>, <em>emphasis</em> in the original)</span></p>
</blockquote>
<section id="the-standard-specification-of-the-multilevel-model-for-change" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="the-standard-specification-of-the-multilevel-model-for-change"><span class="header-section-number">7.1</span> The “standard” specification of the multilevel model for change</h2>
<p>Load the <code>opposites_pp</code> data <span class="citation" data-cites="willett1988QuestionsAndAnswers">(<a href="references.html#ref-willett1988QuestionsAndAnswers" role="doc-biblioref">Willett, 1988</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>opposites_pp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/Dropbox/Recoding Applied Longitudinal Data Analysis/data/opposites_pp.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(opposites_pp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 140
Columns: 6
$ id   &lt;dbl&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8, 9, 9, 9, 9, 10, 10,…
$ time &lt;dbl&gt; 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2…
$ opp  &lt;dbl&gt; 205, 217, 268, 302, 219, 243, 279, 302, 142, 212, 250, 289, 206, 230, 248, 273, 190, 220, 229, 220, 165, 205, 207, …
$ cog  &lt;dbl&gt; 137, 137, 137, 137, 123, 123, 123, 123, 129, 129, 129, 129, 125, 125, 125, 125, 81, 81, 81, 81, 110, 110, 110, 110,…
$ ccog &lt;dbl&gt; 23.5429, 23.5429, 23.5429, 23.5429, 9.5429, 9.5429, 9.5429, 9.5429, 15.5429, 15.5429, 15.5429, 15.5429, 11.5429, 11…
$ wave &lt;dbl&gt; 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3…</code></pre>
</div>
</div>
<p><span class="citation" data-cites="willett1988QuestionsAndAnswers">Willett (<a href="references.html#ref-willett1988QuestionsAndAnswers" role="doc-biblioref">1988</a>)</span> clarified these data were simulated for pedagogical purposes, which will become important later on. For now, here’s our version of Table 7.1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>opposites_pp <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">"opp"</span>, wave)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, name, opp, cog) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> opp) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="fu">starts_with</span>(<span class="st">"opp"</span>), cog) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
      id  opp1  opp2  opp3  opp4   cog
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1   205   217   268   302   137
 2     2   219   243   279   302   123
 3     3   142   212   250   289   129
 4     4   206   230   248   273   125
 5     5   190   220   229   220    81
 6     6   165   205   207   263   110
 7     7   170   182   214   268    99
 8     8    96   131   159   213   113
 9     9   138   156   197   200   104
10    10   216   252   274   298    96</code></pre>
</div>
</div>
<p>The data are composed of 35 people’s scores on a cognitive task, across 4 time points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>opposites_pp <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 2
      id     n
   &lt;dbl&gt; &lt;int&gt;
 1     1     4
 2     2     4
 3     3     4
 4     4     4
 5     5     4
 6     6     4
 7     7     4
 8     8     4
 9     9     4
10    10     4
# ℹ 25 more rows</code></pre>
</div>
</div>
<p>Our first model will serve as a comparison model for all that follow. We’ll often refer to it as the <em>standard</em> multilevel model for change. You’ll see why in a bit. It follows the form</p>
<p><span class="math display">\[
\begin{align}
\text{opp}_{ij} &amp; = \pi_{0i} + \pi_{1i} \text{time}_{ij} + \epsilon_{ij}\\
\pi_{0i} &amp; = \gamma_{00} + \gamma_{01} (\text{cog}_i - \overline{\text{cog}}) + \zeta_{0i}\\
\pi_{1i} &amp; = \gamma_{10} + \gamma_{11} (\text{cog}_i - \overline{\text{cog}}) + \zeta_{1i} \\
\epsilon_{ij} &amp; \stackrel{iid}{\sim} \operatorname{Normal}(0, \sigma_\epsilon) \\
\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp; \stackrel{iid}{\sim} \operatorname{Normal} \left (
\begin{bmatrix} 0 \\ 0 \end{bmatrix}, \mathbf D \mathbf\Omega \mathbf D' \right ) \\
\mathbf D      &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \\
\mathbf \Omega &amp; = \begin{bmatrix} 1 &amp; \rho_{01} \\ \rho_{01} &amp; 1 \end{bmatrix},
\end{align}
\]</span></p>
<p>where the <span class="math inline">\((\text{cog}_i - \overline{\text{cog}})\)</span> notation is meant to indicate we are mean centering the time-invariant covariate <span class="math inline">\(\text{cog}_i\)</span>. In the data, the mean-centered version is saved as <code>ccog</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>opposites_pp <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(ccog)) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p>To keep things simple, we’ll be using <strong>brms</strong> default priors for all the models in this chapter. Fit the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time <span class="sc">+</span> ccog <span class="sc">+</span> time<span class="sc">:</span>ccog <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> id),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.1</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: opp ~ 0 + Intercept + time + ccog + time:ccog + (1 + time | id) 
   Data: opposites_pp (Number of observations: 140) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~id (Number of levels: 35) 
                    Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
sd(Intercept)         36.119     4.933   27.567   46.837 1.001     1249     1827
sd(time)              10.575     1.808    7.466   14.570 1.000     1289     2344
cor(Intercept,time)   -0.438     0.167   -0.711   -0.074 1.001     1501     2221

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
Intercept  164.282     6.464  151.454  176.704 1.006      828     1301
time        26.962     2.093   22.917   31.209 1.003     1558     2290
ccog        -0.144     0.520   -1.179    0.888 1.004     1274     2011
time:ccog    0.439     0.170    0.104    0.770 1.001     1781     2433

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
sigma   12.970     1.153   10.947   15.365 1.001     1727     2537

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>If you’re curious, here’s the summary of our <span class="math inline">\(\sigma\)</span> parameters transformed to the variance/covariance metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sigma[epsilon]^2"</span>, <span class="st">"sigma[0]^2"</span>, <span class="st">"sigma[1]^2"</span>, <span class="st">"sigma[0][1]"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="ot">=</span> sd_id__Intercept<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="ot">=</span> sd_id__time<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="ot">=</span> sigma<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="ot">=</span> sd_id__Intercept <span class="sc">*</span> sd_id__time <span class="sc">*</span> cor_id__Intercept__time)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  name             value .lower .upper .width .point .interval
  &lt;fct&gt;            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 sigma[epsilon]^2  166.  120.   236.    0.95 median qi       
2 sigma[0]^2       1274.  760.  2194.    0.95 median qi       
3 sigma[1]^2        109.   55.8  212.    0.95 median qi       
4 sigma[0][1]      -163. -394.   -22.4   0.95 median qi       </code></pre>
</div>
</div>
</section>
<section id="using-the-composite-model-to-understand-assumptions-about-the-error-covariance-matrix" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="using-the-composite-model-to-understand-assumptions-about-the-error-covariance-matrix"><span class="header-section-number">7.2</span> Using the composite model to understand assumptions about the error covariance matrix</h2>
<p>Dropping the terms specifying the distributional assumptions, we can reexpress the model formula, from above, in the composite format as</p>
<p><span class="math display">\[
\begin{align}
\text{opp}_{ij} &amp; = [\gamma_{00} + \gamma_{10} \text{time}_{ij} + \gamma_{01} (\text{cog}_i - \overline{\text{cog}}) + \gamma_{11} (\text{cog}_i - \overline{\text{cog}}) \times \text{time}_{ij}] \\
&amp; \;\;\; + [\zeta_{0i} + \zeta_{1i} \text{time}_{ij} + \epsilon_{ij}],
\end{align}
\]</span></p>
<p>where we’ve divided up the structural and stochastic components with our use of brackets. We might think of the terms of the stochastic portion as a <em>composite residual</em>, <span class="math inline">\(r_{ij} = [\epsilon_{ij} + \zeta_{0i} + \zeta_{1i} \text{time}_{ij}]\)</span>. Thus, we can rewrite the composite equation with the composite residual term <span class="math inline">\(r_{ij}\)</span> as</p>
<p><span class="math display">\[
\text{opp}_{ij} = [\gamma_{00} + \gamma_{10} \text{time}_{ij} + \gamma_{01} (\text{cog}_i - \overline{\text{cog}}) + \gamma_{11} (\text{cog}_i - \overline{\text{cog}}) \times \text{time}_{ij}] + r_{ij}.
\]</span></p>
<p>If we were willing to presume, as in OLS or single-level Bayesian regression, that all residuals are independent and normally distributed, we could express that in statistical notation as</p>
<p><span class="math display">\[\begin{align}
\begin{bmatrix} r_{11} \\ r_{12} \\ r_{13} \\ r_{14} \\ r_{21} \\ r_{22} \\ r_{23} \\ r_{24} \\ \vdots \\ r_{n1} \\ r_{n2} \\ r_{n3} \\ r_{n4} \end{bmatrix} &amp; \sim \mathcal{N}

\begin{pmatrix}

\begin{bmatrix} 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ \vdots \\ 0 \\ 0 \\ 0 \\ 0 \\ \end{bmatrix},

\begin{bmatrix}
\sigma_r^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \sigma_r^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \sigma_r^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; \sigma_r^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\

0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_r^2 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_r^2 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_r^2 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_r^2 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\

\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \\

0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; \sigma_r^2 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; \sigma_r^2 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; \sigma_r^2 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_r^2
\end{bmatrix}

\end{pmatrix},
\end{align}\]</span></p>
<p>where <span class="math inline">\(r_{ij}\)</span> is the <span class="math inline">\(i\)</span>th person’s residual on the <span class="math inline">\(j\)</span>th time point. The variance/covariance matrix <span class="math inline">\(\mathbf \Sigma\)</span> is diagonal (i.e., all the off-diagonal elements are 0’s) and <em>homoscedastic</em> (i.e., all the diagonal elements are the same value, <span class="math inline">\(\sigma_r^2\)</span>).</p>
<p>These assumptions are absurd for longitudinal data, which is why we don’t analyze such data with single-level models. If we were to make the less restrictive assumptions that, within people, the residuals were <em>correlated over time</em> and were <em>heteroscedastic</em>, we could express that as</p>
<p><span class="math display">\[\begin{align}
\begin{bmatrix} r_{11} \\ r_{12} \\ r_{13} \\ r_{14} \\ r_{21} \\ r_{22} \\ r_{23} \\ r_{24} \\ \vdots \\ r_{n1} \\ r_{n2} \\ r_{n3} \\ r_{n4} \end{bmatrix} &amp; \sim \mathcal{N}

\begin{pmatrix}

\begin{bmatrix} 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ \vdots \\ 0 \\ 0 \\ 0 \\ 0 \\ \end{bmatrix},

\begin{bmatrix}
\sigma_{r_1}^2 &amp; \sigma_{r_1 r_2} &amp; \sigma_{r_1 r_3} &amp; \sigma_{r_1 r_4} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\sigma_{r_2 r_1} &amp; \sigma_{r_2}^2 &amp; \sigma_{r_2 r_3} &amp; \sigma_{r_2 r_4} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\sigma_{r_3 r_1} &amp; \sigma_{r_3 r_2} &amp; \sigma_{r_3}^2 &amp; \sigma_{r_3 r_4} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\sigma_{r_4 r_1} &amp; \sigma_{r_4 r_2} &amp; \sigma_{r_4 r_3} &amp; \sigma_{r_4}^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\

0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{r_1}^2 &amp; \sigma_{r_1 r_2} &amp; \sigma_{r_1 r_3} &amp; \sigma_{r_1 r_4} &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{r_2 r_1} &amp; \sigma_{r_2}^2 &amp; \sigma_{r_2 r_3} &amp; \sigma_{r_2 r_4} &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{r_3 r_1} &amp; \sigma_{r_3 r_2} &amp; \sigma_{r_3}^2 &amp; \sigma_{r_3 r_4} &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{r_4 r_1} &amp; \sigma_{r_4 r_2} &amp; \sigma_{r_4 r_3} &amp; \sigma_{r_4}^2 &amp; \dots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\

\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \\

0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; \sigma_{r_1}^2 &amp; \sigma_{r_1 r_2} &amp; \sigma_{r_1 r_3} &amp; \sigma_{r_1 r_4} \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; \sigma_{r_2 r_1} &amp; \sigma_{r_2}^2 &amp; \sigma_{r_2 r_3} &amp; \sigma_{r_2 r_4} \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; \sigma_{r_3 r_1} &amp; \sigma_{r_3 r_2} &amp; \sigma_{r_3}^2 &amp; \sigma_{r_3 r_4} \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; \sigma_{r_4 r_1} &amp; \sigma_{r_4 r_2} &amp; \sigma_{r_4 r_3} &amp; \sigma_{r_4}^2
\end{bmatrix}

\end{pmatrix}.
\end{align}\]</span></p>
<p>this kind of structure can be called <em>block diagonal</em>, which means the off-diagonal elements are zero between persons, but allowed to be non-zero within persons (i.e., within blocks). The zero elements between person blocks explicate how the residuals are independent between persons. Notice that the variances on the diagonal vary across the four time points (i.e., <span class="math inline">\(\sigma_{r_1}^2, \dots, \sigma_{r_4}^2\)</span>). Yet also notice that the block for one person is identical to the block for all others. Thus, this model allows for <em>heterogeneity</em> across time within persons, but <em>homogeneity</em> between persons.</p>
<p>We can express this in the more compact notation,</p>
<p><span class="math display">\[\begin{align}
r &amp; \sim \mathcal{N}
\begin{pmatrix} \mathbf 0,

\begin{bmatrix}

\mathbf{\Sigma}_r &amp; \mathbf 0 &amp; \mathbf 0 &amp; \dots &amp; \mathbf 0 \\
\mathbf 0 &amp; \mathbf{\Sigma}_r &amp; \mathbf 0 &amp; \dots &amp; \mathbf 0 \\
\mathbf 0 &amp; \mathbf 0 &amp; \mathbf{\Sigma}_r &amp; \dots &amp; \mathbf 0 \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \mathbf 0 \\
\mathbf 0 &amp; \mathbf 0 &amp; \mathbf 0 &amp; \mathbf 0 &amp; \mathbf{\Sigma}_r

\end{bmatrix}

\end{pmatrix}, \;\;\; \text{where} \\

\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma_{r_1}^2 &amp; \sigma_{r_1 r_2} &amp; \sigma_{r_1 r_3} &amp; \sigma_{r_1 r_4} \\
  \sigma_{r_2 r_1} &amp; \sigma_{r_2}^2 &amp; \sigma_{r_2 r_3} &amp; \sigma_{r_2 r_4} \\
  \sigma_{r_3 r_1} &amp; \sigma_{r_3 r_2} &amp; \sigma_{r_3}^2 &amp; \sigma_{r_3 r_4} \\
  \sigma_{r_4 r_1} &amp; \sigma_{r_4 r_2} &amp; \sigma_{r_4 r_3} &amp; \sigma_{r_4}^2 \end{bmatrix}.

\end{align}\]</span></p>
<p>The bulk of the rest of the material in this chapter will focus around how different models handle <span class="math inline">\(\mathbf{\Sigma}_r\)</span>. The <em>standard</em> multilevel growth model has one way. There are many others.</p>
<section id="variance-of-the-composite-residual" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="variance-of-the-composite-residual"><span class="header-section-number">7.2.1</span> Variance of the composite residual</h3>
<p>Under the conventional multilevel growth model</p>
<p><span class="math display">\[
\begin{align}
\sigma_{r_j}^2 &amp; = \operatorname{Var} \left ( \epsilon_{ij} + \zeta_{0i} + \zeta_{1i} \text{time}_j \right ) \\
&amp; = \sigma_\epsilon^2 + \sigma_0^2 + 2 \sigma_{01} \text{time}_j + \sigma_1^2 \text{time}_j^2.
\end{align}
\]</span></p>
<p>Here’s how to use our posterior samples to compute <span class="math inline">\(\sigma_{r_1}^2, \dots, \sigma_{r_4}^2\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">time =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> time <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">"sigma[italic(r)["</span>, time <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"]]^2"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"marginal posterior"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> ggplot2<span class="sc">:::</span>parse_safe) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">4.2</span>)) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>As is often the case with variance parameters, the posteriors show marked right skew. Here are the numeric summaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">time =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> time <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">"sigma[italic(r)["</span>, time <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"]]^2"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  name                      r .lower .upper .width .point .interval
  &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 sigma[italic(r)[1]]^2 1443.   929.  2365.   0.95 median qi       
2 sigma[italic(r)[2]]^2 1219.   811.  1979.   0.95 median qi       
3 sigma[italic(r)[3]]^2 1209.   813.  1995.   0.95 median qi       
4 sigma[italic(r)[4]]^2 1421.   915.  2431.   0.95 median qi       </code></pre>
</div>
</div>
<p>Though our precise numeric values are different from those in the text, we see the same overall pattern. Using our posterior medians, we can update <span class="math inline">\(\mathbf{\Sigma}_r\)</span> to</p>
<p><span class="math display">\[
\begin{align}
\hat{\mathbf{\Sigma}}_r &amp; = \begin{bmatrix}
  1430 &amp; \hat{\sigma}_{r_1 r_2} &amp; \hat{\sigma}_{r_1 r_3} &amp; \hat{\sigma}_{r_1 r_4} \\
  \hat{\sigma}_{r_2 r_1} &amp; 1201 &amp; \hat{\sigma}_{r_2 r_3} &amp; \hat{\sigma}_{r_2 r_4} \\
  \hat{\sigma}_{r_3 r_1} &amp; \hat{\sigma}_{r_3 r_2} &amp; 1203 &amp; \hat{\sigma}_{r_3 r_4} \\
  \hat{\sigma}_{r_4 r_1} &amp; \hat{\sigma}_{r_4 r_2} &amp; \hat{\sigma}_{r_4 r_3} &amp; 1416 \end{bmatrix}.
\end{align}
\]</span></p>
<blockquote class="blockquote">
<p>For the opposites-naming data, composite residual variance is greatest at the beginning and end of data collection and smaller in between. And, while not outrageously heteroscedastic, this situation is clearly beyond the bland homoscedasticity that we routinely assume for residuals in cross-sectional data. (p.&nbsp;252)</p>
</blockquote>
<p>If you work through the equation at the beginning of this section–which I am not going to do, here–, you’ll see that the standard multilevel growth model is set up such that the residual variance follows a quadratic function with time. To give a sense, here we plot the expected <span class="math inline">\(\sigma_r^2\)</span> values over a wider and more continuous range of time values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>, <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">time =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">4.2</span>, <span class="at">to =</span> <span class="fl">6.6</span>, <span class="at">length.out =</span> <span class="dv">200</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> time <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> r, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(sigma[<span class="fu">italic</span>(r)]<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"50 posterior draws showing the quadratic shape of "</span><span class="sc">*</span>sigma[<span class="fu">italic</span>(r)[time]]<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="456"></p>
</figure>
</div>
</div>
</div>
<p>Since we have 4,000 posterior draws for all the parameters, we also have 4,000 posterior draws for the quadratic curve. Here we just show 50. The curve is at its minimum at <span class="math inline">\(\text{time} = -(\sigma_{01} / \sigma_1^2)\)</span>. Since we have posterior distributions for <span class="math inline">\(\sigma_{01}\)</span> and <span class="math inline">\(\sigma_1^2\)</span>, we’ll also have a posterior distribution for the minimum point. Here it is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">minimum =</span> <span class="sc">-</span><span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> minimum)) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fl">0.95</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"time"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">4.2</span>, <span class="fl">6.6</span>)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Minimum<span class="sc">~</span>value<span class="sc">~</span>(<span class="sc">-</span>sigma[<span class="dv">0</span>][<span class="dv">1</span>]<span class="sc">/</span>sigma[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>If we plug those minimum time values into the equation for <span class="math inline">\(\sigma_{r_\text{time}}^2\)</span>, we’ll get the posterior distribution for the minimum variance value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">minimum =</span> <span class="sc">-</span><span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> minimum <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> minimum<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> r)) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fl">0.95</span>) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(sigma[<span class="fu">italic</span>(r)[time]]<span class="sc">^</span><span class="dv">2</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Minimum variance"</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Here’s the numeric summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">minimum =</span> <span class="sc">-</span><span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> minimum <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> minimum<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
      r .lower .upper .width .point .interval
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 1147.   773.  1853.   0.95 median qi       </code></pre>
</div>
</div>
</section>
<section id="covariance-of-the-composite-residuals" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="covariance-of-the-composite-residuals"><span class="header-section-number">7.2.2</span> Covariance of the composite residuals</h3>
<p>In addition to the variances in <span class="math inline">\(\mathbf{\Sigma}_r\)</span>, we might focus on the off-diagonal covariances, too. We can define the covariance between two time points <span class="math inline">\(\sigma_{r_j, r_{j'}}\)</span> as</p>
<p><span class="math display">\[
\sigma_{r_j, r_{j'}} = \sigma_0^2 + \sigma_{01} (t_j + t_{j'}) + \sigma_1^2 t_j t_{j'},
\]</span></p>
<p>where <span class="math inline">\(\sigma_0^2\)</span>, <span class="math inline">\(\sigma_{01}\)</span> and <span class="math inline">\(\sigma_1^2\)</span> all have their usual interpretation, and <span class="math inline">\(t_j\)</span> and <span class="math inline">\(t_{j'}\)</span> are the numeric values for whatever variable is used to index time in the model, which is <code>time</code> in the case of <code>fit7.1</code>. Here we compute and plot the marginal posteriors for all <span class="math inline">\(4 \times 4 = 16\)</span> parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange the panels</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[italic(r)[1]]^2"</span>, <span class="st">"sigma[italic(r)[1]][italic(r)[2]]"</span>, <span class="st">"sigma[italic(r)[1]][italic(r)[3]]"</span>, <span class="st">"sigma[italic(r)[1]][italic(r)[4]]"</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[italic(r)[2]][italic(r)[1]]"</span>, <span class="st">"sigma[italic(r)[2]]^2"</span>, <span class="st">"sigma[italic(r)[2]][italic(r)[3]]"</span>, <span class="st">"sigma[italic(r)[2]][italic(r)[4]]"</span>, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[italic(r)[3]][italic(r)[1]]"</span>, <span class="st">"sigma[italic(r)[3]][italic(r)[2]]"</span>, <span class="st">"sigma[italic(r)[3]]^2"</span>, <span class="st">"sigma[italic(r)[3]][italic(r)[4]]"</span>, </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[italic(r)[4]][italic(r)[1]]"</span>, <span class="st">"sigma[italic(r)[4]][italic(r)[2]]"</span>, <span class="st">"sigma[italic(r)[4]][italic(r)[3]]"</span>, <span class="st">"sigma[italic(r)[4]]^2"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> sigma <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">0</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">2</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[epsilon]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">3</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[2]][italic(r)[1]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">0</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[3]][italic(r)[1]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">0</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[4]][italic(r)[1]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">3</span> <span class="sc">+</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">0</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[3]][italic(r)[2]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">1</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[4]][italic(r)[2]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">1</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[4]][italic(r)[3]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">3</span> <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[1]][italic(r)[2]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">*</span> <span class="dv">1</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[1]][italic(r)[3]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">0</span> <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[2]][italic(r)[3]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[1]][italic(r)[4]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">0</span> <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">*</span> <span class="dv">3</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[2]][italic(r)[4]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">3</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[3]][italic(r)[4]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[0]^2</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[0][1]</span><span class="st">`</span> <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">3</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"italic"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"marginal posterior"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4000</span>),</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>It might be helpful to reduce the complexity of this plot by focusing on the posterior medians. With a little help from <code>geom_tile()</code> and <code>geom_text()</code>, we’ll make a plot version of the matrix at the top of page 255 in the text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"italic"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"posterior</span><span class="sc">\n</span><span class="st">median"</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(Sigma)[<span class="fu">italic</span>(r)]<span class="sc">*</span><span class="st">" for the standard multilevel model for change"</span>)) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Although our posterior median values differ a bit from the REML values reported in the text, the overall pattern holds. Hopefully the coloring in the plot helps highlight what Singer and Willett described as a “‘band diagonal’ structure, in which the overall magnitude of the residual covariances tends to decline in diagonal ‘bands’ the further you get from the main diagonal” (p.&nbsp;255).</p>
<p>One of the consequences for this structure is that in cases where both <span class="math inline">\(\sigma_1^2 \rightarrow 0\)</span> and <span class="math inline">\(\sigma_{01} \rightarrow 0\)</span>, the residual covariance matrix becomes <em>compound symmetric</em>, which is:</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma_\epsilon^2 + \sigma_0^2 &amp; \sigma_0^2 &amp; \sigma_0^2 &amp; \sigma_0^2 \\
  \sigma_0^2 &amp; \sigma_\epsilon^2 + \sigma_0^2 &amp; \sigma_0^2 &amp; \sigma_0^2 \\
  \sigma_0^2 &amp; \sigma_0^2 &amp; \sigma_\epsilon^2 + \sigma_0^2 &amp; \sigma_0^2 \\
  \sigma_0^2 &amp; \sigma_0^2 &amp; \sigma_0^2 &amp; \sigma_\epsilon^2 + \sigma_0^2 \end{bmatrix}.
\end{align}
\]</span></p>
<blockquote class="blockquote">
<p>Compound symmetric error covariance structures are particularly common in longitudinal data, especially if the slopes of the change trajectories do not differ much asroc people. Regardless of these special cases, however, the most sensible question to ask of your data is whether the error covariance structure that the “standard” multilevel model for change demands is realistic when applied to data in practice? The answer to this question will determine whether the standard model can be applied ubiquitously, as question we soon address. (pp.&nbsp;255–256)</p>
</blockquote>
</section>
<section id="autocorrelation-of-the-composite-residuals" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="autocorrelation-of-the-composite-residuals"><span class="header-section-number">7.2.3</span> Autocorrelation of the composite residuals</h3>
<p>We can use the following equation to convert our <span class="math inline">\(\mathbf{\Sigma}_r\)</span> into a correlation matrix:</p>
<p><span class="math display">\[\rho_{r_j r_{j^\prime}} = \sigma_{r_j r_{j^\prime}} \Big / \sqrt{\sigma_{r_j}^2 \sigma_{r_{j^\prime}}^2}.\]</span></p>
<p>Here we use the formula and plot the posteriors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange the panels</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[italic(r)[1]]"</span>, <span class="st">"rho[italic(r)[1]][italic(r)[2]]"</span>, <span class="st">"rho[italic(r)[1]][italic(r)[3]]"</span>, <span class="st">"rho[italic(r)[1]][italic(r)[4]]"</span>, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho[italic(r)[2]][italic(r)[1]]"</span>, <span class="st">"sigma[italic(r)[2]]"</span>, <span class="st">"rho[italic(r)[2]][italic(r)[3]]"</span>, <span class="st">"rho[italic(r)[2]][italic(r)[4]]"</span>, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho[italic(r)[3]][italic(r)[1]]"</span>, <span class="st">"rho[italic(r)[3]][italic(r)[2]]"</span>, <span class="st">"sigma[italic(r)[3]]"</span>, <span class="st">"rho[italic(r)[3]][italic(r)[4]]"</span>, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho[italic(r)[4]][italic(r)[1]]"</span>, <span class="st">"rho[italic(r)[4]][italic(r)[2]]"</span>, <span class="st">"rho[italic(r)[4]][italic(r)[3]]"</span>, <span class="st">"sigma[italic(r)[4]]"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> sigma <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"italic"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[1]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[2]][italic(r)[1]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[2]][italic(r)[1]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span>),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[3]][italic(r)[1]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[3]][italic(r)[1]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[4]][italic(r)[1]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[4]][italic(r)[1]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span>),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[1]][italic(r)[2]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[1]][italic(r)[2]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span>),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[2]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[3]][italic(r)[2]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[3]][italic(r)[2]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span>),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[4]][italic(r)[2]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[4]][italic(r)[2]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span>),</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[1]][italic(r)[3]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[1]][italic(r)[3]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span>),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[2]][italic(r)[3]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[2]][italic(r)[3]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span>),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[3]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[4]][italic(r)[3]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[4]][italic(r)[3]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span>),</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[1]][italic(r)[4]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[1]][italic(r)[4]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[1]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span>),</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[2]][italic(r)[4]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[2]][italic(r)[4]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[2]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span>),</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">rho[italic(r)[3]][italic(r)[4]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[3]][italic(r)[4]]</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[3]]^2</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span>),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">sigma[italic(r)[4]]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="st">`</span><span class="at">sigma[italic(r)[4]]^2</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">sigma[italic(r)[1]]</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">sigma[italic(r)[4]]</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"marginal posterior"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">/</span> <span class="dv">4</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">".25"</span>, <span class="st">".5"</span>, <span class="st">".75"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>As before, it might be helpful to reduce the complexity of this plot by focusing on the posterior medians. We’ll make a plot version of the correlation matrix in the middle of page 256 in the text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">sigma[italic(r)[1]]</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">sigma[italic(r)[4]]</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"posterior</span><span class="sc">\n</span><span class="st">median"</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(Omega)[<span class="fu">italic</span>(r)]<span class="sc">*</span><span class="st">" for the standard multilevel model for change"</span>)) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The correlation matrix has an even more pronounced band-diagonal structure. Thus even though the standard multilevel model of change does not contain an explicit autocorrelation parameter <span class="math inline">\(\rho\)</span>, the model does account for residual autocorrelation. We might take this even further. Notice the parameters <span class="math inline">\(\rho_{r_2, r_1}\)</span>, <span class="math inline">\(\rho_{r_3, r_2}\)</span>, and <span class="math inline">\(\rho_{r_4, r_3}\)</span> are all autocorrelations of the first order, and further note how similar their posterior medians all are. Here’s a summary of the average of those three parameters, which we’ll just call <span class="math inline">\(\rho\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take the average of the three parameters</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">rho =</span> (<span class="st">`</span><span class="at">rho[italic(r)[2]][italic(r)[1]]</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">rho[italic(r)[3]][italic(r)[2]]</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">rho[italic(r)[4]][italic(r)[3]]</span><span class="st">`</span>) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summarize</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
    rho .lower .upper .width .point .interval
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 0.828  0.740  0.897   0.95 median qi       </code></pre>
</div>
</div>
<p>If you look at the “estimate” column in Table 7.3 (pp.&nbsp;258–259), you’ll see the <span class="math inline">\(\hat \rho\)</span> values for the autoregressive and heterogeneous-autoregressive models are very similar to the <span class="math inline">\(\hat \rho\)</span> posterior we just computed for the standard multilevel model of change. The standard multilevel model of change accounts for autocorrelation, but it does so without an explicit <span class="math inline">\(\rho\)</span> parameter.</p>
</section>
</section>
<section id="postulating-an-alternative-error-covariance-structure" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="postulating-an-alternative-error-covariance-structure"><span class="header-section-number">7.3</span> Postulating an alternative error covariance structure</h2>
<p>Singer and Willett wrote:</p>
<blockquote class="blockquote">
<p>it is easy to specify alternative covariance structures for the composite residual and determine analytically which specification—the “standard” or an alternative—fits best. You already possess the analytic tools and skills needed for this work. (p.&nbsp;257)</p>
</blockquote>
<p>Frequentest <strong>R</strong> users would likely do this with the <a href="https://CRAN.R-project.org/package=nlme"><strong>nlme</strong> package</a> <span class="citation" data-cites="R-nlme">(<a href="references.html#ref-R-nlme" role="doc-biblioref">Pinheiro et al., 2021</a>)</span>. Recent additions to <strong>brms</strong> makes this largely possible, but not completely so. The six error structures listed in this section were:</p>
<ul>
<li>unstructured,</li>
<li>compound symmetric,</li>
<li>heterogeneous compound symmetric,</li>
<li>autoregressive,</li>
<li>heterogeneous autoregressive, and</li>
<li>Toeplitz.</li>
</ul>
<p>The Toeplitz structure is not currently available with <strong>brms</strong>, but we can experiment with the first five. For details, see <a href="https://github.com/paul-buerkner/brms/issues/403">issue #403</a> in the <strong>brms</strong> GitHub repo.</p>
<section id="unstructured-error-covariance-matrix" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="unstructured-error-covariance-matrix"><span class="header-section-number">7.3.1</span> Unstructured error covariance matrix</h3>
<p>Models using an unstructured error covariance matrix include <span class="math inline">\(k (k + 1) / 2\)</span> variance/covariance parameters, where <span class="math inline">\(k\)</span> is the number of time waves in the data. In the case of our <code>opposites_pp</code> data, we can compute the number of parameters as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>k <span class="sc">*</span> (k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<p>We end up with 4 variances and 6 covariances. Following the notation Singer and Willett used in the upper left corner of Table 7.3 (p.&nbsp;258), we can express this as</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma_1^2 &amp; \sigma_{12} &amp; \sigma_{13} &amp; \sigma_{14} \\
  \sigma_{21} &amp; \sigma_2^2 &amp; \sigma_{23} &amp; \sigma_{24} \\
  \sigma_{31} &amp; \sigma_{32} &amp; \sigma_3^2 &amp; \sigma_{34} \\
  \sigma_{41} &amp; \sigma_{42} &amp; \sigma_{43} &amp; \sigma_4^2 \end{bmatrix}.
\end{align}
\]</span></p>
<blockquote class="blockquote">
<p>The great appeal of an unstructured error covariance structure is that it places no restrictions on the structure of <span class="math inline">\(\mathbf{\Sigma}_r\)</span>. For a given set of fixed effects, its deviance statistic will always be the smallest of any error covariance structure. If you have just a few waves of data, this choice can be attractive. But if you have many waves, it can require an exorbitant number of parameters… [However,] the “standard” model requires only 3 variance components (<span class="math inline">\(\sigma_0^2\)</span>, <span class="math inline">\(\sigma_1^2\)</span>, and <span class="math inline">\(\sigma_\epsilon^2\)</span>) and one covariance component, <span class="math inline">\(\sigma_{01}\)</span>. (p.&nbsp;260)</p>
</blockquote>
<p>To fit the unstructured model with <strong>brms</strong>, we use the <code>unstr()</code> function. Notice how we’ve dropped the usual <code>(1 + time | id)</code> syntax. Instead, we indicate the data are temporally structured by the <code>time</code> variable by setting <code>time = time</code> within <code>unstr()</code>, and we indicate the data are grouped by <code>id</code> by setting <code>gr = id</code>, also within <code>unstr()</code>. Also, notice we’ve wrapped the entire model formula within the <code>bf()</code> function. The second line within the <code>bf()</code> function has <code>sigma</code> on the left side of the <code>~</code> operator, which is something we haven’t seen before. With that line, we have allowed the residual variance <span class="math inline">\(\sigma_\epsilon\)</span> to vary across time points. By default, <strong>brms</strong> will use the log link, to insure the model for <span class="math inline">\(\sigma_{\epsilon j}\)</span> will never predict negative variances.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time <span class="sc">+</span> ccog <span class="sc">+</span> time<span class="sc">:</span>ccog <span class="sc">+</span> <span class="fu">unstr</span>(<span class="at">time =</span> time, <span class="at">gr =</span> id),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>     sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(time)),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.02"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.2</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">robust =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = log 
Formula: opp ~ 0 + Intercept + time + ccog + time:ccog + unstr(time = time, gr = id) 
         sigma ~ 0 + factor(time)
   Data: opposites_pp (Number of observations: 140) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Correlation Structures:
             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
cortime(0,1)    0.751     0.070    0.583    0.862 1.000     2317     2772
cortime(0,2)    0.659     0.088    0.441    0.801 1.000     2152     2910
cortime(1,2)    0.807     0.058    0.652    0.897 1.001     2525     2717
cortime(0,3)    0.336     0.140    0.033    0.576 1.001     2290     2824
cortime(1,3)    0.637     0.098    0.408    0.787 1.001     3011     3144
cortime(2,3)    0.735     0.076    0.540    0.848 1.000     2963     3200

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
Intercept          165.505     5.751  154.795  177.194 1.001     3098     3063
time                26.613     2.018   22.366   30.716 1.000     3125     3018
ccog                -0.109     0.462   -1.005    0.810 1.000     3444     2960
time:ccog            0.456     0.163    0.135    0.802 1.000     3233     2746
sigma_factortime0    3.571     0.117    3.357    3.824 1.002     2587     2530
sigma_factortime1    3.458     0.113    3.253    3.688 1.001     2123     2406
sigma_factortime2    3.496     0.106    3.294    3.724 1.002     2196     2410
sigma_factortime3    3.519     0.114    3.313    3.753 1.000     2817     2771

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>There’s a lot of exciting things going on in that output. We’ll start with the bottom 4 rows in the <code>Population-Level Effects</code> section, which contains our the summaries for our <span class="math inline">\(\log (\sigma_{\epsilon j})\)</span> parameters. To get them out of the log metric, we exponentiate. Here’s a quick conversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit7<span class="fl">.2</span>)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">-</span><span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Estimate     Q2.5    Q97.5
sigma_factortime0 35.73391 28.71447 45.80566
sigma_factortime1 31.88199 25.87892 39.96905
sigma_factortime2 33.09534 26.93729 41.44291
sigma_factortime3 33.87613 27.47317 42.65918</code></pre>
</div>
</div>
<p>Now let’s address the new <code>Correlation Structures</code> section of the <code>print()</code> output. Just as <strong>brms</strong> decomposes the typical multilevel model level-2 variance/covariance matrix <span class="math inline">\(\mathbf{\Sigma}\)</span> as</p>
<p><span class="math display">\[
\begin{align}
\mathbf \Sigma &amp; = \mathbf D \mathbf \Omega \mathbf D, \text{where} \\
\mathbf D      &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \text{and} \\
\mathbf \Omega &amp; = \begin{bmatrix} 1 &amp; \rho \\ \rho &amp; 1 \end{bmatrix},
\end{align}
\]</span></p>
<p>the same kind of thing happens when we fit a model with an unstructured variance/covariance matrix with the <code>unstr()</code> function. The <code>print()</code> output returned posterior summaries for the elements of the correlation matrix <span class="math inline">\(\mathbf \Omega\)</span> in the <code>Correlation Structures</code> section, and it returned posterior summaries for the elements of the diagonal matrix of standard deviations <span class="math inline">\(\mathbf D\)</span> in the last four rows of the <code>Population-Level Effects</code> section. But notice that instead of <span class="math inline">\(2 \times 2\)</span> matrices like we got with our conventional growth model <code>fit7.1</code>, both <span class="math inline">\(\mathbf D\)</span> and <span class="math inline">\(\mathbf \Omega\)</span> are now <span class="math inline">\(4 \times 4\)</span> matrices right out of the gate. Thus if we use the posterior medians from the <code>print()</code> output as our point estimates, we can express the <span class="math inline">\(\hat{\mathbf \Sigma}\)</span> matrix from our unstructured <code>fit7.2</code> model as</p>
<p><span class="math display">\[
\begin{align}
\mathbf \Sigma &amp; = \mathbf D \mathbf \Omega \mathbf D \\
\hat{\mathbf D} &amp; = \begin{bmatrix}
  35.6 &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 31.6  &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 33.0 &amp; 0 \\
  0 &amp; 0 &amp; 0 &amp; 33.7
  \end{bmatrix} \\
\hat{\mathbf \Omega} &amp; = \begin{bmatrix}
  1 &amp; .75 &amp; .66 &amp; .33 \\
  .75 &amp; 1 &amp; .81 &amp; .64 \\
  .66 &amp; .81 &amp; 1 &amp; .73 \\
  .33 &amp; .64 &amp; .73 &amp; 1
  \end{bmatrix}.
\end{align}
\]</span></p>
<p>Here’s how to compute and summarize the <span class="math inline">\(\mathbf D\)</span> and <span class="math inline">\(\mathbf \Omega\)</span> parameters with the <code>as_draws_df()</code> output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sigma.us <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime0),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime1),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime2),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime3),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[12]</span><span class="st">`</span> <span class="ot">=</span> cortime__0__1,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[13]</span><span class="st">`</span> <span class="ot">=</span> cortime__0__2,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[14]</span><span class="st">`</span> <span class="ot">=</span> cortime__0__3,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[23]</span><span class="st">`</span> <span class="ot">=</span> cortime__1__2,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[24]</span><span class="st">`</span> <span class="ot">=</span> cortime__1__3,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[34]</span><span class="st">`</span> <span class="ot">=</span> cortime__2__3,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[21]</span><span class="st">`</span> <span class="ot">=</span> cortime__0__1, </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[31]</span><span class="st">`</span> <span class="ot">=</span> cortime__0__2, </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[32]</span><span class="st">`</span> <span class="ot">=</span> cortime__1__2, </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[41]</span><span class="st">`</span> <span class="ot">=</span> cortime__0__3, </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[42]</span><span class="st">`</span> <span class="ot">=</span> cortime__1__3, </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">rho[43]</span><span class="st">`</span> <span class="ot">=</span> cortime__2__3)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>sigma.us <span class="sc">%&gt;%</span> </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 7
   name     value .lower .upper .width .point .interval
   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
 1 rho[12]   0.75   0.58   0.86   0.95 median qi       
 2 rho[13]   0.66   0.44   0.8    0.95 median qi       
 3 rho[14]   0.34   0.03   0.58   0.95 median qi       
 4 rho[21]   0.75   0.58   0.86   0.95 median qi       
 5 rho[23]   0.81   0.65   0.9    0.95 median qi       
 6 rho[24]   0.64   0.41   0.79   0.95 median qi       
 7 rho[31]   0.66   0.44   0.8    0.95 median qi       
 8 rho[32]   0.81   0.65   0.9    0.95 median qi       
 9 rho[34]   0.73   0.54   0.85   0.95 median qi       
10 rho[41]   0.34   0.03   0.58   0.95 median qi       
11 rho[42]   0.64   0.41   0.79   0.95 median qi       
12 rho[43]   0.73   0.54   0.85   0.95 median qi       
13 sigma[1] 35.6   28.7   45.8    0.95 median qi       
14 sigma[2] 31.8   25.9   40.0    0.95 median qi       
15 sigma[3] 33.0   26.9   41.4    0.95 median qi       
16 sigma[4] 33.8   27.5   42.7    0.95 median qi       </code></pre>
</div>
</div>
<p>Since Singer and Willett preferred the variance/covariance parameterization for <span class="math inline">\(\mathbf \Sigma\)</span>, we’ll practice wrangling the posterior draws to transform our results into that metric, too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>sigma.us <span class="ot">&lt;-</span> sigma.us <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[12]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[12]</span><span class="st">`</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[13]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[13]</span><span class="st">`</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[14]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[14]</span><span class="st">`</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[21]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[21]</span><span class="st">`</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[2]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[23]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[23]</span><span class="st">`</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[24]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[24]</span><span class="st">`</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[31]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[31]</span><span class="st">`</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[32]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[32]</span><span class="st">`</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[3]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[34]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[34]</span><span class="st">`</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[41]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[41]</span><span class="st">`</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[42]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[42]</span><span class="st">`</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[43]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho[43]</span><span class="st">`</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[4]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>sigma.us <span class="sc">%&gt;%</span> </span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 7
   name       value .lower .upper .width .point .interval
   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
 1 sigma[1]^2 1264.  825.   2098.   0.95 median qi       
 2 sigma[12]   840.  503.   1438.   0.95 median qi       
 3 sigma[13]   765.  429.   1321.   0.95 median qi       
 4 sigma[14]   393.   40.5   846.   0.95 median qi       
 5 sigma[2]^2 1008.  670.   1598.   0.95 median qi       
 6 sigma[21]   840.  503.   1438.   0.95 median qi       
 7 sigma[23]   841.  520.   1390.   0.95 median qi       
 8 sigma[24]   677.  367.   1176.   0.95 median qi       
 9 sigma[3]^2 1087.  726.   1718.   0.95 median qi       
10 sigma[31]   765.  429.   1321.   0.95 median qi       
11 sigma[32]   841.  520.   1390.   0.95 median qi       
12 sigma[34]   806.  484.   1375.   0.95 median qi       
13 sigma[4]^2 1139.  755.   1820.   0.95 median qi       
14 sigma[41]   393.   40.5   846.   0.95 median qi       
15 sigma[42]   677.  367.   1176.   0.95 median qi       
16 sigma[43]   806.  484.   1375.   0.95 median qi       </code></pre>
</div>
</div>
<p>But again, I suspect it will be easier to appreciate our posterior <span class="math inline">\(\hat{\mathbf \Sigma}\)</span> in a tile plot. Here’s a summary using the posterior medians, similar to what Singer and Willett reported in the rightmost column of Table 7.3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[1]^2"</span>, <span class="st">"sigma[12]"</span>, <span class="st">"sigma[13]"</span>, <span class="st">"sigma[14]"</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[21]"</span>, <span class="st">"sigma[2]^2"</span>, <span class="st">"sigma[23]"</span>, <span class="st">"sigma[24]"</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[31]"</span>, <span class="st">"sigma[32]"</span>, <span class="st">"sigma[3]^2"</span>, <span class="st">"sigma[34]"</span>, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[41]"</span>, <span class="st">"sigma[42]"</span>, <span class="st">"sigma[43]"</span>, <span class="st">"sigma[4]^2"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>sigma.us <span class="sc">%&gt;%</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">color =</span> value <span class="sc">&lt;</span> <span class="dv">1</span>),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"posterior</span><span class="sc">\n</span><span class="st">median"</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(Sigma)[<span class="fu">italic</span>(r)]<span class="sc">*</span><span class="st">" for the unstructured model"</span>)) <span class="sc">+</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>In case you’re curious, here’s the variance/covariance matrix from the sample data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.2</span><span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, time, opp) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time, <span class="at">values_from =</span> opp) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     0    1    2    3
0 1309  976  922  563
1  976 1125 1021  855
2  922 1021 1292 1081
3  563  855 1081 1415</code></pre>
</div>
</div>
<p>The <strong>brms</strong> default priors are weakly regularizing, particularly the LKJ prior for the correlation matrix <span class="math inline">\(\mathbf \Omega\)</span>, and I believe this is why the values from our model are systemically lower that the sample statistics. If you find this upsetting, collect more data, which hill help the likelihood dominate the prior.</p>
</section>
<section id="compound-symmetric-error-covariance-matrix" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="compound-symmetric-error-covariance-matrix"><span class="header-section-number">7.3.2</span> Compound symmetric error covariance matrix</h3>
<p>“A <em>compound symmetric</em> error covariance matrix requires just two parameters, labeled <span class="math inline">\(\sigma^2\)</span> and <span class="math inline">\(\sigma_1^2\)</span> in table 7.3” (p.&nbsp;260). From the table, we see that matrix follows the form</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma^2 + \sigma_1^2 &amp; \sigma_1^2 &amp; \sigma_1^2 &amp; \sigma_1^2 \\
  \sigma_1^2 &amp; \sigma^2 + \sigma_1^2 &amp; \sigma_1^2 &amp; \sigma_1^2 \\
  \sigma_1^2 &amp; \sigma_1^2 &amp; \sigma^2 + \sigma_1^2 &amp; \sigma_1^2 \\
  \sigma_1^2 &amp; \sigma_1^2 &amp; \sigma_1^2 &amp; \sigma^2 + \sigma_1^2 \end{bmatrix},
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\sigma_1^2\)</span> does not have the same meaning we’ve become accustomed to (i.e., the level-2 variance in linear change over time). The meaning of <span class="math inline">\(\sigma^2\)</span> might also be a little opaque. Happily, there’s another way to express this matrix, which is a modification of the heterogeneous compound symmetric matrix we see listed in Table 7.3. That alternative is:</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma_\epsilon^2 &amp; \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 \rho \\
  \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 &amp; \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 \rho \\
  \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 &amp; \sigma_\epsilon^2 \rho \\
  \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 \rho &amp; \sigma_\epsilon^2 \end{bmatrix},
\end{align}
\]</span></p>
<p>where the term on the diagonal, <span class="math inline">\(\sigma_\epsilon^2\)</span>, is the residual variance, which is constrained to equality across all four time points. In all cells in the off-diagonal, we see <span class="math inline">\(\sigma_\epsilon^2\)</span> multiplied by <span class="math inline">\(\rho\)</span>. In this parameterization, <span class="math inline">\(\rho\)</span> is the correlation between time points, and that correlation is constrained to equality across all possible pairs of time points. Although this notation is a little different from the notation used in the text, I believe it will help us interpret our model. As we’ll see, <strong>brms</strong> uses this alternative parameterization.</p>
<p>To fit the compound symmetric model with <strong>brms</strong>, we use the <code>cosy()</code> function. Notice how like with the unstructured model <code>fit7.2</code>, we’ve dropped the usual <code>(1 + time | id)</code> syntax. Instead, we impose compound symmetry <em>within persons</em> by setting <code>gr = id</code> within <code>cosy()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time <span class="sc">+</span> ccog <span class="sc">+</span> time<span class="sc">:</span>ccog <span class="sc">+</span> <span class="fu">cosy</span>(<span class="at">gr =</span> id),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.03"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the model summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.3</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: opp ~ 0 + Intercept + time + ccog + time:ccog + cosy(gr = id) 
   Data: opposites_pp (Number of observations: 140) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Correlation Structures:
     Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
cosy    0.723     0.059    0.602    0.829 1.001     2590     2657

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
Intercept  164.376     5.728  152.970  175.620 1.000     3406     2479
time        26.972     1.410   24.149   29.661 1.001     3687     2962
ccog        -0.102     0.472   -1.022    0.815 1.001     3519     3006
time:ccog    0.431     0.112    0.214    0.657 1.000     3931     3225

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
sigma   35.528     3.524   29.654   43.530 1.002     2662     2594

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>See that new <code>cosy</code> row? That’s <span class="math inline">\(\rho\)</span>, the residual correlation among the time points. The <code>sigma</code> row on the bottom has it’s typical interpretation, it’s the residual standard deviation, what we typically call <span class="math inline">\(\sigma_\epsilon\)</span>. Square it and you’ll have what we called <span class="math inline">\(\sigma_\epsilon^2\)</span> in the matrix, above. Okay, since our <strong>brms</strong> model is parameterized differently from what Singer and Willett reported in the text (see Table 7.3, p.&nbsp;258), we’ll wrangle the posterior draws a bit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>sigma.cs <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">rho                    =</span> cosy,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">sigma_e                =</span> sigma,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma^2 + sigma[1]^2</span><span class="st">`</span> <span class="ot">=</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="ot">=</span> rho <span class="sc">*</span> sigma_e<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">sigma^2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma^2 + sigma[1]^2</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># what did we do?</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sigma.cs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
    rho sigma_e `sigma^2 + sigma[1]^2` `sigma[1]^2` `sigma^2`
  &lt;dbl&gt;   &lt;dbl&gt;                  &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
1 0.641    32.5                  1054.         675.      379.
2 0.649    30.9                   954.         619.      334.
3 0.684    33.4                  1115.         763.      352.
4 0.713    38.3                  1463.        1044.      420.
5 0.807    36.8                  1354.        1093.      261.
6 0.756    39.4                  1551.        1172.      379.</code></pre>
</div>
</div>
<p>Here’s the numeric summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sigma.cs <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  name                   value .lower  .upper .width .point .interval
  &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 rho                     0.73    0.6    0.83   0.95 median qi       
2 sigma_e                35.2    29.6   43.5    0.95 median qi       
3 sigma[1]^2            899.    553.  1542.     0.95 median qi       
4 sigma^2               336.    261.   451.     0.95 median qi       
5 sigma^2 + sigma[1]^2 1240.    879.  1895.     0.95 median qi       </code></pre>
</div>
</div>
<p>To simplify, we might pull the posterior medians for <span class="math inline">\(\sigma^2 + \sigma_1^2\)</span> and <span class="math inline">\(\sigma_1^2\)</span>. We’ll call them <code>diagonal</code> and <code>off_diagonal</code>, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>diagonal <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.cs<span class="sc">$</span><span class="st">`</span><span class="at">sigma^2 + sigma[1]^2</span><span class="st">`</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>off_diagonal <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.cs<span class="sc">$</span><span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have them, we can make our colored version of the <span class="math inline">\(\mathbf{\Sigma}_r\)</span> Singer and Willett reported in the rightmost column of Table 7.3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">if_else</span>(row <span class="sc">==</span> col, diagonal, off_diagonal)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="at">digits =</span> <span class="dv">0</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">fct_rev</span>(col)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> row, <span class="at">y =</span> col)) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"posterior</span><span class="sc">\n</span><span class="st">median"</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">"top"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(Sigma)[<span class="fu">italic</span>(r)]<span class="sc">*</span><span class="st">" for the compound symmetric model"</span>)) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heterogeneous-compound-symmetric-error-covariance-matrix" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="heterogeneous-compound-symmetric-error-covariance-matrix"><span class="header-section-number">7.3.3</span> Heterogeneous compound symmetric error covariance matrix</h3>
<p>Now we extend the compound symmetric matrix by allowing the residual variances to vary across the time waves. Thus, instead of a single <span class="math inline">\(\sigma_\epsilon^2\)</span> parameter, we’ll have <span class="math inline">\(\sigma_1^2\)</span> through <span class="math inline">\(\sigma_4^2\)</span>. However, we still have a single correlation parameter <span class="math inline">\(\rho\)</span>. We can express this as</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma_1^2 &amp; \sigma_1 \sigma_2 \rho &amp; \sigma_1 \sigma_3 \rho &amp; \sigma_1 \sigma_4 \rho \\
  \sigma_2 \sigma_1 \rho &amp; \sigma_1^2 &amp; \sigma_2 \sigma_3 \rho &amp; \sigma_2 \sigma_4 \rho \\
  \sigma_3 \sigma_1 \rho &amp; \sigma_3 \sigma_2 \rho &amp; \sigma_3^2 &amp; \sigma_3 \sigma_4 \rho \\
  \sigma_4 \sigma_1 \rho &amp; \sigma_4 \sigma_2 \rho &amp; \sigma_4 \sigma_3 \rho &amp; \sigma_4^2 \end{bmatrix},
\end{align}
\]</span></p>
<p>where, even though the correlation is the same in all cells, the covariances will differ because they are based on different combinations of the <span class="math inline">\(\sigma\)</span> parameters. To fit this model with <strong>brms</strong>, we will continue to use <code>cosy(gr = id)</code>. But now we wrap the entire model <code>formula</code> within the <code>bf()</code> function and allow the residual standard deviations to vary across he waves with the line <code>sigma ~ 0 + factor(time)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time <span class="sc">+</span> ccog <span class="sc">+</span> time<span class="sc">:</span>ccog <span class="sc">+</span> <span class="fu">cosy</span>(<span class="at">gr =</span> id),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>     sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(time)), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.04"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.4</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = log 
Formula: opp ~ 0 + Intercept + time + ccog + time:ccog + cosy(gr = id) 
         sigma ~ 0 + factor(time)
   Data: opposites_pp (Number of observations: 140) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Correlation Structures:
     Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
cosy    0.720     0.060    0.592    0.830 1.005     1704     1837

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
Intercept          164.415     5.682  153.560  175.795 1.000     3690     2738
time                26.905     1.502   23.950   29.849 1.002     3800     2933
ccog                -0.179     0.463   -1.085    0.718 1.002     3251     2619
time:ccog            0.440     0.118    0.213    0.673 1.002     3958     2884
sigma_factortime0    3.641     0.124    3.417    3.902 1.005     2012     2178
sigma_factortime1    3.494     0.119    3.272    3.742 1.003     1843     2362
sigma_factortime2    3.529     0.121    3.306    3.774 1.002     2065     2370
sigma_factortime3    3.593     0.125    3.361    3.853 1.003     1955     2295

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>If you look at the second row in the output, you’ll see that the <strong>brms</strong> default was to model <span class="math inline">\(\log(\sigma_j)\)</span>. Thus, you’ll have to exponentiate those posteriors to get them in their natural metric. Here’s a quick conversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit7<span class="fl">.4</span>)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">-</span><span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Estimate     Q2.5    Q97.5
sigma_factortime0 38.14764 30.48905 49.51246
sigma_factortime1 32.91011 26.35654 42.19741
sigma_factortime2 34.10152 27.28920 43.53938
sigma_factortime3 36.34854 28.81602 47.13603</code></pre>
</div>
</div>
<p>To get the marginal posteriors for the full <span class="math inline">\(\mathbf{\Sigma}_r\)</span> matrix, we’ll want to work directly with the output from <code>as_draws_df()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>sigma.hcs <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime0),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime1),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime2),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime3),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho          =</span> cosy,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime0)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[2]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime1)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[3]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime2)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma[4]^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_sigma_factortime3)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">sigma[2]*sigma[1]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[3]*sigma[1]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[4]*sigma[1]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[1]*sigma[2]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[3]*sigma[2]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[4]*sigma[2]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[1]*sigma[3]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[2]*sigma[3]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[4]*sigma[3]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[1]*sigma[4]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[1]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[2]*sigma[4]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[2]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> rho,</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">sigma[3]*sigma[4]*rho</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">sigma[3]</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">sigma[4]</span><span class="st">`</span> <span class="sc">*</span> rho)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a><span class="co"># what did we do?</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sigma.hcs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,000
Columns: 21
$ `sigma[1]`              &lt;dbl&gt; 35.56208, 35.57836, 33.08933, 40.70314, 30.48914, 32.99203, 37.94815, 34.25566, 35.42878, 35.996…
$ `sigma[2]`              &lt;dbl&gt; 33.89407, 27.96338, 30.16567, 31.72296, 29.12656, 31.00532, 30.26289, 32.73009, 26.74998, 29.142…
$ `sigma[3]`              &lt;dbl&gt; 32.12802, 32.03955, 28.60996, 33.40432, 29.84702, 30.76859, 35.32730, 28.68270, 28.11751, 26.272…
$ `sigma[4]`              &lt;dbl&gt; 35.59806, 32.35704, 35.97292, 35.62483, 35.83509, 35.78706, 38.32063, 30.29754, 29.57775, 29.713…
$ rho                     &lt;dbl&gt; 0.6875016, 0.6944474, 0.6521933, 0.6996793, 0.6928762, 0.7100510, 0.7489264, 0.5943043, 0.684699…
$ `sigma[1]^2`            &lt;dbl&gt; 1264.6614, 1265.8195, 1094.9037, 1656.7458, 929.5879, 1088.4742, 1440.0624, 1173.4503, 1255.1984…
$ `sigma[2]^2`            &lt;dbl&gt; 1148.8083, 781.9504, 909.9677, 1006.3460, 848.3564, 961.3296, 915.8427, 1071.2586, 715.5612, 849…
$ `sigma[3]^2`            &lt;dbl&gt; 1032.2095, 1026.5327, 818.5296, 1115.8487, 890.8449, 946.7061, 1248.0183, 822.6971, 790.5946, 69…
$ `sigma[4]^2`            &lt;dbl&gt; 1267.2221, 1046.9782, 1294.0513, 1269.1287, 1284.1537, 1280.7136, 1468.4711, 917.9409, 874.8432,…
$ `sigma[2]*sigma[1]*rho` &lt;dbl&gt; 828.6758, 690.8995, 650.9944, 903.4427, 615.3044, 726.3313, 860.0828, 666.3285, 648.9028, 699.77…
$ `sigma[3]*sigma[1]*rho` &lt;dbl&gt; 785.4975, 791.6107, 617.4211, 951.3265, 630.5244, 720.7857, 1004.0152, 583.9306, 682.0767, 630.8…
$ `sigma[4]*sigma[1]*rho` &lt;dbl&gt; 870.3366, 799.4551, 776.3187, 1014.5648, 757.0235, 838.3485, 1089.0868, 616.8060, 717.4991, 713.…
$ `sigma[1]*sigma[2]*rho` &lt;dbl&gt; 828.6758, 690.8995, 650.9944, 903.4427, 615.3044, 726.3313, 860.0828, 666.3285, 648.9028, 699.77…
$ `sigma[3]*sigma[2]*rho` &lt;dbl&gt; 748.6545, 622.1790, 562.8679, 741.4388, 602.3458, 677.3814, 800.6820, 557.9252, 514.9919, 510.74…
$ `sigma[4]*sigma[2]*rho` &lt;dbl&gt; 829.5143, 628.3445, 707.7259, 790.7251, 723.1915, 787.8648, 868.5249, 589.3366, 541.7371, 577.63…
$ `sigma[1]*sigma[3]*rho` &lt;dbl&gt; 785.4975, 791.6107, 617.4211, 951.3265, 630.5244, 720.7857, 1004.0152, 583.9306, 682.0767, 630.8…
$ `sigma[2]*sigma[3]*rho` &lt;dbl&gt; 748.6545, 622.1790, 562.8679, 741.4388, 602.3458, 677.3814, 800.6820, 557.9252, 514.9919, 510.74…
$ `sigma[4]*sigma[3]*rho` &lt;dbl&gt; 786.2923, 719.9372, 671.2268, 832.6347, 741.0801, 781.8494, 1013.8701, 516.4594, 569.4323, 520.7…
$ `sigma[1]*sigma[4]*rho` &lt;dbl&gt; 870.3366, 799.4551, 776.3187, 1014.5648, 757.0235, 838.3485, 1089.0868, 616.8060, 717.4991, 713.…
$ `sigma[2]*sigma[4]*rho` &lt;dbl&gt; 829.5143, 628.3445, 707.7259, 790.7251, 723.1915, 787.8648, 868.5249, 589.3366, 541.7371, 577.63…
$ `sigma[3]*sigma[4]*rho` &lt;dbl&gt; 786.2923, 719.9372, 671.2268, 832.6347, 741.0801, 781.8494, 1013.8701, 516.4594, 569.4323, 520.7…</code></pre>
</div>
</div>
<p>Here’s the numeric summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sigma.hcs <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 7
   name                    value .lower  .upper .width .point .interval
   &lt;chr&gt;                   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
 1 rho                      0.72   0.59    0.83   0.95 median qi       
 2 sigma[1]                38.0   30.5    49.5    0.95 median qi       
 3 sigma[1]*sigma[2]*rho  896.   535.   1609.     0.95 median qi       
 4 sigma[1]*sigma[3]*rho  930.   556.   1655.     0.95 median qi       
 5 sigma[1]*sigma[4]*rho  990.   589.   1795.     0.95 median qi       
 6 sigma[1]^2            1447.   930.   2451.     0.95 median qi       
 7 sigma[2]                32.8   26.4    42.2    0.95 median qi       
 8 sigma[2]*sigma[1]*rho  896.   535.   1609.     0.95 median qi       
 9 sigma[2]*sigma[3]*rho  796.   479.   1425.     0.95 median qi       
10 sigma[2]*sigma[4]*rho  853.   509.   1517.     0.95 median qi       
# ℹ 11 more rows</code></pre>
</div>
</div>
<p>That’s a lot of information to wade through. Here we simplify the picture by making our plot version of the matrix Singer and Willett reported in the rightmost column of Table 7.3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange the panels</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[1]^2"</span>, <span class="st">"sigma[1]*sigma[2]*rho"</span>, <span class="st">"sigma[1]*sigma[3]*rho"</span>, <span class="st">"sigma[1]*sigma[4]*rho"</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[2]*sigma[1]*rho"</span>, <span class="st">"sigma[2]^2"</span>, <span class="st">"sigma[2]*sigma[3]*rho"</span>, <span class="st">"sigma[2]*sigma[4]*rho"</span>, </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[3]*sigma[1]*rho"</span>, <span class="st">"sigma[3]*sigma[2]*rho"</span>, <span class="st">"sigma[3]^2"</span>, <span class="st">"sigma[3]*sigma[4]*rho"</span>, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma[4]*sigma[1]*rho"</span>, <span class="st">"sigma[4]*sigma[2]*rho"</span>, <span class="st">"sigma[4]*sigma[3]*rho"</span>, <span class="st">"sigma[4]^2"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>sigma.hcs <span class="sc">%&gt;%</span> </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">sigma[1]^2</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">sigma[3]*sigma[4]*rho</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"posterior</span><span class="sc">\n</span><span class="st">median"</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(Sigma)[<span class="fu">italic</span>(r)]<span class="sc">*</span><span class="st">" for the heterogeneous compound symmetric model"</span>)) <span class="sc">+</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="autoregressive-error-covariance-matrix" class="level3" data-number="7.3.4">
<h3 data-number="7.3.4" class="anchored" data-anchor-id="autoregressive-error-covariance-matrix"><span class="header-section-number">7.3.4</span> Autoregressive error covariance matrix</h3>
<p>The first-order autoregressive has a strict “band-diagonal” structure governed by two parameters, which Singer and Willett called <span class="math inline">\(\sigma^2\)</span> and <span class="math inline">\(\rho\)</span>. From Table 7.3 (p.&nbsp;260), we see that matrix follows the form</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma^2 &amp; \sigma^2 \rho &amp; \sigma^2 \rho^2 &amp; \sigma^2 \rho^3 \\
  \sigma^2 \rho &amp; \sigma^2 &amp; \sigma^2 \rho &amp; \sigma^2 \rho^2 \\
  \sigma^2 \rho^2 &amp; \sigma^2 \rho &amp; \sigma^2 &amp; \sigma^2 \rho \\
  \sigma^2 \rho^3 &amp; \sigma^2 \rho^2 &amp; \sigma^2 \rho &amp; \sigma^2 \end{bmatrix},
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\rho\)</span> is the correlation of one time point to the one immediately before or after, after conditioning on the liner model. In a similar way, <span class="math inline">\(\rho^2\)</span> is the correlation between time points with one degree of separation (e.g., time 1 with time 3) and <span class="math inline">\(\rho^3\)</span> is the correlation between the first and fourth time point. The other parameter, <span class="math inline">\(\sigma^2\)</span> is the residual variance after conditioning on the linear model.</p>
<p>Once can fit this model with <strong>brms</strong> using a version of the <code>ar()</code> syntax. However, the model will follow a slightly different parameterization, following the form:</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho^2 &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho^3 \\
  \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho^2 \\
  \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho^2 &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho \\
  \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho^3 &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho^2 &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2 \rho &amp; \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2
  \end{bmatrix},\\
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\sigma_\epsilon\)</span> is the residual variance after conditioning on both the linear model AND the autoregressive correlation <span class="math inline">\(\rho\)</span>. It’s not clear to me why <strong>brms</strong> is parameterized this way, but this is what we’ve got. The main point to get is that what Singer and Willett called <span class="math inline">\(\sigma\)</span> in their autoregressive model, we’ll have to call <span class="math inline">\(\sigma_\epsilon \Big / \sqrt{1 - \rho^2}\)</span>. Thus, if you substitute our verbose <strong>brms</strong> term <span class="math inline">\(\sigma_\epsilon \Big / \sqrt{1 - \rho^2}\)</span> for Singer and Willett’s compact term <span class="math inline">\(\sigma\)</span>, you’ll see the hellish matrix above is the same as the much simpler one before it.</p>
<p>To fit the first-order autoregressive model with <strong>brms</strong>, we use the <code>ar()</code> function. As with the last few models, notice how we continue to omit the <code>(1 + time | id)</code> syntax. Instead, we impose the autoregressive structure <em>within persons</em> by setting <code>gr = id</code> within <code>ar()</code>. We also set <code>cov = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time <span class="sc">+</span> ccog <span class="sc">+</span> time<span class="sc">:</span>ccog <span class="sc">+</span> <span class="fu">ar</span>(<span class="at">gr =</span> id, <span class="at">cov =</span> <span class="cn">TRUE</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.05"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.5</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: opp ~ 0 + Intercept + time + ccog + time:ccog + ar(gr = id, cov = TRUE) 
   Data: opposites_pp (Number of observations: 140) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Correlation Structures:
      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
ar[1]    0.816     0.041    0.731    0.888 1.001     4530     3265

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
Intercept  164.193     6.037  152.037  176.006 1.000     4923     3328
time        27.227     1.856   23.603   30.875 1.000     5013     3664
ccog        -0.039     0.480   -0.998    0.899 1.000     5030     3189
time:ccog    0.423     0.152    0.118    0.727 1.000     5223     3356

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
sigma   20.316     1.395   17.797   23.198 1.002     4379     3131

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>The <code>ar[1]</code> row in our summary is <span class="math inline">\(\rho\)</span>. As we discussed just before fitting the model, the <code>sigma</code> line is the summary for what I’m calling <span class="math inline">\(\sigma_\epsilon\)</span>, which is the residual standard deviation after conditioning on both the linear model AND <span class="math inline">\(\rho\)</span>. If we rename the <span class="math inline">\(\sigma^2\)</span> parameter in the text as <span class="math inline">\(\sigma_\text{Singer \&amp; Willett (2003)}^2\)</span>, we can convert our <span class="math inline">\(\sigma_\epsilon\)</span> parameter to that metric using the formula</p>
<p><span class="math display">\[\sigma_\text{Singer \&amp; Willett (2003)}^2 = \left (\sigma_\epsilon \Big / \sqrt{1 - \rho^2} \right )^2.\]</span></p>
<p>With that formula in hand, we’re ready to compute the marginal posteriors for the full <span class="math inline">\(\mathbf{\Sigma}_r\)</span> matrix, saving the results as <code>sigma.ar</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>sigma.ar <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_e =</span> sigma,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma   =</span> sigma_e <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">ar[1]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">rho             =</span> <span class="st">`</span><span class="at">ar[1]</span><span class="st">`</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma^2</span><span class="st">`</span>       <span class="ot">=</span> sigma<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma^2 rho</span><span class="st">`</span>   <span class="ot">=</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> rho,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma^2 rho^2</span><span class="st">`</span> <span class="ot">=</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> rho<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma^2 rho^3</span><span class="st">`</span> <span class="ot">=</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> rho<span class="sc">^</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s the numeric summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>sigma.ar <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  name            value .lower  .upper .width .point .interval
  &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
1 rho              0.82   0.73    0.89   0.95 median qi       
2 sigma^2       1252.   890.   1912.     0.95 median qi       
3 sigma^2 rho   1023.   668.   1664.     0.95 median qi       
4 sigma^2 rho^2  838.   496.   1471.     0.95 median qi       
5 sigma^2 rho^3  686.   365.   1298.     0.95 median qi       </code></pre>
</div>
</div>
<p>To simplify, we might pull the posterior medians for <span class="math inline">\(\sigma^2\)</span> through <span class="math inline">\(\sigma^2 \rho^3\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>s2   <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.ar<span class="sc">$</span><span class="st">`</span><span class="at">sigma^2</span><span class="st">`</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>s2p  <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.ar<span class="sc">$</span><span class="st">`</span><span class="at">sigma^2 rho</span><span class="st">`</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>s2p2 <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.ar<span class="sc">$</span><span class="st">`</span><span class="at">sigma^2 rho^2</span><span class="st">`</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>s2p3 <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.ar<span class="sc">$</span><span class="st">`</span><span class="at">sigma^2 rho^3</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have them, we can make our colored version of the <span class="math inline">\(\mathbf{\Sigma}_r\)</span> Singer and Willett reported in the rightmost column of Table 7.3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">c</span>(s2, s2p, s2p2, s2p3,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                   s2p, s2, s2p, s2p2,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                   s2p2, s2p, s2, s2p,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                   s2p3, s2p2, s2p, s2)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="at">digits =</span> <span class="dv">0</span>),</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">col   =</span> <span class="fu">fct_rev</span>(col)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> row, <span class="at">y =</span> col)) <span class="sc">+</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"posterior</span><span class="sc">\n</span><span class="st">median"</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">"top"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(Sigma)[<span class="fu">italic</span>(r)]<span class="sc">*</span><span class="st">" for the autoregressive model"</span>)) <span class="sc">+</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>With this presentation, that strict band-diagonal structure really pops.</p>
</section>
<section id="heterogeneous-autoregressive-error-covariance-matrix" class="level3" data-number="7.3.5">
<h3 data-number="7.3.5" class="anchored" data-anchor-id="heterogeneous-autoregressive-error-covariance-matrix"><span class="header-section-number">7.3.5</span> Heterogeneous autoregressive error covariance matrix</h3>
<p>For the heterogeneous autoregressive error covariance matrix, we relax the assumption that the variances on the diagonal of the <span class="math inline">\(\mathbf{\Sigma}_r\)</span> matrix are constant across waves. From Table 7.3 (p.&nbsp;260), we see that matrix follows the form</p>
<p><span class="math display">\[
\begin{align}
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma_1^2 &amp; \sigma_1 \sigma_2 \rho &amp; \sigma_1 \sigma_3 \rho^2 &amp; \sigma_1 \sigma_4 \rho^3 \\
  \sigma_2 \sigma_1 \rho &amp; \sigma_2^2 &amp; \sigma_2 \sigma_3 \rho &amp; \sigma_2 \sigma_4 \rho^2 \\
  \sigma_3 \sigma_1 \rho^2 &amp; \sigma_3 \sigma_2 \rho &amp; \sigma_3^2 &amp; \sigma_3 \sigma_4 \rho \\
  \sigma_4 \sigma_1 \rho^3 &amp; \sigma_4 \sigma_2 \rho^2 &amp; \sigma_4 \sigma_3 \rho &amp; \sigma_4^2 \end{bmatrix},
\end{align}
\]</span></p>
<p>where, as before, <span class="math inline">\(\rho\)</span> is the correlation of one time point to the one immediately before or after, after conditioning on the liner model. To fit this model with <strong>brms</strong>, we continue to use the <code>ar(gr = id, cov = TRUE)</code> syntax. The only adjustment is we now wrap the <code>formula</code> within the <code>bf()</code> function and add a second line for <code>sigma</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> time <span class="sc">+</span> ccog <span class="sc">+</span> time<span class="sc">:</span>ccog <span class="sc">+</span> <span class="fu">ar</span>(<span class="at">gr =</span> id, <span class="at">cov =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>     sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(time)), </span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.06"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Inspect the parameter summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.6</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = log 
Formula: opp ~ 0 + Intercept + time + ccog + time:ccog + ar(gr = id, cov = TRUE) 
         sigma ~ 0 + factor(time)
   Data: opposites_pp (Number of observations: 140) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Correlation Structures:
      Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
ar[1]    0.808     0.043    0.715    0.884 1.000     4091     3167

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
Intercept          164.639     6.156  152.417  176.771 1.000     4077     3125
time                27.139     2.002   23.248   31.070 1.000     4145     3300
ccog                -0.119     0.504   -1.079    0.893 1.002     3979     2731
time:ccog            0.428     0.160    0.110    0.738 1.002     4262     3212
sigma_factortime0    3.066     0.102    2.874    3.279 1.001     3738     3018
sigma_factortime1    2.967     0.086    2.810    3.143 1.000     3266     2883
sigma_factortime2    3.012     0.085    2.856    3.191 1.001     3777     3029
sigma_factortime3    3.026     0.102    2.838    3.238 1.000     3885     3633

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Here are summaries for the four <span class="math inline">\(\sigma_\epsilon\)</span> posteriors, after exponentiation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit7<span class="fl">.6</span>)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">-</span><span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Estimate     Q2.5    Q97.5
sigma_factortime0 21.44741 17.70577 26.54369
sigma_factortime1 19.44305 16.60763 23.17069
sigma_factortime2 20.33684 17.39643 24.31242
sigma_factortime3 20.62398 17.07822 25.47298</code></pre>
</div>
</div>
<p>Extending our workflow from the last section, here how we might compute the marginal posteriors for the full <span class="math inline">\(\mathbf{\Sigma}_r\)</span> matrix, saving the results as <code>sigma.har</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>sigma.har <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_1e =</span> <span class="fu">exp</span>(b_sigma_factortime0),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_2e =</span> <span class="fu">exp</span>(b_sigma_factortime1),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_3e =</span> <span class="fu">exp</span>(b_sigma_factortime2),</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_4e =</span> <span class="fu">exp</span>(b_sigma_factortime3)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_1 =</span> sigma_1e <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">ar[1]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_2 =</span> sigma_2e <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">ar[1]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_3 =</span> sigma_3e <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">ar[1]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_4 =</span> sigma_4e <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">ar[1]</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">rho =</span> <span class="st">`</span><span class="at">ar[1]</span><span class="st">`</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_1^2</span><span class="st">`</span> <span class="ot">=</span> sigma_1<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_2^2</span><span class="st">`</span> <span class="ot">=</span> sigma_2<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_3^2</span><span class="st">`</span> <span class="ot">=</span> sigma_3<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_4^2</span><span class="st">`</span> <span class="ot">=</span> sigma_4<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_2 sigma_1 rho</span><span class="st">`</span>   <span class="ot">=</span> sigma_2 <span class="sc">*</span> sigma_1 <span class="sc">*</span> rho,</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_3 sigma_1 rho^2</span><span class="st">`</span> <span class="ot">=</span> sigma_3 <span class="sc">*</span> sigma_1 <span class="sc">*</span> rho<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_4 sigma_1 rho^3</span><span class="st">`</span> <span class="ot">=</span> sigma_4 <span class="sc">*</span> sigma_1 <span class="sc">*</span> rho<span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_3 sigma_2 rho</span><span class="st">`</span>   <span class="ot">=</span> sigma_3 <span class="sc">*</span> sigma_2 <span class="sc">*</span> rho,</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_4 sigma_2 rho^2</span><span class="st">`</span> <span class="ot">=</span> sigma_4 <span class="sc">*</span> sigma_2 <span class="sc">*</span> rho<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">sigma_4 sigma_3 rho</span><span class="st">`</span>   <span class="ot">=</span> sigma_4 <span class="sc">*</span> sigma_3 <span class="sc">*</span> rho)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s the numeric summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>sigma.har <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 7
   name                    value .lower  .upper .width .point .interval
   &lt;chr&gt;                   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
 1 rho                      0.81   0.72    0.88   0.95 median qi       
 2 sigma_1^2             1348.   876.   2204.     0.95 median qi       
 3 sigma_2 sigma_1 rho    990.   626.   1684.     0.95 median qi       
 4 sigma_2^2             1111.   724.   1821.     0.95 median qi       
 5 sigma_3 sigma_1 rho^2  840.   480.   1516.     0.95 median qi       
 6 sigma_3 sigma_2 rho    940.   569.   1614.     0.95 median qi       
 7 sigma_3^2             1218.   775.   2042.     0.95 median qi       
 8 sigma_4 sigma_1 rho^3  691.   362.   1317.     0.95 median qi       
 9 sigma_4 sigma_2 rho^2  773.   439.   1415.     0.95 median qi       
10 sigma_4 sigma_3 rho   1002.   614.   1730.     0.95 median qi       
11 sigma_4^2             1250.   804.   2091      0.95 median qi       </code></pre>
</div>
</div>
<p>As in the last section, we might pull the posterior medians for <span class="math inline">\(\sigma1^2\)</span> through <span class="math inline">\(\sigma_4^2\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>s12   <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_1^2</span><span class="st">`</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>s22   <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_2^2</span><span class="st">`</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>s32   <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_3^2</span><span class="st">`</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>s42   <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_4^2</span><span class="st">`</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>s2s1p  <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_2 sigma_1 rho</span><span class="st">`</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>s3s1p2 <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_3 sigma_1 rho^2</span><span class="st">`</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>s3s2p  <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_3 sigma_2 rho</span><span class="st">`</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>s4s1p3 <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_4 sigma_1 rho^3</span><span class="st">`</span>)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>s4s2p2 <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_4 sigma_2 rho^2</span><span class="st">`</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>s4s3p  <span class="ot">&lt;-</span> <span class="fu">median</span>(sigma.har<span class="sc">$</span><span class="st">`</span><span class="at">sigma_4 sigma_3 rho</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have them, we can make our colored version of the <span class="math inline">\(\mathbf{\Sigma}_r\)</span> Singer and Willett reported in the rightmost column of Table 7.3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">c</span>(s12, s2s1p, s3s1p2, s4s1p3,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                   s2s1p, s22, s3s2p, s4s2p2,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                   s3s1p2, s3s2p, s32, s4s3p,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                   s4s1p3, s4s2p2, s4s3p, s42)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="at">digits =</span> <span class="dv">0</span>),</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">col   =</span> <span class="fu">fct_rev</span>(col)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> row, <span class="at">y =</span> col)) <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"posterior</span><span class="sc">\n</span><span class="st">median"</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">"top"</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(Sigma)[<span class="fu">italic</span>(r)]<span class="sc">*</span><span class="st">" for the heterogeneous autoregressive model"</span>)) <span class="sc">+</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>Even though there’s still a strict band diagonal correlation structure, the heterogeneous variances allow for differences among the covariances within the bands.</p>
</section>
<section id="toeplitz-error-covariance-matrix" class="level3" data-number="7.3.6">
<h3 data-number="7.3.6" class="anchored" data-anchor-id="toeplitz-error-covariance-matrix"><span class="header-section-number">7.3.6</span> Toeplitz error covariance matrix</h3>
<p>Handy as it is, <strong>brms</strong> is not yet set up to fit models with the Toeplitz error covariance matrix, at this time. For details, see <strong>brms</strong> GitHub <a href="https://github.com/paul-buerkner/brms/issues/403#issuecomment-381404989">issue #403</a>.</p>
</section>
<section id="does-choosing-the-correct-error-covariance-structure-really-matter" class="level3" data-number="7.3.7">
<h3 data-number="7.3.7" class="anchored" data-anchor-id="does-choosing-the-correct-error-covariance-structure-really-matter"><span class="header-section-number">7.3.7</span> Does choosing the “correct” error covariance structure really matter?</h3>
<p>Now we have all our models, we might compare them with information criteria, as was done in the text. Here we’ll use the WAIC. First, compute and save the WAIC estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit7<span class="fl">.1</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit7<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit7<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit7<span class="fl">.4</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit7<span class="fl">.5</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit7<span class="fl">.6</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now compare the models using WAIC differences and WAIC weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit7<span class="fl">.1</span>, fit7<span class="fl">.2</span>, fit7<span class="fl">.3</span>, fit7<span class="fl">.4</span>, fit7<span class="fl">.5</span>, fit7<span class="fl">.6</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
fit7.1    0.0       0.0  -586.7       6.2         47.1    3.5    1173.5   12.3 
fit7.5  -20.9       4.1  -607.7       8.5          3.4    0.5    1215.4   17.1 
fit7.2  -21.5       2.8  -608.2       7.6         14.2    1.7    1216.4   15.3 
fit7.6  -23.7       4.2  -610.5       8.8          6.7    1.1    1220.9   17.6 
fit7.3  -39.5       5.9  -626.2       8.1          4.5    0.7    1252.5   16.3 
fit7.4  -41.4       5.4  -628.1       7.8          7.0    0.8    1256.2   15.6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(fit7<span class="fl">.1</span>, fit7<span class="fl">.2</span>, fit7<span class="fl">.3</span>, fit7<span class="fl">.4</span>, fit7<span class="fl">.5</span>, fit7<span class="fl">.6</span>, <span class="at">weights =</span> <span class="st">"waic"</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fit7.1 fit7.2 fit7.3 fit7.4 fit7.5 fit7.6 
     1      0      0      0      0      0 </code></pre>
</div>
</div>
<p>By both methods of comparison, the <em>standard</em> multilevel model for change was the clear winner.</p>
<blockquote class="blockquote">
<p>Perhaps most important, consider how choice of an error covariance structure affects our ability to address our research questions, especially given that it is the <em>fixed effects</em>–and not the <em>variance components</em>–that usually embody these questions. Some might say that refining the error covariance structure for the multilevel model for change is akin to rearranging the deck chairs on the <em>Titanic</em>–it rarely fundamentally changes our parameter estimates. Indeed, regardless of the error structure chosen, estimates of the fixed effects are unbiased and may not be affected much by choices made in the stochastic part of the model (providing that neither the data, nor the error structure, are idiosyncratic). (p.&nbsp;264, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For more on the idea that researchers generally just care about fixed effects, see the paper by <span class="citation" data-cites="mcneishOnTheUnnecessaryUbiquity2017">McNeish et al. (<a href="references.html#ref-mcneishOnTheUnnecessaryUbiquity2017" role="doc-biblioref">2017</a>)</span>, <a href="https://doi.org/10.1037/met0000078"><em>On the unnecessary ubiquity of hierarchical linear modeling</em></a>. Although I can’t disagree with the logic presented by Singer and Willett, or by McNeish and colleagues, I’m uneasy with this perspective for a couple reasons. First, I suspect part of the reason researchers don’t theorize about variances and covariances is because those are difficult metrics for many of us to think about. Happily, <strong>brms</strong> makes these more accessible by parameterizing them as standard deviations and correlations.</p>
<p>Second, in many disciplines, including my own (clinical psychology), multilevel models are still exotic and researchers just aren’t used to thinking in their terms. But I see this as more of a reason to spread the multilevel gospel than to down emphasize variance parameters. In my opinion, which is heavily influenced by <a href="https://elevanth.org/blog/2017/08/24/multilevel-regression-as-default/">McElreath’s</a>, it would be great if someday soon, researchers used multilevel models (longitudinal or otherwise) as the default rather than the exception.</p>
<p>Third, I actually care about random effects. If you go back and compare the models from this chapter, it was only the multilevel growth model (<code>fit7.1</code>) that assigned person-specific intercepts and slopes. In clinical psychology, this matters! I want a model that allows me to make plots like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 35 person-specific growth trajectories</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> opposites_pp <span class="sc">%&gt;%</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, ccog) <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(id, ccog),</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>))</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit7<span class="fl">.1</span>, <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">+</span> <span class="dv">1</span>, <span class="at">y =</span> Estimate, <span class="at">group =</span> id)) <span class="sc">+</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"35 person-specific growth trajectories"</span>,</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"day"</span>,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"opposites naming task"</span>) <span class="sc">+</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 35 person-specific intercept and slope parameters</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">coef</span>(fit7<span class="fl">.1</span>)<span class="sc">$</span>id[, , <span class="st">"Intercept"</span>],</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coef</span>(fit7<span class="fl">.1</span>)<span class="sc">$</span>id[, , <span class="st">"time"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"intercepts"</span>, <span class="st">"slopes"</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">35</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> id)) <span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"35 person-specific intercept and slope parameters"</span>,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"marginal posterior"</span>) <span class="sc">+</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type, <span class="at">scales =</span> <span class="st">"free_x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-49-2.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Of all the models we fit, only the standard multilevel model for change allows us to drill down all the way to the individual participants and this was accomplished by how it parameterized <span class="math inline">\(\mathbf{\Sigma}_r\)</span>. Even your substantive theory isn’t built around the subtleties in the <span class="math inline">\(4 \times 4 = 16\)</span> cells in the <span class="math inline">\(\mathbf{\Sigma}_r\)</span>, it still matters that our <code>fit7.1</code> parameterized them by way of <span class="math inline">\(\sigma_\epsilon\)</span>, <span class="math inline">\(\sigma_0\)</span>, <span class="math inline">\(\sigma_1\)</span>, and <span class="math inline">\(\rho_{01}\)</span>.</p>
<p>But Singer and Willett went on:</p>
<blockquote class="blockquote">
<p>But refining our hypotheses about the error covariance structure <em>does</em> affect the <em>precision</em> of estimates of the fixed effects and will therefore impact hypothesis testing and confidence interval construction. (p.&nbsp;264, <em>emphasis</em> in the original)</p>
</blockquote>
<p>I’m going to showcase this in a coefficient plot, rather than the way the authors did in their Table 7.4. First, we’ll want a custom wrangling function. Let’s call it <code>gamma_summary()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>gamma_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(brmsfit) {</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fixef</span>(brmsfit)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gamma =</span> <span class="fu">c</span>(<span class="st">"gamma[0][0]"</span>, <span class="st">"gamma[1][0]"</span>, <span class="st">"gamma[0][1]"</span>, <span class="st">"gamma[1][1]"</span>))</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">gamma_summary</span>(fit7<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Est.Error        Q2.5       Q97.5       gamma
Intercept 164.2819042 6.4642477 151.4539370 176.7035537 gamma[0][0]
time       26.9621087 2.0933771  22.9170354  31.2093872 gamma[1][0]
ccog       -0.1438951 0.5199258  -1.1788654   0.8879831 gamma[0][1]
time:ccog   0.4392846 0.1697978   0.1044915   0.7695013 gamma[1][1]</code></pre>
</div>
</div>
<p>Now wrangle and plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>type <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"standard growth model"</span>, <span class="st">"unstructured"</span>, <span class="st">"compound symmetric"</span>, </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"heterogeneous compound symmetric"</span>, <span class="st">"autoregressive"</span>, <span class="st">"heterogeneous autoregressive"</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">fit  =</span> <span class="fu">str_c</span>(<span class="st">"fit7."</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="fu">factor</span>(type, <span class="at">levels =</span> type)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type  =</span> <span class="fu">fct_rev</span>(type),</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">gamma =</span> <span class="fu">map</span>(fit, <span class="sc">~</span><span class="fu">get</span>(.) <span class="sc">%&gt;%</span> <span class="fu">gamma_summary</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(gamma) <span class="sc">%&gt;%</span> </span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> type)) <span class="sc">+</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"marginal posterior"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Parameter precision can vary across model types."</span>,</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> gamma, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">labeller =</span> label_parsed, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Yep, the way we parameterize <span class="math inline">\(\mathbf{\Sigma}_r\)</span> might have subtle consequences for the widths of our marginal <span class="math inline">\(\gamma\)</span> posteriors. This can matter a lot when you’re analyzing data from, say, a clinical trial where lives may depend on the results of your analysis. Rearrange the deck chairs on your <em>Titanic</em> with caution, friends. Someone might trip and hurt themselves.</p>
</section>
<section id="bonus-did-we-trade-multilevel-for-multivariate" class="level3" data-number="7.3.8">
<h3 data-number="7.3.8" class="anchored" data-anchor-id="bonus-did-we-trade-multilevel-for-multivariate"><span class="header-section-number">7.3.8</span> Bonus: Did we trade multilevel for multivariate?</h3>
<p>So far in this chapter, only the first model <code>fit7.1</code> used the conventional <strong>brms</strong> multilevel syntax, such as <code>(1 + time | id)</code>. The other five models used the <code>unstr()</code>, <code>cosy()</code>, or <code>ar()</code> helper functions, instead. Singer and Willett didn’t exactly come out and say it this way, but in a sense, <code>fit7.1</code> is the only multilevel model we’ve fit so far in this chapter. <span class="citation" data-cites="mallinckrod2008recommendations">Mallinckrod et al. (<a href="references.html#ref-mallinckrod2008recommendations" role="doc-biblioref">2008</a>)</span> made the point more clearly:</p>
<blockquote class="blockquote">
<p>A simple formulation of the general linear mixed model… can be implemented in which the random effects are not explicitly modeled, but rather are included as part of the marginal covariance matrix… leading them to what could alternatively be described as a multivariate normal model. (p.&nbsp;306)</p>
</blockquote>
<p>Thus we might think of all our models after <code>fit7.1</code> as special kinds of multivariate panel models. To help make this easier to see, let’s first fit a simplified version of the unstructured model, following the form</p>
<p><span class="math display">\[
\begin{align}
\text{opp}_{ij} &amp; \sim \operatorname{Normal}(\mu_j, \mathbf{\Sigma}_r) \\
\mu_j &amp; = \pi_{0j} \\
\mathbf{\Sigma}_r &amp; = \begin{bmatrix}
  \sigma_1^2 &amp; \sigma_{12} &amp; \sigma_{13} &amp; \sigma_{14} \\
  \sigma_{21} &amp; \sigma_2^2 &amp; \sigma_{23} &amp; \sigma_{24} \\
  \sigma_{31} &amp; \sigma_{32} &amp; \sigma_3^2 &amp; \sigma_{34} \\
  \sigma_{41} &amp; \sigma_{42} &amp; \sigma_{43} &amp; \sigma_4^2 \end{bmatrix},
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\pi_{0j}\)</span> is the intercept, which is estimated separately for each of the 4 <span class="math inline">\(j\)</span> time points, and <span class="math inline">\(\mathbf{\Sigma}_r\)</span> is the unstructured variance/covariance matrix. To fit those separate <span class="math inline">\(\pi_{0j}\)</span> intercepts with <code>brm()</code>, we use the syntax of <code>0 + factor(time)</code> in the <span class="math inline">\(\mu_j\)</span> portion of the model. Otherwise, the syntax is much the same as with the first unstructured model <code>fit7.2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp, </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(time) <span class="sc">+</span> <span class="fu">unstr</span>(<span class="at">time =</span> time, <span class="at">gr =</span> id),</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>     sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(time)),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.07"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the parameter summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.7</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = log 
Formula: opp ~ 0 + factor(time) + unstr(time = time, gr = id) 
         sigma ~ 0 + factor(time)
   Data: opposites_pp (Number of observations: 140) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Correlation Structures:
             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
cortime(0,1)    0.739     0.077    0.563    0.859 1.001     2354     2259
cortime(0,2)    0.624     0.098    0.409    0.782 1.001     2037     2187
cortime(1,2)    0.780     0.065    0.628    0.883 1.000     2782     2943
cortime(0,3)    0.288     0.144   -0.015    0.545 1.001     2298     2515
cortime(1,3)    0.585     0.107    0.346    0.761 1.002     3050     2823
cortime(2,3)    0.735     0.077    0.555    0.857 1.001     3018     2793

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
factortime0        164.606     6.252  152.389  177.005 1.002     2387     2579
factortime1        192.099     5.528  180.967  202.933 1.001     2121     2114
factortime2        216.843     5.886  205.079  228.142 1.001     2046     1889
factortime3        246.174     6.432  233.158  258.451 1.001     2523     2876
sigma_factortime0    3.568     0.116    3.351    3.806 1.001     2785     3109
sigma_factortime1    3.460     0.112    3.251    3.690 1.001     2478     2365
sigma_factortime2    3.528     0.109    3.321    3.751 1.001     2239     2744
sigma_factortime3    3.613     0.116    3.404    3.850 1.001     2875     2784

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Once again, those 4 <code>sigma_</code> parameters were fit using the log link. Here they are after exponentiation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit7<span class="fl">.7</span>)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">-</span><span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Estimate     Q2.5    Q97.5
sigma_factortime0 35.45656 28.52038 44.97009
sigma_factortime1 31.82985 25.81269 40.04808
sigma_factortime2 34.05243 27.69567 42.56658
sigma_factortime3 37.08273 30.09709 47.00746</code></pre>
</div>
</div>
<p>All we’ve really done is fit an unconditional multivariate normal model for <code>opp</code>, across the four time points. To see, compare the posterior point estimates in the <code>Population-Level Effects</code> section (or their exponentiated values, above), to the sample means and SD’s for <code>opp</code> over <code>time</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>opposites_pp <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">m =</span> <span class="fu">mean</span>(opp),</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">s =</span> <span class="fu">sd</span>(opp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
   time     m     s
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0  164.  36.2
2     1  192   33.5
3     2  217.  35.9
4     3  246.  37.6</code></pre>
</div>
</div>
<p>In a similar way, the correlations in the <code>Correlation Structures</code> part of the <code>print()</code> output are really just regularized sample correlations. Compare them to the un-regularized Pearson’s correlation estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>opposites_pp <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, time, opp) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time, <span class="at">values_from =</span> opp) <span class="sc">%&gt;%</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      0     1     2     3
0 1.000 0.804 0.709 0.414
1 0.804 1.000 0.847 0.678
2 0.709 0.847 1.000 0.800
3 0.414 0.678 0.800 1.000</code></pre>
</div>
</div>
<p>The reason for the regularization, by the way, is because of the default LKJ(1) prior. That prior is more strongly regularizing as you increase the dimensions of the correlation matrix. In the case of a <span class="math inline">\(4 \times 4\)</span> matrix, the LKJ will definitely push the individual correlations toward zero, particularly in the case of a modestly-sized data set like <code>opposites_pp</code>.</p>
<p>But anyway, we can fit basically the same model by explicitly using the <strong>brms</strong> multivariate syntax, as outlined in Bürkner’s <span class="citation" data-cites="Bürkner2022Multivariate">(<a href="references.html#ref-Bürkner2022Multivariate" role="doc-biblioref">2022</a>)</span> vignette, <em>Estimating multivariate models with brms</em>. Before we can fit a more conventional multivariate model to the data, we’ll need to convert <code>opposites_pp</code> to the wide format, which we’ll call <code>opposites_wide</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>opposites_wide <span class="ot">&lt;-</span> opposites_pp <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">str_c</span>(<span class="st">"t"</span>, time)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>wave) <span class="sc">%&gt;%</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time, <span class="at">values_from =</span> opp)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(opposites_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
     id   cog   ccog    t0    t1    t2    t3
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1   137  23.5    205   217   268   302
2     2   123   9.54   219   243   279   302
3     3   129  15.5    142   212   250   289
4     4   125  11.5    206   230   248   273
5     5    81 -32.5    190   220   229   220
6     6   110  -3.46   165   205   207   263</code></pre>
</div>
</div>
<p>Now we’re ready to fit a multivariate model to our 4 variables <code>t0</code> through <code>t3</code>. To do so, we place all 4 variables within the <code>mvbind()</code> function, and we nest the entire model formula within the <code>bf()</code> function. Also notice we are explicitly asking for residual correlations by setting <code>set_rescor(TRUE)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_wide, </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(<span class="fu">mvbind</span>(t0, t1, t2, t3) <span class="sc">~</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_rescor</span>(<span class="cn">TRUE</span>),</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.08"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Review the model summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.8</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian, gaussian, gaussian) 
  Links: mu = identity
         mu = identity
         mu = identity
         mu = identity 
Formula: t0 ~ 1 
         t1 ~ 1 
         t2 ~ 1 
         t3 ~ 1 
   Data: opposites_wide (Number of observations: 35) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
             Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
t0_Intercept  164.516     5.807  152.990  176.136 1.001     2339     2617
t1_Intercept  192.037     5.210  181.789  201.859 1.001     2047     2374
t2_Intercept  216.789     5.630  205.493  227.683 1.001     1967     2313
t3_Intercept  246.113     6.292  233.689  258.336 1.000     2565     2718

Further Distributional Parameters:
         Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
sigma_t0   35.805     4.109   28.956   45.091 1.000     2540     2826
sigma_t1   32.240     3.591   26.055   39.884 1.001     2103     2130
sigma_t2   34.425     3.851   27.758   42.555 1.000     2240     2692
sigma_t3   37.532     4.569   29.879   47.750 1.001     2610     2746

Residual Correlations: 
              Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
rescor(t0,t1)    0.738     0.078    0.556    0.861 1.000     2183     2371
rescor(t0,t2)    0.624     0.101    0.397    0.790 1.000     2007     2291
rescor(t1,t2)    0.784     0.065    0.633    0.886 1.000     2613     3327
rescor(t0,t3)    0.288     0.147   -0.015    0.549 1.000     2343     2962
rescor(t1,t3)    0.590     0.105    0.357    0.770 1.000     2879     3158
rescor(t2,t3)    0.737     0.076    0.564    0.860 1.000     2884     2930

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>The results are very similar to those for <code>fit7.7</code>, above, with a few small differences. First, we now have a <code>Residual Correlations</code> section instead of a <code>Correlation Structures</code>. The output of the two is basically the same, though. The various <code>sigma_</code> parameters are now in their own <code>Family Specific Parameters</code>, instead of in the bottom fo the <code>Population-Level Effects</code> section. You’ll also note the <code>sigma_</code> parameters are all in their natural metric, rather than the log metric. This is because, by default, <strong>brms</strong> used the log link for the syntax we used for <code>fit7.7</code>, but used the identity link for the syntax we used for <code>fit7.8</code>.</p>
<p>Even if you take these small formatting-type differences into account, a careful eye will notice the parameter summaries are still a little different between these two models. The reason is the defualt priors were a little different. Take a look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.7</span><span class="sc">$</span>prior</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                prior    class        coef group resp  dpar nlpar lb ub tag       source
               (flat)        b                                                   default
               (flat)        b factortime0                                  (vectorized)
               (flat)        b factortime1                                  (vectorized)
               (flat)        b factortime2                                  (vectorized)
               (flat)        b factortime3                                  (vectorized)
               (flat)        b                        sigma                      default
               (flat)        b factortime0            sigma                 (vectorized)
               (flat)        b factortime1            sigma                 (vectorized)
               (flat)        b factortime2            sigma                 (vectorized)
               (flat)        b factortime3            sigma                 (vectorized)
 lkj_corr_cholesky(1) Lcortime                                                   default</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.8</span><span class="sc">$</span>prior</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   prior     class coef group resp dpar nlpar lb ub tag  source
 student_t(3, 166, 35.6) Intercept              t0                      default
   student_t(3, 196, 43) Intercept              t1                      default
 student_t(3, 215, 32.6) Intercept              t2                      default
 student_t(3, 246, 47.4) Intercept              t3                      default
    lkj_corr_cholesky(1)   Lrescor                                      default
   student_t(3, 0, 35.6)     sigma              t0             0        default
     student_t(3, 0, 43)     sigma              t1             0        default
   student_t(3, 0, 32.6)     sigma              t2             0        default
   student_t(3, 0, 47.4)     sigma              t3             0        default</code></pre>
</div>
</div>
<p>I’m not going to break down exactly why <strong>brms</strong> made different default prior choices for these models, but experienced <strong>brms</strong> users should find these results very predictable, particularly due to our use of the <code>0 + factor(time)</code> syntax in the <code>fit7.7</code> model. Know your software defaults, friends. So let’s try fitting these two models one more time, but with a couple adjustments. First, we will explicitly set the priors based on the defaults used by <code>fit7.8</code>. We will manually request the identity link for the <code>sigma_</code> parameters in <code>fit7.7</code>. We will also increase the post-warmup draws for both models, to help account for MCMC sampling error.</p>
<p>Now fit the models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unstructured</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.7</span>b <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_pp, </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">brmsfamily</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">link =</span> <span class="st">"identity"</span>, <span class="at">link_sigma =</span> <span class="st">"identity"</span>),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(opp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(time) <span class="sc">+</span> <span class="fu">unstr</span>(<span class="at">time =</span> time, <span class="at">gr =</span> id),</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>     sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(time)),</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">166</span>, <span class="fl">35.6</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime0),</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">196</span>, <span class="fl">43.0</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime1),</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">215</span>, <span class="fl">32.6</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime2),</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">246</span>, <span class="fl">47.4</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime3),</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">35.6</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime0, <span class="at">dpar =</span> sigma),</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">43.0</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime1, <span class="at">dpar =</span> sigma),</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">32.6</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime2, <span class="at">dpar =</span> sigma),</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">47.4</span>), <span class="at">class =</span> b, <span class="at">coef =</span> factortime3, <span class="at">dpar =</span> sigma),</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">1</span>), <span class="at">class =</span> cortime)),</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">13500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.07b"</span>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a><span class="co"># multivariate</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.8</span>b <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> opposites_wide, </span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(<span class="fu">mvbind</span>(t0, t1, t2, t3) <span class="sc">~</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_rescor</span>(<span class="cn">TRUE</span>),</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">166</span>, <span class="fl">35.6</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> t0),</span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">196</span>, <span class="fl">43.0</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> t1),</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">215</span>, <span class="fl">32.6</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> t2),</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">246</span>, <span class="fl">47.4</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> t3),</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">35.6</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> t0),</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">43.0</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> t1),</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">32.6</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> t2),</span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">47.4</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> t3),</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">1</span>), <span class="at">class =</span> rescor)),</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">13500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit07.08b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This time, let’s just compare the <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> posteriors in a coefficient plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(fit7<span class="fl">.7</span>b) <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"factortime"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">"mu_"</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">str_c</span>(<span class="st">"sigma_"</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>))),</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(fit7<span class="fl">.8</span>b) <span class="sc">%&gt;%</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"b_"</span>), <span class="fu">starts_with</span>(<span class="st">"sigma_"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">"mu_"</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">str_c</span>(<span class="st">"sigma_"</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)))</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"fit7.7b"</span>, <span class="st">"fit7.8b"</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>fit) <span class="sc">%&gt;%</span> </span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"par"</span>, <span class="st">"time"</span>), <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fit, par, time) <span class="sc">%&gt;%</span> </span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper, <span class="at">y =</span> time, <span class="at">group =</span> fit, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="sc">-</span><span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">end =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"posterior"</span>) <span class="sc">+</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> par, <span class="at">labeller =</span> label_parsed, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Now the results between the two methods are very similar. If you wanted to, you could make a similar kind of plot for the two versions of the correlation matrix, too. Thus, the various models Singer and Willett introduced in this chapter are special multivariate alternatives to the standard multilevel approach we’ve preferred up to this point. Cool, huh?</p>
</section>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">Session info</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Ventura 13.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] tidybayes_3.0.7 brms_2.23.0     Rcpp_1.1.0      lubridate_1.9.4 forcats_1.0.1   stringr_1.6.0   dplyr_1.1.4    
 [8] purrr_1.2.1     readr_2.1.5     tidyr_1.3.2     tibble_3.3.1    ggplot2_4.0.1   tidyverse_2.0.0

loaded via a namespace (and not attached):
 [1] svUnit_1.0.8            tidyselect_1.2.1        viridisLite_0.4.2       farver_2.1.2            loo_2.9.0.9000         
 [6] S7_0.2.1                fastmap_1.2.0           TH.data_1.1-4           tensorA_0.36.2.1        digest_0.6.39          
[11] estimability_1.5.1      timechange_0.3.0        lifecycle_1.0.5         StanHeaders_2.36.0.9000 survival_3.8-3         
[16] magrittr_2.0.4          posterior_1.6.1.9000    compiler_4.5.1          rlang_1.1.7             tools_4.5.1            
[21] utf8_1.2.6              knitr_1.51              labeling_0.4.3          bridgesampling_1.2-1    htmlwidgets_1.6.4      
[26] bit_4.6.0               pkgbuild_1.4.8          curl_7.0.0              plyr_1.8.9              RColorBrewer_1.1-3     
[31] abind_1.4-8             multcomp_1.4-29         withr_3.0.2             grid_4.5.1              stats4_4.5.1           
[36] xtable_1.8-4            inline_0.3.21           emmeans_1.11.2-8        scales_1.4.0            MASS_7.3-65            
[41] cli_3.6.5               mvtnorm_1.3-3           rmarkdown_2.30          crayon_1.5.3            generics_0.1.4         
[46] RcppParallel_5.1.11-1   rstudioapi_0.17.1       reshape2_1.4.5          tzdb_0.5.0              rstan_2.36.0.9000      
[51] splines_4.5.1           bayesplot_1.15.0.9000   parallel_4.5.1          matrixStats_1.5.0       vctrs_0.7.0            
[56] V8_8.0.1                Matrix_1.7-3            sandwich_3.1-1          jsonlite_2.0.0          arrayhelpers_1.1-0     
[61] hms_1.1.4               bit64_4.6.0-1           ggdist_3.3.3            glue_1.8.0              codetools_0.2-20       
[66] distributional_0.5.0    stringi_1.8.7           gtable_0.3.6            QuickJSR_1.8.1          pillar_1.11.1          
[71] htmltools_0.5.9         Brobdingnag_1.2-9       R6_2.6.1                vroom_1.6.6             evaluate_1.0.5         
[76] lattice_0.22-7          backports_1.5.0         rstantools_2.5.0.9000   coda_0.19-4.1           gridExtra_2.3          
[81] nlme_3.1-168            checkmate_2.3.3         xfun_0.55               zoo_1.8-14              pkgconfig_2.0.3        </code></pre>
</div>
</div>
</section>
<section id="comments" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="comments">Comments</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Bürkner2022Multivariate" class="csl-entry" role="listitem">
Bürkner, P.-C. (2022). <em>Estimating multivariate models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html">https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html</a>
</div>
<div id="ref-mallinckrod2008recommendations" class="csl-entry" role="listitem">
Mallinckrod, C. H., Lane, P. W., Schnell, D., Peng, Y., &amp; Mancuso, J. P. (2008). Recommendations for the primary analysis of continuous endpoints in longitudinal clinical trials. <em>Drug Information Journal</em>, <em>42</em>(4), 303–319. <a href="https://doi.org/10.1177/009286150804200402">https://doi.org/10.1177/009286150804200402</a>
</div>
<div id="ref-mcneishOnTheUnnecessaryUbiquity2017" class="csl-entry" role="listitem">
McNeish, D., Stapleton, L. M., &amp; Silverman, R. D. (2017). On the unnecessary ubiquity of hierarchical linear modeling. <em>Psychological Methods</em>, <em>22</em>(1), 114. <a href="https://doi.org/10.1037/met0000078">https://doi.org/10.1037/met0000078</a>
</div>
<div id="ref-R-nlme" class="csl-entry" role="listitem">
Pinheiro, J., Bates, D., &amp; R-core. (2021). <em><span class="nocase">nlme</span>: <span>Linear</span> and nonlinear mixed effects models</em> [Manual]. <a href="https://CRAN.R-project.org/package=nlme">https://CRAN.R-project.org/package=nlme</a>
</div>
<div id="ref-singerAppliedLongitudinalData2003" class="csl-entry" role="listitem">
Singer, J. D., &amp; Willett, J. B. (2003). <em>Applied longitudinal data analysis: <span>Modeling</span> change and event occurrence</em>. Oxford University Press, USA. <a href="https://oxford.universitypressscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968">https://oxford.universitypressscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968</a>
</div>
<div id="ref-willett1988QuestionsAndAnswers" class="csl-entry" role="listitem">
Willett, J. B. (1988). Chapter 9: <span>Questions</span> and answers in the measurement of change. <em>Review of Research in Education</em>, <em>15</em>, 345–422. <a href="https://doi.org/10.2307/1167368">https://doi.org/10.2307/1167368</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/solomon\.quarto\.pub\/alda\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkxODg5MTU1MTM=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOC0KfOc4C1eQu";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06.html" class="pagination-link" aria-label="Modeling Discontinuous and Nonlinear Change">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modeling Discontinuous and Nonlinear Change</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08.html" class="pagination-link" aria-label="Modeling Change Using Covariance Structure Analysis">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Change Using Covariance Structure Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>