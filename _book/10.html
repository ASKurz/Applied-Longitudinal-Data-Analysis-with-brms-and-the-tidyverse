<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10&nbsp; Describing Discrete-Time Event Occurrence Data – *Applied longitudinal data analysis* in brms and the tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11.html" rel="next">
<link href="./09.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7d082c015fa132ca880f975003d7bf2f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="10&nbsp; Describing Discrete-Time Event Occurrence Data – Applied longitudinal data analysis in brms and the tidyverse">
<meta property="og:description" content="">
<meta property="og:image" content="https://solomon.quarto.pub/alda/10_files/figure-html/unnamed-chunk-12-1.png">
<meta property="og:site_name" content="*Applied longitudinal data analysis* in brms and the tidyverse">
<meta property="og:image:height" content="576">
<meta property="og:image:width" content="1152">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Describing Discrete-Time Event Occurrence Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"><em>Applied longitudinal data analysis</em> in brms and the tidyverse</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What and why</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">A Framework for Investigating Change over Time</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploring Longitudinal Data on Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introducing the Multilevel Model for Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Doing Data Analysis with the Multilevel Model for Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Treating Time More Flexibly</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modeling Discontinuous and Nonlinear Change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Examining the Multilevel Model’s Error Covariance Structure</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Change Using Covariance Structure Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">A Framework for Investigating Event Occurrence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Describing Discrete-Time Event Occurrence Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fitting Basic Discrete-Time Hazard Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Extending the Discrete-Time Hazard Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Describing Continuous-Time Event Occurrence Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-life-table" id="toc-the-life-table" class="nav-link active" data-scroll-target="#the-life-table"><span class="header-section-number">10.1</span> The life table</a></li>
  <li><a href="#a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data" id="toc-a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data" class="nav-link" data-scroll-target="#a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data"><span class="header-section-number">10.2</span> A framework for characterizing the distribution of discrete-time event occurrence data</a>
  <ul>
  <li><a href="#survivor-function" id="toc-survivor-function" class="nav-link" data-scroll-target="#survivor-function"><span class="header-section-number">10.2.1</span> Survivor function</a></li>
  <li><a href="#sec-Median-lifetime" id="toc-sec-Median-lifetime" class="nav-link" data-scroll-target="#sec-Median-lifetime"><span class="header-section-number">10.2.2</span> Median lifetime</a></li>
  </ul></li>
  <li><a href="#developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes" id="toc-developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes" class="nav-link" data-scroll-target="#developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes"><span class="header-section-number">10.3</span> Developing intuition about hazard functions, survivor functions, and median lifetimes</a>
  <ul>
  <li><a href="#identifying-periods-of-high-and-low-risk-using-hazard-functions" id="toc-identifying-periods-of-high-and-low-risk-using-hazard-functions" class="nav-link" data-scroll-target="#identifying-periods-of-high-and-low-risk-using-hazard-functions"><span class="header-section-number">10.3.1</span> Identifying periods of high and low risk using hazard functions</a></li>
  <li><a href="#survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard" id="toc-survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard" class="nav-link" data-scroll-target="#survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard"><span class="header-section-number">10.3.2</span> Survivor functions as a context for evaluating the magnitude of hazard</a></li>
  <li><a href="#strengths-and-limitations-of-estimated-median-lifetimes" id="toc-strengths-and-limitations-of-estimated-median-lifetimes" class="nav-link" data-scroll-target="#strengths-and-limitations-of-estimated-median-lifetimes"><span class="header-section-number">10.3.3</span> Strengths and limitations of estimated median lifetimes</a></li>
  </ul></li>
  <li><a href="#quantifying-the-effects-of-sampling-variation" id="toc-quantifying-the-effects-of-sampling-variation" class="nav-link" data-scroll-target="#quantifying-the-effects-of-sampling-variation"><span class="header-section-number">10.4</span> Quantifying the effects of sampling variation</a>
  <ul>
  <li><a href="#the-standard-error-of-the-estimated-hazard-probabilities" id="toc-the-standard-error-of-the-estimated-hazard-probabilities" class="nav-link" data-scroll-target="#the-standard-error-of-the-estimated-hazard-probabilities"><span class="header-section-number">10.4.1</span> The standard error of the estimated hazard probabilities</a></li>
  <li><a href="#standard-error-of-the-estimated-survival-probabilities" id="toc-standard-error-of-the-estimated-survival-probabilities" class="nav-link" data-scroll-target="#standard-error-of-the-estimated-survival-probabilities"><span class="header-section-number">10.4.2</span> Standard error of the estimated survival probabilities</a></li>
  </ul></li>
  <li><a href="#a-simple-and-useful-strategy-for-constructing-the-life-table" id="toc-a-simple-and-useful-strategy-for-constructing-the-life-table" class="nav-link" data-scroll-target="#a-simple-and-useful-strategy-for-constructing-the-life-table"><span class="header-section-number">10.5</span> A simple and useful strategy for constructing the life table</a>
  <ul>
  <li><a href="#the-person-period-data-set" id="toc-the-person-period-data-set" class="nav-link" data-scroll-target="#the-person-period-data-set"><span class="header-section-number">10.5.1</span> The person-period data set</a></li>
  <li><a href="#using-the-person-period-data-set-to-construct-the-life-table" id="toc-using-the-person-period-data-set-to-construct-the-life-table" class="nav-link" data-scroll-target="#using-the-person-period-data-set-to-construct-the-life-table"><span class="header-section-number">10.5.2</span> Using the person-period data set to construct the life table</a></li>
  </ul></li>
  <li><a href="#bonus-fit-the-discrete-time-hazard-models-with-brms" id="toc-bonus-fit-the-discrete-time-hazard-models-with-brms" class="nav-link" data-scroll-target="#bonus-fit-the-discrete-time-hazard-models-with-brms"><span class="header-section-number">10.6</span> Bonus: Fit the discrete-time hazard models with <strong>brms</strong></a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments">Comments</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-Describing-Discrete-Time-Event-Occurrence-Data" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Describing Discrete-Time Event Occurrence Data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>In this chapter, [Singer and Willett presented] a framework for describing discrete-time event occurrence data…. As we will [see], the conceptual linchpin for all subsequent survival methods is to approach the analysis on a period-by-period basis. This allows you to examine event occurrence sequentially among those individuals eligible to experience the event at each discrete point in time. <span class="citation" data-cites="singerAppliedLongitudinalData2003">(<a href="references.html#ref-singerAppliedLongitudinalData2003" role="doc-biblioref">Singer &amp; Willett, 2003, p. 325</a>)</span></p>
</blockquote>
<section id="the-life-table" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="the-life-table"><span class="header-section-number">10.1</span> The life table</h2>
<blockquote class="blockquote">
<p>The fundamental tool for summarizing the sample distribution of event occurrence is the <em>life table</em>. As befits its name, a life table tracks the event histories (the “lives”) of a sample of individuals from the beginning of time (when no one has yet experienced the target event) through the end of data collection. (p.&nbsp;326, <em>emphasis</em> in the original)</p>
</blockquote>
<p>To make a life table as presented in Table 10.1, we need to load the <code>teachers.csv</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>teachers <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/teachers.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(teachers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,941
Columns: 3
$ id     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32…
$ t      &lt;dbl&gt; 1, 2, 1, 1, 12, 1, 12, 1, 2, 2, 7, 12, 1, 12, 12, 2, 12, 1, 3, 2, 12, 12, 9, 12, 2, 3, 1, 2, 2, 4, 3, 12, 1, 5, 1…
$ censor &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0,…</code></pre>
</div>
</div>
<p>Perhaps the easiest way to make a life table as presented in Table 10.1 is with help from the <a href="https://CRAN.R-project.org/package=survival"><strong>survival</strong> package</a> <span class="citation" data-cites="R-survival therneau2000ModelingSurvivalData">(<a href="references.html#ref-R-survival" role="doc-biblioref">Terry M. Therneau, 2021b</a>; <a href="references.html#ref-therneau2000ModelingSurvivalData" role="doc-biblioref">Terry M. Therneau &amp; Grambsch, 2000</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we’ll use the <code>survfit()</code> function to compute survival curves. Within the <code>survfit()</code> function, we’ll use the <code>Surv()</code> function to make a survival object, which will become the criterion within the model formula. It takes two basic arguments, <code>time</code> and <code>event</code>. With the <code>teachers</code> data, <code>t</code> is time in years. In the data, events are encoded in <code>censor</code>. However, it’s important to understand how the <code>event</code> argument expects the data. From the <a href="https://CRAN.R-project.org/package=survival/survival.pdf"><strong>survival</strong> reference manual</a> <span class="citation" data-cites="survival2021RM">(<a href="references.html#ref-survival2021RM" role="doc-biblioref">Terry M. Therneau, 2021a</a>)</span>, we read that <code>event</code> is “the status indicator, normally <code>0=alive</code>, <code>1=dead</code>. Other choices are <code>TRUE/FALSE</code> (<code>TRUE = death</code>) or <code>1/2</code> (<code>2=death</code>).” Note that whereas within our data <code>censor</code> is coded <code>0 = event</code> <code>1 = censored</code>, the <code>event</code> argument expects the opposite. A quick way to solve that is to enter <code>1 - censor</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> teachers,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(t, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use the <code>str()</code> function to survey the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 17
 $ n        : int 3941
 $ time     : num [1:12] 1 2 3 4 5 6 7 8 9 10 ...
 $ n.risk   : num [1:12] 3941 3485 3101 2742 2447 ...
 $ n.event  : num [1:12] 456 384 359 295 218 184 123 79 53 35 ...
 $ n.censor : num [1:12] 0 0 0 0 0 0 280 307 255 265 ...
 $ surv     : num [1:12] 0.884 0.787 0.696 0.621 0.566 ...
 $ std.err  : num [1:12] 0.00576 0.00829 0.01053 0.01245 0.01396 ...
 $ cumhaz   : num [1:12] 0.116 0.226 0.342 0.449 0.538 ...
 $ std.chaz : num [1:12] 0.00542 0.00781 0.00992 0.01173 0.01319 ...
 $ type     : chr "right"
 $ logse    : logi TRUE
 $ conf.int : num 0.95
 $ conf.type: chr "log"
 $ lower    : num [1:12] 0.874 0.774 0.682 0.606 0.55 ...
 $ upper    : num [1:12] 0.894 0.8 0.71 0.636 0.581 ...
 $ t0       : num 0
 $ call     : language survfit(formula = Surv(t, 1 - censor) ~ 1, data = teachers)
 - attr(*, "class")= chr "survfit"</code></pre>
</div>
</div>
<p>We can retrieve the values for the “Year” column from <code>fit10.1$time</code>. The values in the “Time interval” column are a simple transformation from there.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.1</span><span class="sc">$</span>time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12</code></pre>
</div>
</div>
<p>We can find the values in the “Employed at the beginning of the year” column in <code>fit10.1$n.risk</code> and those in the “Who left during the year” column in <code>fit10.1$n.event</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.1</span><span class="sc">$</span>n.risk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3941 3485 3101 2742 2447 2229 2045 1642 1256  948  648  391</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.1</span><span class="sc">$</span>n.event</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 456 384 359 295 218 184 123  79  53  35  16   5</code></pre>
</div>
</div>
<p>We’ll have to work a little harder to compute the values in the “Censored at the end of the year column.” Here we’ll walk it through in a data frame format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">n_risk  =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_event =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_risk_1 =</span> <span class="fu">lead</span>(n_risk, <span class="at">default =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_censored =</span> n_risk <span class="sc">-</span> n_event <span class="sc">-</span> n_risk_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   n_risk n_event n_risk_1 n_censored
1    3941     456     3485          0
2    3485     384     3101          0
3    3101     359     2742          0
4    2742     295     2447          0
5    2447     218     2229          0
6    2229     184     2045          0
7    2045     123     1642        280
8    1642      79     1256        307
9    1256      53      948        255
10    948      35      648        265
11    648      16      391        241
12    391       5        0        386</code></pre>
</div>
</div>
<p>That is, to get the number of those censored at the end of a given year, you take the number employed at the beginning of that year, subtract the number of those who left (i.e., the number who experienced the “event”), and then subtract the number of those employed at the beginning of the next year. Notice our use of the <code>dplyr::lead()</code> function to get the number employed in the next year (learn more about that function <a href="https://dplyr.tidyverse.org/reference/lead-lag.html">here</a>).</p>
<p>To get the values in the “Teachers at the beginning of the year who left during the year” column, which is in a proportion metric, we use division.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.1</span><span class="sc">$</span>n.event <span class="sc">/</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.11570667 0.11018651 0.11576911 0.10758570 0.08908868 0.08254823 0.06014670 0.04811206 0.04219745 0.03691983 0.02469136
[12] 0.01278772</code></pre>
</div>
</div>
<p>Finally, to pull the values in the “All teachers still employed at the end of the year” column, we just execute <code>fit10.1$surv</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.1</span><span class="sc">$</span>surv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.8842933 0.7868561 0.6957625 0.6209084 0.5655925 0.5189038 0.4876935 0.4642295 0.4446402 0.4282242 0.4176508 0.4123100</code></pre>
</div>
</div>
<p>Let’s put that all together in a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>most_rows <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year =</span> fit10<span class="fl">.1</span><span class="sc">$</span>time) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_int   =</span> <span class="fu">str_c</span>(<span class="st">"["</span>, year, <span class="st">", "</span>, year <span class="sc">+</span> <span class="dv">1</span>, <span class="st">")"</span>), </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_employed =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_left     =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_censored   =</span> n_employed <span class="sc">-</span> n_left <span class="sc">-</span> <span class="fu">lead</span>(n_employed, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">hazard_fun   =</span> n_left <span class="sc">/</span> n_employed,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">survivor_fun =</span> fit10<span class="fl">.1</span><span class="sc">$</span>surv)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>most_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 7
    year time_int n_employed n_left n_censored hazard_fun survivor_fun
   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
 1     1 [1, 2)         3941    456          0     0.116         0.884
 2     2 [2, 3)         3485    384          0     0.110         0.787
 3     3 [3, 4)         3101    359          0     0.116         0.696
 4     4 [4, 5)         2742    295          0     0.108         0.621
 5     5 [5, 6)         2447    218          0     0.0891        0.566
 6     6 [6, 7)         2229    184          0     0.0825        0.519
 7     7 [7, 8)         2045    123        280     0.0601        0.488
 8     8 [8, 9)         1642     79        307     0.0481        0.464
 9     9 [9, 10)        1256     53        255     0.0422        0.445
10    10 [10, 11)        948     35        265     0.0369        0.428
11    11 [11, 12)        648     16        241     0.0247        0.418
12    12 [12, 13)        391      5        386     0.0128        0.412</code></pre>
</div>
</div>
<p>The only thing missing from our version of Table 10.1 is we don’t have a row for Year 0. Here’s a quick and dirty way to manually insert those values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>row_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year         =</span> <span class="dv">0</span>, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">time_int     =</span> <span class="st">"[0, 1)"</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_employed   =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk[<span class="dv">1</span>], </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_left       =</span> <span class="cn">NA</span>, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_censored   =</span> <span class="cn">NA</span>, </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">hazard_fun   =</span> <span class="cn">NA</span>, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">survivor_fun =</span> <span class="dv">1</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(row_1, most_rows)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 7
    year time_int n_employed n_left n_censored hazard_fun survivor_fun
   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
 1     0 [0, 1)         3941     NA         NA    NA             1    
 2     1 [1, 2)         3941    456          0     0.116         0.884
 3     2 [2, 3)         3485    384          0     0.110         0.787
 4     3 [3, 4)         3101    359          0     0.116         0.696
 5     4 [4, 5)         2742    295          0     0.108         0.621
 6     5 [5, 6)         2447    218          0     0.0891        0.566
 7     6 [6, 7)         2229    184          0     0.0825        0.519
 8     7 [7, 8)         2045    123        280     0.0601        0.488
 9     8 [8, 9)         1642     79        307     0.0481        0.464
10     9 [9, 10)        1256     53        255     0.0422        0.445
11    10 [10, 11)        948     35        265     0.0369        0.428
12    11 [11, 12)        648     16        241     0.0247        0.418
13    12 [12, 13)        391      5        386     0.0128        0.412</code></pre>
</div>
</div>
<p>We might walk out the notation in our <code>time_int</code> column a bit. Those intervals</p>
<blockquote class="blockquote">
<p>reflect a standard partition of time, in which each interval <em>includes</em> the initial time and <em>excludes</em> the concluding time. Adopting common mathematical notation, [brackets] denote inclusions and (parentheses) denote exclusions. Thus, we bracket each interval’s initial time and place a parenthesis around its concluding time. (p.&nbsp;328, <em>emphasis</em> in the original)</p>
</blockquote>
<p>The values in the <code>n_employed</code> column the <em>risk set</em>, those who are “<em>eligible</em> to experience the event during that interval” (p.&nbsp;329, <em>emphasis</em> in the original).</p>
</section>
<section id="a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="a-framework-for-characterizing-the-distribution-of-discrete-time-event-occurrence-data"><span class="header-section-number">10.2</span> A framework for characterizing the distribution of discrete-time event occurrence data</h2>
<blockquote class="blockquote">
<p>The fundamental quantity used to assess the risk of event occurrence in each discrete time period is known as <em>hazard.</em> Denoted by <span class="math inline">\(h(t_{ij})\)</span>, discrete time hazard is the <em>conditional probability that individual</em> <span class="math inline">\(i\)</span> <em>will experience the event time in period</em> <span class="math inline">\(j\)</span>, <em>given that he or she did not experience it in any earlier time period</em>. Because hazard represents the risk of the event occurrence in each discrete time period among those people eligible to experience the event (those in the risk set) hazard tells us precisely what we want to know: whether and when events occurs. (p.&nbsp;330, <em>emphasis</em> in the original)</p>
</blockquote>
<p>If we let <span class="math inline">\(T_i\)</span> stand for the discrete value in time person <span class="math inline">\(i\)</span> experiences the event, we can express the conditional probability the event might occur in the <span class="math inline">\(j^\text{th}\)</span> interval as</p>
<p><span class="math display">\[h(t_{ij}) = \Pr[T_i = j \mid T \geq j].\]</span></p>
<p>That last part, <span class="math inline">\(T \geq j\)</span>, clarifies the event can only occur once and, therefore, cannot have occurred in any of the prior levels of <span class="math inline">\(j\)</span>. More plainly put, imagine the event is death and person <span class="math inline">\(i\)</span> died during the period of <span class="math inline">\(T_j = 20\)</span>. In such a case, it’s nonsensical to speak of that <span class="math inline">\(i^\text{th}\)</span> person’s hazard for the period of <span class="math inline">\(T_j = 25\)</span>. They’re already dead.</p>
<p>Also, “the discrete-time hazard probabilities expressed as a function of time–labeled <span class="math inline">\(h(t_{ij})\)</span>–is known as the population <em>discrete-time hazard function</em>” (p 330, <em>emphasis</em> in the original). That was expressed in the 6<sup>th</sup> column in Table 10.1, which we called <code>hazard_fun</code> in our <code>d</code> tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, hazard_fun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
    year hazard_fun
   &lt;dbl&gt;      &lt;dbl&gt;
 1     0    NA     
 2     1     0.116 
 3     2     0.110 
 4     3     0.116 
 5     4     0.108 
 6     5     0.0891
 7     6     0.0825
 8     7     0.0601
 9     8     0.0481
10     9     0.0422
11    10     0.0369
12    11     0.0247
13    12     0.0128</code></pre>
</div>
</div>
<p>You might notice <span class="math inline">\(h(t_{ij})\)</span> is in a proportion metric and it is not cumulative. If you look above in the code, you’ll see we computed that by <code>hazard_fun = n_left / n_employed</code>. More formally and generally, this is an operationalization of</p>
<p><span class="math display">\[\hat h(t_{j}) = \frac{n \text{ events}_j}{n \text{ at risk}_j},\]</span></p>
<p>where <span class="math inline">\(n \text{ events}_j\)</span> is the number of individuals who experienced the event in the <span class="math inline">\(j^{th}\)</span> period and <span class="math inline">\(n \text{ at risk}_j\)</span> is the number within the period who have not (a) already experienced the event and (b) been censored. Also note that by <span class="math inline">\(\hat h(t_{j})\)</span>, we’re indicating we’re talking about the maximum likelihood estimate for <span class="math inline">\(h(t_{j})\)</span>. Because no one is at risk during the initial time point, <span class="math inline">\(h(t_0)\)</span> is undefined (i.e., <code>NA</code>). Here we mimic the top panel of Figure 10.1 and plot our <span class="math inline">\(\hat h(t_{j})\)</span> over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hazard_fun)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"years in teaching"</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">13</span>)) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="st">"estimated hazard probability, "</span><span class="sc">*</span><span class="fu">hat</span>(<span class="fu">italic</span>(h))(<span class="fu">italic</span>(t[j]))), </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<section id="survivor-function" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="survivor-function"><span class="header-section-number">10.2.1</span> Survivor function</h3>
<p>The survivor function provides another way of describing the distribution of event occurrence over time. Unlike the hazard function, which assesses the unique risk associated with each time period, the survivor function cumulates these period-by-period risks of event occurrence (or more properly, nonoccurrence) together to assess the probability that a randomly selected individual will survive will not experience the event.</p>
<p>We can formally define the survivor function, <span class="math inline">\(S(t_{ij})\)</span>, as</p>
<p><span class="math display">\[S(t_{ij}) = \Pr[T &gt; j],\]</span></p>
<p>where <span class="math inline">\(S\)</span> is survival as a function of time, <span class="math inline">\(t\)</span>. But since our data are finite, we can only have an estimate of the “true” survivor function, which we call <span class="math inline">\(\hat S(t_{ij})\)</span>. Here it is in a plot, our version of the bottom panel of Figure 10.1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> survivor_fun)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"years in teaching"</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">13</span>)) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="st">"estimated survival probability, "</span><span class="sc">*</span><span class="fu">hat</span>(<span class="fu">italic</span>(S))(<span class="fu">italic</span>(t[j]))),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-Median-lifetime" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="sec-Median-lifetime"><span class="header-section-number">10.2.2</span> Median lifetime</h3>
<blockquote class="blockquote">
<p>Having characterized the <em>distribution</em> of event times using the hazard and survivor functions, we often want to identify the distribution’s center. Were there no censoring, all event times would be known, and we could compute a sample mean. But because of censoring, another estimate of central tendency is preferred: the <em>median lifetime</em>.</p>
<p><em>The estimated median lifetime identifies that value for</em> <span class="math inline">\(T\)</span> <em>for which the value of the estimated survivor function is .5</em>. It is the point in time by which we estimate that half of the sample has experienced the target event, half has not. (p.&nbsp;337, <em>emphasis</em> in the original)</p>
</blockquote>
<p>If we use <code>filter()</code>, well see our median lifetime rests between years 6 and 7.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this just simplifies the output</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, time_int, survivor_fun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
   year time_int survivor_fun
  &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
1     6 [6, 7)          0.519
2     7 [7, 8)          0.488</code></pre>
</div>
</div>
<p>Using a simple descriptive approach, we’d just say the median lifetime was between years 6 and 7. We could also follow <span class="citation" data-cites="miller1981SurvivalAnalysis">Miller (<a href="references.html#ref-miller1981SurvivalAnalysis" role="doc-biblioref">1981</a>)</span> and linearly interpolate between the two values of <span class="math inline">\(S(t_j)\)</span> bracketing .5. If we let <span class="math inline">\(m\)</span> be the time interval just before the median lifetime, <span class="math inline">\(\hat S(t_m)\)</span> be the value of the survivor function in that <span class="math inline">\(m^\text{th}\)</span> interval, and <span class="math inline">\(\hat S(t_{m + 1})\)</span> be the survival value in the next interval, the can write</p>
<p><span class="math display">\[\text{Estimated median lifetime} = m + \Bigg [\frac{\hat S(t_m) - .5}{\hat S(t_m) - \hat S(t_{m + 1})} \Bigg ] \big ((m + 1) - m \big).\]</span></p>
<p>We can compute that by hand like so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>m        <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>m_plus_1 <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>stm <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> m) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survivor_fun)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>stm_plus_1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> m_plus_1) <span class="sc">%&gt;%</span> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survivor_fun)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the interpolated median lifetime and save it as `iml`</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>iml <span class="ot">&lt;-</span> m <span class="sc">+</span> ((stm <span class="sc">-</span> .<span class="dv">5</span>) <span class="sc">/</span> (stm <span class="sc">-</span> stm_plus_1)) <span class="sc">*</span> ((m <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">-</span> m)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>iml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.605691</code></pre>
</div>
</div>
<p>Now we have the <code>iml</code> value, we can add that information to our version of the lower panel of Figure 10.1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>line <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year         =</span> <span class="fu">c</span>(<span class="dv">0</span>, iml, iml),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">survivor_fun =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">0</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> survivor_fun)) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> line,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> iml, <span class="at">y =</span> <span class="fl">0.55</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"All teachers (6.6 years)"</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"years in teaching"</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">13</span>)) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="st">"estimated survival probability, "</span><span class="sc">*</span><span class="fu">hat</span>(<span class="fu">italic</span>(S))(<span class="fu">italic</span>(t[j]))),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>We can compute the estimates for the 5- and 10-year survival rates as a direct algebraic transformation of the survival function from those years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, survivor_fun) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">survival rate (%)</span><span class="st">`</span> <span class="ot">=</span> (<span class="dv">100</span> <span class="sc">*</span> survivor_fun) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
   year survivor_fun `survival rate (%)`
  &lt;dbl&gt;        &lt;dbl&gt;               &lt;dbl&gt;
1     5        0.566                  57
2    10        0.428                  43</code></pre>
</div>
</div>
</section>
</section>
<section id="developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="developing-intuition-about-hazard-functions-survivor-functions-and-median-lifetimes"><span class="header-section-number">10.3</span> Developing intuition about hazard functions, survivor functions, and median lifetimes</h2>
<blockquote class="blockquote">
<p>Developing intuition about these sample statistics requires exposure to estimates computed from a wide range of studies. To jump-start this process, we review results from four studies that differ across three salient dimensions–the type of event investigated, the metric used to record discrete time, and most important, the underlying profile of risk–and discuss how we would examine, and describe, the estimated hazard functions, survivor functions, and median lifetimes. (p.&nbsp;339)</p>
</blockquote>
<p>Here we load the four relevant data sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cocaine  <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/cocaine_relapse.csv"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sex      <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/firstsex.csv"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>suicide  <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/suicide.csv"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>congress <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/congress.csv"</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(cocaine)</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(sex)</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(suicide)</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(congress)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have a lot of leg work in front of use before we can recreate Figure 10.2. First, we’ll feed each of the four data sets into the <code>survfit()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cocaine,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(week, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sex,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(time, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> suicide,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(time, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">survfit</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> congress,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(time, <span class="dv">1</span> <span class="sc">-</span> censor) <span class="sc">~</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given the four fits all follow the same basic form and given our end point is to make the same basic plots for each, we can substantially streamline our code by making a series of custom functions. For our first custom function, <code>make_lt()</code>, we’ll save the general steps for making life tables for each data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>make_lt <span class="ot">&lt;-</span> <span class="cf">function</span>(fit) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange the lt data for all rows but the first</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  most_rows <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">time =</span> fit<span class="sc">$</span>time) <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_int =</span> <span class="fu">str_c</span>(<span class="st">"["</span>, time, <span class="st">", "</span>, time <span class="sc">+</span> <span class="dv">1</span>, <span class="st">")"</span>), </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_risk   =</span> fit<span class="sc">$</span>n.risk, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_event  =</span> fit<span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hazard_fun   =</span> n_event <span class="sc">/</span> n_risk,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">survivor_fun =</span> fit<span class="sc">$</span>surv)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the values for t = 2 and t = 1</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  time_1 <span class="ot">&lt;-</span> fit<span class="sc">$</span>time[<span class="dv">1</span>]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  time_0 <span class="ot">&lt;-</span> time_1 <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the values for the row for which t = 1</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  row_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">time         =</span> time_0, </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_int     =</span> <span class="fu">str_c</span>(<span class="st">"["</span>, time_0, <span class="st">", "</span>, time_1, <span class="st">")"</span>),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_risk       =</span> fit<span class="sc">$</span>n.risk[<span class="dv">1</span>],</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_event      =</span> <span class="cn">NA</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">hazard_fun   =</span> <span class="cn">NA</span>, </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">survivor_fun =</span> <span class="dv">1</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make the full life table</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(row_1, most_rows)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>make_lt()</code> to make the four life tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lt_cocaine  <span class="ot">&lt;-</span> <span class="fu">make_lt</span>(fit10<span class="fl">.2</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>lt_sex      <span class="ot">&lt;-</span> <span class="fu">make_lt</span>(fit10<span class="fl">.3</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>lt_suicide  <span class="ot">&lt;-</span> <span class="fu">make_lt</span>(fit10<span class="fl">.4</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>lt_congress <span class="ot">&lt;-</span> <span class="fu">make_lt</span>(fit10<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll note that the four survival-curve plots in Figure 10.2 all show the median lifetime using the interpolation method. Here we’ll save the necessary steps to compute that for each model as the <code>make_iml()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>make_iml <span class="ot">&lt;-</span> <span class="cf">function</span>(lt) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lt is a generic name for a life table of the </span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># kind we made with our `make_lt()` function</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># determine the mth row</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  lt_m <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(survivor_fun <span class="sc">&gt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="fu">n</span>())</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># determine the row for m + 1</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  lt_m1 <span class="ot">&lt;-</span> lt <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(survivor_fun <span class="sc">&lt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull the value for m</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  m  <span class="ot">&lt;-</span> <span class="fu">pull</span>(lt_m, time)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull the two survival function values</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  stm  <span class="ot">&lt;-</span> <span class="fu">pull</span>(lt_m, survivor_fun)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  stm1 <span class="ot">&lt;-</span> <span class="fu">pull</span>(lt_m1, survivor_fun)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plug the values into Equation 10.6 (page 338)</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  m <span class="sc">+</span> ((stm <span class="sc">-</span> .<span class="dv">5</span>) <span class="sc">/</span> (stm <span class="sc">-</span> stm1)) <span class="sc">*</span> ((m <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">-</span> m)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want, you can use <code>make_iml()</code> directly like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make_iml</span>(lt_cocaine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.5</code></pre>
</div>
</div>
<p>However, our approach will be to wrap it in another function, <code>line_tbl()</code>, with which we will save the coordinates necessary for marking off the median lifetimes and them save them in a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>line_tbl <span class="ot">&lt;-</span> <span class="cf">function</span>(lt) {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  iml <span class="ot">&lt;-</span> <span class="fu">make_iml</span>(lt)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">time         =</span> <span class="fu">c</span>(lt[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(), iml, iml),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">survivor_fun =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">0</span>))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It works like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">line_tbl</span>(lt_cocaine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   time survivor_fun
  &lt;dbl&gt;        &lt;dbl&gt;
1   0            0.5
2   7.5          0.5
3   7.5          0  </code></pre>
</div>
</div>
<p>If you look closely at the hazard function plots in the left column of Figure 10.2, you’ll note they share many common settings (e.g., the basic shape, the label of the <span class="math inline">\(y\)</span>-axis). But there are several parameters we’ll need to set custom settings for. To my eye, those are:</p>
<ul>
<li>the data;</li>
<li>the <span class="math inline">\(x\)</span>-axis label, break points, and limits; and</li>
<li>the <span class="math inline">\(y\)</span>-axis break points, and limits.</li>
</ul>
<p>With our custom <code>h_plot()</code> function, we’ll leave those parameters free while keeping all the other <strong>ggplot2</strong> parameters the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>h_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> data, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlab =</span> xlab, <span class="at">xbreaks =</span> xbreaks, <span class="at">xlimits =</span> xlimits,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ybreaks =</span> ybreaks, <span class="at">ylimits =</span> ylimits) {</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard_fun)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(xlab, <span class="at">breaks =</span> xbreaks, <span class="at">limits =</span> xlimits) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">h</span>(t)))), </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> ybreaks, <span class="at">limits =</span> ylimits) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’ll make a similar custom plotting function, <code>s_plot()</code>, for the hazard function plots on the right column of Figure 10.2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>s_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> data, <span class="at">xlab =</span> xlab, <span class="at">xbreaks =</span> xbreaks, <span class="at">xlimits =</span> xlimits) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the interpolated median life value</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  iml <span class="ot">&lt;-</span> <span class="fu">make_iml</span>(data)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make the imp line values</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  line <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">line_tbl</span>()</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survivor_fun)) <span class="sc">+</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> line,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> iml, <span class="at">y =</span> <span class="fl">0.6</span>,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">"widehat(ML)=="</span>, iml <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">1</span>)),</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(xlab, <span class="at">breaks =</span> xbreaks, <span class="at">limits =</span> xlimits) <span class="sc">+</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">widehat</span>(<span class="fu">italic</span>(<span class="fu">S</span>(t)))),</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we make the eight subplots in bulk, naming them <code>p1</code>, <code>p2</code>, and so on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cocaine</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> lt_cocaine <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h_plot</span>(<span class="at">xlab =</span> <span class="st">"Weeks after release"</span>, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ybreaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>), <span class="at">ylimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> lt_cocaine <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">s_plot</span>(<span class="at">xlab =</span> <span class="st">"Weeks after release"</span>, </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>))</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sex</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> lt_sex <span class="sc">%&gt;%</span> </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h_plot</span>(<span class="at">xlab =</span> <span class="st">"Grade"</span>, </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>),</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">ybreaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">/</span> <span class="dv">10</span>, <span class="at">ylimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.325</span>))</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> lt_sex <span class="sc">%&gt;%</span> </span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">s_plot</span>(<span class="at">xlab =</span> <span class="st">"Grade"</span>, </span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>))</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co"># suicide</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> lt_suicide <span class="sc">%&gt;%</span> </span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h_plot</span>(<span class="at">xlab =</span> <span class="st">"Age"</span>, </span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">22</span>),</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">ybreaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>), <span class="at">ylimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.16</span>))</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> lt_suicide <span class="sc">%&gt;%</span> </span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">s_plot</span>(<span class="at">xlab =</span> <span class="st">"Age"</span>, </span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">22</span>))</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="co"># congress</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> lt_congress <span class="sc">%&gt;%</span> </span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h_plot</span>(<span class="at">xlab =</span> <span class="st">"Terms in office"</span>, </span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>),</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">ybreaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">/</span> <span class="dv">10</span>, <span class="at">ylimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.3</span>))</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> lt_congress <span class="sc">%&gt;%</span> </span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">s_plot</span>(<span class="at">xlab =</span> <span class="st">"Terms in office"</span>, </span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">xbreaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">xlimits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’ll use some functions and syntax from the <strong>patchwork</strong> package to combine the subplots and make Figure 10.2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>p12 <span class="ot">&lt;-</span> (p1 <span class="sc">+</span> p2) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"A"</span>) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="fl">5.5</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>p34 <span class="ot">&lt;-</span> (p3 <span class="sc">+</span> p4) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"B"</span>) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="fl">5.5</span>))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>p56 <span class="ot">&lt;-</span> (p5 <span class="sc">+</span> p6) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"C"</span>) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="fl">5.5</span>))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>p78 <span class="ot">&lt;-</span> (p7 <span class="sc">+</span> p8) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"D"</span>) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="fl">5.5</span>))</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>(<span class="fu">wrap_elements</span>(p12) <span class="sc">/</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_elements</span>(p34) <span class="sc">/</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_elements</span>(p56) <span class="sc">/</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_elements</span>(p78))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Boom! Looks like a dream.</p>
<section id="identifying-periods-of-high-and-low-risk-using-hazard-functions" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="identifying-periods-of-high-and-low-risk-using-hazard-functions"><span class="header-section-number">10.3.1</span> Identifying periods of high and low risk using hazard functions</h3>
<p>It can be useful to evaluate hazard functions based on whether they are <em>monotonic</em> (i.e., have a single distinctive peak and single distinctive trough) and <em>nonmonotonic</em> (i.e., have multiple distinctive peaks or troughs). Globally speaking, the hazard functions for rows <code>A</code> and <code>B</code> are monotonic and the remaining two are nonmonotonic.</p>
<p>Singer and Willett remarked “monotonically increasing hazard functions are common when studying events that are ultimately inevitable (or near universal)…. [However,] nonmonotonic hazard functions, like those in Panels C and D, generally arise in studies of long duration” (p.&nbsp;342).</p>
<p>However, when risk is constant over time, hazard functions will not have peaks or troughs.</p>
</section>
<section id="survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="survivor-functions-as-a-context-for-evaluating-the-magnitude-of-hazard"><span class="header-section-number">10.3.2</span> Survivor functions as a context for evaluating the magnitude of hazard</h3>
<p>Unlike with hazard functions, all survivor functions decrease or stay constant over time. They are monotonic (i.e., they never switch direction, they never increase). From the text (p.&nbsp;344), we learn three ways hazard functions relate to survival functions:</p>
<ul>
<li><em>When hazard is high, the survivor function drops rapidly</em>.</li>
<li><em>When hazard is low, the survivor function drops slowly</em>.</li>
<li><em>When hazard is zero, the survivor function remains unchanged</em>.</li>
</ul>
</section>
<section id="strengths-and-limitations-of-estimated-median-lifetimes" class="level3" data-number="10.3.3">
<h3 data-number="10.3.3" class="anchored" data-anchor-id="strengths-and-limitations-of-estimated-median-lifetimes"><span class="header-section-number">10.3.3</span> Strengths and limitations of estimated median lifetimes</h3>
<blockquote class="blockquote">
<p>When examining a median lifetime, we find it helpful to remember three important limitations on its interpretation. First, it identifies only an “average” event time; it tells us little about the distribution of even times and is relatively insensitive to extreme values. Second, the median lifetime is not necessarily a moment when the target event is <em>especially</em> likely to occur…. Third, the median lifetime reveals little about the distribution of risk over time; identical median lifetimes can result from dramatically different survivor and hazard functions. (pp.&nbsp;345–346, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Without access to Singer and Willett’s hypothetical data, we’re not in a good position to recreate their Figure 10.3. Even the <a href="https://stats.idre.ucla.edu/r/examples/alda/r-applied-longitudinal-data-analysis-ch-10/">good folks at IDRE</a> gave up on that one.</p>
</section>
</section>
<section id="quantifying-the-effects-of-sampling-variation" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="quantifying-the-effects-of-sampling-variation"><span class="header-section-number">10.4</span> Quantifying the effects of sampling variation</h2>
<p>We can quantify the uncertainty in the estimates with standard errors.</p>
<section id="the-standard-error-of-the-estimated-hazard-probabilities" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="the-standard-error-of-the-estimated-hazard-probabilities"><span class="header-section-number">10.4.1</span> The standard error of the estimated hazard probabilities</h3>
<p>The formula for the frequentist standard errors for the hazard probabilities follows the form</p>
<p><span class="math display">\[se \left (\hat h(t_j) \right) = \sqrt{\frac{\hat h(t_j) \left (1 - \hat h(t_j) \right)}{n \text{ at risk}_j}}.\]</span></p>
<p>We can express that equation <strong>R</strong> code to recreate the first four columns of Table 10.2. We’ll be pulling much of the information from <code>fit10.1</code>. But to show our work within a tibble format, we’ll be adding a column after <span class="math inline">\(n_j\)</span>. Our additional <code>n_event</code> column will contain the information pulled from <code>fit10.1$n.event</code>, which we’ll use to compute the <span class="math inline">\(\hat h(t_j)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>se_h_hat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year    =</span> fit10<span class="fl">.1</span><span class="sc">$</span>time,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_j     =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_event =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h_hat =</span> n_event <span class="sc">/</span> n_j) <span class="sc">%&gt;%</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se_h_hat =</span> <span class="fu">sqrt</span>((h_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> h_hat)) <span class="sc">/</span> n_j))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>se_h_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 5
    year   n_j n_event  h_hat se_h_hat
   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1     1  3941     456 0.116   0.00510
 2     2  3485     384 0.110   0.00530
 3     3  3101     359 0.116   0.00575
 4     4  2742     295 0.108   0.00592
 5     5  2447     218 0.0891  0.00576
 6     6  2229     184 0.0825  0.00583
 7     7  2045     123 0.0601  0.00526
 8     8  1642      79 0.0481  0.00528
 9     9  1256      53 0.0422  0.00567
10    10   948      35 0.0369  0.00612
11    11   648      16 0.0247  0.00610
12    12   391       5 0.0128  0.00568</code></pre>
</div>
</div>
<p>As in the text, our standard errors are pretty small. To get a better sense, here they are in a rug plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>se_h_hat <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> se_h_hat)) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"in"</span>)) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(se)(<span class="fu">hat</span>(<span class="fu">italic</span>(h))(<span class="fu">italic</span>(t[j])))), </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.004</span>, <span class="fl">0.007</span>)) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Standard errors for discrete hazards probabilities share a property with those for other probabilities: they are less certain (i.e., larger) for probability values near .5 and increasingly certain (i.e., smaller) for probability values approaching 0 and 1. To give a sense of that, here are the corresponding <span class="math inline">\(se \big (\hat h(t_j) \big)\)</span> for a series of <span class="math inline">\(\hat h(t_j)\)</span> values ranging from 0 to 1, with <span class="math inline">\(n_j\)</span> held constant at 1,000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">n_j   =</span> <span class="dv">1000</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">h_hat =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se_h_hat =</span> <span class="fu">sqrt</span>((h_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> h_hat)) <span class="sc">/</span> n_j)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> h_hat, <span class="at">y =</span> se_h_hat)) <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(<span class="fu">italic</span>(h))(<span class="fu">italic</span>(t[j]))),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(se)(<span class="fu">hat</span>(<span class="fu">italic</span>(h))(<span class="fu">italic</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Also, as the size of the risk set, <span class="math inline">\(n_j\)</span>, influences the standard errors in the typical way. All things equal, a larger <span class="math inline">\(n\)</span> will make for a smaller <span class="math inline">\(se\)</span>. To give a sense, here’s the same basic plot from above, but this time with <span class="math inline">\(n_j = 100, 1{,}000, \text{ and } 10{,}000\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">n_j   =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>),</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">h_hat =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se_h_hat =</span> <span class="fu">sqrt</span>((h_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> h_hat)) <span class="sc">/</span> n_j),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_j      =</span> <span class="fu">str_c</span>(<span class="st">"italic(n[j])=="</span>, n_j)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> h_hat, <span class="at">y =</span> se_h_hat)) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(<span class="fu">italic</span>(h))(<span class="fu">italic</span>(t[j]))),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(se)(<span class="fu">hat</span>(<span class="fu">italic</span>(h))(<span class="fu">italic</span>(t[j]))))) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> n_j, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="standard-error-of-the-estimated-survival-probabilities" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="standard-error-of-the-estimated-survival-probabilities"><span class="header-section-number">10.4.2</span> Standard error of the estimated survival probabilities</h3>
<p>Computing the frequentist standard errors for estimated survival probabilities is more difficult because these are the products of (1 - hazard) for the current and all previous survival probabilities. Computing them is such a pain, Singer and Willett recommend you rely on Greenwood’s <span class="citation" data-cites="greenwood1926NaturalDuration">(<a href="references.html#ref-greenwood1926NaturalDuration" role="doc-biblioref">1926</a>)</span> approximation. This follows the form</p>
<p><span class="math display">\[se \big (\hat S(t_j) \big) = \hat S(t_j)  \sqrt{\frac{\hat h(t_1)}{n_1 \big (1 - \hat h(t_1) \big)} + \frac{\hat h(t_2)}{n_2 \big (1 - \hat h(t_2) \big)} + \cdots + \frac{\hat h(t_j)}{n_j \big (1 - \hat h(t_j) \big)}}.\]</span></p>
<p>Here we put the formula to work and finish our version of Table 10.2. For the sake of sanity, we’re simply calling our “Term under the square root sign” column <code>term</code>. Note our use of the <code>cumsum()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># suspend scientific notation</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">year    =</span> fit10<span class="fl">.1</span><span class="sc">$</span>time,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">n_j     =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">n_event =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h_hat =</span> n_event <span class="sc">/</span> n_j) <span class="sc">%&gt;%</span> </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se_h_hat =</span> <span class="fu">sqrt</span>((h_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> h_hat)) <span class="sc">/</span> n_j),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">s_hat    =</span> fit10<span class="fl">.1</span><span class="sc">$</span>surv,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">term     =</span> <span class="fu">cumsum</span>(h_hat <span class="sc">/</span> (n_j <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> h_hat)))) <span class="sc">%&gt;%</span> </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se_s_hat =</span> s_hat <span class="sc">*</span> <span class="fu">sqrt</span>(term),</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">std.err  =</span> fit10<span class="fl">.1</span><span class="sc">$</span>std.err)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 9
    year   n_j n_event  h_hat se_h_hat s_hat      term se_s_hat std.err
   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1     1  3941     456 0.116   0.00510 0.884 0.0000332  0.00510 0.00576
 2     2  3485     384 0.110   0.00530 0.787 0.0000687  0.00652 0.00829
 3     3  3101     359 0.116   0.00575 0.696 0.000111   0.00733 0.0105 
 4     4  2742     295 0.108   0.00592 0.621 0.000155   0.00773 0.0124 
 5     5  2447     218 0.0891  0.00576 0.566 0.000195   0.00790 0.0140 
 6     6  2229     184 0.0825  0.00583 0.519 0.000235   0.00796 0.0153 
 7     7  2045     123 0.0601  0.00526 0.488 0.000267   0.00796 0.0163 
 8     8  1642      79 0.0481  0.00528 0.464 0.000297   0.00800 0.0172 
 9     9  1256      53 0.0422  0.00567 0.445 0.000332   0.00811 0.0182 
10    10   948      35 0.0369  0.00612 0.428 0.000373   0.00827 0.0193 
11    11   648      16 0.0247  0.00610 0.418 0.000412   0.00848 0.0203 
12    12   391       5 0.0128  0.00568 0.412 0.000445   0.00870 0.0211 </code></pre>
</div>
</div>
<p>For comparisson, we also added the <span class="math inline">\(se \big (\hat S(t_j) \big)\)</span> values coputed by the <strong>survivor</strong> package in the final column, <code>std.err</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">year    =</span> fit10<span class="fl">.1</span><span class="sc">$</span>time,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">n_j     =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">n_event =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.event) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h_hat =</span> n_event <span class="sc">/</span> n_j) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se_h_hat =</span> <span class="fu">sqrt</span>((h_hat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> h_hat)) <span class="sc">/</span> n_j),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">s_hat    =</span> fit10<span class="fl">.1</span><span class="sc">$</span>surv,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">term     =</span> <span class="fu">cumsum</span>(h_hat <span class="sc">/</span> (n_j <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> h_hat)))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Greenwood =</span> s_hat <span class="sc">*</span> <span class="fu">sqrt</span>(term),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">survival package</span><span class="st">`</span>  <span class="ot">=</span> fit10<span class="fl">.1</span><span class="sc">$</span>std.err) <span class="sc">%&gt;%</span> </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Greenwood<span class="sc">:</span><span class="st">`</span><span class="at">survival package</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"survival package"</span>, <span class="st">"Greenwood"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.55</span>) <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(se)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.025</span>)) <span class="sc">+</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey92"</span>),</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.9</span>),</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>It’s out of my expertise to comment on which should we should trust more. But Singer and Willett did note that “as an approximation, Greenwood’s formula is accurate only asymptotically” (p.&nbsp;351).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># turn scientific notation back on (R default)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="a-simple-and-useful-strategy-for-constructing-the-life-table" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="a-simple-and-useful-strategy-for-constructing-the-life-table"><span class="header-section-number">10.5</span> A simple and useful strategy for constructing the life table</h2>
<blockquote class="blockquote">
<p>How can you construct a life table for <em>your</em> data set? For preliminary analyses, it is easy to use the prepackaged routines available in the major statistical packages. If you choose this approach, be sure to check whether your package allows you to: (1) select the partition of time; and (2) ignore any actuarial corrections invoked due to continuous-time assumptions (that do not hold in discrete time). When event times have been measured using a discrete-time scale, actuarial corrections (discussed in chapter13) are inappropriate. Although most packages clearly document the algorithm being used, we suggest that you double-check by comparing results with one or two estimates computed by hand. (p.&nbsp;351, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For more information about the methods we’ve been using via the <strong>survival</strong> package, browse through the documentation listed on the CRAN page, <a href="https://CRAN.R-project.org/package=survival">https://CRAN.R-project.org/package=survival</a>, with a particular emphasis on the <a href="https://CRAN.R-project.org/package=survival/survival.pdf">reference manual</a> and <a href="https://CRAN.R-project.org/package=survival/vignettes/survival.pdf"><em>A package for survival analysis in R</em></a> <span class="citation" data-cites="therneau2021Package4Survival">(<a href="references.html#ref-therneau2021Package4Survival" role="doc-biblioref">Terry M. Therneau, 2021c</a>)</span>. But back to the text:</p>
<blockquote class="blockquote">
<p>Despite the simplicity of preprogrammed algorithms, [Singer and Willett] prefer an alternative approach for life table construction. This approach requires construction of a person-period data set, much like the period-period data set used for growth modeling. Once you create the person-period data set, you can compute descriptive statistics sing any standard cross-tabulation routine. (p.&nbsp;351)</p>
</blockquote>
<section id="the-person-period-data-set" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="the-person-period-data-set"><span class="header-section-number">10.5.1</span> The person-period data set</h3>
<p>Here is the person-level data set displayed in Figure 10.4; it’s just a subset of the <code>teachers</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>teachers <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">126</span>, <span class="dv">129</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
     id     t censor
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1    20     3      0
2   126    12      0
3   129    12      1</code></pre>
</div>
</div>
<p>You can transform the person-level survival data set into the person-period variant shown on the right panel of Figure 10.4 with a workflow like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>teachers_pp <span class="ot">&lt;-</span> teachers <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(<span class="at">weights =</span> t) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="fu">if_else</span>(period <span class="sc">==</span> <span class="fu">max</span>(period) <span class="sc">&amp;</span> censor <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>censor) <span class="sc">%&gt;%</span> </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>teachers_pp <span class="sc">%&gt;%</span> </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">126</span>, <span class="dv">129</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 3
      id period event
   &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
 1    20      1     0
 2    20      2     0
 3    20      3     1
 4   126      1     0
 5   126      2     0
 6   126      3     0
 7   126      4     0
 8   126      5     0
 9   126      6     0
10   126      7     0
# ℹ 17 more rows</code></pre>
</div>
</div>
<p>You don’t necessarily need to use <code>ungroup()</code> at the end, but it’s probably a good idea. Anyway, note how the information previously contained in the <code>censor</code> column has been transformed to the <code>event</code> column, which is coded 0 = no event, 1 = event. With this coding, we know a participant has been censored when <code>event == 0</code> on their <code>max(period)</code> row.</p>
<p>We can count the number of teachers in the sample like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>teachers <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  3941</code></pre>
</div>
</div>
<p>To get a sense of the difference in the data structures, here are the number of rows for the original person-level <code>teachers</code> data and for our person-period transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># person-level</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>teachers <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  3941</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># person-period</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>teachers_pp <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1 24875</code></pre>
</div>
</div>
<p>Here is the breakdown of the number of rows in the person-period <code>teachers</code> data for which <code>event == 1</code> or <code>event == 0</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>teachers_pp <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  event     n
  &lt;dbl&gt; &lt;int&gt;
1     0 22668
2     1  2207</code></pre>
</div>
</div>
</section>
<section id="using-the-person-period-data-set-to-construct-the-life-table" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="using-the-person-period-data-set-to-construct-the-life-table"><span class="header-section-number">10.5.2</span> Using the person-period data set to construct the life table</h3>
<p>“All the life table’s essential elements can be computed through cross-tabulation of <em>PERIOD</em> and <em>EVENT</em> in the person-period data set” (p.&nbsp;354, <em>emphasis</em> in the original). Here’s how we might use the <strong>tidyverse</strong> do that with <code>teachers_pp</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>teachers_lt <span class="ot">&lt;-</span> teachers_pp <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># change the coding for `event` in anticipation of the final format</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="fu">str_c</span>(<span class="st">"event = "</span>, event)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period) <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(event) <span class="sc">%&gt;%</span> </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> event,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="st">`</span><span class="at">event = 0</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">event = 1</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_e_1 =</span> (<span class="st">`</span><span class="at">event = 1</span><span class="st">`</span> <span class="sc">/</span> total) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">4</span>))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>teachers_lt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 5
   period `event = 0` `event = 1` total prop_e_1
    &lt;int&gt;       &lt;int&gt;       &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;
 1      1        3485         456  3941   0.116 
 2      2        3101         384  3485   0.110 
 3      3        2742         359  3101   0.116 
 4      4        2447         295  2742   0.108 
 5      5        2229         218  2447   0.0891
 6      6        2045         184  2229   0.0825
 7      7        1922         123  2045   0.0601
 8      8        1563          79  1642   0.0481
 9      9        1203          53  1256   0.0422
10     10         913          35   948   0.0369
11     11         632          16   648   0.0247
12     12         386           5   391   0.0128</code></pre>
</div>
</div>
<p>Here are the totals Singer and Willett displayed in the bottom row.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>teachers_lt <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="st">`</span><span class="at">event = 0</span><span class="st">`</span><span class="sc">:</span>total) <span class="sc">%&gt;%</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  `event = 0` `event = 1` total
        &lt;int&gt;       &lt;int&gt; &lt;int&gt;
1       22668        2207 24875</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The ability to construct a life table using the person-period data set provides a simple strategy for conducting the descriptive analyses outlined in this chapter. This strategy yields appropriate statistics regardless of the amount, or pattern, of censoring. Perhaps even more important, the person-period data set is the fundamental tool for fitting discrete-time hazard models to data, using methods that we describe in the next chapter. (p.&nbsp;356)</p>
</blockquote>
</section>
</section>
<section id="bonus-fit-the-discrete-time-hazard-models-with-brms" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="bonus-fit-the-discrete-time-hazard-models-with-brms"><span class="header-section-number">10.6</span> Bonus: Fit the discrete-time hazard models with <strong>brms</strong></h2>
<p>The frequentists aren’t the only ones who can discrete-time hazard models. Bayesians can get in on the fun, too. The first step is to decide on an appropriate likelihood function. Why? Because Bayes’ formula requires that we define the likelihood and the priors. As all the parameters in the model are seen through the lens of the likelihood, it’s important we consider it with care.</p>
<p>Happily, the exercises in the last section did a great job preparing us for the task. In Table 10.3, Singer and Willett hand computed the discrete hazards (i.e., the values in the “Proportion <em>EVENT</em> = 1” column) by dividing the valued in the “<em>EVENT</em> = 1” column by those in the “Total” column. Discrete hazards are proportions. Proportions have two important characteristics; they are continuous and necessarily range between 0 and 1. You know what else has those characteristics? Probabilities.</p>
<p>So far in this text, we have primarily focused on models using the Gaussian likelihood. Though it’s a workhorse, the Gaussian is inappropriate for modeling proportions/probabilities. Good old Gauss is great at modeling unbounded continuous data, but it can fail miserably when working with bounded data and our proportions/probabilities are most certainly bounded. The binomial likelihood, however, is well-suited for handling probabilities. Imagine you have data that can take on values of 0 and 1, such as failures/successes, no’s/yesses, fails/passes, and no-events/events. If you sum up all the 1’s and divide them by the total cases, you get a proportion/probability. The simple binomial model takes just that kind of data–the number of 1’s and the number of total cases. The formula for the binomial likelihood is</p>
<p><span class="math display">\[\Pr (z \mid n, p) = \frac{n!}{z!(n - z)!} p^z (1 - p)^{n - z},\]</span></p>
<p>where <span class="math inline">\(z\)</span> is the number of cases for which the value is 1, <span class="math inline">\(n\)</span> is the total number of cases, and <span class="math inline">\(p\)</span> is the probability of a 1 across cases. As the data provide us with <span class="math inline">\(z\)</span> and <span class="math inline">\(n\)</span>, we end up estimating <span class="math inline">\(p\)</span>. If we’re willing to use what’s called a <em>link function</em>, we can estimate <span class="math inline">\(p\)</span> with a linear model with any number of predictors. When fitting binomial regression models, you can take your choice among several link functions, the most popular of which is the logit. This will be our approach. As you may have guesses, using the logit link to fit a binomial model is often termed <em>logistic regression</em>. Welcome to the generalized linear model.</p>
<p>Let’s fire up <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we fit the model, it will make our lives easier if we redefine <code>period</code> as a factor and rename our <code>event = 1</code> column as <code>event</code>. We defined <code>period</code> as a factor because we want to fit a model with discrete time. Renaming <code>event = 1</code> column as <code>event</code> just makes it easier on the <code>brm()</code> function to read the variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>teachers_lt <span class="ot">&lt;-</span> teachers_lt <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">factor</span>(period),</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">event  =</span> <span class="st">`</span><span class="at">event = 1</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this formulation, <code>event</code> is our <span class="math inline">\(z\)</span> term and <code>total</code> is our <span class="math inline">\(n\)</span> term. We’re estimating <span class="math inline">\(p\)</span>. Behold the mode syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>fit10<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> teachers_lt,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  event <span class="sc">|</span> <span class="fu">trials</span>(total) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> period,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">class =</span> b),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">1</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">10</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/fit10.06"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit10<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: event | trials(total) ~ 0 + period 
   Data: teachers_lt (Number of observations: 12) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
period1     -2.03      0.05    -2.13    -1.94 1.00     8232     2802
period2     -2.09      0.06    -2.20    -1.98 1.00     9299     2913
period3     -2.03      0.06    -2.15    -1.93 1.00     9240     3350
period4     -2.12      0.06    -2.24    -1.99 1.00     9405     2531
period5     -2.32      0.07    -2.46    -2.19 1.00     8022     3216
period6     -2.41      0.08    -2.57    -2.26 1.00     8555     3045
period7     -2.75      0.09    -2.94    -2.57 1.00     8481     3040
period8     -2.99      0.12    -3.22    -2.77 1.00     8966     2761
period9     -3.13      0.14    -3.40    -2.86 1.00     7762     3253
period10    -3.27      0.18    -3.62    -2.94 1.00     8575     2718
period11    -3.69      0.26    -4.22    -3.23 1.00     9301     2599
period12    -4.38      0.45    -5.37    -3.59 1.00     9029     3007

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Because we used the <code>0 + Intercept</code> syntax in the presence of a factor predictor, <code>period</code>, we suppressed the default intercept. Instead, we have separate “intercepts” for each of the 12 levels <code>period</code>. Because we used the conventional logit link, the parameters are all on the log-odds scale. Happily, we can use the <code>plogis()</code> function to convert them back into the probability metric. Here’s a quick and dirty conversion using the output from <code>fixef()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(fit10<span class="fl">.6</span>) <span class="sc">%&gt;%</span> <span class="fu">plogis</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Estimate Est.Error        Q2.5      Q97.5
period1  0.11567890 0.5123075 0.105988479 0.12576996
period2  0.11018973 0.5138348 0.099876961 0.12118738
period3  0.11566288 0.5142310 0.104437289 0.12723862
period4  0.10758428 0.5154676 0.096217529 0.11983230
period5  0.08908959 0.5172146 0.078527309 0.10050792
period6  0.08237622 0.5198561 0.071012977 0.09471206
period7  0.05997496 0.5237001 0.050374975 0.07100347
period8  0.04802106 0.5290276 0.038328790 0.05916089
period9  0.04200683 0.5343985 0.032231454 0.05404363
period10 0.03673341 0.5439678 0.025979648 0.05035764
period11 0.02429261 0.5635033 0.014530393 0.03822677
period12 0.01231631 0.6112087 0.004651289 0.02696934</code></pre>
</div>
</div>
<p>Compare these <code>Estimate</code> values with the values in the “Estimated hazard probability” column from Table 10.2 in the text (p.&nbsp;349). They are very close. We can go further and look at these hazard estimates in a plot. We’ll use the <code>tidybayes::stat_lineribbon()</code> function to plot their posterior means atop their 50% and 95% intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit10<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"b_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(plogis) <span class="sc">%&gt;%</span> </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"period"</span>,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"hazard"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> period <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> hazard)) <span class="sc">+</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.95</span>), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the hazard estimates from `survival::survfit()`</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">period =</span> fit10<span class="fl">.1</span><span class="sc">$</span>time,</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">hazard =</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.event <span class="sc">/</span> fit10<span class="fl">.1</span><span class="sc">$</span>n.risk),</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> hazard),</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"violetred1"</span>) <span class="sc">+</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"CI"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"grey75"</span>, <span class="st">"grey60"</span>)) <span class="sc">+</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey92"</span>),</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.925</span>, <span class="fl">0.825</span>),</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>For comparison sake, those violet dots in the foreground are the hazard estimates from the frequentist <code>survival::survfit()</code> function. Turns out our Bayesian results are very similar to the frequentist ones. Hopefully this isn’t a surprise. There was a lot of data and we used fairly weak priors. For simple models under those conditions, frequentist and Bayesian results should be pretty close.</p>
<p>Remember that <span class="math inline">\(se \big (\hat h(t_j) \big)\)</span> formula from back in section 10.4.1? That doesn’t quite apply to the posterior standard deviations from our Bayesian model. Even so, our posterior <span class="math inline">\(\textit{SD}\)</span>s will be very similar to the ML standard errors. Let’s compare those in a plot, too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit10<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"b_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(plogis) <span class="sc">%&gt;%</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"period"</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"hazard"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> period <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period) <span class="sc">%&gt;%</span> </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(hazard)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(se_h_hat <span class="sc">%&gt;%</span> <span class="fu">select</span>(se_h_hat)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>period) <span class="sc">%&gt;%</span> </span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"sd"</span>, <span class="st">"se_h_hat"</span>),</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bayesian"</span>, <span class="st">"ML"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="cn">NULL</span>, <span class="at">option =</span> <span class="st">"A"</span>, <span class="at">end =</span> <span class="fl">0.55</span>) <span class="sc">+</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(se)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>)) <span class="sc">+</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey92"</span>),</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.09</span>, <span class="fl">0.9</span>),</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Man those are close.</p>
<p>We can also use our <strong>brms</strong> output to depict the survivor function. On page 337 in the text (Equation 10.5), Singer and Willett demonstrated how to define the survivor function in terms of the hazard function. It follows the form</p>
<p><span class="math display">\[\hat S (t_j) = [1 - \hat h (t_j)][1 - \hat h (t_{j - 1})][1 - \hat h (t_{j - 2})] \dots [1 - \hat h (t_1)].\]</span></p>
<p>In words, “each year’s estimated survival probability is the successive product of the complement of the estimated hazard function probabilities across <em>this</em> and <em>all previous</em> years” (p.&nbsp;337, <em>emphasis</em> in the original). Here’s how you might do that with the output from <code>as_draws_df()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit10<span class="fl">.6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"b_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform the hazards from the log-odds metric to probabilities</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(plogis) <span class="sc">%&gt;%</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">"h"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take the "complement" of each hazard</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="dv">1</span> <span class="sc">-</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># apply Equation 10.5</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">s0  =</span> <span class="dv">1</span>, </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">s1  =</span> h1, </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">s2  =</span> h1 <span class="sc">*</span> h2, </span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">s3  =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3, </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">s4  =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4, </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">s5  =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5, </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">s6  =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5 <span class="sc">*</span> h6, </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">s7  =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5 <span class="sc">*</span> h6 <span class="sc">*</span> h7, </span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">s8  =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5 <span class="sc">*</span> h6 <span class="sc">*</span> h7 <span class="sc">*</span> h8, </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">s9  =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5 <span class="sc">*</span> h6 <span class="sc">*</span> h7 <span class="sc">*</span> h8 <span class="sc">*</span> h9, </span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">s10 =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5 <span class="sc">*</span> h6 <span class="sc">*</span> h7 <span class="sc">*</span> h8 <span class="sc">*</span> h9 <span class="sc">*</span> h10, </span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">s11 =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5 <span class="sc">*</span> h6 <span class="sc">*</span> h7 <span class="sc">*</span> h8 <span class="sc">*</span> h9 <span class="sc">*</span> h10 <span class="sc">*</span> h11, </span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">s12 =</span> h1 <span class="sc">*</span> h2 <span class="sc">*</span> h3 <span class="sc">*</span> h4 <span class="sc">*</span> h5 <span class="sc">*</span> h6 <span class="sc">*</span> h7 <span class="sc">*</span> h8 <span class="sc">*</span> h9 <span class="sc">*</span> h10 <span class="sc">*</span> h11 <span class="sc">*</span> h12)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(draws)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,000
Columns: 13
$ s0  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ s1  &lt;dbl&gt; 0.8882725, 0.8841842, 0.8870165, 0.8906272, 0.8801260, 0.8808762, 0.8877767, 0.8809166, 0.8876376, 0.8810157, 0.8888…
$ s2  &lt;dbl&gt; 0.7995095, 0.7774375, 0.7912860, 0.7868829, 0.7908395, 0.7832934, 0.7903921, 0.7841811, 0.7899500, 0.7838445, 0.7896…
$ s3  &lt;dbl&gt; 0.7028917, 0.6808228, 0.7015976, 0.6929662, 0.7017946, 0.6869828, 0.7084219, 0.6943937, 0.6949710, 0.6913329, 0.6993…
$ s4  &lt;dbl&gt; 0.6213355, 0.6097996, 0.6252030, 0.6174389, 0.6270114, 0.6093450, 0.6338153, 0.6189226, 0.6220228, 0.6166871, 0.6242…
$ s5  &lt;dbl&gt; 0.5610498, 0.5585496, 0.5724598, 0.5556052, 0.5765991, 0.5591931, 0.5739501, 0.5614475, 0.5688041, 0.5591788, 0.5701…
$ s6  &lt;dbl&gt; 0.5138439, 0.5084096, 0.5309647, 0.5129127, 0.5250917, 0.5137151, 0.5248989, 0.5104266, 0.5270480, 0.5091437, 0.5273…
$ s7  &lt;dbl&gt; 0.4816660, 0.4780778, 0.4981472, 0.4848866, 0.4926044, 0.4857342, 0.4901806, 0.4768854, 0.4980448, 0.4760355, 0.4978…
$ s8  &lt;dbl&gt; 0.4627847, 0.4513930, 0.4807182, 0.4594040, 0.4705295, 0.4622705, 0.4658327, 0.4520261, 0.4762691, 0.4511294, 0.4757…
$ s9  &lt;dbl&gt; 0.4434304, 0.4293679, 0.4605806, 0.4387918, 0.4521570, 0.4401244, 0.4495158, 0.4296258, 0.4589467, 0.4296229, 0.4582…
$ s10 &lt;dbl&gt; 0.4299888, 0.4165077, 0.4411670, 0.4245981, 0.4335712, 0.4265166, 0.4325786, 0.4127737, 0.4410256, 0.4138769, 0.4418…
$ s11 &lt;dbl&gt; 0.4192832, 0.4051306, 0.4302408, 0.4135297, 0.4234692, 0.4144529, 0.4225917, 0.4016406, 0.4303435, 0.4033449, 0.4312…
$ s12 &lt;dbl&gt; 0.4158431, 0.3967256, 0.4257802, 0.4102225, 0.4161995, 0.4122905, 0.4127486, 0.3958909, 0.4265116, 0.3970272, 0.4270…</code></pre>
</div>
</div>
<p>We’ll learn how to simplify that syntax with help from the <code>cumprod()</code> function in the next chapter. Now we have our survival estimates, we can make our Bayesian version of the lower panel of Figure 10.1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this will help us depict the median lifetime</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>line <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">period   =</span> <span class="fu">c</span>(<span class="dv">0</span>, iml, iml),</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">survival =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">0</span>))</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"survival"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">str_remove</span>(name, <span class="st">"s"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> survival)) <span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> line,</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">fill =</span> <span class="st">"grey75"</span>) <span class="sc">+</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the survival estimates from `survival::survfit()`</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">period   =</span> fit10<span class="fl">.1</span><span class="sc">$</span>time,</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">survival =</span> fit10<span class="fl">.1</span><span class="sc">$</span>surv),</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"violetred1"</span>) <span class="sc">+</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"years in teaching"</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">13</span>)) <span class="sc">+</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="st">"estimated survival probability, "</span><span class="sc">*</span><span class="fu">hat</span>(<span class="fu">italic</span>(S))(<span class="fu">italic</span>(t[j]))),</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="10_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Like we did with our hazard plot above, we superimposed the frequentist estimates as violet dots atop the Bayesian posterior means and intervals. Because of how narrow the posteriors were, we only showed the 95% intervals, here. As with the hazard estimates, our Bayesian survival estimates are very close to the ones we computed with ML.</p>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">Session info</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Ventura 13.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] tidybayes_3.0.7 brms_2.23.0     Rcpp_1.1.0      patchwork_1.3.2 survival_3.8-3  lubridate_1.9.4 forcats_1.0.1  
 [8] stringr_1.6.0   dplyr_1.1.4     purrr_1.2.1     readr_2.1.5     tidyr_1.3.2     tibble_3.3.1    ggplot2_4.0.1  
[15] tidyverse_2.0.0

loaded via a namespace (and not attached):
 [1] svUnit_1.0.8            tidyselect_1.2.1        viridisLite_0.4.2       farver_2.1.2            loo_2.9.0.9000         
 [6] S7_0.2.1                fastmap_1.2.0           TH.data_1.1-4           tensorA_0.36.2.1        digest_0.6.39          
[11] timechange_0.3.0        estimability_1.5.1      lifecycle_1.0.5         StanHeaders_2.36.0.9000 magrittr_2.0.4         
[16] posterior_1.6.1.9000    compiler_4.5.1          rlang_1.1.7             tools_4.5.1             utf8_1.2.6             
[21] knitr_1.51              labeling_0.4.3          bridgesampling_1.2-1    htmlwidgets_1.6.4       curl_7.0.0             
[26] bit_4.6.0               pkgbuild_1.4.8          plyr_1.8.9              RColorBrewer_1.1-3      abind_1.4-8            
[31] multcomp_1.4-29         withr_3.0.2             grid_4.5.1              stats4_4.5.1            xtable_1.8-4           
[36] inline_0.3.21           emmeans_1.11.2-8        scales_1.4.0            MASS_7.3-65             cli_3.6.5              
[41] mvtnorm_1.3-3           rmarkdown_2.30          crayon_1.5.3            generics_0.1.4          RcppParallel_5.1.11-1  
[46] rstudioapi_0.17.1       reshape2_1.4.5          tzdb_0.5.0              rstan_2.36.0.9000       splines_4.5.1          
[51] bayesplot_1.15.0.9000   parallel_4.5.1          matrixStats_1.5.0       vctrs_0.6.5             V8_8.0.1               
[56] Matrix_1.7-3            sandwich_3.1-1          jsonlite_2.0.0          arrayhelpers_1.1-0      hms_1.1.4              
[61] bit64_4.6.0-1           ggdist_3.3.3            glue_1.8.0              codetools_0.2-20        distributional_0.5.0   
[66] stringi_1.8.7           gtable_0.3.6            QuickJSR_1.8.1          pillar_1.11.1           htmltools_0.5.9        
[71] Brobdingnag_1.2-9       R6_2.6.1                vroom_1.6.6             evaluate_1.0.5          lattice_0.22-7         
[76] backports_1.5.0         rstantools_2.5.0.9000   gridExtra_2.3           coda_0.19-4.1           nlme_3.1-168           
[81] checkmate_2.3.3         xfun_0.55               zoo_1.8-14              pkgconfig_2.0.3        </code></pre>
</div>
</div>
</section>
<section id="comments" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="comments">Comments</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-greenwood1926NaturalDuration" class="csl-entry" role="listitem">
Greenwood, M. (1926). The natural duration of cancer. <em>Reports on Public Health and Medical Subjects</em>, <em>33</em>, 1–26.
</div>
<div id="ref-miller1981SurvivalAnalysis" class="csl-entry" role="listitem">
Miller, R. G. (1981). <em>Survival analysis</em>. John Wiley &amp; Sons.
</div>
<div id="ref-singerAppliedLongitudinalData2003" class="csl-entry" role="listitem">
Singer, J. D., &amp; Willett, J. B. (2003). <em>Applied longitudinal data analysis: <span>Modeling</span> change and event occurrence</em>. Oxford University Press, USA. <a href="https://oxford.universitypressscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968">https://oxford.universitypressscholarship.com/view/10.1093/acprof:oso/9780195152968.001.0001/acprof-9780195152968</a>
</div>
<div id="ref-survival2021RM" class="csl-entry" role="listitem">
Therneau, Terry M. (2021a). <em><span class="nocase">survival</span> reference manual, <span>Version</span> 3.2-10</em>. <a href="https://CRAN.R-project.org/package=survival/survival.pdf">https://CRAN.R-project.org/package=survival/survival.pdf</a>
</div>
<div id="ref-R-survival" class="csl-entry" role="listitem">
Therneau, Terry M. (2021b). <em><span class="nocase">survival</span>: <span>Survival</span> analysis</em> [Manual]. <a href="https://github.com/therneau/survival">https://github.com/therneau/survival</a>
</div>
<div id="ref-therneau2021Package4Survival" class="csl-entry" role="listitem">
Therneau, Terry M. (2021c). <em>A package for survival analysis in <span>R</span></em>. <a href="https://CRAN.R-project.org/package=survival/vignettes/survival.pdf">https://CRAN.R-project.org/package=survival/vignettes/survival.pdf</a>
</div>
<div id="ref-therneau2000ModelingSurvivalData" class="csl-entry" role="listitem">
Therneau, Terry M., &amp; Grambsch, P. M. (2000). <em>Modeling survival data: <span>Extending</span> the <span>Cox</span> model</em>. Springer. <a href="https://link.springer.com/book/10.1007/978-1-4757-3294-8">https://link.springer.com/book/10.1007/978-1-4757-3294-8</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/solomon\.quarto\.pub\/alda\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse";
    script.dataset.repoId = "";
    script.dataset.category = "General";
    script.dataset.categoryId = "";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./09.html" class="pagination-link" aria-label="A Framework for Investigating Event Occurrence">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">A Framework for Investigating Event Occurrence</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11.html" class="pagination-link" aria-label="Fitting Basic Discrete-Time Hazard Models">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fitting Basic Discrete-Time Hazard Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ASKurz/Applied-Longitudinal-Data-Analysis-with-brms-and-the-tidyverse/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>